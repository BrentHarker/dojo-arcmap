//>>built
define(["require","exports"],function(B,r){function u(a,d,b,c){return void 0!==a.fmin&&(a.min=a.fmin),void 0!==a.fmax&&(a.max=a.fmax),"0"!==a.min&&b.length<Number(a.min)?-2:"*"!==a.max&&b.length>Number(a.max)?-2:1}function v(a,d,b){if(null!==b.localScope&&void 0!==b.localScope[a.toLowerCase()]){var c=b.localScope[a.toLowerCase()];if("FormulaFunction"===c.type||"any"===c.type)return void 0===c.signature&&(c.signature={min:"0",max:"*"}),u(c.signature,a,d,b)}return void 0!==b.globalScope[a.toLowerCase()]&&
(c=b.globalScope[a.toLowerCase()],"FormulaFunction"===c.type||"any"===c.type)?(void 0===c.signature&&(c.signature={min:"0",max:"*"}),u(c.signature,a,d,b)):-1}function l(a,d){void 0===d&&(d=!0);var b=f(a,"SYNTAX","UNREOGNISED");try{switch(a.type){case "VariableDeclarator":return null!==a.init&&"FunctionExpression"===a.init.type?f(a,"SYNTAX","FUNCTIONVARIABLEDECLARATOR"):"Identifier"!==a.id.type?f(a,"SYNTAX","VARIABLEMUSTHAVEIDENTIFIER"):null!==a.init?l(a.init,!1):"";case "VariableDeclaration":for(var c=
0;c<a.declarations.length;c++)if(b=l(a.declarations[c],d),""!==b)return b;return"";case "ForInStatement":if(b=l(a.left,d),""!==b)break;if("VariableDeclaration"===a.left.type){if(1<a.left.declarations.length)return f(a,"SYNTAX","ONLY1VAR");if(null!==a.left.declarations[0].init)return f(a,"SYNTAX","CANNOTDECLAREVAL")}else if("Identifier"!==a.left.type)return f(a,"SYNTAX","LEFTNOTVAR");return b=l(a.right,d),""!==b?b:(b=l(a.body,d),""!==b?b:"");case "ForStatement":return null!==a.test&&(b=l(a.test,d),
""!==b)?b:null!==a.init&&(b=l(a.init,d),""!==b)?b:null!==a.update&&(b=l(a.update,d),""!==b)?b:null!==a.body&&(b=l(a.body,d),""!==b)?b:"";case "ContinueStatement":return"";case "EmptyStatement":return"";case "BreakStatement":return"";case "IfStatement":return b=l(a.test,d),""!==b?b:null!==a.consequent&&(b=l(a.consequent,!1),""!==b)?b:null!==a.alternate&&(b=l(a.alternate,!1),""!==b)?b:"";case "BlockStatement":for(var e=[],c=0;c<a.body.length;c++)"EmptyStatement"!==a.body[c].type&&e.push(a.body[c]);
a.body=e;for(c=0;c<a.body.length;c++)if(b=l(a.body[c],d),""!==b)return b;return"";case "FunctionDeclaration":return!1===d?f(a,"SYNTAX","GLOBALFUNCTIONSONLY"):"Identifier"!==a.id.type?f(a,"SYNTAX","FUNCTIONMUSTHAVEIDENTIFIER"):l(a.body,!1);case "ReturnStatement":return null!==a.argument?l(a.argument,d):"";case "UpdateExpression":return"Identifier"!==a.argument.type&&"MemberExpression"!==a.argument.type?f(a,"SYNTAX","ASSIGNMENTTOVARSONLY"):l(a.argument,d);case "AssignmentExpression":if("Identifier"!==
a.left.type&&"MemberExpression"!==a.left.type)return f(a,"SYNTAX","ASSIGNMENTTOVARSONLY");if(b=l(a.left,d),""!==b)break;switch(a.operator){case "\x3d":case "/\x3d":case "*\x3d":case "%\x3d":case "+\x3d":case "-\x3d":break;default:return f(a,"SYNTAX","OPERATORNOTRECOGNISED")}return l(a.right,!1);case "ExpressionStatement":return l(a.expression,!1);case "Identifier":b="";break;case "MemberExpression":return b=l(a.object,d),""!==b?b:!0===a.computed?l(a.property,d):"";case "Literal":return"";case "ThisExpression":return f(a,
"SYNTAX","NOTSUPPORTED");case "CallExpression":if("Identifier"!==a.callee.type)return f(a,"SYNTAX","ONLYNODESSUPPORTED");b="";for(c=0;c<a.arguments.length;c++)if(b=l(a.arguments[c],d),""!==b)return b;return"";case "UnaryExpression":b=l(a.argument,d);break;case "BinaryExpression":if(b=l(a.left,d),""!==b)break;if(b=l(a.right,d),""!==b)break;switch(a.operator){case "\x3d\x3d":case "!\x3d":case "\x3c":case "\x3c\x3d":case "\x3e":case "\x3e\x3d":case "+":case "-":case "*":case "/":case "%":break;default:return f(a,
"SYNTAX","OPERATORNOTRECOGNISED")}return"";case "LogicalExpression":if(b=l(a.left,d),""!==b)break;if(b=l(a.right),""!==b)break;switch(a.operator){case "\x26\x26":case "||":break;default:return f(a,"SYNTAX","OPERATORNOTRECOGNISED")}return"";case "ConditionalExpression":return f(a,"SYNTAX","NOTSUPPORTED");case "ArrayExpression":b="";for(c=0;c<a.elements.length&&(b=l(a.elements[c],d),""===b);c++);break;case "Array":return f(a,"SYNTAX","NOTSUPPORTED");case "ObjectExpression":b="";for(c=0;c<a.properties.length;c++){if(b=
"",null!==a.properties[c].key&&("Literal"!==a.properties[c].key.type&&"Identifier"!==a.properties[c].key.type&&(b=f(a,"SYNTAX","OBJECTPROPERTYMUSTBESTRING")),"Literal"===a.properties[c].key.type))e=a.properties[c].key.value,"string"==typeof e||e instanceof String||(b=f(a,"SYNTAX","OBJECTPROPERTYMUSTBESTRING"));if(""===b&&(b=l(a.properties[c],d)),""!==b)break}break;case "Property":return"Literal"!==a.key.type&&"Identifier"!==a.key.type?f(a,"SYNTAX","ONLYLITERAL"):"Identifier"!==a.key.type&&(b=l(a.key,
d),""!==b)?b:b=l(a.value,d)}return b}catch(t){throw t;}}function n(a,d){var b=f(a,"SYNTAX","UNREOGNISED"),c=null,e="";try{switch(a.type){case "VariableDeclarator":if(null!==a.init&&"FunctionExpression"===a.init.type)return f(a,"SYNTAX","FUNCTIONVARIABLEDECLARATOR");null!==d.localScope?void 0!==d.localScope[a.id.name.toLowerCase()]&&a.id.name.toLowerCase():void 0!==d.globalScope[a.id.name.toLowerCase()]&&a.id.name.toLowerCase();var l=null===a.init?"":n(a.init,d);return""!==l?l:(null===d.localScope?
d.globalScope[a.id.name.toLowerCase()]={type:"any"}:d.localScope[a.id.name.toLowerCase()]={type:"any"},"");case "FunctionDeclaration":return c=w(a.id.name.toLowerCase(),a,d),e=y(a,d),""!==e?e:null!==d.localScope?f(a,"SYNTAX","GLOBALFUNCTIONSONLY"):(c.isnative=!1,d.globalScope[a.id.name.toLowerCase()]={type:"FormulaFunction",signature:[c]},"");case "VariableDeclaration":for(var b="",h=0;h<a.declarations.length&&(b=n(a.declarations[h],d),""===b);h++);break;case "IfStatement":return b=n(a.test,d),""!==
b?b:"AssignmentExpression"===a.test.type||"UpdateExpression"===a.test.type?f(a.test,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"):null!==a.consequent&&(b=n(a.consequent,d),""!==b)?b:null!==a.alternate&&(b=n(a.alternate,d),""!==b)?b:"";case "EmptyStatement":return"";case "BlockStatement":for(h=0;h<a.body.length;h++)if(b=n(a.body[h],d),""!==b)return b;return"";case "ReturnStatement":return null!==a.argument?n(a.argument,d):"";case "ForInStatement":if("VariableDeclaration"===a.left.type){if(1<a.left.declarations.length)return f(a,
"SYNTAX","ONLY1VAR");if(null!==a.left.declarations[0].init)return f(a,"SYNTAX","CANNOTDECLAREVAL")}else if("Identifier"!==a.left.type)return f(a,"SYNTAX","LEFTNOTVAR");return b=n(a.left,d),""!==b?b:(b=n(a.right,d),""!==b?b:(b=n(a.body,d),""!==b?b:""));case "ForStatement":return null!==a.init&&(b=n(a.init,d),""!==b)?b:null!==a.test&&(b=n(a.test,d),""!==b)?b:null!==a.body&&(b=n(a.body,d),""!==b)?b:null!==a.update&&(b=n(a.update,d),""!==b)?b:"";case "BreakStatement":return"";case "ContinueStatement":return"";
case "UpdateExpression":if("Identifier"!==a.argument.type&&"MemberExpression"!==a.argument.type)return f(a,"SYNTAX","ASSIGNMENTTOVARSONLY");var k=!1;return"MemberExpression"===a.argument.type?n(a.argument,d):(null!==d.localScope&&void 0!==d.localScope[a.argument.name.toLowerCase()]&&(k=!0),void 0!==d.globalScope[a.argument.name.toLowerCase()]&&(k=!0),!1===k?"Identifier "+a.argument.name+" has not been declared.":"");case "AssignmentExpression":if("Identifier"!==a.left.type&&"MemberExpression"!==a.left.type)return f(a,
"SYNTAX","ASSIGNMENTTOVARSONLY");var g=n(a.right,d);return""!==g?g:(k=!1,"MemberExpression"===a.left.type?(g=n(a.left,d),""!==g?g:""):(null!==d.localScope&&void 0!==d.localScope[a.left.name.toLowerCase()]&&(k=!0),void 0!==d.globalScope[a.left.name.toLowerCase()]&&(k=!0),!1===k?"Identifier "+a.left.name+" has not been declared.":""));case "ExpressionStatement":return n(a.expression,d);case "Identifier":var m=a.name.toLowerCase();if(null!==d.localScope&&void 0!==d.localScope[m])return"";b=void 0!==
d.globalScope[m]?"":f(a,"SYNTAX","VARIABLENOTFOUND");break;case "MemberExpression":return b=n(a.object,d),""!==b?b:!0===a.computed?n(a.property,d):"";case "Literal":return"";case "ThisExpression":b=f(a,"SYNTAX","NOTSUPPORTED");break;case "CallExpression":if("Identifier"!==a.callee.type)return f(a,"SYNTAX","ONLYNODESSUPPORTED");b="";for(h=0;h<a.arguments.length;h++)if(b=n(a.arguments[h],d),""!==b)return b;var p=v(a.callee.name,a.arguments,d);-1===p&&(b=f(a,"SYNTAX","NOTFOUND"));-2===p&&(b=f(a,"SYNTAX",
"WRONGSIGNATURE"));break;case "UnaryExpression":b=n(a.argument,d);break;case "BinaryExpression":return b=n(a.left,d),""!==b?b:(b=n(a.right,d),""!==b?b:"");case "LogicalExpression":return b=n(a.left,d),""!==b?b:"AssignmentExpression"===a.left.type||"UpdateExpression"===a.left.type?f(a.left,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"):(b=n(a.right,d),""!==b?b:"AssignmentExpression"===a.right.type||"UpdateExpression"===a.right.type?f(a.right,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"):"");case "ConditionalExpression":return f(a,
"SYNTAX","NOTSUPPORTED");case "ArrayExpression":b="";for(h=0;h<a.elements.length&&(b=n(a.elements[h],d),""===b);h++);break;case "ObjectExpression":b="";for(h=0;h<a.properties.length;h++){if(b="",null!==a.properties[h].key&&("Literal"!==a.properties[h].key.type&&"Identifier"!==a.properties[h].key.type&&(b=f(a,"SYNTAX","OBJECTPROPERTYMUSTBESTRING")),"Literal"===a.properties[h].key.type)){var q=a.properties[h].key.value;"string"==typeof q||q instanceof String||(b=f(a,"SYNTAX","OBJECTPROPERTYMUSTBESTRING"))}if(""===
b&&(b=n(a.properties[h],d)),""!==b)break}break;case "Property":return"Literal"!==a.key.type&&"Identifier"!==a.key.type?f(a,"SYNTAX","ONLYLITERAL"):"Identifier"!==a.key.type&&(b=n(a.key,d),""!==b)?b:b=n(a.value,d);case "Array":return f(a,"SYNTAX","NOTSUPPORTED")}return b}catch(A){throw A;}}function g(a,d){var b=!1;try{switch(a.type){case "VariableDeclarator":return null!==a.init?g(a.init,d):b;case "FunctionDeclaration":return g(a.body,d);case "VariableDeclaration":for(var c=0;c<a.declarations.length;c++)if(g(a.declarations[c],
d))return!0;return b;case "IfStatement":return g(a.test,d)?!0:null!==a.consequent&&g(a.consequent,d)?!0:null!==a.alternate&&g(a.alternate,d)?!0:b;case "EmptyStatement":return b;case "BlockStatement":for(c=0;c<a.body.length;c++)if(g(a.body[c],d))return!0;return b;case "ReturnStatement":return null!==a.argument?g(a.argument,d):b;case "UpdateExpression":return g(a.argument,d);case "AssignmentExpression":return b=g(a.right,d),b?b:g(a.left,d);case "ExpressionStatement":return g(a.expression,d);case "ForInStatement":return(b=
g(a.left,d))?b:(b=g(a.right,d))?b:(b=g(a.body,d),b);case "ForStatement":return null!==a.init&&(b=g(a.init,d))?b:null!==a.test&&(b=g(a.test,d))?b:null!==a.body&&(b=g(a.body,d))?b:(null!==a.update&&(b=g(a.update,d)),b);case "BreakStatement":return b;case "ContinueStatement":return b;case "Compound":return b;case "Identifier":return d.toLowerCase()===a.name.toLowerCase();case "MemberExpression":return(b=g(a.object,d))?b:(!0===a.computed&&(b=g(a.property,d)),b);case "Literal":return b;case "ThisExpression":return b;
case "CallExpression":for(c=0;c<a.arguments.length;c++)g(a.arguments[c],d)&&(b=!0);return b;case "ArrayExpression":for(c=0;c<a.elements.length;c++)g(a.elements[c],d)&&(b=!0);return b;case "UnaryExpression":return g(a.argument,d);case "BinaryExpression":return(b=g(a.left,d))?b:b=g(a.right,d);case "LogicalExpression":return(b=g(a.left,d))?b:b=g(a.right,d);case "ObjectExpression":for(c=0;c<a.properties.length;c++)g(a.properties[c],d)&&(b=!0);return b;case "Property":return b=g(a.value,d);case "ConditionalExpression":return b;
case "Array":return b;default:return b}}catch(e){throw e;}}function m(a,d){var b=!1;try{switch(a.type){case "VariableDeclarator":return null!==a.init?m(a.init,d):b;case "FunctionDeclaration":return m(a.body,d);case "VariableDeclaration":for(var c=0;c<a.declarations.length;c++)if(m(a.declarations[c],d))return!0;return b;case "IfStatement":return m(a.test,d)?!0:null!==a.consequent&&m(a.consequent,d)?!0:null!==a.alternate&&m(a.alternate,d)?!0:b;case "EmptyStatement":return b;case "BlockStatement":for(c=
0;c<a.body.length;c++)if(m(a.body[c],d))return!0;return b;case "ReturnStatement":return null!==a.argument?m(a.argument,d):b;case "UpdateExpression":return m(a.argument,d);case "AssignmentExpression":return m(a.left,d)?!0:m(a.right,d);case "ExpressionStatement":return m(a.expression,d);case "ForInStatement":return(b=m(a.left,d))?b:(b=m(a.right,d))?b:(b=m(a.body,d),b);case "ForStatement":return null!==a.init&&(b=m(a.init,d))?b:null!==a.test&&(b=m(a.test,d))?b:null!==a.body&&(b=m(a.body,d))?b:(null!==
a.update&&(b=m(a.update,d)),b);case "BreakStatement":return b;case "ContinueStatement":return b;case "Compound":return b;case "Identifier":return b;case "MemberExpression":return(b=m(a.object,d))?b:(!0===a.computed&&(b=m(a.property,d)),b);case "Literal":return b;case "ThisExpression":return b;case "CallExpression":if(a.callee.name.toLowerCase()===d.toLowerCase())return!0;for(c=0;c<a.arguments.length;c++)m(a.arguments[c],d)&&(b=!0);return b;case "ArrayExpression":for(c=0;c<a.elements.length;c++)m(a.elements[c],
d)&&(b=!0);return b;case "UnaryExpression":return m(a.argument,d);case "BinaryExpression":return(b=m(a.left,d))?b:b=m(a.right,d);case "LogicalExpression":return(b=m(a.left,d))?b:b=m(a.right,d);case "ConditionalExpression":return b;case "ObjectExpression":for(c=0;c<a.properties.length;c++)m(a.properties[c],d)&&(b=!0);return b;case "Property":return b=m(a.value,d);case "Array":return b;default:return b}}catch(e){throw e;}}function p(a,d){var b,c=[];try{switch(a.type){case "VariableDeclarator":return null!==
a.init?p(a.init,d):c;case "FunctionDeclaration":return p(a.body,d);case "VariableDeclaration":for(var e=0;e<a.declarations.length;e++)b=p(a.declarations[e],d),c=c.concat(b);return c;case "ForInStatement":return b=p(a.left,d),c=c.concat(b),b=p(a.right,d),c=c.concat(b),b=p(a.body,d),c=c.concat(b);case "ForStatement":return null!==a.init&&(b=p(a.init,d),c=c.concat(b)),null!==a.test&&(b=p(a.test,d),c=c.concat(b)),null!==a.body&&(b=p(a.body,d),c=c.concat(b)),null!==a.update&&(b=p(a.update,d),c=c.concat(b)),
c;case "IfStatement":return b=p(a.test,d),c=c.concat(b),null!==a.consequent&&(b=p(a.consequent,d),c=c.concat(b)),null!==a.alternate&&(b=p(a.alternate,d),c=c.concat(b)),c;case "EmptyStatement":return c;case "BlockStatement":for(e=0;e<a.body.length;e++)b=p(a.body[e],d),c=c.concat(b);return c;case "ReturnStatement":return null!==a.argument?p(a.argument,d):c;case "UpdateExpression":return p(a.argument,d);case "AssignmentExpression":return c=p(a.left,d),c=c.concat(p(a.right,d));case "ExpressionStatement":return p(a.expression,
d);case "BreakStatement":return c;case "ContinueStatement":return c;case "Compound":return c;case "Identifier":return c;case "MemberExpression":if("Identifier"!==a.object.type)return c;if(!1===a.computed)c.push(a.object.name.toLowerCase()+"."+a.property.name.toLowerCase());else try{"Literal"===a.property.type&&"string"==typeof a.property.value&&c.push(a.object.name.toLowerCase()+"."+a.property.value.toString().toLowerCase())}catch(t){}return c;case "Literal":return c;case "ThisExpression":return c;
case "CallExpression":for(e=0;e<a.arguments.length;e++)b=p(a.arguments[e],d),c=c.concat(b);return c;case "ArrayExpression":for(e=0;e<a.elements.length;e++)b=p(a.elements[e],d),c=c.concat(b);return c;case "UnaryExpression":return p(a.argument,d);case "ObjectExpression":for(e=0;e<a.properties.length;e++)b=p(a.properties[e],d),c=c.concat(b);return c;case "Property":return p(a.value,d);case "BinaryExpression":return b=p(a.left,d),c=c.concat(b),b=p(a.right,d),c=c.concat(b);case "LogicalExpression":return b=
p(a.left,d),c=c.concat(b),b=p(a.right,d),c=c.concat(b);case "ConditionalExpression":return c;case "Array":return c;default:return c}}catch(t){throw t;}}function w(a,d,b){b=[];if(void 0!==d.params&&null!==d.params)for(var c=0;c<d.params.length;c++)b.push("any");return{name:a,"return":"any",params:b}}function y(a,d){d={globalScope:d.globalScope,localScope:{}};for(var b=0;b<a.params.length;b++)d.localScope[a.params[b].name.toLowerCase()]={type:"any"};return n(a.body,d)}function x(a,d,b,c){var e={};void 0!==
a&&null!==a||(a={});void 0!==b&&null!==b||(b={});e.infinity={type:"any"};e.textformatting={type:"any"};e.pi={type:"any"};for(var f in d)("simple"!==c||"simple"===c&&"a"===d[f].av)&&(e[f]={type:"FormulaFunction",signature:d[f]});for(d=0;d<b.length;d++)f=b[d],e[f.name]={type:"FormulaFunction",signature:f};for(f in a)e[f]=a[f],e[f].type="any";return e}function f(a,d,b){var c="";switch(d){case "SYNTAX":c="Syntax Error: ";break;case "RUNTIME":c="Runtime Error: ";break;default:c="Syntax Error: "}try{switch(a.type){case "IfStatement":switch(b){case "CANNOT_USE_ASSIGNMENT_IN_CONDITION":c+=
" Assignments not be made in logical tests";break;case "CANNOT_USE_NONBOOLEAN_IN_CONDITION":c+=" Non Boolean used as Condition"}break;case "UpdateExpression":case "AssignmentExpression":switch(b){case "CANNOT_USE_ASSIGNMENT_IN_CONDITION":c+=" Assignments not be made in logical tests";break;case "ASSIGNMENTTOVARSONLY":c+=" Assignments can only be made to identifiers"}break;case "ExpressionStatement":c+=" Assignments can only be made to identifiers";break;case "FunctionDeclaration":switch(b){case "GLOBALFUNCTIONSONLY":c+=
" Functions cannot be declared as variables";break;case "FUNCTIONMUSTHAVEIDENTIFIER":c+=" Function Definition must have an identifier"}break;case "VariableDeclaration":c+=" Only 1 variable can be declared at a time";break;case "VariableDeclarator":switch(b){case "FUNCTIONVARIABLEDECLARATOR":c+=" Functions cannot be declared as variables";break;case "VARIABLEMUSTHAVEIDENTIFIER":c+=" Variable Definition must have an identifier"}break;case "Identifier":c+=" Identifier Not Found. ";c+=a.name;break;case "ObjectExpression":switch(b){case "OBJECTPROPERTYMUSTBESTRING":c+=
" Property name must be a string"}break;case "ForStatement":switch(b){case "CANNOT_USE_NONBOOLEAN_IN_CONDITION":c+=" Non Boolean used as Condition"}break;case "ForInStatement":switch(b){case "ONLY1VAR":c+=" Can only declare 1 var for use with IN";break;case "CANNOTDECLAREVAL":c+=" Can only declare value for use with IN";break;case "LEFTNOVAR":c+="Must provide a variable to iterate with.";break;case "VARIABLENOTDECLARED":c+="Variable must be declared before it is used..";break;case "CANNOTITERATETHISTYPE":c+=
"This type cannot be used in an IN loop"}break;case "MemberExpression":switch(b){case "PROPERTYNOTFOUND":c+="Cannot find member property. ";c+=!1===a.computed?a.property.name:"";break;case "OUTOFBOUNDS":c+="Out of Bounds. ";c+=!1===a.computed?a.property.name:"";break;case "NOTFOUND":c+="Cannot call member method on null. ";c+=!1===a.computed?a.property.name:"";break;case "INVALIDTYPE":c+="Cannot call member property on object of this type. ",c+=!1===a.computed?a.property.name:""}break;case "Property":switch(b){case "ONLYLITERAL":c+=
"Property names must be literals or identifiers"}break;case "Literal":break;case "ThisExpression":c+="THIS construct is not supported.";case "CallExpression":switch(b){case "WRONGSIGNATURE":c+="Function signature does not match: ";c+=a.callee.name;break;case "ONLYNODESUPPORTED":c+="Functions must be declared.";c+=a.callee.name;break;case "NOTAFUNCTION":c+="Not a Function: ";c+=a.callee.name;break;case "NOTFOUND":c+="Function Not Found: "+a.callee.name}break;case "UnaryExpression":switch(b){case "NOTSUPPORTEDUNARYOPERATOR":c+=
"Operator "+a.operator+" not allowed in this context. Only ! can be used with boolean, and - with a number";break;case "NOTSUPPORTEDTYPE":c+="Unary operator "+a.operator+" cannot be used with this argument."}case "BinaryExpression":switch(b){case "OPERATORNOTRECOGNISED":c+="Binary Operator not recognised "+a.operator}break;case "LogicalExpression":switch(b){case "ONLYBOOLEAN":c+="Operator "+a.operator+" cannot be used. Only || or \x26\x26 are allowed values";break;case "ONLYORORAND":c+="Logical Expression "+
a.operator+" being applied to parameters that are not boolean."}case "ConditionalExpression":c+="Conditional statements not supported.";break;case "ArrayExpression":switch(b){case "FUNCTIONCONTEXTILLEGAL":c+=" Cannot Put Function inside Array."}break;case "Array":c+="Expression contains unrecognised array structure.";break;default:c+="Expression contains unrecognised code structures."}}catch(e){throw e;}return c}function q(a,d,b){return{line:a.loc.start.line,character:a.loc.start.column,reason:f(a,
d,b)}}function z(a,d,b,c,e){void 0===e&&(e=!0);d={globalScope:d.globalScope,localScope:{}};for(e=0;e<a.params.length;e++)d.localScope[a.params[e].name.toLowerCase()]={type:"any"};k(a.body,d,b,c,!1)}function k(a,d,b,c,e){if(void 0===e&&(e=!0),null===a)throw Error("Unnexpexted Expression Syntax");f(a,"SYNTAX","UNREOGNISED");var g=null;try{switch(a.type){case "VariableDeclarator":return null!==a.init&&"FunctionExpression"===a.init.type?void c.push(q(a,"SYNTAX","FUNCTIONVARIABLEDECLARATOR")):("Identifier"!==
a.id.type?c.push(q(a,"SYNTAX","VARIABLEMUSTHAVEIDENTIFIER")):(null!==d.localScope?void 0!==d.localScope[a.id.name.toLowerCase()]&&a.id.name.toLowerCase():void 0!==d.globalScope[a.id.name.toLowerCase()]&&a.id.name.toLowerCase(),null===d.localScope?d.globalScope[a.id.name.toLowerCase()]={type:"any"}:d.localScope[a.id.name.toLowerCase()]={type:"any"}),void(null===a.init?"":k(a.init,d,b,c,e)));case "FunctionDeclaration":return!1===e&&c.push(q(a,"SYNTAX","GLOBALFUNCTIONSONLY")),"Identifier"!==a.id.type&&
c.push(q(a,"SYNTAX","FUNCTIONMUSTHAVEIDENTIFIER")),g=w("",a,d),z(a,d,b,c,e),null!==d.localScope&&c.push(q(a,"SYNTAX","GLOBALFUNCTIONSONLY")),g.isnative=!1,void("Identifier"===a.id.type&&(d.globalScope[a.id.name.toLowerCase()]={type:"FormulaFunction",signature:[g]}));case "VariableDeclaration":for(var h=0;h<a.declarations.length;h++)k(a.declarations[h],d,b,c,e);break;case "IfStatement":return null!==a.test&&(k(a.test,d,b,c,e),("AssignmentExpression"===a.test.type||"UpdateExpression"===a.test.type)&&
c.push(q(a.test,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))),null!==a.consequent&&k(a.consequent,d,b,c,e),void(null!==a.alternate&&k(a.alternate,d,b,c,e));case "EmptyStatement":break;case "BlockStatement":if(null!==a.body)for(h=0;h<a.body.length;h++)k(a.body[h],d,b,c,e);break;case "ReturnStatement":return void(null!==a.argument&&k(a.argument,d,b,c,e));case "ForInStatement":return"VariableDeclaration"===a.left.type?(1<a.left.declarations.length&&c.push(q(a,"SYNTAX","ONLY1VAR")),null!==a.left.declarations[0].init&&
c.push(q(a,"SYNTAX","CANNOTDECLAREVAL"))):"Identifier"!==a.left.type&&c.push(q(a,"SYNTAX","LEFTNOTVAR")),k(a.left,d,b,c,e),k(a.right,d,b,c,e),void k(a.body,d,b,c,e);case "ForStatement":return null!==a.init&&k(a.init,d,b,c,e),null!==a.test&&k(a.test,d,b,c,e),null!==a.body&&k(a.body,d,b,c,e),void(null!==a.update&&k(a.update,d,b,c,e));case "BreakStatement":break;case "ContinueStatement":break;case "UpdateExpression":"Identifier"!==a.argument.type&&"MemberExpression"!==a.argument.type?c.push(q(a,"SYNTAX",
"ASSIGNMENTTOVARSONLY")):("Identifier"===a.argument.type&&(g=!1,!1===b&&(null!==d.localScope&&void 0!==d.localScope[a.argument.name.toLowerCase()]&&(g=!0),void 0!==d.globalScope[a.argument.name.toLowerCase()]&&(g=!0),!1===g&&c.push({line:null===a?0:a.loc.start.line,character:null===a?0:a.loc.start.column,reason:"Identifier "+a.argument.name+" has not been declared."}))),"MemberExpression"===a.argument.type&&k(a.argument,d,b,c,e));break;case "AssignmentExpression":switch("Identifier"!==a.left.type&&
"MemberExpression"!==a.left.type&&c.push(q(a,"SYNTAX","ASSIGNMENTTOVARSONLY")),a.operator){case "\x3d":case "/\x3d":case "*\x3d":case "%\x3d":case "+\x3d":case "-\x3d":break;default:c.push(q(a,"SYNTAX","OPERATORNOTRECOGNISED"))}k(a.right,d,b,c,e);g=!1;return"Identifier"===a.left.type&&(null!==d.localScope&&void 0!==d.localScope[a.left.name.toLowerCase()]&&(g=!0),void 0!==d.globalScope[a.left.name.toLowerCase()]&&(g=!0),!1===b&&!1===g&&c.push({line:null===a?0:a.loc.start.line,character:null===a?0:
a.loc.start.column,reason:"Identifier "+a.argument.name+" has not been declared."})),void("MemberExpression"===a.left.type&&k(a.left,d,b,c,e));case "ExpressionStatement":return void k(a.expression,d,b,c,e);case "Identifier":var l=a.name.toLowerCase();if(null!==d.localScope&&void 0!==d.localScope[l])break;if(void 0!==d.globalScope[l])break;!1===b&&c.push(q(a,"SYNTAX","VARIABLENOTFOUND"));break;case "MemberExpression":return k(a.object,d,b,c,e),void(!0===a.computed&&k(a.property,d,b,c,e));case "Literal":return"";
case "ThisExpression":c.push(q(a,"SYNTAX","NOTSUPPORTED"));break;case "CallExpression":"Identifier"!==a.callee.type&&c.push(q(a,"SYNTAX","ONLYNODESSUPPORTED"));for(h=0;h<a.arguments.length;h++)k(a.arguments[h],d,b,c,e);var m=v(a.callee.name,a.arguments,d);return!1===b&&-1===m&&c.push(q(a,"SYNTAX","NOTFOUND")),void(-2===m&&c.push(q(a,"SYNTAX","WRONGSIGNATURE")));case "UnaryExpression":return void k(a.argument,d,b,c,e);case "BinaryExpression":switch(k(a.left,d,b,c,e),k(a.right,d,b,c,e),a.operator){case "\x3d\x3d":case "!\x3d":case "\x3c":case "\x3c\x3d":case "\x3e":case "\x3e\x3d":case "+":case "-":case "*":case "/":case "%":break;
default:c.push(q(a,"SYNTAX","OPERATORNOTRECOGNISED"))}break;case "LogicalExpression":switch(a.operator){case "\x26\x26":case "||":break;default:c.push(q(a,"SYNTAX","OPERATORNOTRECOGNISED"))}return k(a.left,d,b,c,e),("AssignmentExpression"===a.left.type||"UpdateExpression"===a.left.type)&&c.push(q(a,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION")),k(a.right,d,b,c,e),void(("AssignmentExpression"===a.right.type||"UpdateExpression"===a.right.type)&&c.push(q(a,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION")));
case "ConditionalExpression":c.push(q(a,"SYNTAX","NOTSUPPORTED"));break;case "ArrayExpression":for(h=0;h<a.elements.length;h++)k(a.elements[h],d,b,c,e);break;case "Array":c.push(q(a,"SYNTAX","NOTSUPPORTED"));case "ObjectExpression":for(h=0;h<a.properties.length;h++)k(a.properties[h],d,b,c,e);break;case "Property":return"Literal"!==a.key.type&&"Identifier"!==a.key.type&&c.push(q(a,"SYNTAX","ONLYLITERAL")),"Literal"===a.key.type&&k(a.key,d,b,c,e),void k(a.value,d,b,c,e);default:c.push(q(a,"SYNTAX",
"UNRECOGNISED"))}}catch(C){c.push({line:null===a?0:a.loc.start.line,character:null===a?0:a.loc.start.column,reason:"Unnexpected Syntax"})}}Object.defineProperty(r,"__esModule",{value:!0});r.functionDecls={concatenate:{min:"0",max:"*",av:"a"},split:{min:"2",max:"4",av:"a"},guid:{min:"0",max:"1",av:"a"},today:{min:"0",max:"0",av:"a"},now:{min:"0",max:"0",av:"a"},timestamp:{min:"0",max:"0",av:"a"},day:{min:"1",max:"1",av:"a"},month:{min:"1",max:"1",av:"a"},year:{min:"1",max:"1",av:"a"},hour:{min:"1",
max:"1",av:"a"},second:{min:"1",max:"1",av:"a"},millisecond:{min:"1",max:"1",av:"a"},minute:{min:"1",max:"1",av:"a"},weekday:{min:"1",max:"1",av:"a"},toutc:{min:"1",max:"1",av:"a"},tolocal:{min:"1",max:"1",av:"a"},date:{min:"0",max:"7",av:"a"},datediff:{min:"2",max:"3",av:"a"},dateadd:{min:"2",max:"3",av:"a"},trim:{min:"1",max:"1",av:"a"},text:{min:"1",max:"2",av:"a"},left:{min:"2",max:"2",av:"a"},right:{min:"2",max:"2",av:"a"},mid:{min:"2",max:"3",av:"a"},upper:{min:"1",max:"1",av:"a"},proper:{min:"1",
max:"2",av:"a"},lower:{min:"1",max:"1",av:"a"},find:{min:"2",max:"3",av:"a"},iif:{min:"3",max:"3",av:"a"},decode:{min:"2",max:"*",av:"a"},when:{min:"2",max:"*",av:"a"},defaultvalue:{min:"2",max:"2",av:"a"},isempty:{min:"1",max:"1",av:"a"},maplayer:{min:"2",max:"3",av:"f"},domaincode:{min:"3",max:"4",av:"a"},domainname:{min:"2",max:"4",av:"a"},polygon:{min:"1",max:"1",av:"a"},point:{min:"1",max:"1",av:"a"},polyline:{min:"1",max:"1",av:"a"},extent:{min:"1",max:"1",av:"a"},multipoint:{min:"1",max:"1",
av:"a"},geometry:{min:"1",max:"1",av:"a"},featurelayer:{min:"1",max:"3",av:"f"},featurecollection:{min:"1",max:"1",av:"f"},buffer:{min:"2",max:"4",av:"f"},area:{min:"1",max:"2",av:"f"},sumarea:{min:"1",max:"2",av:"f"},length:{min:"1",max:"2",av:"f"},sumlength:{min:"1",max:"2",av:"f"},count:{min:"0",max:"*",av:"a"},filter:{min:"2",max:"2",av:"f"},envelopeintersects:{min:"2",max:"2",av:"f"},intersects:{min:"2",max:"2",av:"f"},contains:{min:"2",max:"2",av:"f"},overlaps:{min:"2",max:"2",av:"f"},within:{min:"2",
max:"2",av:"f"},touches:{min:"2",max:"2",av:"f"},crosses:{min:"2",max:"2",av:"f"},union:{min:"1",max:"2",av:"f",fmin:1},difference:{min:"2",max:"2",av:"f",fmin:2,fmax:3},intersection:{min:"2",max:"2",av:"f",fmin:2,fmax:3},symmetricdifference:{min:"2",max:"2",av:"f",fmin:2,fmax:3},number:{min:"1",max:"2",av:"a"},acos:{min:"1",max:"1",av:"a"},asin:{min:"1",max:"1",av:"a"},atan:{min:"1",max:"1",av:"a"},atan2:{min:"2",max:"2",av:"a"},ceil:{min:"1",max:"2",av:"a"},floor:{min:"1",max:"2",av:"a"},round:{min:"1",
max:"2",av:"a"},cos:{min:"1",max:"1",av:"a"},exp:{min:"1",max:"1",av:"a"},log:{min:"1",max:"1",av:"a"},min:{min:"0",max:"*",av:"a"},console:{min:"0",max:"*",av:"a"},max:{min:"0",max:"*",av:"a"},pow:{min:"2",max:"2",av:"a"},random:{min:"0",max:"0",av:"a"},sqrt:{min:"1",max:"1",av:"a"},sin:{min:"1",max:"1",av:"a"},tan:{min:"1",max:"1",av:"a"},abs:{min:"1",max:"1",av:"a"},isnan:{min:"1",max:"1",av:"a"},stdev:{min:"0",max:"*",av:"a"},average:{min:"0",max:"*",av:"a"},mean:{min:"0",max:"*",av:"a"},sum:{min:"0",
max:"*",av:"a"},variance:{min:"0",max:"*",av:"a"},distinct:{min:"0",max:"*",av:"a"},addfield:{min:"3",max:"3",av:"f"},removefield:{min:"2",max:"2",av:"f"},aggregate:{min:"3",max:"3",av:"f"},dissolve:{min:"2",max:"3",av:"f"},changeshape:{min:"2",max:"4",av:"f"},first:{min:"1",max:"1",av:"a"},top:{min:"2",max:"2",av:"a"},orderby:{min:"2",max:"2",av:"f"},"boolean":{min:"1",max:"1",av:"a"},dictionary:{min:"0",max:"*",av:"a"},servicearea:{min:"2",max:"*",av:"f"},equals:{min:"2",max:"2",av:"a"},"typeof":{min:"1",
max:"1",av:"a"},reverse:{min:"1",max:"1",av:"a"},replace:{min:"3",max:"4",av:"a"},sort:{min:"1",max:"2",av:"a"},feature:{min:"1",max:"*",av:"a"},haskey:{min:"2",max:"2",av:"a"},indexof:{min:"2",max:"2",av:"a"},centroid:{min:"1",max:"1",av:"f"},multiparttosinglepart:{min:"1",max:"1",av:"f"}};r.checkFunctionSignature=u;r.findFunction=v;r.validateLanguageNode=l;r.testValidityOfExpression=n;r.referencesMemberImpl=g;r.referencesMember=function(a,d){return!0===g(a.body[0].body,d.toLowerCase())?!0:!1};r.referencesFunctionImpl=
m;r.referencesFunction=function(a,d){return!0===m(a.body[0].body,d)?!0:!1};r.findFieldLiteralsImpl=p;r.findFieldLiterals=function(a,d){return p(a.body[0].body,d)};r.extractFunctionDeclaration=w;r.validateFunction=y;r.constructGlobalScope=x;r.validateScript=function(a,d,b){void 0===b&&(b="full");d={globalScope:x(d.vars,r.functionDecls,d.customFunctions,b),localScope:null};return n(a.body[0].body,d)};r.validateLanguage=function(a){return"BlockStatement"!==a.body[0].body.type?"Invalid formula content.":
l(a.body[0].body)};r.nodeErrorMessage=f;r.makeError=q;r.extractAllIssuesInFunction=z;r.extractAllIssues=k;r.checkScript=function(a,d,b,c){void 0===c&&(c="full");var e=[];if("BlockStatement"!==a.body[0].body.type)return[{line:0,character:0,reason:"Invalid Body"}];null!==d&&void 0!==d||(d={vars:{},customFunctions:[]});d={globalScope:x(d.vars,r.functionDecls,d.customFunctions,c),localScope:null};try{k(a.body[0].body,d,b,e)}catch(t){}return e}});