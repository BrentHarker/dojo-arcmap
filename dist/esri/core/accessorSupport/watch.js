//>>built
define("require exports ../Scheduler ../ObjectPool ../ArrayPool ../lang ./utils ./get ./wire".split(" "),function(E,f,z,A,B,r,m,k,t){function u(a){l.has(a)?c.splice(c.indexOf(a),1):l.add(a);c.push(a);n||(n=z.schedule(v))}function w(a){if(!a.removed){var e=a.callback,b=a.path,d=a.oldValue,c=a.target,q=k.valueOf(c,a.propertyPath,!0);!r.equals(d,q)&&(a.oldValue=q,e.call(c,q,d,b,c))}}function v(){if(n){n=null;var a=c;c=h.acquire();l.clear();for(var e=h.acquire(),b=0;b<a.length;b++){var d=a[b];w(d);d.removed&&
e.push(d)}for(b=0;b<c.length;b++)d=c[b],d.removed&&(e.push(d),l["delete"](d),c.splice(b,1),--b);for(b=0;b<e.length;b++)p.pool.release(e[b]);h.release(a);h.release(e)}}function C(a,e,b){var d=m.parse(a,e,b,function(a,b,e){var c,g=k.valueOf(a,b,!0),x=t.wire(a,b,function(a,b){return a.__accessor__.destroyed?void d.remove():(c||(c=p.pool.acquire(a,b,g,e),g=null),void u(c))});return{remove:m.once(function(){x.remove();c&&(c.removed=!0,u(c),c=null);d=x=g=null})}});return d}function D(a,c,b){var d=m.parse(a,
c,b,function(a,b,c){var e=k.valueOf(a,b,!0),g=!1;return t.wire(a,b,function(a,b){if(a.__accessor__.destroyed)return void d.remove();if(!g){g=!0;var f=k.valueOf(a,b,!0);!r.equals(e,f)&&c.call(a,f,e,b,a);e=k.valueOf(a,b,!0);g=!1}})});return d}function y(a,c,b,d){return void 0===d&&(d=!1),!a.__accessor__||a.__accessor__.destroyed?{remove:function(){}}:d?D(a,c,b):C(a,c,b)}Object.defineProperty(f,"__esModule",{value:!0});var p=function(){function a(a,b,c,f){this.target=a;this.path=b;this.oldValue=c;this.callback=
f;this.removed=!1;this.propertyPath=m.pathToStringOrArray(b)}return a.prototype.release=function(){this.target=this.path=this.propertyPath=this.callback=this.oldValue=null;this.removed=!0},a}();p.pool=new A(p,!0);var n,h=new B,l=new Set,c=h.acquire();f.dispatchTarget=function(a){for(var e=h.copy(c),b=0;b<e.length;b++){var d=e[b];d.target===a&&(w(d),l["delete"](d),c.splice(c.indexOf(d),1))}};f.removeTarget=function(a){for(var e=0;e<c.length;e++){var b=c[e];b.target===a&&(b.removed=!0)}};f.dispatch=
v;f.watch=y;f["default"]=y});