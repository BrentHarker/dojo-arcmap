//>>built
define("require exports dojo/_base/window dojo/_base/lang dojo/_base/url dojo/io-query ../config ./lang ./sniff ./Logger ./Error".split(" "),function(A,d,T,U,h,r,B,V,C,W,X){function t(a){var b={path:null,query:null},c=new h(a),e=a.indexOf("?");return null===c.query?b.path=a:(b.path=a.substring(0,e),b.query=r.queryToObject(c.query)),c.fragment&&(b.hash=c.fragment,null===c.query&&(b.path=b.path.substring(0,b.path.length-(c.fragment.length+1)))),b}function D(a,b){void 0===a&&(a=!1);void 0===b&&(b=!0);
var c,e=l.proxyUrl;"string"==typeof a?(c=E(a),(a=u(a))&&(e=a.proxyUrl)):c=!!a;if(!e)throw Y.warn(F),new X("urlutils:proxy-not-set",F);var g;c&&b&&"https"===d.appUrl.scheme&&(b=G(e),v(b)&&(e=b,g=1));e=t(e);return e._xo=g,e}function H(a){var b=a.indexOf("?");return-1!==b?(m.path=a.slice(0,b),m.query=a.slice(b+1)):(m.path=a,m.query=null),m}function I(a){return a=H(a).path,a=a&&"/"===a[a.length-1]?a:a+"/",a=w(a,!0),a=a.toLowerCase()}function u(a){var b=l.proxyRules;a=I(a);for(var c=0;c<b.length;c++)if(0===
a.indexOf(b[c].urlPrefix))return b[c]}function J(a){a=n(a);var b=a.indexOf("/sharing");return 0<b?a.substring(0,b):a.replace(/\/+$/,"")}function x(a,b,c){void 0===c&&(c=!1);a=y(a);b=y(b);return c||a.scheme===b.scheme?a.host.toLowerCase()===b.host.toLowerCase()&&a.port===b.port:!1}function v(a){return C("esri-phonegap")?!0:C("esri-cors")?null!=K(a):!1}function K(a,b){void 0===b&&(b=!1);"string"==typeof a&&(a=p(a)?y(a):d.appUrl);for(var c=l.corsEnabledServers||[],e=0;e<c.length;e++)for(var g=c[e],z=
void 0,z="string"==typeof g?L(g):g.host?L(g.host):[],f=0;f<z.length;f++)if(x(a,z[f]))return b?e:g;return b?-1:null}function L(a){return d.corsServersUrlCache[a]||(q(a)||f(a)?d.corsServersUrlCache[a]=[new h(k(a))]:d.corsServersUrlCache[a]=[new h("http://"+a),new h("https://"+a)]),d.corsServersUrlCache[a]}function k(a,b,c){void 0===b&&(b=d.appBaseUrl);if(f(a))a=c&&c.preserveProtocolRelative?a:"http"===d.appUrl.scheme&&d.appUrl.authority===M(a).slice(2)?"http:"+a:"https:"+a;else if(!q(a)){c=N;if("/"===
a[0]){var e=b.indexOf("//"),e=b.indexOf("/",e+2);b=-1===e?b:b.slice(0,e)}a=c(b,a)}return a}function O(a,b,c){if(void 0===b&&(b=d.appBaseUrl),!p(a))return a;var e=n(a),g=e.toLowerCase();b=n(b).toLowerCase().replace(/\/+$/,"");if((c=c?n(c).toLowerCase().replace(/\/+$/,""):null)&&0!==b.indexOf(c))return a;for(var f=function(a,b,c){return c=a.indexOf(b,c),-1===c?a.length:c},h=f(g,"/",g.indexOf("//")+2),k=-1;g.slice(0,h+1)===b.slice(0,h)+"/"&&(k=h+1,h!==g.length);)h=f(g,"/",h+1);if(-1===k||c&&k<c.length)return a;
a=e.slice(k);e=b.slice(k-1).replace(/[^\/]+/g,"").length;if(0<e)for(g=0;e>g;g++)a="../"+a;else a="./"+a;return a}function n(a){a=a.trim();var b=a=k(a);return a="http"===d.appUrl.scheme&&E(b)&&x(d.appBaseUrl,b,!0)&&!v(b)?f(b)?"http:"+b:b.replace(P,"http:"):b,a=Z(a),a=a.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function N(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];if(a&&a.length){b=[];if(p(a[0])){var c=a[0],e=c.indexOf("//");b.push(c.slice(0,e+1));aa.test(a[0])&&(b[0]+="/");
a[0]=c.slice(e+2)}else"/"===a[0][0]&&b.push("");a=a.reduce(function(a,b){return a.concat(b.split("/"))},[]);for(c=0;c<a.length;c++)e=a[c],".."===e&&0<b.length?b.pop():!e||"."===e&&0!==b.length||b.push(e);return b.join("/")}}function M(a){if(Q(a))return null;var b=a.indexOf("://");if(-1===b&&f(a))b=2;else{if(-1===b)return null;b+=3}b=a.indexOf("/",b);return-1===b?a:a.slice(0,b)}function p(a){return f(a)||q(a)}function Q(a){return"data:"===a.slice(0,5)}function f(a){return a&&"/"===a[0]&&"/"===a[1]}
function q(a){return R.test(a)}function E(a){return P.test(a)||"https"===d.appUrl.scheme&&f(a)}function ba(a){return S.test(a)||"http"===d.appUrl.scheme&&f(a)}function G(a){return f(a)?"https:"+a:a.replace(S,"https:")}function w(a,b){return void 0===b&&(b=!1),f(a)?a.slice(2):(a=a.replace(R,""),b&&1<a.length&&"/"===a[0]&&"/"===a[1]&&(a=a.slice(2)),a)}function Z(a){var b=B.request.httpsDomains;if(!ba(a))return a;var c,e=a.indexOf("/",7);return c=-1===e?a:a.slice(0,e),c=c.toLowerCase().slice(7),"http"===
d.appUrl.scheme&&c===d.appUrl.authority?a:(("https"===d.appUrl.scheme&&c===d.appUrl.authority||b&&b.some(function(a){return c===a||V.endsWith(c,"."+a)}))&&(a=G(a)),a)}function y(a){return"string"==typeof a?new h(k(a)):(a.scheme||(a.scheme=d.appUrl.scheme),a)}Object.defineProperty(d,"__esModule",{value:!0});A=T.global;var Y=W.getLogger("esri.core.urlUtils"),l=B.request,F="esri/config: esriConfig.request.proxyUrl is not set. If making a request to a CORS-enabled\n server, please push the domain into esriConfig.request.corsEnabledServers.",
R=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,S=/^\s*http:/i,P=/^\s*https:/i,aa=/^\s*file:/i;d.appUrl=new h(A.location);d.corsServersUrlCache={};d.appBaseUrl=function(){var a=d.appUrl.path,a=a.substring(0,a.lastIndexOf(a.split("/")[a.split("/").length-1]));return""+(d.appUrl.scheme+"://"+d.appUrl.host+(null!=d.appUrl.port?":"+d.appUrl.port:""))+a}();d.urlToObject=t;d.getProxyUrl=D;d.addProxy=function(a){var b,c,e=u(a);e?(c=H(e.proxyUrl),b=c.path,c=c.query?r.queryToObject(c.query):null):l.forceProxy&&(c=D(),
b=c.path,c=c.query);b&&(e=t(a),a=b+"?"+e.path,(b=r.objectToQuery(U.mixin(c||{},e.query)))&&(a=a+"?"+b));return a};var m={path:"",query:""};d.addProxyRule=function(a){a={proxyUrl:a.proxyUrl,urlPrefix:I(a.urlPrefix)};for(var b=l.proxyRules,c=a.urlPrefix,e=b.length,d=0;d<b.length;d++){var f=b[d].urlPrefix;if(0===c.indexOf(f)){if(c.length===f.length)return-1;e=d;break}0===f.indexOf(c)&&(e=d+1)}return b.splice(e,0,a),e};d.getProxyRule=u;d.hasSamePortal=function(a,b){return a=J(a),b=J(b),w(a)===w(b)};d.hasSameOrigin=
x;d.canUseXhr=v;d.getCorsConfig=K;d.makeAbsolute=k;d.makeRelative=O;d.normalize=n;d.join=N;d.getOrigin=M;d.isAbsolute=p;d.isDataProtocol=Q;var ca=/^data:(.*?)(;base64)?,(.*)$/;d.dataComponents=function(a){return(a=a.match(ca))?{mediaType:a[1],isBase64:!!a[2],data:a[3]}:null};d.makeData=function(a){return a.isBase64?"data:"+a.mediaType+";base64,"+a.data:"data:"+a.mediaType+","+a.data};d.isProtocolRelative=f;d.hasProtocol=q;d.read=function(a,b){b=b&&b.url&&b.url.path;return a&&b?k(a,b,{preserveProtocolRelative:!0}):
a};d.write=function(a,b){if(!a)return a;!p(a)&&b&&b.blockedRelativeUrls&&b.blockedRelativeUrls.push(a);var c=k(a);if(b){var d=b.verifyItemRelativeUrls&&b.verifyItemRelativeUrls.rootPath||b.url&&b.url.path;d&&(c=O(c,d,d),c!==a&&b.verifyItemRelativeUrls&&b.verifyItemRelativeUrls.writtenUrls.push(c))}return c};d.isSVG=function(a){return da.test(a)};var da=/(^data:image\/svg|\.svg$)/i});