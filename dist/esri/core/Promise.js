//>>built
define("./declare dojo/promise/all dojo/aspect dojo/Deferred dojo/errors/create ./Scheduler".split(" "),function(l,m,n,g,p,q){var h=function(a){if(!a.isFulfilled()){var d,c,b=a._promiseProps,f=b.resolvingPromises;b.allPromise&&b.allPromise.cancel();var e=new g;for(d=f.length-1;0<=d;d--)c=f[d],c.isCanceled&&c.isCanceled()?f.splice(d,1):c.then(null,null,b.resolver.progress);c=null;(b.allPromise=m(f.concat([e.promise]))).then(function(){b.resolver.resolve(a);a=b=e=b.allPromise=b.resolvingPromises=null},
function(c){if(b.allPromise=null,!c||"cancel"!==c.dojoType){var d=Array.prototype.slice.call(arguments,0);b.resolver.reject(d[0]);a=b=e=b.allPromise=b.resolvingPromises=null}});e&&q.schedule(function(){e&&e.resolve()})}},r=p("CancelError",null,function(a){this.target=a}),t=function(a){return a||new r(this.instance)},k=function(a){this.instance=a;this.canceler=t.bind(this);this.resolver=new g;this.initialized=!1;this.resolvingPromises=[]};k.prototype={canceler:null,cancel:function(a){if(!this.resolver.isFulfilled()){this.allPromise.cancel();
for(var d=this.resolvingPromises.concat(),c=d.length-1;0<=c;c--)d[c].cancel(a);this.resolver.cancel(a)}}};return l(null,{declaredClass:"esri.core.Promise",constructor:function(){Object.defineProperty(this,"_promiseProps",{value:new k(this),enumerable:!1,configurable:!1,writable:!0});var a=n.after(this,"postscript",function(d,c){a.remove();a=null;h(this)},!0)},_promiseProps:null,always:function(a){return this.then(a,a)},then:function(a,d,c){var b=new g(this._promiseProps.canceler);a=b.then(a,d,c);
return this._promiseProps.resolver.then(b.resolve,b.reject,b.progress),a},isResolved:function(){return this._promiseProps.resolver.isResolved()},isRejected:function(){return this._promiseProps.resolver.isRejected()},isFulfilled:function(){return this._promiseProps.resolver.isFulfilled()},otherwise:function(a){return this.then(null,a)},addResolvingPromise:function(a){a&&!this.isFulfilled()&&(this._promiseProps.resolvingPromises.push(a),h(this))}})});