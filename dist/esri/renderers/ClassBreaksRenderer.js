//>>built
define("../core/declare ../core/lang ../core/kebabDictionary ../core/Error dojo/_base/array dojo/_base/lang ../symbols/support/jsonUtils ./Renderer ./support/arcadeUtils".split(" "),function(r,e,l,k,t,m,g,u,h){var n=l({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"}),p=l({esriClassifyNaturalBreaks:"natural-breaks",esriClassifyEqualInterval:"equal-interval",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyGeometricalInterval:"geometrical-interval"}),
q=r(u,{declaredClass:"esri.renderers.ClassBreaksRenderer",properties:{backgroundFillSymbol:{value:null,json:{read:g.read,write:function(a,b,d,c){(a=g.write(a,{},c))&&(b.backgroundFillSymbol=a)}}},classBreakInfos:{set:function(a){a&&a.forEach(this._processCBInfo,this);this._set("classBreakInfos",a)},json:{read:{source:["classBreakInfos","minValue"],reader:function(a,b,d){var c=b.minValue;if(a&&Array.isArray(a)){var f=a[0]&&null!=a[0].classMaxValue;return a.map(function(a){if(a=e.clone(a),f){var h=
a.classMaxValue;a.minValue=c;c=a.maxValue=h}return a.symbol=g.read(a.symbol,b,d),a})}return a}},write:function(a,b,d,c){a=this.classBreakInfos||[];d=a[0]&&a[0].minValue;b.minValue=d===-(1/0)?-Number.MAX_VALUE:d;b.classBreakInfos=t.map(a,function(a){return a=e.clone(a),a.symbol&&(a.symbol=g.write(a.symbol,{},c)),a.classMaxValue=a.maxValue===1/0?Number.MAX_VALUE:a.maxValue,delete a.minValue,delete a.maxValue,e.fixJson(a)})}}},classificationMethod:{value:null,json:{read:p.fromJSON,write:function(a,b){(a=
p.toJSON(a))&&(b.classificationMethod=a)}}},defaultLabel:{value:null,json:{write:!0}},defaultSymbol:{value:null,json:{read:g.read,write:function(a,b,d,c){(a=g.write(a,{},c))&&(b.defaultSymbol=a)}}},valueExpression:{value:null,json:{write:function(a,b,d,c){c&&"web-scene"===c.origin?a&&c.messages&&c.messages.push(new k("property:unsupported",this.declaredClass+".valueExpression is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:"valueExpression",
context:c})):b.valueExpression=a}}},valueExpressionTitle:{value:null,json:{write:function(a,b,d,c){c&&"web-scene"===c.origin?a&&c.messages&&c.messages.push(new k("property:unsupported",this.declaredClass+".valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:"valueExpressionTitle",context:c})):b.valueExpressionTitle=a}}},compiledFunc:{dependsOn:["valueExpression"],get:function(){return h.createFunction(this.valueExpression)}},
legendOptions:{value:null,json:{read:function(a){return e.clone(a)},write:function(a,b,d,c){c&&"web-scene"===c.origin?a&&c.messages&&c.messages.push(new k("property:unsupported",this.declaredClass+".legendOptions is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:"legendOptions",context:c})):b.legendOptions=e.clone(a)}}},field:{value:null,json:{write:!0}},isMaxInclusive:!0,normalizationField:{value:null,json:{write:!0}},normalizationTotal:{value:null,
json:{write:!0}},normalizationType:{value:null,dependsOn:["normalizationField","normalizationTotal"],get:function(){var a=this._get("normalizationType"),b=!!this.normalizationField,d=null!=this.normalizationTotal;return b||d?(a=b&&"field"||d&&"percent-of-total",b&&d&&console.warn("warning: both normalizationField and normalizationTotal are set!")):("field"===a||"percent-of-total"===a)&&(a=null),a},json:{read:n.fromJSON,write:function(a,b){(a=n.toJSON(a))&&(b.normalizationType=a)}}},requiredFields:{dependsOn:["field",
"normalizationField"]},type:"classBreaks"},constructor:function(){this.classBreakInfos=[]},addClassBreakInfo:function(a,b,d){a=m.isObject(a)?a:{minValue:a,maxValue:b,symbol:d};this.classBreakInfos.push(a);this._processCBInfo(a)},removeClassBreakInfo:function(a,b){var d,c,f=this.classBreakInfos.length;for(c=0;f>c;c++)if(d=[this.classBreakInfos[c].minValue,this.classBreakInfos[c].maxValue],d[0]==a&&d[1]==b){this.classBreakInfos.splice(c,1);break}},getBreakIndex:function(a,b){var d,c,f=this.field;d=
a.attributes;var e=this.classBreakInfos.length,g=this.isMaxInclusive;if(this.valueExpression)a=h.executeFunction(this.compiledFunc,h.createExecContext(a,h.getViewInfo(b)));else if(m.isFunction(f))a=f(a);else if(a=parseFloat(d[f]),f=this.normalizationType)if(b=parseFloat(this.normalizationTotal),d=parseFloat(d[this.normalizationField]),"log"===f)a=Math.log(a)*Math.LOG10E;else if("percent-of-total"!==f||isNaN(b)){if("field"===f&&!isNaN(d)){if(isNaN(a)||isNaN(d))return-1;a/=d}}else a=a/b*100;if(null!=
a&&!isNaN(a)&&"number"==typeof a)for(d=0;e>d;d++)if(c=[this.classBreakInfos[d].minValue,this.classBreakInfos[d].maxValue],c[0]<=a&&(g?a<=c[1]:a<c[1]))return d;return-1},getClassBreakInfo:function(a,b){a=this.getBreakIndex(a,b);return-1!==a?this.classBreakInfos[a]:null},getSymbol:function(a,b){a=this.getBreakIndex(a,b);return-1<a?this.classBreakInfos[a].symbol:this.defaultSymbol},clone:function(){return new q({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),
classificationMethod:this.classificationMethod,defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:e.clone(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:e.clone(this.visualVariables),legendOptions:e.clone(this.legendOptions),
authoringInfo:e.clone(this.authoringInfo)})},collectRequiredFields:function(a){this.inherited(arguments);[this.field,this.normalizationField].forEach(function(b){b&&(a[b]=!0)})},_processCBInfo:function(a){var b=(a.minValue,a.maxValue,a.symbol);b&&(b.declaredClass||(a.symbol=g.fromJSON(b)))}});return q});