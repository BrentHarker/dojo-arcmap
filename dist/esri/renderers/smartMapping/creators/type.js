//>>built
define("require exports dojo/i18n!../../nls/smartMapping dojo/_base/lang ../symbology/type ../../../core/promiseUtils ../../../core/lang ../support/utils ./support/utils ../../../views/SceneView ../statistics/uniqueValues ../../UniqueValueRenderer ../../support/utils".split(" "),function(L,t,z,u,v,g,A,l,h,B,C,D,p){function E(b){if(!b||!b.layer||!b.field&&!b.valueExpression)return g.reject(h.createError("type-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required"));
var a=u.mixin({},b);return a.symbolType=a.symbolType||"2d",a.layer=l.createLayerAdapter(a.layer),a.numTypes=null==a.numTypes?10:a.numTypes,a.defaultSymbolEnabled=null==a.defaultSymbolEnabled?!0:a.defaultSymbolEnabled,a.sortBy=null==a.sortBy?"count":a.sortBy,a.statistics=A.clone(a.statistics),a.layer?a.layer.load().then(function(){var b=a.layer.geometryType,d=-1<a.symbolType.indexOf("3d");if("mesh"===b)a.symbolType="3d-volumetric",a.colorMixMode=a.colorMixMode||"replace";else{if(d&&("polyline"===b||
"polygon"===b))return g.reject(h.createError("type-renderer:not-supported","3d symbols are not supported for polyline and polygon layers"));if(-1<a.symbolType.indexOf("3d-volumetric")&&!(a.view instanceof B))return g.reject(h.createError("type-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'"))}b=l.getFieldsList({field:a.field,valueExpression:a.valueExpression});return(b=h.verifyBasicFieldValidity(a.layer,
b,"type-renderer:invalid-parameters"))?g.reject(b):a}):g.reject(h.createError("type-renderer:invalid-parameters","'layer' must be one of these types: "+F))}function w(b,a){var c=b.typeScheme,d=b.basemap;c?c=v.cloneScheme(c):(c=(b=v.getSchemes({basemap:b.basemap,geometryType:a,worldScale:-1<b.symbolType.indexOf("3d-volumetric"),view:b.view}))&&b.primaryScheme,d=b&&b.basemapId);return{scheme:c,basemapId:d}}function x(b,a){return b.label<a.label?-1:b.label>a.label?1:0}function y(b,a){return b.value<
a.value?-1:b.value>a.value?1:0}function G(b,a){var c=a.count-b.count;return 0===c&&(c=x(b,a)),c}function H(b,a){var c=a.count-b.count;return 0===c&&(c=y(b,a)),c}function I(b,a,c){var d;"count"===a?(d=H,c&&c.codedValues&&(d=G)):"value"===a&&(d=y,c&&c.codedValues&&(d=x));d&&b.sort(d)}function J(b,a){var c;b=b.uniqueValueInfos;var d=a.layer,f=a.field,e=f?d.getField(f):null,g=e?d.getFieldDomain(e.name):null,l=-1===a.numTypes?b.length:a.numTypes,m=d.geometryType,d=w(a,m),k=d.scheme,f=new D({field:f}),
q=-1,n={value:null,domain:g,fieldInfo:e};if(b.forEach(function(a,b){n.value=a.value;a.label=p.createUniqueValueLabel(n);null===a.value&&(q=b)}),-1<q&&(c=b.splice(q,1)[0]),I(b,a.sortBy,g),e&&e.type===K)e=b.filter(function(a,b){return l>b}).map(function(a){return a.value}),n.dateFormatInterval=p.calculateDateFormatInterval(e);var r=h.createColors(k.colors,b.length);b.forEach(function(b,c){n.value=b.value;b.label=p.createUniqueValueLabel(n);b.symbol=h.createSymbol(k,r[c],m,a.symbolType,a.colorMixMode)});
a.valueExpression&&(f.valueExpression=a.valueExpression,f.valueExpressionTitle=a.valueExpressionTitle);f.legendOptions=a.legendOptions;r=h.createColors(k.colors,l);for(e=0;l>e;e++)(g=b[e])&&f.addUniqueValueInfo({value:g.value,label:g.label,symbol:h.createSymbol(k,r[e],m,a.symbolType,a.colorMixMode)});a.defaultSymbolEnabled&&(f.defaultSymbol=h.createSymbol(k,k.noDataColor,m,a.symbolType,a.colorMixMode),f.defaultLabel=z.other);c&&(c.symbol=h.createSymbol(k,k.noDataColor,m,a.symbolType,a.colorMixMode),
b.push(c));c=[];e=f.uniqueValueInfos.length===b.length?-1:f.uniqueValueInfos.length;if(-1<e)for(;e<b.length;e++)c.push(u.mixin({},b[e]));return{renderer:f,uniqueValueInfos:b,excludedUniqueValueInfos:c,typeScheme:w(a,m).scheme,basemapId:d.basemapId}}Object.defineProperty(t,"__esModule",{value:!0});var F=l.supportedLayerTypes.join(", "),K="date";t.createRenderer=function(b){return E(b).then(function(a){return(null!=a.statistics?g.resolve(a.statistics):C({layer:a.layer,field:a.field,valueExpression:a.valueExpression,
returnAllCodedValues:a.returnAllCodedValues})).then(function(b){return J(b,a)})})}});