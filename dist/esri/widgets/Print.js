//>>built
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./Print/PrintViewModel ../tasks/support/PrintTemplate ../core/watchUtils ./Widget ./Print/FileLink ../core/urlUtils ./support/widget dojo/i18n!./Print/nls/Print".split(" "),function(e,w,p,k,l,m,q,n,r,t,u,a,c){e=function(e){function d(){var a=e.call(this)||this;return a._attribution=!0,a._exportedFileNameMap={},a._layoutTabSelected=!0,a._legend=!0,a._advancedOptionsVisible=
!1,a._pendingExportScroll=!1,a._selectedTemplate=new q,a._scaleEnabled=!1,a._templatesInfo=null,a.view=null,a.viewModel=new m,a.printServiceUrl=null,a}return p(d,e),d.prototype.postInitialize=function(){var a=this;n.init(this,"viewModel.templatesInfo",function(b){b&&(a._templatesInfo=b,a._selectedTemplate.layout=a._templatesInfo.layout.defaultValue,a._selectedTemplate.format=a._templatesInfo.format.defaultValue,"MAP_ONLY"===a._selectedTemplate.layout&&(a._layoutTabSelected=!1))});n.init(this,"viewModel.view.scale",
function(b){a._scaleEnabled||(a._scale=b,a.scheduleRender())});this._width=this._selectedTemplate.exportOptions.width;this._height=this._selectedTemplate.exportOptions.height},d.prototype.render=function(){var v=this,b=a.tsx("div",{key:"title-section","class":"esri-print__form-section-container"},a.tsx("label",{"for":this.id+"__title"},this._layoutTabSelected?c.title:c.fileName),a.tsx("input",{key:this.id+"__title",name:"title",type:"text",tabIndex:0,placeholder:this._layoutTabSelected?c.titlePlaceHolder:
c.fileNamePlaceHolder,"class":"esri-print__input-text",oninput:this._updateInputValue,bind:this})),h=this.get("_templatesInfo.format.choiceList")||[],h=0<h.length?h.map(function(b){return a.tsx("option",{key:b},b)}):a.tsx("option",{key:"format-default-option"},c.formatDefaultOption),h=a.tsx("div",{key:"file-format-section","class":"esri-print__form-section-container"},a.tsx("label",{"for":this.id+"__formats"},c.fileFormatTitle),a.tsx("select",{key:this.id+"__formats",onchange:this._updateFromOption,
"data-target-property":"format",bind:this},h)),f=this.get("_templatesInfo.layout.choiceList")||[],f=0<f.length?f.map(function(b){return a.tsx("option",{key:b,bind:v},b)}):a.tsx("option",{key:"layout-default-option"},c.layoutDefaultOption),f=a.tsx("div",{key:"page-setup-section","class":"esri-print__form-section-container"},a.tsx("label",{"for":this.id+"__layouts"},c.layoutTitle),a.tsx("select",{key:this.id+"__layouts",onchange:this._updateFromOption,"data-target-property":"layout",bind:this},f)),
d=this._advancedOptionsVisible?a.tsx("div",{"aria-labelledby":this.id+"__advancedOptions","class":"esri-print__advanced-options-container"},a.tsx("div",{"class":a.join("esri-print__scale-info-container","esri-print__form-section-container")},a.tsx("input",{key:this.id+"__scaleEnabled",name:"scaleEnabled",type:"checkbox",tabIndex:0,onchange:this._toggleInputValue,bind:this}),a.tsx("label",{"for":this.id+"__scaleEnabled"},c.scale),a.tsx("div",{"class":"esri-print__scale-input-container"},a.tsx("input",
{key:this.id+"__scale","aria-label":c.scaleLabel,type:"number",name:"scale","class":a.join("esri-print__input-text","esri-print__scale-input"),tabIndex:0,oninput:this._updateInputValue,disabled:!this._scaleEnabled,value:""+this._scale,bind:this}),a.tsx("button",{role:"button","aria-label":c.reset,"class":a.join("esri-widget-button","esri-print__refresh-button","esri-icon-refresh"),tabIndex:0,onclick:this._resetToCurrentScale,bind:this}))),a.tsx("div",{"class":a.join("esri-print__author-info-container",
"esri-print__form-section-container")},a.tsx("label",{"for":this.id+"__author"},c.author),a.tsx("input",{key:this.id+"__author",type:"text",name:"author","class":"esri-print__input-text",tabIndex:0,oninput:this._updateInputValue,bind:this})),a.tsx("div",{"class":a.join("esri-print__copyright-info-container","esri-print__form-section-container")},a.tsx("label",{"for":this.id+"__copyright"},c.copyright),a.tsx("input",{key:this.id+"__copyright",type:"text",name:"copyright","class":"esri-print__input-text",
tabIndex:0,oninput:this._updateInputValue,bind:this})),a.tsx("div",{"class":a.join("esri-print__legend-info-container","esri-print__form-section-container")},a.tsx("input",{key:this.id+"__legend",type:"checkbox",name:"legend",tabIndex:0,checked:!0,onchange:this._toggleInputValue,bind:this}),a.tsx("label",{"for":this.id+"__legend"},c.legend))):null,b=this._layoutTabSelected?a.tsx("section",{key:this.id+"__layoutContent","aria-labelledby":this.id+"__layoutTab","class":"esri-print__layout-section"},
a.tsx("div",{key:"layout","class":"esri-print__panel-container"},b,f,this._layoutTabSelected?h:null),a.tsx("div",{key:"advanced-section","class":a.join("esri-print__panel-container","esri-print__advanced-options-section")},a.tsx("button",{key:this.id+"__advancedOptions","aria-label":c.advancedOptions,"aria-expanded":this._advancedOptionsVisible?"true":"false",role:"button","class":"esri-print__advanced-options-button",onclick:this._showAdvancedOptions,bind:this},a.tsx("div",{"class":"esri-print__advanced-options-button-container"},
a.tsx("span",{"aria-hidden":"true","class":a.join("esri-icon-right-triangle-arrow","esri-print__advanced-options-button-icon--closed")}),a.tsx("span",{"aria-hidden":"true","class":a.join("esri-icon-left-triangle-arrow","esri-print__advanced-options-button-icon--closed-rtl")}),a.tsx("span",{"aria-hidden":"true","class":a.join("esri-icon-down-arrow","esri-print__advanced-options-button-icon--opened")}),a.tsx("span",{"class":"esri-print__advanced-options-button-title"},c.advancedOptions))),d)):a.tsx("section",
{key:this.id+"__mapOnlyContent","aria-labelledby":this.id+"__mapOnlyTab","class":"esri-print__map-only-section"},a.tsx("div",{key:"mapOnly","class":"esri-print__panel-container"},b,this._layoutTabSelected?null:h,a.tsx("div",{"class":a.join("esri-print__size-container","esri-print__form-section-container")},a.tsx("div",{"class":"esri-print__width-container"},a.tsx("label",{"for":"width"},c.width),a.tsx("input",{key:this.id+"__width",type:"text",name:"width","class":"esri-print__input-text",onchange:this._updateInputValue,
value:""+this._width,tabIndex:0,bind:this})),a.tsx("div",{"class":"esri-print__height-container"},a.tsx("label",{"for":"height"},c.height),a.tsx("input",{key:this.id+"__height",type:"text",name:"height","class":"esri-print__input-text",onchange:this._updateInputValue,value:""+this._height,tabIndex:0,bind:this})),a.tsx("button",{role:"button","aria-label":c.swap,"class":a.join("esri-widget-button","esri-print__swap-button","esri-icon-swap"),onclick:this._switchInput,tabIndex:0,bind:this})),a.tsx("div",
{key:"attribution-container","class":"esri-print__form-section-container"},a.tsx("input",{key:this.id+"__attribution",name:"attribution",type:"checkbox",onchange:this._toggleInputValue,tabIndex:0,checked:!0,bind:this}),a.tsx("label",{"for":"attribution"},c.attribution)))),h=this.exportedLinks.toArray(),f=this._renderExportedLink(h),d=(g={},g["esri-disabled"]=!this._selectedTemplate.layout&&!this._selectedTemplate.format,g),g="2d"!==this.get("view.type"),e=a.tsx("div",{key:this.id+"__errorPanel","class":"esri-print__panel--error"},
g?c.sceneViewError:c.serviceError),b=a.tsx("div",{key:this.id+"__printPanel"},a.tsx("ul",{"class":"esri-print__layout-tab-list",role:"tablist",onclick:this._toggleLayoutPanel,onkeydown:this._toggleLayoutPanel,bind:this},a.tsx("li",{key:this.id+"__layoutTab","data-tab-id":"layoutTab","class":"esri-print__layout-tab",role:"tab",tabIndex:0,"aria-selected":""+this._layoutTabSelected,bind:this},c.layoutTab),a.tsx("li",{key:this.id+"__mapOnlyTab","data-tab-id":"mapOnlyTab","class":"esri-print__layout-tab",
role:"tab",tabIndex:0,"aria-selected":""+!this._layoutTabSelected,bind:this},c.mapOnlyTab)),b,a.tsx("button",{"aria-label":c.exportDescription,role:"button","class":"esri-print__export-button",tabIndex:0,classes:d,onclick:this._handlePrintMap,bind:this},c["export"]),a.tsx("div",{key:this.id+"__exportedFilesContainer","class":"esri-print__export-panel-container",afterUpdate:this._scrollExportIntoView,onclick:this._removeLink,bind:this},a.tsx("h2",{"class":"esri-print__export-title"},c.exportText),
0<h.length?null:a.tsx("div",{key:"exported-section-hints"},a.tsx("div",null,c.exportHint)),f)),g=a.tsx("div",{key:this.id+"__printContainer"},a.tsx("div",{"class":"esri-print__container"},a.tsx("header",{"class":"esri-print__header-title"},c["export"]),this.error||!this.printServiceUrl||g?e:b));return a.tsx("div",{"class":"esri-print esri-widget"},g);var g},d.prototype._configurePrintTemplate=function(){this._selectedTemplate.attributionVisible=this._attribution;this._width&&(this._selectedTemplate.exportOptions.width=
this._width);this._height&&(this._selectedTemplate.exportOptions.height=this._height);this._selectedTemplate.layoutOptions={titleText:this._title||"",authorText:this._author||"",copyrightText:this._copyright||""};this._legend||(this._selectedTemplate.layoutOptions.legendLayers=[]);this.scale=this._scale;this._selectedTemplate.outScale=this.scale;var a=this._title||c.untitled,b=this._selectedTemplate.format.toLowerCase(),b=-1<b.indexOf("png")?"png":b,d=a+b;void 0!==this._exportedFileNameMap[d]?this._exportedFileNameMap[d]++:
this._exportedFileNameMap[d]=0;this.exportedLinks.add(new t({name:a,extension:b,count:this._exportedFileNameMap[d]}))},d.prototype._resetToCurrentScale=function(){this._scale=this.viewModel.view.scale},d.prototype._updateInputValue=function(a){a=a.target;this["_"+a.name]=a.value},d.prototype._handlePrintMap=function(){this._configurePrintTemplate();this._pendingExportScroll=!0;this.viewModel.print(this._selectedTemplate)},d.prototype._updateFromOption=function(a){var b=a.target;a=b.selectedOptions.item(0).value;
var c=this._selectedTemplate,b=b.getAttribute("data-target-property");c[b]=a},d.prototype._switchInput=function(){a=[this._height,this._width];this._width=a[0];this._height=a[1];var a},d.prototype._showAdvancedOptions=function(){this._advancedOptionsVisible=!this._advancedOptionsVisible},d.prototype._scrollExportIntoView=function(a){this._pendingExportScroll&&(this._pendingExportScroll=!1,a.scrollIntoView())},d.prototype._toggleInputValue=function(a){a=a.target;var b="_"+a.name;this[b]=a.checked;
"_scaleEnabled"===b&&(this.viewModel.scaleEnabled=this[b],this[b]||this._resetToCurrentScale())},d.prototype._removeLink=function(a){(a=a.target["data-item"])&&"error"===a.state&&this.exportedLinks.remove(a)},d.prototype._renderExportedLink=function(d){return d.map(function(b){var d=(f={},f["esri-icon-loading-indicator"]="pending"===b.state,f["esri-rotating"]="pending"===b.state,f["esri-icon-download"]="ready"===b.state,f["esri-icon-error"]="error"===b.state,f["esri-print__exported-file--error"]=
"error"===b.state,f),f=(g={},g["esri-disabled"]="pending"===b.state,g["esri-print__exported-file--error"]="error"===b.state,g);(g=""===b.url?null:b.url)&&(g=u.addProxy(g));var e;return e="pending"===b.state?c.pending:"ready"===b.state?c.ready:c.error,a.tsx("div",{"aria-label":e,key:b.formattedName,"class":"esri-print__exported-file"},a.tsx("a",{href:g,tabIndex:0,target:"_blank","class":"esri-print__exported-file-link"},a.tsx("span",{"data-item":b,classes:d}),a.tsx("span",{"data-item":b,"class":"esri-print__exported-file-link-title",
classes:f},b.formattedName)));var f,g})},d.prototype._resetInputValue=function(){this._title="";this._selectedTemplate.format=this._templatesInfo.format.defaultValue},d.prototype._toggleLayoutPanel=function(a){this._resetInputValue();(this._layoutTabSelected="layoutTab"===a.target.getAttribute("data-tab-id"),this._layoutTabSelected)?(a=this.get("_templatesInfo.layout.choiceList"),this._selectedTemplate.layout=a&&a[0]):this._selectedTemplate.layout="MAP_ONLY"},d}(l.declared(r));return k([l.aliasOf("viewModel.view"),
a.renderable()],e.prototype,"view",void 0),k([l.property({type:m}),a.renderable(["viewModel.templatesInfo","viewModel.state"])],e.prototype,"viewModel",void 0),k([l.aliasOf("viewModel.printServiceUrl")],e.prototype,"printServiceUrl",void 0),k([l.aliasOf("viewModel.scale"),a.renderable()],e.prototype,"scale",void 0),k([l.aliasOf("viewModel.exportedLinks"),a.renderable()],e.prototype,"exportedLinks",void 0),k([l.aliasOf("viewModel.error")],e.prototype,"error",void 0),k([a.accessibleHandler()],e.prototype,
"_toggleLayoutPanel",null),e=k([l.subclass("esri.widgets.Print")],e)});