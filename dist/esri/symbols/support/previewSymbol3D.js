//>>built
define("require exports ../../core/Logger ../../core/promiseUtils ../../core/Error ../../core/screenUtils ./symbolUtils ./gfxUtils ./renderUtils ./previewUtils".split(" "),function(M,G,N,v,H,k,D,O,C,p){function y(a){var c=a.outline,b=a.get("material.color"),b=b&&b.toRgba().toString();if(!c)return"fill"===a.type&&"255,255,255,1"===b?{color:"#bdc3c7",width:.75}:null;a=k.pt2px(c.size)||0;return{color:"rgba("+(null!=c.color?c.color.toRgba():"255,255,255,1")+")",width:Math.min(a,E)}}function P(a,c){var b=
c&&c.resource;return b&&b.href&&"object"!==c.type?v.resolve(D.getIconHref(a,c)):a.thumbnail&&a.thumbnail.url?v.resolve(a.thumbnail.url):a.styleOrigin&&(a.styleOrigin.styleName||a.styleOrigin.styleUrl)?D.fetchStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal}).always(function(a){return a&&a.thumbnail&&a.thumbnail.url||I}):v.resolve(I)}function d(a,c){if(!a.material||!a.material.color)return a=Math.min(Math.max(O.defaultThematicColor.r+191.25*c,0),255),[a,a,a,100];for(var b=a.material.color.toRgb(),
d=0;3>d;d++)b[d]=Math.min(Math.max(b[d]+191.25*c,0),255);return b.push(a.material.color.a),b}function J(a){return a.outline?y(a):{color:"rgba(0, 0, 0, 1)",width:1.5}}function w(a,c){if(!a.material)return{};for(var b=a.material.color.toRgb(),d="rgba(",n=0;3>n;n++)d+=Math.min(Math.max(b[n]+191.25*c,0),255)+",";d+=a.material.color.a+");";a=a.size?k.pt2px(a.size):.75;return{color:d,width:Math.min(a,E)}}function x(a,c,b){b*=.75;return{type:"linear",x1:b?.25*b:0,y1:b?.5*b:0,x2:b||4,y2:b?.5*b:4,colors:[{color:a,
offset:0},{color:c,offset:1}]}}function Q(a){var c=a.depth,b=a.height;return(a=a.width)&&c&&b&&a===c&&b>a}function R(a,c,b,g){var n=a&&a.type,k="object"===n,e=[];if("icon"===n)switch(c){case "circle":e.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:d(a,0),stroke:y(a)});break;case "square":e.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[0,0]},{command:"L",values:[b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:d(a,0),stroke:y(a)});break;case "cross":e.push({shape:{type:"path",
path:[{command:"M",values:[.5*b,0]},{command:"L",values:[.5*b,b]},{command:"M",values:[0,.5*b]},{command:"L",values:[b,.5*b]},{command:"E",values:[]}]},stroke:J(a)});break;case "x":e.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[b,b]},{command:"M",values:[b,0]},{command:"L",values:[0,b]},{command:"E",values:[]}]},stroke:J(a)});break;case "kite":e.push({shape:{type:"path",path:[{command:"M",values:[0,.5*b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,.5*b]},
{command:"L",values:[.5*b,b]},{command:"Z",values:[]}]},fill:d(a,0),stroke:y(a)})}else if(k)switch(c){case "cone":c=d(a,0);a=d(a,-.6);a=x(c,a,g?F:b);b=p.getConeShapes(b,g);e.push({shape:b[0],fill:a});e.push({shape:b[1],fill:a});break;case "inverted-cone":g=d(a,0);a=d(a,-.6);a=x(g,a,b);b=p.getInvertedConeShapes(b);e.push({shape:b[0],fill:a});e.push({shape:b[1],fill:g});break;case "cube":b=p.getCubeShapes(b,g);e.push({shape:b[0],fill:d(a,0)});e.push({shape:b[1],fill:d(a,-.3)});e.push({shape:b[2],fill:d(a,
-.5)});break;case "cylinder":c=d(a,0);n=d(a,-.6);c=x(c,n,g?F:b);b=p.getCylinderShapes(b,g);e.push({shape:b[0],fill:c});e.push({shape:b[1],fill:c});e.push({shape:b[2],fill:d(a,0)});break;case "diamond":b=p.getDiamondShapes(b);e.push({shape:b[0],fill:d(a,-.3)});e.push({shape:b[1],fill:d(a,0)});e.push({shape:b[2],fill:d(a,-.3)});e.push({shape:b[3],fill:d(a,-.7)});break;case "sphere":g=d(a,0);a=d(a,-.6);a=x(g,a);a.x1=0;a.y1=0;a.x2=.25*b;a.y2=.25*b;e.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:a});
break;case "tetrahedron":b=p.getTetrahedronShapes(b),e.push({shape:b[0],fill:d(a,-.3)}),e.push({shape:b[1],fill:d(a,0)}),e.push({shape:b[2],fill:d(a,-.6)})}return e}function S(a,c){var b,d=c&&c.size?k.pt2px(c.size):null,n=c&&c.maxSize?k.pt2px(c.maxSize):null,p=c&&c.disableUpsampling,e=a.symbolLayers,l=[],h=0,t=0,m=e.getItemAt(e.length-1);return m&&"icon"===m.type&&(b=m.size&&k.pt2px(m.size)),e.forEach(function(f,z){var B=f&&f.type,m="icon"===B,B="object"===B,g=m?f.size&&k.pt2px(f.size):0,r=d||g?Math.ceil(Math.min(d||
g,n||K)):u;if(m||B){var A=y(f),w=A?A.width:0;if(f&&f.resource&&f.resource.href)z=P(a,f).then(function(a){return C.tintImageWithColor(a,r,f.get("material.color"),p)}).then(function(a){var b=a.width,c=a.height;return h=Math.max(h,b+2*w),t=Math.max(t,c+2*w),[{shape:{type:"image",width:b,height:c,src:a.url},fill:null,stroke:null}]}),l.unshift(z);else{var A=(A=f.get("resource.primitive"))?A:m?"circle":"sphere",x=r;m&&(x=z<e.length-1&&d?g/b*r:r);z=c&&"tall"===c.symbolConfig||(B?Q(f):!1);h=Math.max(h,z?
F:x+2*w);t=Math.max(t,x+2*w);l.unshift(v.resolve(R(f,A,x,z)))}}}),v.eachAlways(l).then(function(a){var b=[];return a.forEach(function(a){a.value?b.push(a.value):a.error&&T.warn("error while building swatchInfo!",a.error)}),C.renderSymbol(b,[h,t],{node:c&&c.node,scale:!1})})}function U(a,c){var b,g=a.symbolLayers,n=[];a=D.isVolumetricSymbol(a);var r=c&&c.size?k.pt2px(c.size):null,e=(c&&c.maxSize?k.pt2px(c.maxSize):null)||E,l=0,h=0;return g.forEach(function(a,c){var f=a&&a.type,t="line"===f;if(t||"path"===
f){var m=w(a,0),g=m&&m.width||0,f=[];t?(0===c&&(b=g),a=Math.min(r||g,e),a=0===c?a:r?g/b*a:a,c=a>u?2*a:V,h=Math.max(h,a),l=Math.max(l,c),m.width=a,f.push({shape:{type:"path",path:[{command:"M",values:[0,.5*h]},{command:"L",values:[l,.5*h]},{command:"E",values:[]}]},stroke:m})):(m=Math.min(r||u,e),c=d(a,0),t=d(a,-.2),a=w(a,-.4),a.width=1,f.push({shape:p.shapes.pathSymbol3DLayer[0],fill:t,stroke:a}),f.push({shape:p.shapes.pathSymbol3DLayer[1],fill:c,stroke:a}),l=h=Math.max(h,m+2));n.push(f)}}),v.resolve(C.renderSymbol(n,
[l,h],{node:c&&c.node,scale:a}))}function W(a,c){var b=a.type===L;a=a.symbolLayers;var g=c&&c.size?k.pt2px(c.size):null,n=c&&c.maxSize?k.pt2px(c.maxSize):null,r=g||u,e=[],l=0,h=0;return a.forEach(function(a){var c=a.type,f="fill"===c,g="line"===c,k="extrude"===a.type,c=[];if(!b||f){var q=p.shapes.fill[0];f?(g=(f=y(a))&&f.width||0,l=Math.max(l,u+g),h=Math.max(h,u+g),c.push({shape:q,fill:d(a,0),stroke:f})):g?(a=(f=w(a,0))&&f.width||0,q={stroke:f,shape:q},l=Math.max(l,u+a),h=Math.max(h,u+a),c.push(q)):
k&&(q=w(a,-.4),f=d(a,0),a=d(a,-.2),g=Math.min(r,n||K),k=p.getExtrudeSymbolShapes(g),q.width=1,c.push({shape:k[0],fill:a,stroke:q}),c.push({shape:k[1],fill:a,stroke:q}),c.push({shape:k[2],fill:f,stroke:q}),a=.7*u+.5*g,l=Math.max(l,u+2*q.width),h=Math.max(h,a+2*q.width));e.push(c)}}),v.resolve(C.renderSymbol(e,[l,h],{node:c&&c.node,scale:!1}))}Object.defineProperty(G,"__esModule",{value:!0});var L="mesh-symbol-3d",I=M.toUrl("../../images/Legend/legend3dsymboldefault.png"),u=22,K=120,E=80,V=40,F=20,
T=N.getLogger("esri.symbols.support.previewSymbol3D");G.previewSymbol3D=function(a,c){if(0===a.symbolLayers.length)return v.reject(new H("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));var b=null;switch(a.type){case "point-symbol-3d":b=S(a,c);break;case "line-symbol-3d":b=U(a,c);break;case "polygon-symbol-3d":case L:b=W(a,c)}return b?b:v.reject(new H("symbolPreview: swatchInfo3D","symbol not supported."))}});