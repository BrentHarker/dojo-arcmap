//>>built
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators dojo/Deferred dojo/when ../core/Accessor ../core/Collection ../core/Error ../core/watchUtils".split(" "),function(a,r,k,f,d,l,m,n,p,g,q){a=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;return b.creationRequests=new p,b.paused=!0,b}return k(c,a),c.prototype.initialize=function(){var b=this;q.whenFalse(this,"paused",function(){b.creationRequests.toArray().forEach(b._processRequest,
b)},!0)},c.prototype.destroy=function(){this.creationRequests.drain(function(b){return b.deferred.cancel(void 0)})},Object.defineProperty(c.prototype,"working",{get:function(){return 0<this.creationRequests.length},enumerable:!0,configurable:!0}),c.prototype.create=function(b,a){var h=this.getLayerViewPromise(a);if(h)return h;var c=this.creationRequests,e={deferred:new l(function(){var b=new g("cancelled:layerview-create","layerview creation cancelled",{layer:a});return c.remove(e),e.creationPromise&&
e.creationPromise.cancel(b),b}),view:b,layer:a,started:!1,creationPromise:null};return c.push(e),this.paused||this._processRequest(e),e.deferred.promise},c.prototype.dispose=function(b){b.layer.destroyLayerView(b)},c.prototype.getLayerViewPromise=function(b){var a=this.creationRequests&&this.creationRequests.find(function(a){return a.layer===b});return a&&a.deferred.promise},c.prototype._processRequest=function(b){var a=this;if(!b.started){b.started=!0;var c=b.deferred,d=b.layer,e=b.view;d.load().then(function(a){return c.isCanceled()?
void 0:(b.creationPromise=a.createLayerView(e),b.creationPromise)}).then(function(a){return c.isCanceled()?a:b.creationPromise=m(a)}).otherwise(function(a){c.isCanceled()||c.reject(new g("layerview:create-error","layerview creation failed",{layer:d,error:a}))}).then(function(d){return a.creationRequests&&a.creationRequests.remove(b),c.isFulfilled()?d&&a.dispose(d):c.resolve(d),d})}},c}(d.declared(n));return f([d.property()],a.prototype,"creationRequests",void 0),f([d.property()],a.prototype,"paused",
void 0),f([d.property()],a.prototype,"view",void 0),f([d.property({dependsOn:["paused","creationRequests.length"],readOnly:!0})],a.prototype,"working",null),a=f([d.subclass("esri.views.LayerViewFactory")],a)});