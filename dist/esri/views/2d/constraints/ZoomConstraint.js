//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../layers/support/LOD".split(" "),function(d,w,t,f,b,u,v){d=h=function(d){function b(){var a=null!==d&&d.apply(this,arguments)||this;return a._lodByScale={},a._scales=[],a.effectiveLODs=null,a.effectiveMinZoom=-1,a.effectiveMaxZoom=-1,a.effectiveMinScale=0,a.effectiveMaxScale=0,a.enabled=!0,a.lods=null,a.minZoom=-1,a.maxZoom=
-1,a.minScale=0,a.maxScale=0,a.snapToZoom=!0,a}return t(b,d),b.prototype.initialize=function(){var a=this,c=this.lods,g=this.minScale,b=this.maxScale,e=this.minZoom,d=this.maxZoom,f=-1,h=-1,p=!1,q=!1;if(0!==g&&0!==b&&b>g&&(k=[b,g],g=k[0],b=k[1]),!c||!c.length)return this._set("effectiveMinScale",g),void this._set("effectiveMaxScale",b);c=c.map(function(a){return a.clone()});c.sort(function(a,c){return c.scale-a.scale});c.forEach(function(a,c){return a.level=c});for(var m,k=0,r=c;k<r.length;k++){var l=
r[k];!p&&0<g&&g>=l.scale&&(f=l.level,p=!0);!q&&0<b&&b>=l.scale&&(h=m?m.level:-1,q=!0);m=l}-1===e&&(e=0===g?0:f);-1===d&&(d=0===b?c.length-1:h);e=Math.max(e,0);e=Math.min(e,c.length-1);d=Math.max(d,0);d=Math.min(d,c.length-1);e>d&&(n=[d,e],e=n[0],d=n[1]);g=c[e].scale;b=c[d].scale;c.splice(0,e);c.splice(d-e+1,c.length);c.forEach(function(c,b){a._lodByScale[c.scale]=c;a._scales[b]=c.scale});this._set("effectiveLODs",c);this._set("effectiveMinZoom",e);this._set("effectiveMaxZoom",d);this._set("effectiveMinScale",
g);this._set("effectiveMaxScale",b);var k,n},b.prototype.constrain=function(a,c){if(!this.enabled||c&&a.scale===c.scale)return a;var b=this.effectiveMinScale,d=this.effectiveMaxScale,e=a.targetGeometry,f=c&&c.targetGeometry,h=0!==b&&a.scale>b;if(0!==d&&a.scale<d||h)b=h?b:d,f&&(c=(b-c.scale)/(a.scale-c.scale),e.x=f.x+(e.x-f.x)*c,e.y=f.y+(e.y-f.y)*c),a.scale=b;return this.snapToZoom&&this.effectiveLODs&&(a.scale=this._getClosestScale(a.scale)),a},b.prototype.fit=function(a){if(!this.effectiveLODs)return this.constrain(a,
null);var c=a.scale,b=Math.round(this.scaleToZoom(c));return.95<Math.abs(b-Math.round(b))?a.scale=this.snapToPreviousScale(c):a.scale=this.zoomToScale(Math.round(b)),a},b.prototype.zoomToScale=function(a){if(!this.effectiveLODs)return 0;a-=this.effectiveMinZoom;a=Math.max(0,a);var c=this._scales;if(0>=a)return c[0];if(a>=c.length)return c[c.length-1];var b=Math.round(a);return c[b]+(b-a)*(c[Math.round(a-.5)]-c[b])},b.prototype.scaleToZoom=function(a){if(!this.effectiveLODs)return-1;var c,b,d=this._scales,
e=0,f=d.length-1;for(e;f>e;e++){if(c=d[e],b=d[e+1],a>=c)return e+this.effectiveMinZoom;if(b===a)return e+1+this.effectiveMinZoom;if(c>a&&a>b)return e+1-(a-b)/(c-b)+this.effectiveMinZoom}return e},b.prototype.snapToClosestScale=function(a){if(!this.effectiveLODs)return a;a=this.scaleToZoom(a);return this.zoomToScale(Math.round(a))},b.prototype.snapToNextScale=function(a,c){if(void 0===c&&(c=.5),!this.effectiveLODs)return a*c;a=Math.round(this.scaleToZoom(a));return this.zoomToScale(a+1)},b.prototype.snapToPreviousScale=
function(a,c){if(void 0===c&&(c=2),!this.effectiveLODs)return a*c;a=Math.round(this.scaleToZoom(a));return this.zoomToScale(a-1)},b.prototype.clone=function(){return new h({enabled:this.enabled,lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})},b.prototype._getClosestScale=function(a){return this._lodByScale[a]?this._lodByScale[a].scale:(a=this._scales.reduce(function(c,b,d,e){return Math.abs(b-a)<=Math.abs(c-a)?b:c},this._scales[0]),this._lodByScale[a].scale)},
b}(b.declared(u));f([b.property({readOnly:!0})],d.prototype,"effectiveLODs",void 0);f([b.property({readOnly:!0})],d.prototype,"effectiveMinZoom",void 0);f([b.property({readOnly:!0})],d.prototype,"effectiveMaxZoom",void 0);f([b.property({readOnly:!0})],d.prototype,"effectiveMinScale",void 0);f([b.property({readOnly:!0})],d.prototype,"effectiveMaxScale",void 0);f([b.property()],d.prototype,"enabled",void 0);f([b.property({type:[v]})],d.prototype,"lods",void 0);f([b.property()],d.prototype,"minZoom",
void 0);f([b.property()],d.prototype,"maxZoom",void 0);f([b.property()],d.prototype,"minScale",void 0);f([b.property()],d.prototype,"maxScale",void 0);f([b.property()],d.prototype,"snapToZoom",void 0);d=h=f([b.subclass("esri.views.2d.constraints.ZoomConstraint")],d);var h;return d});