//>>built
define("require exports dojo/_base/lang ../../libs/gl-matrix/mat2d ../../libs/gl-matrix/mat2dExtras ../../../../core/screenUtils ../../../../geometry/Polygon ../../../../symbols/SimpleMarkerSymbol ../../../../symbols/support/gfxUtils".split(" "),function(L,m,y,t,u,q,H,n,r){function v(c,a){return a.toRgba?(c[0]=a.r,c[1]=a.g,c[2]=a.b,c[3]=a.a):(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3]),c}function w(c,a,b){return null!=b&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=b),c}function z(c,a,b){var d=a[0]/a[1];return c[0]=
c[1]=1,isNaN(b)||(1<d?(c[0]=b/a[0],c[1]=b/d/a[1]):(c[1]=b/a[1],c[0]=b*d/a[0])),c}function A(c,a,b,d,e,k,f){var h,l,g=e.symbol;b=c.toScreenPoint(I,b,f[0]);f=[b.x,b.y];c=b.x;b=b.y;var m=e.heading;e=e.size&&e.size[0];t.identity(p);"number"==typeof e&&(l=isFinite(e)&&e);l=(e=l&&isFinite(l)&&!isNaN(l))?q.pt2px(l):NaN;k&&u.rotategAt(p,p,k,f);m&&u.rotategAt(p,p,m,f);k=q.pt2px(g.xoffset);m=q.pt2px(g.yoffset);if((0!==k||0!==m)&&t.translate(p,p,[k,-m]),0!==g.angle&&u.rotategAt(p,p,g.angle,f),"simple-marker-symbol"===
g.type)switch(h=g.style,k=Math.round,l=e?l:q.pt2px(g.size),e=void 0,h){case n.STYLE_SQUARE:case n.STYLE_CROSS:case n.STYLE_X:case n.STYLE_DIAMOND:e=isNaN(l)?16:.5*l;h=x(a,d,B(h,c,b,k(c-e),k(c+e),k(b-e),k(b+e)));break;case n.STYLE_PATH:h=g=x(a,d,g.path);g=g.getBoundingBox();l=z(t.create(),[g.width,g.height],l);1===l[0]&&1===l[3]||u.scaleAt(p,p,l,f);t.translate(p,p,[-(g.x+.5*g.width)+c,-(g.y+.5*g.height)+b]);break;default:e=isNaN(l)?16:.5*l,h=C(a,d,{cx:c,cy:b,r:e})}else"picture-marker-symbol"===g.type?
(h=e?l:q.pt2px(g.width),l=e?l:q.pt2px(g.height),h=D(a,d,{x:c-.5*h,y:b-.5*l,width:h,height:l,src:g.url})):"text-symbol"===g.type&&((f=g.font&&g.font.clone())&&(f.size=e?l:q.pt2px(f.size)),h=E(a,d,{type:"text",text:g.text,x:c,y:b,align:r.getSVGAlign(g),decoration:g.decoration||f&&f.decoration,rotated:g.rotated,kerning:g.kerning}),f&&h.setFont(f),l=h.getNode(),a=r.getSVGBaseline(g),g=r.getSVGBaselineShift(g),l&&(l.setAttribute("dominant-baseline",a),g&&l.setAttribute("baseline-shift",g)));return h.setTransform(p),
h}function D(c,a,b){return a?a.setShape(b):c.createImage(b)}function C(c,a,b){return a?a.setShape(b):c.createCircle(b)}function x(c,a,b){b=Array.isArray(b)?b.join(" "):b;return a?a.setShape(b):c.createPath(b)}function E(c,a,b){return a?a.setShape(b):c.createText(b)}function F(c,a){a=a&&a.shape&&a.shape.type;var b=c&&c.type;c=c&&c.style;return b&&(c=J[b]||c),K[c]&&(c="path"),!(!a||!c||a===c)}function B(c,a,b,d,e,k,f,h){switch(c){case n.STYLE_SQUARE:return["M",d+","+k,e+","+k,e+","+f,d+","+f,"Z"];case n.STYLE_CROSS:return["M",
a+","+k,a+","+f,"M",d+","+b,e+","+b];case n.STYLE_X:return["M",d+","+k,e+","+f,"M",d+","+f,e+","+k];case n.STYLE_DIAMOND:return["M",a+","+k,e+","+b,a+","+f,d+","+b,"Z"];case n.STYLE_TARGET:return["M",d+","+k,e+","+k,e+","+f,d+","+f,d+","+k,"M",d-h+","+b,d+","+b,"M",a+","+(k-h),a+","+k,"M",e+h+","+b,e+","+b,"M",a+","+(f+h),a+","+f]}}function G(c,a){var b=a.symbol;if("picture-marker-symbol"!==b.type){var d=r.getFill(b);if("simple-marker-symbol"===b.type){var e=b.style,k=(b=r.getStroke(b))&&b.color,
e=e===n.STYLE_X||e===n.STYLE_CROSS,f=a.opacity;(a=a.color||v([0,0,0,0],e?k:d))&&null!=f&&(a=w([0,0,0,0],a,f));a&&(e?a!==k&&(b=b?y.mixin({},b):{},b.color=a):a!==d&&(d=a));c.setFill(d).setStroke(b)}else"text-symbol"===b.type&&(f=a.opacity,(a=a.color||v([0,0,0,0],d))&&null!=f&&(a=w([0,0,0,0],a,f)),a&&a!==d&&(d=a),c.setFill(d))}}Object.defineProperty(m,"__esModule",{value:!0});m.getScalingVector=z;var I={x:0,y:0},p=t.create();m.drawPoint=A;m.drawMarkers=function(c,a,b,d,e,k,f){var h=e.symbol;b=b.points;
a=d||a.createGroup();d=[0];a.children[0]&&F(h,a.children[0])&&a.clear();for(var l=0,g=b.length,h=0;g>h;h++)for(var m=b[h],p=f.length,n=0;p>n;n++)d[0]=f[n],a.add(A(c,a,{x:m[0],y:m[1]},a.children[l++],e,k,d));c=a.children.length;if(b.length*f.length<c)for(f=b.length*f.length,h=c-1;h>=f;h--)a.children[h].removeShape();return a};m.drawShape=function(c,a,b,d,e){var k=[];if("extent"===b.type&&(b=H.fromExtent(b)),"polyline"===b.type||"polygon"===b.type){for(var f=e.length,h=0;f>h;h++)k=k.concat(c.toScreenPath(b,
e[h]));d=x(a,d,k)}return d};m.drawRect=function(c,a,b){return a?a.setShape(b):c.createRect(b)};m.drawImage=D;m.drawCircle=C;m.drawPath=x;m.drawText=E;var J={"picture-marker-symbol":"image","picture-fill-symbol":"path","simple-fill-symbol":"path","simple-line-symbol":"path","text-symbol":"text"},K={square:1,cross:1,x:1,diamond:1,target:1};m.isShapeInvalid=F;m.smsToPath=B;m.stylePoint=G;m.styleMarkers=function(c,a){for(var b=c.children.length,d=0;b>d;d++)G(c.children[d],a)};m.styleShape=function(c,
a){var b,d=a.symbol,e=a.size,k=a.color;a=a.opacity;var f=r.getStroke(d),h=r.getFill(d),l=!1;"simple-line-symbol"===d.type?(l=!0,b="none"!==d.style):b=d.outline&&"none"!==d.outline.style;var g,m,n;e&&(n=isFinite(e[0])&&e[0]);null!=e&&(n=q.pt2px(n));!k&&null==a||"picture-fill-symbol"===d.type||(l?(g=k||f&&f.color&&v([0,0,0,0],f.color),g&&null!=a&&(g=w(g,g,a))):h&&(m=k||v([0,0,0,0],h),m&&null!=a&&(m=w(m,m,a))));!b||null==e&&!g?c.setStroke(f):c.setStroke(y.mixin({},f,null!=n?{width:n}:null,g&&{color:g}));
c.setFill(m||h);c.rawNode.setAttribute("vector-effect","non-scaling-stroke")}});