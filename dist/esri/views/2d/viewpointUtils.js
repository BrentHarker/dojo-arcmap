//>>built
define("require exports ./libs/gl-matrix/common ./libs/gl-matrix/mat2d ./libs/gl-matrix/vec2 ../../Viewpoint ../../core/promiseUtils ../../core/Error ../../geometry/SpatialReference ../../geometry/Geometry ../../geometry/Point ../../geometry/Extent ../../geometry/support/webMercatorUtils ../../geometry/support/scaleUtils ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils".split(" "),function(V,e,r,l,f,B,C,O,P,D,x,Q,y,E,R,S){function F(a,b,c,d){d&&c&&!d.equals(c)&&
y.canProject(d,c)&&d.isWebMercator?d.isWebMercator?(c=b[1],a=(89.99999<c?c=89.99999:-89.99999>c&&(c=-89.99999),c=Math.sin(r.toRadian(c)),f.set(a,r.toRadian(b[0])*v,.5*v*Math.log((1+c)/(1-c))))):(c=r.toDegree(b[0]/v),a=f.set(a,c-360*Math.floor((c+180)/360),r.toDegree(.5*Math.PI-2*Math.atan(Math.exp(-1*b[1]/v))))):a=f.copy(a,b);return a}function w(a){return a.wkid?a:a.spatialReference||P.WGS84}function t(a,b){return b.type?f.set(a,b.x,b.y):f.copy(a,b)}function z(a,b){return Math.max(a.width/b[0],a.height/
b[1])*G(a.spatialReference)}function u(a,b,c){var d;if(!a)return null;if(Array.isArray(a)&&2===a.length&&"number"==typeof a[0]&&"number"==typeof a[1])return new x(a);if(a.reduce)return a.reduce(function(a,c){return u(c,b,a)},c);if(a instanceof D?d=a:a.geometry&&(d=a.geometry),!d)return null;var g;if(g="point"===d.type?new Q({xmin:d.x,ymin:d.y,xmax:d.x,ymax:d.y,spatialReference:d.spatialReference}):d.extent,!g)return null;a=y.canProject(g,b);if(!g.spatialReference.equals(b)&&a)g=y.project(g,b);else if(!a)return null;
return c=c?c.union(g):g.clone()}function H(a,b){if(!a)return new B({targetGeometry:new x,scale:0,rotation:0});var c=b.spatialReference,d=b.size,g=b.viewpoint,h=b.constraints,e=null;"esri.Viewpoint"===a.declaredClass?e=a:a.viewpoint?e=a.viewpoint:a.target&&"esri.Viewpoint"===a.target.declaredClass&&(e=a.target);var k=null;e&&e.targetGeometry?k=e.targetGeometry:a instanceof D?k=a:(a||a&&(a.hasOwnProperty("center")||a.hasOwnProperty("extent")||a.hasOwnProperty("target")))&&(k=u(a.center,c)||u(a.extent,
c)||u(a.target,c)||u(a,c));!k&&g&&g.targetGeometry?k=g.targetGeometry:!k&&b.extent&&(k=b.extent);var m=w(k);if(c||(c=w(b.spatialReference||b.extent||k)),!S.canProject(k,c)&&m&&!m.equals(c))return null;var l=t(f.create(),k.center?k.center:k),c=new x(F(l,l,m,c),c),m=null,m=e&&e.targetGeometry&&"point"===e.targetGeometry.type?e.scale:a.hasOwnProperty("scale")&&a.scale?a.scale:a.hasOwnProperty("zoom")&&-1!==a.zoom&&h&&h.effectiveLODs?h.zoomToScale(a.zoom):Array.isArray(k)||"point"===k.type||"extent"===
k.type&&0===k.width&&0===k.height?b.extent?z(b.extent,d):g.scale:z(k.extent,d);b=0;return e?b=e.rotation:a.hasOwnProperty("rotation")?b=a.rotation:g&&(b=g.rotation),h&&(h.rotationEnabled||(b=0),h.snapToZoom&&(m=h.snapScale(m)),0!==h.effectiveMinScale&&(m=Math.min(h.effectiveMinScale,m)),0!==h.effectiveMaxScale&&(m=Math.max(h.effectiveMaxScale,m))),new B({targetGeometry:c,scale:m,rotation:b})}function p(a,b){var c=a.targetGeometry,d=b.targetGeometry;return c.x=d.x,c.y=d.y,c.spatialReference=d.spatialReference,
a.scale=b.scale,a.rotation=b.rotation,a}function I(a,b,c){return c?f.set(a,.5*(b[0]-c.right+c.left),.5*(b[1]-c.bottom+c.top)):f.scale(a,b,.5)}function T(a,b,c,d){return e.getTransform(a,b,c,d),l.invert(a,a)}function A(a,b,c){var d=r.toRadian(b.rotation)||0;b=Math.abs(Math.cos(d));d=Math.abs(Math.sin(d));return f.set(a,Math.round(c[1]*d+c[0]*b),Math.round(c[1]*b+c[0]*d))}function q(a){return a.scale*(1/((E.getUnitValueForSR(a.targetGeometry.spatialReference)||J)*K*96))}function G(a){return(E.getUnitValueForSR(a)||
J)*K*96}function L(a){return a.isWrappable?(a=R.getInfo(a),a.valid[1]-a.valid[0]):0}function M(a,b){return Math.round(L(a)/b)}Object.defineProperty(e,"__esModule",{value:!0});var K=39.37,J=6370997*Math.PI/180,v=6378137,U=180/Math.PI;e.create=H;e.copy=p;e.getAnchor=I;e.getExtent=function(){var a=f.create();return function(b,c,d){var g=c.targetGeometry;t(a,g);c=.5*q(c);return b.xmin=a[0]-c*d[0],b.ymin=a[1]-c*d[1],b.xmax=a[0]+c*d[0],b.ymax=a[1]+c*d[1],b.spatialReference=g.spatialReference,b}}();e.setExtent=
function(a,b,c,d,g){return e.centerAt(a,b,c.center),a.scale=z(c,d),g&&g.constraints&&g.constraints.constrain(a),a};e.getOuterExtent=function(){var a=f.create(),b=f.create();return function(c,d,g){t(a,d.targetGeometry);A(b,d,g);g=.5*q(d);return c.set({xmin:a[0]-g*b[0],ymin:a[1]-g*b[1],xmax:a[0]+g*b[0],ymax:a[1]+g*b[1],spatialReference:d.targetGeometry.spatialReference}),c}}();e.getClippedExtent=function(){var a=f.create(),b=f.create();return function(c,d,g){var f=q(d),e=d.targetGeometry.spatialReference,
k=M(e,f);t(a,d.targetGeometry);A(b,d,g);e.isWrappable&&b[0]>k&&(b[0]=k);d=.5*f;return c.set({xmin:a[0]-d*b[0],ymin:a[1]-d*b[1],xmax:a[0]+d*b[0],ymax:a[1]+d*b[1],spatialReference:e}),c}}();e.getOuterSize=A;e.getPaddingScreenTranslation=function(){var a=f.create();return function(b,c,d){return f.sub(b,f.scale(b,c,.5),I(a,c,d))}}();var N=function(){var a=l.create(),b=f.create();return function(c,d,g,h){var n=q(d);d=r.toRadian(d.rotation)||0;return f.set(b,n,n),l.fromScaling(a,b),l.rotate(a,a,d),l.translate(a,
a,e.getPaddingScreenTranslation(b,g,h)),l.translate(a,a,[0,h.top-h.bottom]),f.set(c,a[4],a[5])}}();e.getResolution=q;e.getResolutionToScaleFactor=G;e.getMatrix=function(){var a=f.create(),b=f.create(),c=f.create();return function(d,g,e,n,k,m){return f.negate(a,g),f.scale(b,e,.5*m),f.set(c,1/n*m,-1/n*m),l.identity(d),l.translate(d,d,b),k&&l.rotate(d,d,k),l.scale(d,d,c),l.translate(d,d,a),d}}();e.getTransform=function(){var a=f.create();return function(b,c,d,g){var f=q(c),l=r.toRadian(c.rotation)||
0;return t(a,c.targetGeometry),e.getMatrix(b,a,d,f,l,g)}}();e.getTransformNoRotation=function(){var a=f.create();return function(b,c,d,f){var g=q(c);return t(a,c.targetGeometry),e.getMatrix(b,a,d,g,0,f)}}();e.getWorldWidth=L;e.getWorldScreenWidth=M;e.createAsync=function(a,b){if(a=H(a,b))return C.resolve(a);a=new O("viewpointUtils-createAsync:different-spatialReference","Target spatialReference cannot be projected and is different from out spatialReference");return C.reject(a)};e.angleBetween=function(){var a=
f.create(),b=f.create(),c=f.create();return function(d,g,e){f.subtract(a,d,g);f.normalize(a,a);f.subtract(b,d,e);f.normalize(b,b);f.cross(c,a,b);d=Math.acos(f.dot(a,b)/(f.length(a)*f.length(b)))*U;return 0>c[2]&&(d=-d),isNaN(d)&&(d=0),d}}();e.addPadding=function(){var a=f.create();return function(b,c,d,f){var e=b.targetGeometry;return p(b,c),N(a,c,d,f),e.x+=a[0],e.y+=a[1],b}}();e.removePadding=function(){var a=f.create();return function(b,c,d,e){var f=b.targetGeometry;return p(b,c),N(a,c,d,e),f.x-=
a[0],f.y-=a[1],b}}();e.centerAt=function(){var a=f.create();return function(b,c,d){p(b,c);c=b.targetGeometry;var f=w(d),e=w(c);return t(a,d),F(a,a,f,e),c.x=a[0],c.y=a[1],b}}();e.pixelSizeAt=function(a,b,c){return q(b)};e.resize=function(){var a=f.create();return function(b,c,d,g,h){h||(h="center");f.sub(a,d,g);f.scale(a,a,.5);d=a[0];g=a[1];switch(h){case "center":f.set(a,0,0);break;case "left":f.set(a,-d,0);break;case "top":f.set(a,0,g);break;case "right":f.set(a,d,0);break;case "bottom":f.set(a,
0,-g);break;case "top-left":f.set(a,-d,g);break;case "bottom-left":f.set(a,-d,-g);break;case "top-right":f.set(a,d,g);break;case "bottom-right":f.set(a,d,-g)}return e.translateBy(b,c,a),b}}();e.rotateBy=function(a,b,c){return p(a,b),a.rotation+=c,a};e.rotateTo=function(a,b,c){return p(a,b),a.rotation=c,a};e.scaleBy=function(){var a=f.create();return function(b,c,d,g,h){return p(b,c),0!==d&&(e.toMap(a,g,c,h),b.scale=c.scale*d,e.toScreen(a,a,b,h),e.translateBy(b,b,f.set(a,a[0]-g[0],g[1]-a[1]))),b}}();
e.scaleTo=function(a,b,c){return p(a,b),a.scale=c,a};e.scaleAndRotateBy=function(){var a=f.create();return function(b,c,d,g,h,l){return p(b,c),0!==d&&(e.toMap(a,h,c,l),b.scale=c.scale*d,b.rotation+=g,e.toScreen(a,a,b,l),e.translateBy(b,b,f.set(a,a[0]-h[0],h[1]-a[1]))),b}}();e.padAndScaleAndRotateBy=function(){var a=f.create(),b=f.create();return function(c,d,g,h,l,k,m){return e.getPaddingScreenTranslation(b,k,m),f.add(a,l,b),h?e.scaleAndRotateBy(c,d,g,h,a,k):e.scaleBy(c,d,g,a,k)}}();e.toMap=function(){var a=
l.create();return function(b,c,d,e){return f.transformMat2d(b,c,T(a,d,e,1))}}();e.toScreen=function(){var a=l.create();return function(b,c,d,g){return f.transformMat2d(b,c,e.getTransform(a,d,g,1))}}();e.translateBy=function(){var a=f.create(),b=l.create();return function(c,d,e){p(c,d);var g=q(d),n=c.targetGeometry;return l.fromRotation(b,r.toRadian(d.rotation)||0),l.scale(b,b,f.fromValues(g,g)),f.transformMat2d(a,e,b),n.x+=a[0],n.y+=a[1],c}}()});