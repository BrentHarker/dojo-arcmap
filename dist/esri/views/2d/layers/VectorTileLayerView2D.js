//>>built
require({cache:{"esri/views/2d/layers/LayerView2D":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/watchUtils ../../layers/LayerView".split(" "),function(m,e,a,b,c,d,f){m=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.attached=!1,a.moving=!1,a.updateRequested=!1,a}return a(c,b),c.prototype.initialize=function(){var a=this;this.then(function(){a.requestUpdate()});
d.init(this,"suspended",function(b){a.container.visible=!b;!b&&a.updateRequested&&a.view.requestLayerViewUpdate(a)},!0);d.init(this,"fullOpacity",function(b){a.container.opacity=b},!0);var b=function(){this.notifyChange("rendering")}.bind(this);this.container.on("post-render",b);this.container.on("will-render",b)},c.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach());this.updateRequested=!1;this.layer=null},Object.defineProperty(c.prototype,"rendering",{get:function(){return this.isRendering()},
enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0}),c.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))},c.prototype.processUpdate=function(a){return this.isFulfilled()&&!this.isResolved()?void(this.updateRequested=!1):(this._set("updateParameters",a),void(this.updateRequested&&
!this.suspended&&(this.updateRequested=!1,this.update(a))))},c.prototype.isUpdating=function(){return!1},c.prototype.isRendering=function(){return this.attached&&(this.moving||this.container.renderRequested)},c.prototype.canResume=function(){var a=this.inherited(arguments),b=this.layer;if(a&&null!=b.minScale&&null!=b.minScale){var a=this.view.scale,c=b.minScale,b=b.maxScale,d=!c,f=!b;!d&&c>=a&&(d=!0);!f&&a>=b&&(f=!0);a=d&&f}return a},c}(c.declared(f));return b([c.property()],m.prototype,"attached",
void 0),b([c.property()],m.prototype,"container",void 0),b([c.property()],m.prototype,"moving",void 0),b([c.property({dependsOn:["moving"]})],m.prototype,"rendering",null),b([c.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],m.prototype,"suspended",void 0),b([c.property({readOnly:!0})],m.prototype,"updateParameters",void 0),b([c.property()],m.prototype,"updateRequested",void 0),b([c.property({dependsOn:["updateRequested","attached"]})],m.prototype,"updating",null),b([c.property()],
m.prototype,"view",void 0),m=b([c.subclass("esri.views.2d.layers.LayerView2D")],m)})},"esri/views/layers/LayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor ../../core/Evented ../../core/Identifiable ../../core/Promise ../../core/HandleRegistry ../../core/Logger".split(" "),function(m,e,a,b,c,d,f,g,h,l,p){m=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||
this;return a.handles=new l,a.parent=null,a.view=null,a}return a(c,b),c.prototype.initialize=function(){var a=this;this.addResolvingPromise(this.layer);this.otherwise(function(b){if("layerview:create-error"!==b.name){var c=a.layer&&a.layer.id||"no id",d=a.layer&&a.layer.title||"no title";p.getLogger(a.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+d+"', id: '"+c+"')",b)}})},c.prototype.destroy=function(){this.layer=this.view=this.parent=null},Object.defineProperty(c.prototype,
"layer",{get:function(){return this._get("layer")},set:function(a){this.handles.remove("layer");a&&this.handles.add(a.on("refresh",this.refresh.bind(this)),"layer");this._set("layer",a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"updating",{get:function(){return!this.suspended&&this.isUpdating()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,
"visible",{get:function(){return!0===this.get("layer.visible")},set:function(a){return void 0===a?void this._clearOverride("visible"):void this._override("visible",a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"fullOpacity",{get:function(){var a=this.get("layer.opacity"),a=null!=a?a:1,b=this.get("parent.fullOpacity");return a*(null!=b?b:1)},enumerable:!0,configurable:!0}),c.prototype.refresh=function(){},c.prototype.canResume=function(){return!this.get("parent.suspended")&&
this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},c.prototype.isUpdating=function(){return!1},c}(c.declared(d,f,g,h));return b([c.property({value:null})],m.prototype,"layer",null),b([c.property()],m.prototype,"parent",void 0),b([c.property({readOnly:!0,dependsOn:["view","visible","layer.loaded","parent.suspended"]})],m.prototype,"suspended",null),b([c.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],m.prototype,"updating",null),b([c.property()],m.prototype,"view",void 0),
b([c.property({dependsOn:["layer.visible"]})],m.prototype,"visible",null),b([c.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],m.prototype,"fullOpacity",null),m=b([c.subclass("esri.views.layers.LayerView")],m)})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ./TileKey ./TileInfoView".split(" "),function(m,e,a,b,c,d){return function(b){function d(){return null!==b&&b.apply(this,arguments)||
this}return a(d,b),d.prototype.getTileParentId=function(a){a=c.pool.acquire(a);var b=0===a.level?null:c.getId(a.level-1,a.row>>1,a.col>>1,a.world);return c.pool.release(a),b},d.prototype.getTileIdAtParent=function(a,b){b=c.pool.acquire(b);var d=this._infoByLevel[b.level];if(a.resolution<d.resolution)throw c.pool.release(b),Error("Cannot calculate parent tile. destination LOD's resolution "+a.resolution+" is not a parent resolution of "+d.resolution);if(a.resolution===d.resolution)return a=b.id,c.pool.release(b),
a;d=b.level-a.level;if(0>d)throw c.pool.release(b),Error("Wrong way...!");a=c.getId(a.level,b.row>>d,b.col>>d,b.world);return c.pool.release(b),a},d}(d)})},"esri/views/2d/tiling/TileKey":function(){define(["require","exports","../../../core/ObjectPool"],function(m,e,a){m=function(){function a(a,b,f,g){"string"==typeof a?(a=a.split("/"),b=a[1],f=a[2],g=a[3],this.level=+a[0],this.row=+b,this.col=+f,this.world=+g||0):a&&"object"==typeof a?(this.level=a.level||0,this.row=a.row||0,this.col=a.col||0,this.world=
a.world||0):(this.level=+a||0,this.row=+b||0,this.col=+f||0,this.world=+g||0)}return a.from=function(b,d,f,g){return a.pool.acquire(b,d,f,g)},a.getId=function(a,b,f,g){return"object"==typeof a?a.level+"/"+a.row+"/"+a.col+"/"+a.world:a+"/"+b+"/"+f+"/"+g},Object.defineProperty(a.prototype,"id",{get:function(){return a.getId(this)},enumerable:!0,configurable:!0}),a.prototype.equals=function(a){return this.level===a.level&&this.row===a.row&&this.col===a.col&&this.world===a.world},a.prototype.release=
function(){this.world=this.col=this.row=this.level=0},a.prototype.set=function(a,b,f,g){var c=typeof a;"object"===c?(this.level=a.level||0,this.row=a.row||0,this.col=a.col||0,this.world=a.world||0):"string"===c?(a=a.split("/"),b=a[1],f=a[2],g=a[3],this.level=parseFloat(a[0]),this.row=parseFloat(b),this.col=parseFloat(f),this.world=parseFloat(g)):(this.level=a,this.row=b,this.col=f,this.world=g);return this},a.prototype.toString=function(){return this.level+"/"+this.row+"/"+this.col+"/"+this.world},
a}();return m.pool=new a(m,!0,null,25,50),m})},"esri/views/2d/tiling/TileInfoView":function(){define("require exports ./LODInfo ./TileKey ./TileSpan ./TileCoverage".split(" "),function(m,e,a,b,c,d){var f=function(){function a(a,b,c,d,f,g,h,e){this.x=a;this.ymin=b;this.ymax=c;this.invM=d;this.leftAdjust=f;this.rightAdjust=g;this.leftBound=h;this.rightBound=e}return a.create=function(b,c){b[1]>c[1]&&(p=[c,b],b=p[0],c=p[1]);p=b[0];b=b[1];var d=c[0];c=c[1];var f=d-p,g=c-b,g=0!==g?f/g:0,l=(Math.ceil(b)-
b)*g,h=(Math.floor(b)-b)*g;return new a(p,Math.floor(b),Math.ceil(c),g,0>f?l:h,0>f?h:l,0>f?d:p,0>f?p:d);var p},a.prototype.incrRow=function(){this.x+=this.invM},a.prototype.getLeftCol=function(){return Math.max(this.x+this.leftAdjust,this.leftBound)},a.prototype.getRightCol=function(){return Math.min(this.x+this.rightAdjust,this.rightBound)},a}(),g=[[0,0],[0,0],[0,0],[0,0]];return function(){function h(b,c){var d=this;this.tileInfo=b;this.fullExtent=c;this.scales=[];this._lodInfos=null;this._infoByScale=
{};this._infoByLevel={};var f=b.lods.slice();f.sort(function(a,b){return b.scale-a.scale});var g=this._lodInfos=f.map(function(d){return a.create(b,d,c)});f.forEach(function(a,b){d._infoByLevel[a.level]=g[b];d._infoByScale[a.scale]=g[b];d.scales[b]=a.scale},this);this._wrap=b.spatialReference.isWrappable}return h.prototype.getTileBounds=function(a,b){var c=this._infoByLevel[b.level];return c?c.getTileBounds(a,b):a},h.prototype.getTileCoords=function(a,b){var c=this._infoByLevel[b.level];return c?
c.getTileCoords(a,b):a},h.prototype.getTileCoverage=function(a){var b,k,h,l=this.getClosestInfoForScale(a.scale),e=d.pool.acquire(l),r=this._wrap;b=+(1/0);var v=-(1/0),u=e.spans;g[0][0]=g[0][1]=g[1][1]=g[3][0]=0;g[1][0]=g[2][0]=a.size[0];g[2][1]=g[3][1]=a.size[1];for(var t=0;t<g.length;t++){var x=g[t];a.toMap(x,x);x[0]=l.getColumnForX(x[0]);x[1]=l.getRowForY(x[1])}a=[];x=3;for(t=0;4>t;t++){if(g[t][1]!==g[x][1]){var y=f.create(g[t],g[x]);b=Math.min(y.ymin,b);v=Math.max(y.ymax,v);void 0===a[y.ymin]&&
(a[y.ymin]=[]);a[y.ymin].push(y)}x=t}if(null==b||null==v||100<v-b)return null;for(x=[];v>b;){null!=a[b]&&(x=x.concat(a[b]));k=+(1/0);h=-(1/0);for(t=x.length-1;0<=t;t--)y=x[t],k=Math.min(k,y.getLeftCol()),h=Math.max(h,y.getRightCol());if(k=Math.floor(k),h=Math.floor(h),b>=l.first[1]&&b<=l.last[1])if(r)if(l.size[0]<l.worldSize[0])for(y=Math.floor(h/l.worldSize[0]),t=Math.floor(k/l.worldSize[0]);y>=t;t++)u.push(new c(b,Math.max(l.getFirstColumnForWorld(t),k),Math.min(l.getLastColumnForWorld(t),h)));
else u.push(new c(b,k,h));else k>l.last[0]||h<l.first[0]||(k=Math.max(k,l.first[0]),h=Math.min(h,l.last[0]),u.push(new c(b,k,h)));b+=1;for(t=x.length-1;0<=t;t--)y=x[t],y.ymax>=b?y.incrRow():x.splice(t,1)}return e},h.prototype.getTileIdAtParent=function(a,c){c=b.pool.acquire(c);var d=this._infoByLevel[c.level];if(a.resolution<d.resolution)throw Error("Cannot calculate parent tile. destination LOD's resolution "+a.resolution+" is not a parent resolution of "+d.resolution);return a.resolution===d.resolution?
c.id:b.getId(a.level,Math.floor(c.row*d.resolution/a.resolution+.01),Math.floor(c.col*d.resolution/a.resolution+.01),c.world)},h.prototype.getTileParentId=function(a){a=b.pool.acquire(a);var c=this._lodInfos.indexOf(this._infoByLevel[a.level])-1;if(0>c)return b.pool.release(a),null;c=this.getTileIdAtParent(this._lodInfos[c],a);return b.pool.release(a),c},h.prototype.getTileResolution=function(a){return(a=this._infoByLevel[a.level])?a.resolution:-1},h.prototype.getTileScale=function(a){return(a=this._infoByLevel[a.level])?
a.scale:-1},h.prototype.intersects=function(a,c){var d=b.pool.acquire(c);c=this._infoByLevel[d.level];var f=a.lodInfo;if(f.resolution>c.resolution){var g=b.pool.acquire(this.getTileIdAtParent(f,d)),h=f.denormalizeCol(g.col,g.world);c=a.spans.some(function(a){return a.row===g.row&&a.colFrom<=h&&a.colTo>=h});return b.pool.release(d),b.pool.release(g),c}if(f.resolution<c.resolution){var l=a.spans.reduce(function(a,b){return a[0]=Math.min(a[0],b.row),a[1]=Math.max(a[1],b.row),a[2]=Math.min(a[2],b.colFrom),
a[3]=Math.max(a[3],b.colTo),a},[+(1/0),-(1/0),+(1/0),-(1/0)]);a=l[0];var p=l[1],e=l[2],l=l[3],t=c.denormalizeCol(d.col,d.world),x=f.getColumnForX(c.getXForColumn(t)),y=f.getRowForY(c.getYForRow(d.row)),t=f.getColumnForX(c.getXForColumn(t+1))-1;c=f.getRowForY(c.getYForRow(d.row+1))-1;return b.pool.release(d),!(x>l||e>t||y>p||a>c)}var z=f.denormalizeCol(d.col,d.world);c=a.spans.some(function(a){return a.row===d.row&&a.colFrom<=z&&a.colTo>=z});return b.pool.release(d),c},h.prototype.getClosestInfoForScale=
function(a){var b=this.scales;return this._infoByScale[a]?this._infoByScale[a]:(a=b.reduce(function(b,c,d,f){return Math.abs(c-a)<Math.abs(b-a)?c:b},b[0]),this._infoByScale[a])},h}()})},"esri/views/2d/tiling/LODInfo":function(){define(["require","exports","./TileKey","../../../geometry/support/spatialReferenceUtils"],function(m,e,a,b){function c(a,b,c){return a[0]=b,a[1]=c,a}return function(){function d(a,b,c,d,p,k,q,n,e,r,v,u){this.level=a;this.resolution=b;this.scale=c;this.origin=d;this.first=
p;this.last=k;this.size=q;this.norm=n;this.worldStart=e;this.worldEnd=r;this.worldSize=v;this.wrap=u}return d.create=function(a,g,h){var f=b.getInfo(a.spatialReference),p=[a.origin.x,a.origin.y],k=[a.size[0]*g.resolution,a.size[1]*g.resolution],q=[-(1/0),-(1/0)],n=[+(1/0),+(1/0)],e=[+(1/0),+(1/0)];h&&(c(q,Math.max(0,Math.floor((h.xmin-p[0])/k[0])),Math.max(0,Math.floor((p[1]-h.ymax)/k[1]))),c(n,Math.max(0,Math.floor((h.xmax-p[0])/k[0])),Math.max(0,Math.floor((p[1]-h.ymin)/k[1]))),c(e,n[0]-q[0]+1,
n[1]-q[1]+1));var r,v,u,t;return f?(r=[Math.ceil(Math.round(2*f.origin[1]/g.resolution)/a.size[0]),e[1]],v=[Math.floor((f.origin[0]-p[0])/k[0]),q[1]],u=[r[0]-v[0]-1,n[1]],t=!0):(v=q,u=n,r=e,t=!1),new d(g.level,g.resolution,g.scale,p,q,n,e,k,v,u,r,t)},d.prototype.normalizeCol=function(a){if(!this.wrap)return a;var b=this.worldSize[0];return 0>a?b-1-Math.abs((a+1)%b):a%b},d.prototype.denormalizeCol=function(a,b){return this.wrap?this.worldSize[0]*b+a:a},d.prototype.getWorldForColumn=function(a){return this.wrap?
Math.floor(a/this.worldSize[0]):0},d.prototype.getFirstColumnForWorld=function(a){return a*this.worldSize[0]+this.first[0]},d.prototype.getLastColumnForWorld=function(a){return a*this.worldSize[0]+this.first[0]+this.size[0]-1},d.prototype.getColumnForX=function(a){return(a-this.origin[0])/this.norm[0]},d.prototype.getXForColumn=function(a){return this.origin[0]+a*this.norm[0]},d.prototype.getRowForY=function(a){return(this.origin[1]-a)/this.norm[1]},d.prototype.getYForRow=function(a){return this.origin[1]-
a*this.norm[1]},d.prototype.getTileBounds=function(b,c){c=a.pool.acquire(c);var d=this.getXForColumn(this.denormalizeCol(c.col,c.world)),f=this.getYForRow(c.row+1),g=this.getXForColumn(this.denormalizeCol(c.col,c.world)+1),k=this.getYForRow(c.row);return b[0]=d,b[1]=f,b[2]=g,b[3]=k,a.pool.release(c),b},d.prototype.getTileCoords=function(b,d){d=a.pool.acquire(d);return c(b,this.getXForColumn(this.denormalizeCol(d.col,d.world)),this.getYForRow(d.row)),a.pool.release(d),b},d}()})},"esri/views/2d/tiling/TileSpan":function(){define(["require",
"exports","../../../core/ObjectPool"],function(m,e,a){m=function(){return function(a,c,d){this.row=a;this.colFrom=c;this.colTo=d}}();return m.pool=new a(m,!0),m})},"esri/views/2d/tiling/TileCoverage":function(){define(["require","exports","../../../core/ObjectPool","../../../core/ArrayPool","./TileSpan"],function(m,e,a,b,c){m=function(){function a(a){this.lodInfo=a;this.spans=b.acquire()}return a.prototype.release=function(){for(var a=0,d=this.spans;a<d.length;a++)c.pool.release(d[a]);b.release(this.spans)},
a.prototype.forEach=function(a,b){var c=this.spans,d=this.lodInfo,f=d.level;if(0!==c.length)for(var g=0;g<c.length;g++)for(var q=c[g],n=q.row,e=q.colTo,q=q.colFrom;e>=q;q++)a.call(b,f,n,d.normalizeCol(q),d.getWorldForColumn(q))},a}();return m.pool=new a(m,!0),m})},"esri/views/2d/tiling/TileStrategy":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./TileKey"],function(m,e,a,b){var c=new b(0,0,0,0),d=new Map,f=[],g=[];return function(){function a(a){this._previousResolution=
Number.POSITIVE_INFINITY;this.cachePolicy="keep";this.tileIndex=new Map;this.tiles=[];this.acquireTile=a.acquireTile;this.releaseTile=a.releaseTile;this.tileInfoView=a.tileInfoView;a.cachePolicy&&(this.cachePolicy=a.cachePolicy)}return a.prototype.destroy=function(){this.tileIndex.clear()},a.prototype.update=function(a){var b=this,h=this.tileIndex,l=this.tileInfoView.getTileCoverage(a.state);if(l){var n=l.spans,e=l.lodInfo,r=e.level,v=a.state.resolution,u=!a.stationary&&v>this._previousResolution;
this._previousResolution=v;this.tiles.length=0;d.clear();var t=0,x=0;if(0<n.length)for(var y=0;y<n.length;y++){a=n[y];for(var z=a.row,m=a.colTo,B=a.colFrom;m>=B;B++)t++,a=c.set(r,z,e.normalizeCol(B),e.getWorldForColumn(B)).id,h.has(a)?(v=h.get(a),v.attached?(d.set(a,v),x++):v.attached||u||this._addParentTile(a,d)):(v=this.acquireTile(c),this.tileIndex.set(a,v),u||this._addParentTile(a,d))}var G=x===t;g.length=0;f.length=0;h.forEach(function(a,h){if(c.set(h),!d.has(h)){var k=b.tileInfoView.intersects(l,
c);!k||!u&&G?"purge"===b.cachePolicy?f.push(h):(c.level>r||!k)&&f.push(h):a.attached?g.push(h):u&&f.push(h)}});for(n=0;n<g.length;n++)a=g[n],(v=h.get(a))&&v.attached&&d.set(a,v);for(n=0;n<f.length;n++)a=f[n],v=h.get(a),this.releaseTile(v),h["delete"](a);d.forEach(function(a){return b.tiles.push(a)});g.length=0;f.length=0;d.clear()}},a.prototype._addParentTile=function(a,b){for(var c=null;a=this.tileInfoView.getTileParentId(a);)if(this.tileIndex.has(a)&&(c=this.tileIndex.get(a),c&&c.attached)){b.has(c.key.id)||
b.set(c.key.id,c);break}},a}()})},"esri/views/2d/tiling/TileQueue":function(){define(["require","exports","../../../core/QueueProcessor"],function(m,e,a){function b(a,b){return a.length=0,b.forEach(function(b){return a.push(b)}),a}var c=new Set,d=[],f=new Map;return function(){function g(b){var c=this;this.tileInfoView=b.tileInfoView;this._queue=new a({concurrency:6,process:b.process,peeker:function(a){return c._peek(a)}})}return Object.defineProperty(g.prototype,"length",{get:function(){return this._queue.length},
enumerable:!0,configurable:!0}),g.prototype.clear=function(){this._queue.clear()},g.prototype.find=function(a,b){return this._queue.find(a)},g.prototype.has=function(a){return this._queue.has(a)},g.prototype.pause=function(){return this._queue.pause()},g.prototype.push=function(a){return this._queue.push(a)},g.prototype.reset=function(){return this._queue.reset()},g.prototype.resume=function(){return this._queue.resume()},g.prototype._peek=function(a){var g=this;if(!this.state)return a[0];var h=this.tileInfoView,
k=Number.NEGATIVE_INFINITY,q=Number.POSITIVE_INFINITY;a.forEach(function(a){var b=g.tileInfoView.getTileScale(a);f.has(b)||(f.set(b,[]),k=Math.max(b,k),q=Math.min(b,q));f.get(b).push(a);c.add(b)});var n=this.state.scale;f.has(n)||(b(d,c),d.sort(),n=d.reduce(function(a,b,c,d){return Math.abs(b-n)<Math.abs(a-n)?b:a},d[0]));n=Math.min(n,k);n=Math.max(n,q);a=f.get(n);var e=h.getClosestInfoForScale(n),r=e.getColumnForX(this.state.center[0]),v=e.getRowForY(this.state.center[1]);return a.sort(function(a,
b){var c=e.denormalizeCol(a.col,a.world),d=e.denormalizeCol(b.col,b.world);return Math.sqrt((r-c)*(r-c)+(v-a.row)*(v-a.row))-Math.sqrt((r-d)*(r-d)+(v-b.row)*(v-b.row))}),c.clear(),f.clear(),a[0]},g}()})},"esri/core/QueueProcessor":function(){define(["require","exports","dojo/Deferred","./Queue"],function(m,e,a,b){var c={};return function(){function d(a){this._apiPromises=new Map;this._resolvingPromises=new Map;this._isPaused=!1;this.concurrency=1;a.concurrency&&(this.concurrency=a.concurrency);this._queue=
new b(a.peeker?{peeker:a.peeker}:void 0);this.process=a.process}return Object.defineProperty(d.prototype,"length",{get:function(){return this._resolvingPromises.size+this._queue.length},enumerable:!0,configurable:!0}),d.prototype.clear=function(){this._queue.clear();var a=[];this._resolvingPromises.forEach(function(b){return a.push(b)});this._resolvingPromises.clear();a.forEach(function(a){return a.cancel()});a.length=0;this._apiPromises.forEach(function(b){return a.push(b)});this._apiPromises.clear();
a.forEach(function(a){return a.cancel()});this._isPaused=!1},d.prototype.find=function(a,b){var c=this,d=void 0;return this._apiPromises.forEach(function(f,g){a.call(b,g)&&(d=c._apiPromises.get(g).promise)}),d},d.prototype.has=function(a){return this._apiPromises.has(a)},d.prototype.pause=function(){this._isPaused=!0},d.prototype.push=function(b){var c=this;if(this._apiPromises.has(b))return this._apiPromises.get(b).promise;var d=new a(function(a){c._resolvingPromises.has(b)?c._resolvingPromises.get(b).cancel(a):
(c._remove(b),c._scheduleNext())});return this._add(b,d),this._scheduleNext(),d.promise},d.prototype.reset=function(){var a=[];this._resolvingPromises.forEach(function(b){return a.push(b)});this._resolvingPromises.clear();a.forEach(function(a){return a.cancel(c)})},d.prototype.resume=function(){this._isPaused=!1;this._scheduleNext()},d.prototype._scheduleNext=function(){this._isPaused||this._next()},d.prototype._next=function(){this._resolvingPromises.size!==this.concurrency&&this._process(this._queue.pop())},
d.prototype._process=function(a){var b=this;if(null!=a){var d=this._apiPromises.get(a),f=this.process(a);f&&"function"==typeof f.then?(this._resolvingPromises.set(a,f),f.then(function(c){d.resolve(c);b._remove(a);b._scheduleNext()},function(f){f===c?b._process(a):(d.reject(f),b._remove(a),b._scheduleNext())})):(d.resolve(f),this._remove(a),this._scheduleNext())}},d.prototype._add=function(a,b){this._apiPromises.set(a,b);this._queue.push(a)},d.prototype._remove=function(a){this._queue.remove(a);this._apiPromises["delete"](a);
this._resolvingPromises["delete"](a)},d}()})},"esri/core/Queue":function(){define(["require","exports"],function(m,e){return function(){function a(a){this._items=[];this._itemSet=new Set;this._peeker=function(a){return a[0]};this._length=0;a&&a.peeker&&(this._peeker=a.peeker)}return Object.defineProperty(a.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),a.prototype.clear=function(){this._itemSet.clear();this._length=this._items.length=0},a.prototype.peek=function(){return 0!==
this._length?this._peeker(this._items):void 0},a.prototype.push=function(a){this.contains(a)||this._add(a)},a.prototype.contains=function(a){return 0<this._length&&this._itemSet.has(a)},a.prototype.pop=function(){if(0!==this._length){var a=this.peek();return this._remove(a),a}},a.prototype.remove=function(a){this.contains(a)&&this._remove(a)},a.prototype._add=function(a){this._items.push(a);this._itemSet.add(a);this._length++},a.prototype._remove=function(a){this._itemSet["delete"](a);this._items.splice(this._items.indexOf(a),
1);this._length--},a}()})},"esri/views/vectorTiles/TileHandler":function(){define("require exports module dojo/Deferred dojo/promise/all dojo/has ../../core/workers ../../core/promiseUtils ../../core/requireUtils ../../core/LRUCache ../../request ../2d/tiling/TileKey ./TileIndex ./SpriteMosaic ./SpriteSource ./GlyphMosaic ./GlyphSource ./VectorTileDisplayObject ./GeometryUtils".split(" "),function(m,e,a,b,c,d,f,g,h,l,p,k,q,n,w,r,v,u,t){var x=new l(10);return function(){function l(a,b,c,d,f){void 0===
d&&(d=!1);this.devicePixelRatio=c;this.allowUpdates=d;this._tileIndex=this._connection=this._glyphMosaic=this._spriteMosaic=null;this._updateQueue=new Map;this._ongoingRequests=new Map;this._vectorTileLayer=a;this._styleRepository=a.styleRepository;this._requestUpdate=b;this._tileInfoView=f}return l.prototype.destroy=function(){this.stop();this._vectorTileLayer=this._requestUpdate=this._styleRepository=null;this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null);this._glyphMosaic&&
(this._glyphMosaic.dispose(),this._glyphMosaic=null)},Object.defineProperty(l.prototype,"initialized",{get:function(){return this._broadcastPromise&&this._broadcastPromise.isFulfilled()},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"spriteMosaic",{get:function(){return this._spriteMosaic},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"glyphMosaic",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"ongoingRequestCount",
{get:function(){return this._ongoingRequests.size},enumerable:!0,configurable:!0}),l.prototype.start=function(){var g=this;this.stop();var k=this._styleRepository,l=new w(k.sprite,this.devicePixelRatio);l.devicePixelRatio=this.devicePixelRatio;var p=l.load().then(function(){g._spriteMosaic=new n(1024,1024,250);g._spriteMosaic.setSpriteSource(l);d("stable-symbol-rendering")&&g._spriteMosaic.preloadSpriteItems()}),q=new v(k.glyphs);this._glyphMosaic=new r(1024,1024,q);var e=this._fetchTileMap(this._vectorTileLayer.tileIndexUrl),
t=f.open(this,h.getAbsMid("./WorkerTileHandler",m,a)).then(function(a){g._connection=a}),x=new b(function(a){p.isFulfilled()||p.cancel();e.isFulfilled()||e.cancel();t.isFulfilled()||t.cancel()});return c([p,e,t]).then(function(a){c(g._connection.broadcast("setLayers",k.styleJSON)).then(function(){x.resolve()})}),this._broadcastPromise=x.promise,this._broadcastPromise},l.prototype.stop=function(){this._broadcastPromise&&!this._broadcastPromise.isFulfilled()&&this._broadcastPromise.cancel();this._updateQueue.forEach(function(a){return a.cancel()});
this._ongoingRequests.forEach(function(a){return a.cancel()});this._connection&&(this._connection.close(),this._connection=null)},l.prototype.updateTile=function(a,b){var c=this;if(!this.allowUpdates)return g.resolve(null);if(!this._broadcastPromise.isFulfilled()||!this._connection)return g.reject(Error("no connection"));b=Math.round(t.degToByte(b.state.rotation));if(a.rotation===b)return g.resolve(null);var d,f=a.key;return this._updateQueue.has(f.id)&&(d=this._updateQueue.get(f.id),d.cancel("cancel")),
a.rotation=b,d=this._connection.invoke("update",{key:a.id,rotation:b},[],{id:a.workerID}).then(function(b){return a.updateSymbolData(b),b}).always(function(){c._updateQueue["delete"](f.id)}),this._updateQueue.set(a.id,d),d},l.prototype.getVectorTileWithLRC=function(a,b,c,d){var f=this;void 0===d&&(d=0);a=new k(a,b,c,0);b=this.getRefKey(a);var g=new u(a,b,this._vectorTileLayer.tileInfo,this._styleRepository,this._glyphMosaic,0);return this.getTileData(g.key,0).then(function(a){return g.setData(a.tileData,
a.workerId,f._connection),g})},l.prototype.getTileData=function(a,b){var c=this;if(!this._broadcastPromise.isFulfilled()||!this._connection)return g.reject(Error("no connection"));var d=this._tileIndex?this._tileIndex.dataKey(a):a;if(!d)return g.reject(Error("no data"));b=Math.round(t.degToByte(b));return this._getTileData(this._connection,a,d,b).then(function(a){return a&&a.tileData?{tileData:a.tileData,workerId:a.workerId,connection:c._connection}:g.reject("No data")})},l.prototype.getRefKey=function(a){return this._tileIndex?
this._tileIndex.dataKey(a):a},l.prototype.fetchTileData=function(a){a=k.pool.acquire(a);var b=this._vectorTileLayer.getTileUrl(a.level,a.row,a.col);return k.pool.release(a),p(b,{callbackParamName:"callback",responseType:"array-buffer"}).then(function(a){return{data:{protobuff:a.data},buffers:[a.data]}})},l.prototype.getSprites=function(a){return g.resolve({data:{spriteItems:this._spriteMosaic.getSpriteItems(a.sprites)}})},l.prototype.getGlyphs=function(a){return this._glyphMosaic.getGlyphItems(a.tileID,
a.font,a.codePoints).then(function(a){return{data:{glyphItems:a}}})},l.prototype.getStyleRepository=function(){return this._styleRepository},l.prototype.getTileIndex=function(){return this._tileIndex},l.prototype._getTileData=function(a,b,c,d){var f=this,h={id:null};return(a=this._ongoingRequests.get(b.id))?a:(a=this._connection.invoke("getTile",{key:b.id,refKey:c.id,rotation:d,cacheTile:this.allowUpdates},[],h).then(function(a){return f._ongoingRequests["delete"](b.id),{tileData:a,workerId:h.id}}).otherwise(function(a){return f._ongoingRequests["delete"](b.id),
f._connection.invoke("destructTileData",{key:b.id},[],h),g.reject(a)}),this._ongoingRequests.set(b.id,a),a)},l.prototype._fetchTileMap=function(a){var b=this;return a?x.has(a)?(this._tileIndex=x.use(a),g.resolve()):p(a,{callbackParamName:"callback",responseType:"json"}).then(function(c){b._tileIndex=new q(c.data);x.insert(a,b._tileIndex)}):null},l}()})},"esri/core/workers":function(){define(["require","exports","./workers/workers"],function(m,e,a){Object.defineProperty(e,"__esModule",{value:!0});
for(var b in a)e.hasOwnProperty(b)||(e[b]=a[b])})},"esri/core/workers/workers":function(){define("require exports dojo/Deferred dojo/promise/all ../promiseUtils ./Connection ./JobProxy".split(" "),function(m,e,a,b,c,d,f){function g(a,c){for(var d=[],f=0;f<q.length;f++)d.push(q[f].openConnection(a,c));return b(d).then(function(a){})}function h(a){if((n[a]=!0,!k)&&n.every(function(a){return a})){for(var b in u)(a=v[b])&&u[b].resolve(a);u={};k=!0}}function l(b){var c=r++;b=new d(b,c);var f=new a;return v[c]=
b,k?f.resolve(b):u[c]=f,f.promise}Object.defineProperty(e,"__esModule",{value:!0});var p=Math.max((navigator.hardwareConcurrency||2)-1,2),k=!1,q=[],n=[],w=0,r=0,v={},u={},t=!1;e.open=function(a,b){if(!1===t){for(var d=0;p>d;++d){var k=new f(v,d,h);q.push(k);n.push(!1)}t=!0}return l(a).then(function(a){return g(b,a.id).then(function(){return a}).otherwise(function(a){return c.reject(a)})})};e.terminate=function(){for(var a=0;a<q.length;a++)q[a].terminate();q=[];n=[];k=!1};e.closeConnection=function(a){if(a)if(v[a.id]&&
delete v[a.id],k)for(var b=0;b<q.length;b++)q[b].closeConnection(a.id);else(b=u[a.id])&&(b.promise.cancel(),delete u[a.id])};e.invoke=function(a,b,d,f,g){var h=null;if(f&&(h=f.id),null===h&&(h=w=(w+1)%q.length,!n[h]&&!q.some(function(a,b,c){return h=(h+1)%c.length,n[h]})))return c.reject(Error("No worker available"));a=q[h].invoke(a,b,d,g);return f&&(f.id=h),a};e.broadcast=function(a,b,c,d){for(var f=[],g=0;g<q.length;g++)n[g]&&f.push(q[g].invoke(a,b,c,d));return f}})},"esri/core/workers/Connection":function(){define(["require",
"exports","./workers"],function(m,e,a){return function(){function b(a,b){this.client=a;this.id=b}return b.prototype.invoke=function(b,d,f,g){return a.invoke(b,d,f,g,this.id)},b.prototype.broadcast=function(b,d,f){return a.broadcast(b,d,f,this.id)},b.prototype.close=function(){a.closeConnection(this)},b}()})},"esri/core/workers/JobProxy":function(){define("require exports dojo/_base/kernel dojo/_base/lang dojo/Deferred ../../kernel ../../config ../../request ../Logger ../urlUtils ./WorkerFallbackImpl".split(" "),
function(m,e,a,b,c,d,f,g,h,l,p){function k(){if(!u){var a=void 0;try{a=new Worker(w)}catch(y){n.warn("Failed to create Worker. Fallback to execute module in main thread",event),a=new p}return q(a)}return t||(t=g(w,{responseType:"text"})),t.then(function(a){return new Worker(URL.createObjectURL(new Blob([a.data],{type:"text/javascript"})))}).otherwise(function(a){return n.warn("Failed to create Worker. Fallback to execute module in main thread",a),new p}).then(function(a){return q(a)})}function q(d){function g(c){if(c&&
c.data&&c.data.type)if(c=c.data.type,"\x3cworker-loaded\x3e"===c){c=d;var l;null!=f["default"]?(l=b.mixin({},f),delete l["default"],l=JSON.parse(JSON.stringify(l))):l=JSON.parse(JSON.stringify(f));var p={async:!0,baseUrl:v,locale:a.locale,has:{},paths:{}};b.mixin(p,f.workers.loaderConfig);p.has=b.mixin({"esri-cors":1,"dojo-test-sniff":0,"config-deferredInstrumentation":0,"host-webworker":1},p.has);p.paths=b.mixin({esri:"../esri",dojo:"../dojo",dojox:"../dojox",dstore:"../dstore",moment:"../moment"},
p.paths);c.postMessage({type:"\x3cconfigure\x3e",configure:{esriConfig:l,dojoConfig:p,loaderUrl:r}})}else"\x3cworker-configured\x3e"===c&&(d.removeEventListener("message",g),d.removeEventListener("error",h),k.resolve(d))}function h(a){a.preventDefault();d.removeEventListener("message",g);d.removeEventListener("error",h);n.warn("Failed to create Worker. Fallback to execute module in main thread",a);d=new p;d.addEventListener("message",g);d.addEventListener("error",h)}var k=new c;return d.addEventListener("message",
g),d.addEventListener("error",h),k.promise}var n=h.getLogger("esri.core.workers"),w=l.normalize(m.toUrl("./worker.js")),r=l.makeAbsolute(m.toUrl("dojo/dojo.js")),v=l.makeAbsolute("../",r)+"/",u=!l.hasSameOrigin(w,location.href),t=null;return function(){function a(a,b,c){var d=this;this.connections=a;this.index=b;this.workerInitCallback=c;this.msgCount=0;this.outgoingJobs={};this.incomingJobs={};this.incomingStaticJobs={};k().then(function(a){d.worker=a;d.worker.addEventListener("message",d.message.bind(d));
d.worker.addEventListener("error",function(a){a.preventDefault();n.error(a)});d.workerInitCallback(d.index)})}return a.prototype.terminate=function(){this.worker.terminate()},a.prototype.openConnection=function(a,b){return this.invoke("\x3copen-connection\x3e",{path:a},void 0,b)},a.prototype.closeConnection=function(a){this.invoke("\x3cclose-connection\x3e",void 0,void 0,a)},a.prototype.invoke=function(a,b,d,f){var g=this,h=++this.msgCount,k=new c(function(a){g.worker.postMessage({type:"\x3ccancel\x3e",
id:h,connection:f,data:{reason:a}});g.outgoingJobs[h]&&delete g.outgoingJobs[h]});return this.outgoingJobs[h]=k,this.worker.postMessage({type:a,id:h,connection:f,data:b},d),k.promise},a.prototype.message=function(a){var b=this;if(a&&a.data){var c=a.data.type;if(c){var f=a.data,g=a.data.id;if("\x3cresponse\x3e"===c&&g){if(a=this.outgoingJobs[g])delete this.outgoingJobs[g],f.error?a.reject(f.error):a.resolve(f.data)}else if("\x3ccancel\x3e"===c&&g)a=this.incomingJobs[g],(a&&a.cancel(f.data.reason),
f.staticMsg)&&(a=this.incomingStaticJobs[g])&&a.cancel(f.data.reason);else if("\x3cstatic-message\x3e"===c){var h=f.staticMsg;a=d.workerMessages[h];if(!a||"function"!=typeof a)return void this.worker.postMessage({type:"\x3cstatic-message\x3e",staticMsg:h,id:g,error:h+" message type is not available on the kernel!"});f=a.call(this,f.data);this.incomingStaticJobs[g]=f;f.then(function(a){b.worker.postMessage({type:"\x3cstatic-message\x3e",staticMsg:h,id:g,data:a.data},a.buffers)}).otherwise(function(a){a||
(a="Error encountered at method"+h);a.dojoType&&"cancel"===a.dojoType||b.worker.postMessage({type:"\x3cstatic-message\x3e",staticMsg:h,id:g,error:a})}).always(function(){delete b.incomingStaticJobs[g]})}else{var k=f.connection;if(a=this.connections[k])if(a=a.client){var l=a[c];"function"==typeof l&&(f=l.call(a,f.data),this.incomingJobs[g]=f,f.then(function(a){b.worker.postMessage({type:"\x3cresponse\x3e",id:g,connection:k,error:a.error,data:a.data},a.buffers)}).otherwise(function(a){a||(a="Error encountered at method"+
c);a.dojoType&&"cancel"===a.dojoType||b.worker.postMessage({type:"\x3cresponse\x3e",id:g,connection:k,error:a})}).always(function(){delete b.incomingJobs[g]}))}}}}},a}()})},"esri/core/workers/WorkerFallbackImpl":function(){define(["require","exports"],function(m,e){var a=function(){return this}(),b=function(){return function(){var a=this,b=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(c){a[c]=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=
arguments[d];return b[c].apply(b,a)}})}}(),c=a.MutationObserver||a.WebKitMutationObserver,d=function(){var b;if(a.process&&a.process.nextTick)b=function(b){a.process.nextTick(b)};else if(a.Promise)b=function(b){a.Promise.resolve().then(b)};else if(c){var d=[],h=document.createElement("div");(new c(function(){for(;0<d.length;)d.shift()()})).observe(h,{attributes:!0});b=function(a){d.push(a);h.setAttribute("queueStatus","1")}}return b}();return function(){function a(){this._dispatcher=new b;this._connections=
{};this._outgoingStaticMessages={};this._isInitialized=!1;this._workerPostMessage({type:"\x3cworker-loaded\x3e"})}return a.prototype.terminate=function(){this._connections={}},Object.defineProperty(a.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(a){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=a)&&this.addEventListener("message",a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onerror",
{get:function(){return this._onerrorHandler},set:function(a){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler);(this._onerrorHandler=a)&&this.addEventListener("error",a)},enumerable:!0,configurable:!0}),a.prototype.postMessage=function(a,b){var c=this;d(function(){c._workerMessageHandler(new MessageEvent("message",{data:a}))})},a.prototype.dispatchEvent=function(a){return this._dispatcher.dispatchEvent(a)},a.prototype.addEventListener=function(a,b,c){this._dispatcher.addEventListener(a,
b,c)},a.prototype.removeEventListener=function(a,b,c){this._dispatcher.removeEventListener(a,b,c)},a.prototype._workerPostMessage=function(a,b){var c=this;d(function(){c.dispatchEvent(new MessageEvent("message",{data:a}))})},a.prototype._workerMessageHandler=function(a){var b=this,c=a.data;if(c){var d=c.connection,f=c.type;if("\x3cconfigure\x3e"===f)this._isInitialized||this._workerPostMessage({type:"\x3cworker-configured\x3e"});else if("\x3copen-connection\x3e"===f){a=c.data.path;var g=c.id;if(this._connections[d])return void this._workerPostMessage({type:"\x3cresponse\x3e",
id:g,connection:d});m(["./WorkerConnection",a],function(a,c){b._connections[d]=new a(c,{postMessage:function(a,c){return b._workerPostMessage(a,c)}},d);b._workerPostMessage({type:"\x3cresponse\x3e",id:g,data:{connection:d},error:void 0})})}else"\x3cclose-connection\x3e"===f?this._connections[d]&&delete this._connections[d]:"\x3cstatic-message\x3e"===f?(a=c.id,this._outgoingStaticMessages[a]&&(f=this._outgoingStaticMessages[a],delete this._outgoingStaticMessages[a],c.error?f.reject(c.error):f.resolve(c.data))):
f&&(c=this._connections[d])&&c.proxy.message(a)}},a}()})},"esri/core/LRUCache":function(){define(["require","exports"],function(m,e){return function(){function a(a){if(this._cache={},this._lruQueue=[],0>=a)throw Error("LRU cache size must be bigger than zero!");this._maxSize=a}return a.prototype.has=function(a){return void 0!==this._cache[a]},a.prototype.insert=function(a,c){return null!==this.use(a)?void(this._cache[a]=c):(this._collect(),this._cache[a]=c,void this._lruQueue.unshift(a))},a.prototype.use=
function(a){var b=this._cache[a];return b?(this._lruQueue.splice(this._lruQueue.indexOf(a),1),this._lruQueue.unshift(a),b):null},a.prototype.print=function(){for(var a=0,c=this._lruQueue;a<c.length;a++);},a.prototype._collect=function(){if(!(this._lruQueue.length<this._maxSize)){var a=this._lruQueue.pop(),c=this._cache[a];c&&c.release&&c.release();delete this._cache[a]}},a}()})},"esri/views/vectorTiles/TileIndex":function(){define(["require","exports","../2d/tiling/TileKey"],function(m,e,a){return function(){function b(a){if(!("index"in
a))throw Error("The tilemap is missing the 'index' property.");this._tilemap=a.index}return b.prototype.dataKey=function(b){var c=[b];if(0>b.level||0>b.row||0>b.col||0<b.row>>b.level||0<b.col>>b.level)return null;for(;0!==b.level;)b=new a(b.level-1,b.row>>1,b.col>>1,b.world),c.push(b);var f,g=this._tilemap,h=c.pop();if(1===g)return h;for(;c.length;){b=c.pop();f=h.level+1;var l=2*h.row,p=2*h.col;if(f=[a.getId(f,l,p,b.world),a.getId(f,l,p+1,b.world),a.getId(f,l+1,p,b.world),a.getId(f,l+1,p+1,b.world)].indexOf(b.id),
g){if(0===g[f]){h=null;break}if(1===g[f]){h=b;break}h=b;g=g[f]}}return h},b.prototype.forEach=function(a,b,f,g,h){this._callback=h;this._maxLevel=b+a;this._forEach(this._tilemap,b,f,g)},b.prototype._forEach=function(a,b,f,g){0!==a&&(this._callback(b,f,g),b!==this._maxLevel&&"object"==typeof a&&(this._forEach(a[0],b+1,2*f,2*g),this._forEach(a[1],b+1,2*f,2*g+1),this._forEach(a[2],b+1,2*f+1,2*g),this._forEach(a[3],b+1,2*f+1,2*g+1)))},b}()})},"esri/views/vectorTiles/SpriteMosaic":function(){define("require exports ./Rect ./GeometryUtils ./RectangleBinPack ../webgl/Texture".split(" "),
function(m,e,a,b,c,d){return function(){function f(a,b,d){void 0===d&&(d=0);this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=1;(0>=a||0>=b)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=a;this._pageHeight=b;0<d&&(this._maxItemSize=d);this._binPack=new c(a-4,b-4)}return f.prototype.getWidth=function(a){return a>=
this._size.length?-1:this._size[a][0]},f.prototype.getHeight=function(a){return a>=this._size.length?-1:this._size[a][1]},f.prototype.setSpriteSource=function(a){if(this.dispose(),this.pixelRatio=a.devicePixelRatio,0===this._mosaicsData.length)this._binPack=new c(this._pageWidth-4,this._pageHeight-4),this._mosaicsData[0]=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0);this._sprites=
a},f.prototype.getSpriteItem=function(a,b){void 0===b&&(b=!1);var c=this._mosaicRects[a];if(c)return c;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;var d=this._sprites.getSpritePosition(a);if(!d||!d.width||!d.height||0>d.width||0>d.height)return null;var f=this._allocateImage(d.width,d.height),g=f[0],h=f[1],f=f[2];return 0>=g.width?null:(c={rect:g,width:d.width,height:d.height,sdf:d.sdf,pixelRatio:d.pixelRatio,page:h},this._copy(g,d,h,f,b),this._mosaicRects[a]=c,c)},f.prototype.preloadSpriteItems=
function(){for(var a=0,b=this._sprites.spriteNames;a<b.length;a++)this.getSpriteItem(b[a],!0)},f.prototype.getSpriteItems=function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];b[d]=this.getSpriteItem(d)}return b},f.prototype.getMosaicItemPosition=function(a,b){b=(a=this.getSpriteItem(a,b))&&a.rect;if(!b)return null;b.width=a.width;b.height=a.height;return{size:[a.width,a.height],tl:[(b.x+2)/this._size[a.page][0],(b.y+2)/this._size[a.page][1]],br:[(b.x+2+a.width)/this._size[a.page][0],(b.y+2+a.height)/
this._size[a.page][1]],page:a.page}},f.prototype.bind=function(a,b,c,f){void 0===c&&(c=0);void 0===f&&(f=0);this._textures[c]||(this._textures[c]=new d(a,{pixelFormat:6408,dataType:5121,width:this._size[c][0],height:this._size[c][1]},new Uint8Array(this._mosaicsData[c].buffer)));var g=this._textures[c];g.setSamplingMode(b);this._dirties[c]&&g.setData(new Uint8Array(this._mosaicsData[c].buffer));a.bindTexture(g,f);this._dirties[c]=!1},f._copyBits=function(a,b,c,d,f,q,n,e,r,v,u){var g=d*b+c;n=e*q+n;
if(u)for(n-=q,u=-1;v>=u;u++,g=((u+v)%v+d)*b+c,n+=q)for(e=-1;r>=e;e++)f[n+e]=a[g+(e+r)%r];else for(u=0;v>u;u++){for(e=0;r>e;e++)f[n+e]=a[g+e];g+=b;n+=q}},f.prototype._copy=function(a,b,c,d,k){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(c>=this._mosaicsData.length)){var g=new Uint32Array(this._sprites.image.buffer),h=this._mosaicsData[c];h&&g||console.error("Source or target images are uninitialized!");f._copyBits(g,this._sprites.width,b.x,b.y,h,d[0],a.x+2,a.y+2,b.width,b.height,k);this._dirties[c]=
!0}},f.prototype._allocateImage=function(d,f){d+=2;f+=2;var g=Math.max(d,f);if(this._maxItemSize&&this._maxItemSize<g){var g=Math.pow(2,Math.ceil(b.log2(d))),h=Math.pow(2,Math.ceil(b.log2(f)));d=new a(0,0,d,f);return this._mosaicsData.push(new Uint32Array(g*h)),this._dirties.push(!0),this._size.push([g,h]),this._textures.push(void 0),[d,this._mosaicsData.length-1,[g,h]]}g=d%4?4-d%4:4;h=f%4?4-f%4:4;1===g&&(g=5);1===h&&(h=5);g=this._binPack.allocate(d+g,f+h);return 0>=g.width?(this._dirties[this._currentPage]||
(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new c(this._pageWidth-4,this._pageHeight-4),this._allocateImage(d,f)):[g,this._currentPage,[this._pageWidth,this._pageHeight]]},f.prototype.dispose=function(){this._binPack=null;this._mosaicRects={};for(var a=0,b=this._textures;a<
b.length;a++){var c=b[a];c&&c.dispose()}this._textures.length=0},f}()})},"esri/views/vectorTiles/Rect":function(){define(["require","exports"],function(m,e){return function(){function a(a,c,d,f){void 0===a&&(a=0);void 0===c&&(c=0);void 0===d&&(d=0);void 0===f&&(f=0);this.x=a;this.y=c;this.width=d;this.height=f}return Object.defineProperty(a.prototype,"isEmpty",{get:function(){return 0>=this.width||0>=this.height},enumerable:!0,configurable:!0}),a}()})},"esri/views/vectorTiles/GeometryUtils":function(){define(["require",
"exports"],function(m,e){function a(a,b){return a%=b,0<=a?a:a+b}Object.defineProperty(e,"__esModule",{value:!0});e.C_INFINITY=Number.POSITIVE_INFINITY;e.C_PI=Math.PI;e.C_2PI=2*e.C_PI;e.C_PI_BY_2=e.C_PI/2;e.C_RAD_TO_256=128/e.C_PI;e.C_256_TO_RAD=e.C_PI/128;e.C_DEG_TO_256=256/360;e.C_DEG_TO_RAD=e.C_PI/180;e.C_SQRT2=1.414213562;e.C_SQRT2_INV=1/e.C_SQRT2;var b=1/Math.LN2;e.positiveMod=a;e.radToByte=function(b){return a(b*e.C_RAD_TO_256,256)};e.degToByte=function(b){return a(b*e.C_DEG_TO_256,256)};e.log2=
function(a){return Math.log(a)*b};e.sqr=function(a){return a*a};e.clamp=function(a,b,f){return Math.min(Math.max(a,b),f)};e.interpolate=function(a,b,f){return a*(1-f)+b*f};e.between=function(a,b,f){return a>=b&&f>=a||a>=f&&b>=a}})},"esri/views/vectorTiles/RectangleBinPack":function(){define(["require","exports","./Rect"],function(m,e,a){return function(){function b(b,d){this._height=this._width=0;this._free=[];this._width=b;this._height=d;this._free.push(new a(0,0,b,d))}return b.prototype.allocate=
function(b,d){for(var c=null,g=-1,h=0;h<this._free.length;++h){var l=this._free[h];b<=l.width&&d<=l.height&&(null===c||l.y<=c.y&&l.x<=c.x)&&(c=l,g=h)}return null===c?new a:(this._free.splice(g,1),c.width<c.height?(c.width>b&&this._free.push(new a(c.x+b,c.y,c.width-b,d)),c.height>d&&this._free.push(new a(c.x,c.y+d,c.width,c.height-d))):(c.width>b&&this._free.push(new a(c.x+b,c.y,c.width-b,c.height)),c.height>d&&this._free.push(new a(c.x,c.y+d,b,c.height-d))),new a(c.x,c.y,b,d))},b.prototype.release=
function(a){for(var b=0;b<this._free.length;++b){var c=this._free[b];if(c.y===a.y&&c.height===a.height&&c.x+c.width===a.x)c.width+=a.width;else if(c.x===a.x&&c.width===a.width&&c.y+c.height===a.y)c.height+=a.height;else if(a.y===c.y&&a.height===c.height&&a.x+a.width===c.x)c.x=a.x,c.width+=a.width;else{if(a.x!==c.x||a.width!==c.width||a.y+a.height!==c.y)continue;c.y=a.y;c.height+=a.height}this._free.splice(b,1);this.release(a)}this._free.push(a)},b}()})},"esri/views/vectorTiles/SpriteSource":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper dojo/Deferred dojo/promise/all ../../request ../../kernel ../../core/promiseUtils".split(" "),
function(m,e,a,b,c,d,f,g,h){return function(){function a(a,b){this.baseURL=a;this.devicePixelRatio=b;this._isRetina=!1;this._spritesData={};this.height=this.width=this.image=null;this.loadStatus="not-loaded"}return Object.defineProperty(a.prototype,"spriteNames",{get:function(){var a=[],b;for(b in this._spritesData)a.push(b);return a.sort(),a},enumerable:!0,configurable:!0}),a.prototype.getSpritePosition=function(a){return this._spritesData[a]},a.prototype.load=function(){var a=this;return this.loadStatus=
"loading",this.baseURL?this._loadSprites().then(function(){return a.loadStatus="loaded",a}).otherwise(function(b){return a.loadStatus="failed",a}):h.resolve(this)},a.prototype._loadSprites=function(){var a=this;this._isRetina=1.15<this.devicePixelRatio?!0:!1;var b=this.baseURL,h=this._isRetina?"@2x":"",l=f(b+h+".json",{callbackParamName:"callback",responseType:"json"}).then(function(b){a._spritesData=b.data}),e=new c,r=new Image;r.crossOrigin="anonymous";r.onload=function(){r.onload=null;a.width=
r.width;a.height=r.height;var b=document.createElement("canvas");b.width=r.width;b.height=r.height;b=b.getContext("2d");b.drawImage(r,0,0,r.width,r.height);for(var b=b.getImageData(0,0,r.width,r.height),c=new Uint8Array(b.data),d=0;d<c.length;d+=4)b=c[d+3]/255,c[d]*=b,c[d+1]*=b,c[d+2]*=b;a.image=c;e.resolve()};b=""+b+h+".png";g.id&&(h=g.id.findCredential(b))&&h.token&&(b+="?token\x3d"+h.token);return r.src=b,d([l,e.promise])},a}()})},"esri/views/vectorTiles/GlyphMosaic":function(){define("require exports dojo/promise/all dojo/has ./Rect ../webgl/Texture ./RectangleBinPack".split(" "),
function(m,e,a,b,c,d,f){var g;b("stable-symbol-rendering")&&(g=new Set);return function(){function h(a,b,c){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;(0>=a||0>=b)&&console.error("Glyph mosaic width and height must be greater than zero!");this.width=a;this.height=b;this._glyphSource=c;this._binPack=new f(a-4,b-4);this._glyphData.push(new Uint8Array(a*b));this._dirties.push(!0);this._textures.push(void 0)}
return h.prototype.getGlyphItems=function(d,h,k){var l=this,e=[],p=this._glyphSource,r=new Set;d=1/256;for(var v=0;v<k.length;v++)r.add(Math.floor(k[v]*d));var u=[];return r.forEach(function(a){if(256>=a){var b=h+a;l._rangePromises.has(b)?u.push(l._rangePromises.get(b)):(a=p.getRange(h,a).always(function(){l._rangePromises["delete"](b)}),l._rangePromises.set(b,a),u.push(a))}}),a(u).then(function(a){(a=l._glyphIndex[h])||(a={},l._glyphIndex[h]=a);var d;if(b("stable-symbol-rendering")){g.clear();for(var n=
0;n<k.length;n++)d=k[n],g.add(d);var q=[];r.forEach(function(a){q.push(a)});q.sort();d=[];for(n=0;n<q.length;n++)for(var w=q[n],t=0;256>t;++t)d.push(256*w+t)}else d=k;n=0;for(w=d;n<w.length;n++)if(d=w[n],t=a[d])b("stable-symbol-rendering")&&!g.has(d)||(e[d]={rect:t.rect,metrics:t.metrics,page:t.page});else{var v=p.getGlyph(h,d);if(v&&v.metrics){var t=v.metrics,u=void 0;if(0===t.width)u=new c(0,0,0,0);else{var m=t.width+6,E=t.height+6,I=m%4?4-m%4:4,H=E%4?4-E%4:4;1===I&&(I=5);1===H&&(H=5);u=l._binPack.allocate(m+
I,E+H);u.isEmpty&&(l._dirties[l._currentPage]||(l._glyphData[l._currentPage]=null),l._currentPage=l._glyphData.length,l._glyphData.push(new Uint8Array(l.width*l.height)),l._dirties.push(!0),l._textures.push(void 0),l._binPack=new f(l.width-4,l.height-4),u=l._binPack.allocate(m+I,E+H));var I=l._glyphData[l._currentPage],v=v.bitmap,F=H=void 0;if(v)for(var C=0;E>C;C++)for(var H=m*C,F=l.width*(u.y+C+1)+u.x,J=0;m>J;J++)I[F+J+1]=v[H+J]}a[d]={rect:u,metrics:t,tileIDs:null,page:l._currentPage};b("stable-symbol-rendering")&&
!g.has(d)||(e[d]={rect:u,metrics:t,page:l._currentPage});l._dirties[l._currentPage]=!0}}return e})},h.prototype.removeGlyphs=function(a){for(var b in this._glyphIndex){var c=this._glyphIndex[b];if(c){var d=void 0,f;for(f in c)if(d=c[f],d.tileIDs["delete"](a),0===d.tileIDs.size){for(var g=this._glyphData[d.page],h=d.rect,l=void 0,e=void 0,t=0;t<h.height;t++)for(l=this.width*(h.y+t)+h.x,e=0;e<h.width;e++)g[l+e]=0;delete c[f];this._dirties[d.page]=!0}}}},h.prototype.bind=function(a,b,c,f){void 0===f&&
(f=0);this._textures[c]||(this._textures[c]=new d(a,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var g=this._textures[c];g.setSamplingMode(b);this._dirties[c]&&g.setData(this._glyphData[c]);a.bindTexture(g,f);this._dirties[c]=!1},h.prototype.dispose=function(){this._binPack=null;for(var a=0,b=this._textures;a<b.length;a++){var c=b[a];c&&c.dispose()}this._textures.length=0},h}()})},"esri/views/vectorTiles/GlyphSource":function(){define(["require",
"exports","../../core/promiseUtils","../../request","../../core/pbf"],function(m,e,a,b,c){var d=function(){function a(a){this._metrics=[];for(this._bitmaps=[];a.next();)switch(a.tag()){case 1:for(var b=a.getMessage();b.next();)switch(b.tag()){case 3:for(var c=b.getMessage(),d=void 0,f=void 0,g=void 0,h=void 0,e=void 0,v=void 0,u=void 0;c.next();)switch(c.tag()){case 1:d=c.getUInt32();break;case 2:f=c.getBytes();break;case 3:g=c.getUInt32();break;case 4:h=c.getUInt32();break;case 5:e=c.getSInt32();
break;case 6:v=c.getSInt32();break;case 7:u=c.getUInt32();break;default:c.skip()}d&&(this._metrics[d]={width:g,height:h,left:e,top:v,advance:u},this._bitmaps[d]=f);break;default:b.skip()}break;default:a.skip()}}return a.prototype.getMetrics=function(a){return this._metrics[a]},a.prototype.getBitmap=function(a){return this._bitmaps[a]},a}(),f=function(){function a(){this._ranges=[]}return a.prototype.getRange=function(a){return this._ranges[a]},a.prototype.addRange=function(a,b){this._ranges[a]=b},
a}();return function(){function g(a){this._glyphInfo={};this._baseURL=a}return g.prototype.getRange=function(f,g){var h=this._getFontStack(f);if(h.getRange(g))return a.resolve();var k=256*g,l=k+255;f=this._baseURL.replace("{fontstack}",f).replace("{range}",k+"-"+l);return b(f,{callbackParamName:"callback",responseType:"array-buffer"}).then(function(a){h.addRange(g,new d(new c(new Uint8Array(a.data),new DataView(a.data))))})},g.prototype.getGlyph=function(a,b){if(a=this._getFontStack(a)){var c=Math.floor(b/
256);if(!(256<c)&&(a=a.getRange(c)))return{metrics:a.getMetrics(b),bitmap:a.getBitmap(b)}}},g.prototype._getFontStack=function(a){var b=this._glyphInfo[a];return b||(b=this._glyphInfo[a]=new f),b},g}()})},"esri/core/pbf":function(){define(["require","exports"],function(m,e){return function(){function a(a,c,d,f){this._tag=0;this._dataType=99;this._data=a;this._dataView=c;this._pos=d||0;this._end=f||a.byteLength}return a.prototype.clone=function(){return new a(this._data,this._dataView,this._pos,this._end)},
a.prototype.next=function(a){for(;;){if(this._pos===this._end)return!1;var b=this._decodeVarint();if(this._tag=b>>3,this._dataType=7&b,!a||a===this._tag)break;this.skip()}return!0},a.prototype.empty=function(){return this._pos>=this._end},a.prototype.tag=function(){return this._tag},a.prototype.getInt32=function(){return this._decodeVarint()},a.prototype.getInt64=function(){return this._decodeVarint()},a.prototype.getUInt32=function(){return this._decodeVarint()},a.prototype.getUInt64=function(){return this._decodeVarint()},
a.prototype.getSInt32=function(){return this._decodeSVarint()},a.prototype.getSInt64=function(){return this._decodeSVarint()},a.prototype.getBool=function(){var a=0!==this._data[this._pos];return this._skip(1),a},a.prototype.getEnum=function(){return this._decodeVarint()},a.prototype.getFixed64=function(){var a=this._dataView,c=this._pos,a=a.getUint32(c,!0)+4294967296*a.getUint32(c+4,!0);return this._skip(8),a},a.prototype.getSFixed64=function(){var a=this._dataView,c=this._pos,a=a.getUint32(c,!0)+
4294967296*a.getInt32(c+4,!0);return this._skip(8),a},a.prototype.getDouble=function(){var a=this._dataView.getFloat64(this._pos,!0);return this._skip(8),a},a.prototype.getFixed32=function(){var a=this._dataView.getUint32(this._pos,!0);return this._skip(4),a},a.prototype.getSFixed32=function(){var a=this._dataView.getInt32(this._pos,!0);return this._skip(4),a},a.prototype.getFloat=function(){var a=this._dataView.getFloat32(this._pos,!0);return this._skip(4),a},a.prototype.getString=function(){var a=
this._getLength(),c=this._pos,c=this._toString(this._data,c,c+a);return this._skip(a),c},a.prototype.getBytes=function(){var a=this._getLength(),c=this._pos,c=this._toBytes(this._data,c,c+a);return this._skip(a),c},a.prototype.getMessage=function(){var b=this._getLength(),c=this._pos,c=new a(this._data,this._dataView,c,c+b);return this._skip(b),c},a.prototype.skip=function(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;
case 5:this._skip(4);break;default:throw Error("Invalid data type!");}},a.prototype._skip=function(a){if(this._pos+a>this._end)throw Error("Attempt to skip past the end of buffer!");this._pos+=a},a.prototype._decodeVarint=function(){var a,c=this._data,d=this._pos,f=0;if(10<=this._end-d){if(a=c[d++],f|=127&a,0!==(128&a))if(a=c[d++],f|=(127&a)<<7,0!==(128&a))if(a=c[d++],f|=(127&a)<<14,0!==(128&a))if(a=c[d++],f|=(127&a)<<21,0!==(128&a))if(a=c[d++],f+=268435456*(127&a),0!==(128&a))if(a=c[d++],f+=34359738368*
(127&a),0!==(128&a))if(a=c[d++],f+=4398046511104*(127&a),0!==(128&a))if(a=c[d++],f+=562949953421312*(127&a),0!==(128&a))if(a=c[d++],f+=72057594037927936*(127&a),0!==(128&a))if(a=c[d++],f+=0x7fffffffffffffff*(127&a),0!==(128&a))throw Error("Varint too long!");}else{for(var g=1;d!==this._end&&(a=c[d],0!==(128&a));)++d,f+=(127&a)*g,g*=128;if(d===this._end)throw Error("Varint overrun!");++d;f+=a*g}return this._pos=d,f},a.prototype._decodeSVarint=function(){var a=this._decodeVarint();return a%2?-(a+1)/
2:a/2},a.prototype._getLength=function(){if(2!==this._dataType)throw Error("Not a delimited data type!");return this._decodeVarint()},a.prototype._toString=function(a,c,d){var b="",g="";for(d=Math.min(this._end,d);d>c;++c){var h=a[c];128&h?g+="%"+h.toString(16):(b+=decodeURIComponent(g)+String.fromCharCode(h),g="")}return g.length&&(b+=decodeURIComponent(g)),b},a.prototype._toBytes=function(a,c,d){return d=Math.min(this._end,d),new Uint8Array(a.buffer,c,d-c)},a}()})},"esri/views/vectorTiles/VectorTileDisplayObject":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix/vec2 ../../core/libs/gl-matrix/mat4 ../../core/ObjectPool ../../geometry/support/spatialReferenceUtils ../webgl/BufferObject ../2d/engine/DisplayObject ../2d/tiling/TileKey ./RenderBucket".split(" "),
function(m,e,a,b,c,d,f,g,h,l,p){m=function(d){function h(){for(var a=[],f=0;f<arguments.length;f++)a[f]=arguments[f];f=d.call(this)||this;return f._renderBuckets=[],f._vectorTileData=null,f._symbolUpdateData=null,f.status=5,f.coords=[0,0],f.tileTransform={transform:Float32Array[16],displayCoord:Float32Array[2]},f.stencilData={mask:0,reference:0},f.status=0,f.tileTransform.transform=c.create(),f.tileTransform.displayCoord=b.create(),0<a.length&&(g=f.acquire).call.apply(g,[f].concat(a)),f;var g}return a(h,
d),h.prototype.reset=function(){l.pool.release(this.key);this.refKey=this.key=null;this.coords[0]=0;this.height=this.width=this.coords[1]=0;this.resolution=null;this.rotation=0;this.id=this._connection=this.workerID=this._glyphsMosaic=this.styleLayers=this._vectorTileData=null;this.tileTransform.transform.fill(0);this.tileTransform.displayCoord.fill(0);this.stencilData.mask=0;this.stencilData.reference=0;this._renderBuckets.length=0;this._symbolUpdateData=null;this.status=0},h.prototype.acquire=function(a,
b,c,d,g,h){this.key=a;this.refKey=b;b=c.lods[a.level].resolution;var k=c.size[0]*b,l=c.origin,e=a.col*k,k=a.row*k,n=c.spatialReference,q=0;n&&(n._isWrappable?n._isWrappable():n.isWrappable)&&(q=f.getInfo(n),q=q.valid[1]-q.valid[0]);k=l.y-k;this.coords[0]=l.x+e+a.world*q;this.coords[1]=k;this.widthInPixels=c.size[1];this.coordRange=4096;this.resolution=b;this.rotation=h;this.styleLayers=d;this._glyphsMosaic=g;this.id=a.id;this.status=1},h.prototype.setData=function(a,b,c){this._vectorTileData=a;this.workerID=
b;this._connection=c;this.status=3},h.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())},h.prototype.dispose=function(){this.polygonTrianglesVertexArrayObject&&(this.polygonTrianglesVertexArrayObject.dispose(),this.polygonTrianglesVertexArrayObject=null);this.polygonOutlineVertexArrayObject&&(this.polygonOutlineVertexArrayObject.dispose(),this.polygonOutlineVertexArrayObject=null);this.lineTrianglesVertexArrayObject&&(this.lineTrianglesVertexArrayObject.dispose(),
this.lineTrianglesVertexArrayObject=null);this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this.polygonTrianglesVertexBuffer&&(this.polygonTrianglesVertexBuffer.dispose(),this.polygonTrianglesVertexBuffer=null);this.polygonTrianglesIndexBuffer&&(this.polygonTrianglesIndexBuffer.dispose(),this.polygonTrianglesIndexBuffer=null);this.polygonOutlinesVertexBuffer&&
(this.polygonOutlinesVertexBuffer.dispose(),this.polygonOutlinesVertexBuffer=null);this.polygonOutlinesIndexBuffer&&(this.polygonOutlinesIndexBuffer.dispose(),this.polygonOutlinesIndexBuffer=null);this.lineVertexBuffer&&(this.lineVertexBuffer.dispose(),this.lineVertexBuffer=null);this.lineTrianglesIndexBuffer&&(this.lineTrianglesIndexBuffer.dispose(),this.lineTrianglesIndexBuffer=null);this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),
this.iconIndexBuffer=null);this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null);this.texture&&(this.texture.dispose(),this.texture=null);this._renderBuckets.length=0;this.status=7},h.prototype.attach=function(a){if(4===this.status)return!0;if(this.status=3,!this._vectorTileData)return!1;if(0===this._renderBuckets.length)for(var b=new Uint32Array(this._vectorTileData.bucketDataInfo),c=b.length,
d=0;c>d;){var f=b[d],h=b[d+1];if(0===h)h=new p.BackgroundRenderBucket,h.layerID=f,this._renderBuckets.push(h),d+=2;else if(1===h)h=new p.FillRenderBucket,h.layerID=f,h.triangleElementStart=b[d+2],h.triangleElementCount=b[d+3],h.outlineElementStart=b[d+4],h.outlineElementCount=b[d+5],this._renderBuckets.push(h),d+=6;else if(2===h)h=new p.LineRenderBucket,h.layerID=f,h.triangleElementStart=b[d+2],h.triangleElementCount=b[d+3],this._renderBuckets.push(h),d+=6;else if(3===h){h=new p.SymbolRenderBucket;
h.layerID=f;h.isSDF=0!==b[d+2];var f=b[d+3],k=d+4;if(0<f)for(var k=d+4,l=void 0,e=void 0,n=void 0,q=0;f>q;q++)l=b[k],e=b[k+1],n=b[k+2],h.markerPerPageElementsMap.set(l,[e,n]),k+=3;var m=b[k];if(0<m)for(k++,n=e=l=void 0,q=0;m>q;q++)l=b[k],e=b[k+1],n=b[k+2],h.glyphPerPageElementsMap.set(l,[e,n]),k+=3;this._renderBuckets.push(h);d+=5+3*f+3*m}else console.error("Bad bucket type!")}a=a.context;b=new Uint32Array(this._vectorTileData.bufferDataInfo);c=b.length;for(h=d=0;c>h;h+=2,d++)if(f=b[h],!(0>=b[h+1]||
0===this._vectorTileData.bufferData[d].byteLength))switch(f){case 2:this.polygonTrianglesVertexBuffer?this.polygonTrianglesVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.polygonTrianglesVertexBuffer=g.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 6:this.polygonTrianglesIndexBuffer?this.polygonTrianglesIndexBuffer.setData(this._vectorTileData.bufferData[d]):this.polygonTrianglesIndexBuffer=g.createIndex(a,35044,this._vectorTileData.bufferData[d]);break;case 3:this.polygonOutlinesVertexBuffer?
this.polygonOutlinesVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.polygonOutlinesVertexBuffer=g.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 7:this.polygonOutlinesIndexBuffer?this.polygonOutlinesIndexBuffer.setData(this._vectorTileData.bufferData[d]):this.polygonOutlinesIndexBuffer=g.createIndex(a,35044,this._vectorTileData.bufferData[d]);break;case 0:this.lineVertexBuffer?this.lineVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.lineVertexBuffer=
g.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 8:this.lineTrianglesIndexBuffer?this.lineTrianglesIndexBuffer.setData(this._vectorTileData.bufferData[d]):this.lineTrianglesIndexBuffer=g.createIndex(a,35044,this._vectorTileData.bufferData[d]);break;case 4:this.iconVertexBuffer?this.iconVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.iconVertexBuffer=g.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 9:this.iconIndexBuffer?this.iconIndexBuffer.setData(this._vectorTileData.bufferData[d]):
this.iconIndexBuffer=g.createIndex(a,35044,this._vectorTileData.bufferData[d]);break;case 5:this.textVertexBuffer?this.textVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.textVertexBuffer=g.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 10:this.textIndexBuffer?this.textIndexBuffer.setData(this._vectorTileData.bufferData[d]):this.textIndexBuffer=g.createIndex(a,35044,this._vectorTileData.bufferData[d])}return this.status=4,!0},h.prototype.detach=function(a){-1!==
this.workerID&&this._connection&&6!==this.status&&7!==this.status&&this._connection.broadcast("destructTileData",{key:this.id,worker:this.workerID},[]);this.dispose();d.prototype.detach.call(this,a)},h.prototype.doRender=function(a){if(this.visible&&4===this.status){var b=a.context,c=a.renderer;if(b&&c){var d=a.drawphase;this._symbolUpdateData&&this._updateSymbolData(a);b.setStencilFunction(514,this.stencilData.reference,this.stencilData.mask);var f=this.styleLayers,g=void 0!==a.layerOpacity?a.layerOpacity:
1;if(0!==g){var h,k=this._renderBuckets.length,l=0;if(0===d)for(l=k-1;0<=l;l--)h=this._renderBuckets[l],3!==h.type&&h.hasData()&&c.renderBucket(b,h,a.displayLevel,a.requiredLevel,d,this,f.layers[h.layerID],g);else for(l=0;k>l;l++)h=this._renderBuckets[l],h.hasData()&&c.renderBucket(b,h,a.displayLevel,a.requiredLevel,d,this,f.layers[h.layerID],g)}}}},h.prototype._updateSymbolData=function(a){var b=new Uint32Array(this._symbolUpdateData.bucketDataInfo),c=b.length;if(0===c)return this._symbolUpdateData=
null,!0;if(1>a.budget.remaining||4!==this.status)return this.requestRender(),!1;a=a.context;for(var d=new Uint32Array(this._symbolUpdateData.bufferDataInfo),f=d.length,h=0,k=0;f>k;k+=2,h++)switch(d[k]){case 4:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=g.createVertex(a,35044,this._symbolUpdateData.bufferData[h]);break;case 9:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.iconIndexBuffer=g.createIndex(a,
35044,this._symbolUpdateData.bufferData[h]);break;case 5:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=g.createVertex(a,35044,this._symbolUpdateData.bufferData[h]);break;case 10:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=g.createIndex(a,35044,this._symbolUpdateData.bufferData[h])}a=this._renderBuckets.length;for(d=0;a>d;d++)this._renderBuckets[d]instanceof p.SymbolRenderBucket&&(f=
this._renderBuckets[d],f.markerPerPageElementsMap.clear(),f.glyphPerPageElementsMap.clear());for(a=0;c>a;){f=b[a];h=-1;k=this._renderBuckets.length;for(d=0;k>d;d++)if(this._renderBuckets[d].layerID===f){h=d;break}(d=this._renderBuckets[h])||(d=new p.SymbolRenderBucket,d.layerID=f,d.isSDF=0!==b[a+2],this._renderBuckets.push(d));var f=b[a+3],l=a+4;if(0<f)for(var l=a+4,e=k=h=void 0,n=0;f>n;n++)h=b[l],k=b[l+1],e=b[l+2],d.markerPerPageElementsMap.set(h,[k,e]),l+=3;var q=b[l];if(0<q)for(l++,e=k=h=void 0,
n=0;q>n;n++)h=b[l],k=b[l+1],e=b[l+2],d.glyphPerPageElementsMap.set(h,[k,e]),l+=3;a+=5+3*f+3*q}return this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null),this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null),this._symbolUpdateData=null,!0},h}(h);return m.pool=new d(m),m})},"esri/core/libs/gl-matrix/vec2":function(){define(["./common"],function(m){var e={};return e.create=function(){var a=new m.ARRAY_TYPE(2);
return a[0]=0,a[1]=0,a},e.clone=function(a){var b=new m.ARRAY_TYPE(2);return b[0]=a[0],b[1]=a[1],b},e.fromValues=function(a,b){var c=new m.ARRAY_TYPE(2);return c[0]=a,c[1]=b,c},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},e.set=function(a,b,c){return a[0]=b,a[1]=c,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},e.mul=e.multiply,
e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},e.div=e.divide,e.ceil=function(a,b){return a[0]=Math.ceil(b[0]),a[1]=Math.ceil(b[1]),a},e.floor=function(a,b){return a[0]=Math.floor(b[0]),a[1]=Math.floor(b[1]),a},e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},e.round=function(a,b){return a[0]=Math.round(b[0]),a[1]=Math.round(b[1]),a},e.scale=function(a,b,c){return a[0]=
b[0]*c,a[1]=b[1]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a},e.distance=function(a,b){var c=b[0]-a[0];a=b[1]-a[1];return Math.sqrt(c*c+a*a)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0];a=b[1]-a[1];return c*c+a*a},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0];a=a[1];return Math.sqrt(b*b+a*a)},e.len=e.length,e.squaredLength=function(a){var b=a[0];a=a[1];return b*b+a*a},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=
-b[0],a[1]=-b[1],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a},e.normalize=function(a,b){var c=b[0],d=b[1],c=c*c+d*d;return 0<c&&(c=1/Math.sqrt(c),a[0]=b[0]*c,a[1]=b[1]*c),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},e.cross=function(a,b,c){b=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=b,a},e.lerp=function(a,b,c,d){var f=b[0];b=b[1];return a[0]=f+d*(c[0]-f),a[1]=b+d*(c[1]-b),a},e.random=function(a,b){b=b||1;var c=2*m.RANDOM()*Math.PI;return a[0]=Math.cos(c)*b,a[1]=Math.sin(c)*
b,a},e.transformMat2=function(a,b,c){var d=b[0];b=b[1];return a[0]=c[0]*d+c[2]*b,a[1]=c[1]*d+c[3]*b,a},e.transformMat2d=function(a,b,c){var d=b[0];b=b[1];return a[0]=c[0]*d+c[2]*b+c[4],a[1]=c[1]*d+c[3]*b+c[5],a},e.transformMat3=function(a,b,c){var d=b[0];b=b[1];return a[0]=c[0]*d+c[3]*b+c[6],a[1]=c[1]*d+c[4]*b+c[7],a},e.transformMat4=function(a,b,c){var d=b[0];b=b[1];return a[0]=c[0]*d+c[4]*b+c[12],a[1]=c[1]*d+c[5]*b+c[13],a},e.forEach=function(){var a=e.create();return function(b,c,d,f,g,h){c||(c=
2);d||(d=0);for(f=f?Math.min(f*c+d,b.length):b.length;f>d;d+=c)a[0]=b[d],a[1]=b[d+1],g(a,a,h),b[d]=a[0],b[d+1]=a[1];return b}}(),e.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]},e.equals=function(a,b){var c=a[0];a=a[1];var d=b[0];b=b[1];return Math.abs(c-d)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(d))&&Math.abs(a-b)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))},e})},"esri/core/libs/gl-matrix/common":function(){define([],function(){var m=
{EPSILON:1E-6};m.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array;m.RANDOM=Math.random;m.ENABLE_SIMD=!1;m.SIMD_AVAILABLE=m.ARRAY_TYPE===Float32Array&&"SIMD"in this;m.USE_SIMD=m.ENABLE_SIMD&&m.SIMD_AVAILABLE;m.setMatrixArrayType=function(a){m.ARRAY_TYPE=a};var e=Math.PI/180;return m.toRadian=function(a){return a*e},m.equals=function(a,b){return Math.abs(a-b)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))},m})},"esri/core/libs/gl-matrix/mat4":function(){define(["./common"],function(m){var e=
{scalar:{},SIMD:{}};return e.create=function(){var a=new m.ARRAY_TYPE(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.clone=function(a){var b=new m.ARRAY_TYPE(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=
b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.fromValues=function(a,b,c,d,f,g,h,l,e,k,q,n,w,r,v,u){var p=new m.ARRAY_TYPE(16);return p[0]=a,p[1]=b,p[2]=c,p[3]=d,p[4]=f,p[5]=g,p[6]=h,p[7]=l,p[8]=e,p[9]=k,p[10]=q,p[11]=n,p[12]=w,p[13]=r,p[14]=v,p[15]=u,p},e.set=function(a,b,c,d,f,g,h,l,e,k,q,n,w,r,m,u,t){return a[0]=b,a[1]=c,a[2]=d,a[3]=f,a[4]=g,a[5]=h,a[6]=l,a[7]=e,a[8]=k,a[9]=q,a[10]=n,a[11]=w,a[12]=r,a[13]=m,a[14]=
u,a[15]=t,a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.scalar.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],f=b[3],g=b[6],h=b[7],l=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=d;a[9]=g;a[11]=b[14];a[12]=f;a[13]=h;a[14]=l}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],
a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},e.SIMD.transpose=function(a,b){var c,d,f,g,h,l,e,k,q,n;return c=SIMD.Float32x4.load(b,0),d=SIMD.Float32x4.load(b,4),f=SIMD.Float32x4.load(b,8),g=SIMD.Float32x4.load(b,12),h=SIMD.Float32x4.shuffle(c,d,0,1,4,5),l=SIMD.Float32x4.shuffle(f,g,0,1,4,5),e=SIMD.Float32x4.shuffle(h,l,0,2,4,6),k=SIMD.Float32x4.shuffle(h,l,1,3,5,7),SIMD.Float32x4.store(a,0,e),SIMD.Float32x4.store(a,4,k),h=SIMD.Float32x4.shuffle(c,d,2,3,6,7),l=SIMD.Float32x4.shuffle(f,g,2,3,6,7),q=
SIMD.Float32x4.shuffle(h,l,0,2,4,6),n=SIMD.Float32x4.shuffle(h,l,1,3,5,7),SIMD.Float32x4.store(a,8,q),SIMD.Float32x4.store(a,12,n),a},e.transpose=m.USE_SIMD?e.SIMD.transpose:e.scalar.transpose,e.scalar.invert=function(a,b){var c=b[0],d=b[1],f=b[2],g=b[3],h=b[4],l=b[5],e=b[6],k=b[7],q=b[8],n=b[9],w=b[10],r=b[11],m=b[12],u=b[13],t=b[14];b=b[15];var x=c*l-d*h,y=c*e-f*h,z=c*k-g*h,A=d*e-f*l,B=d*k-g*l,G=f*k-g*e,K=q*u-n*m,D=q*t-w*m,E=q*b-r*m,I=n*t-w*u,H=n*b-r*u,F=w*b-r*t,C=x*F-y*H+z*I+A*E-B*D+G*K;return C?
(C=1/C,a[0]=(l*F-e*H+k*I)*C,a[1]=(f*H-d*F-g*I)*C,a[2]=(u*G-t*B+b*A)*C,a[3]=(w*B-n*G-r*A)*C,a[4]=(e*E-h*F-k*D)*C,a[5]=(c*F-f*E+g*D)*C,a[6]=(t*z-m*G-b*y)*C,a[7]=(q*G-w*z+r*y)*C,a[8]=(h*H-l*E+k*K)*C,a[9]=(d*E-c*H-g*K)*C,a[10]=(m*B-u*z+b*x)*C,a[11]=(n*z-q*B-r*x)*C,a[12]=(l*D-h*I-e*K)*C,a[13]=(c*I-d*D+f*K)*C,a[14]=(u*y-m*A-t*x)*C,a[15]=(q*A-n*y+w*x)*C,a):null},e.SIMD.invert=function(a,b){var c,d,f,g,h,l,e,k,q,n,w=SIMD.Float32x4.load(b,0),r=SIMD.Float32x4.load(b,4),m=SIMD.Float32x4.load(b,8);b=SIMD.Float32x4.load(b,
12);return h=SIMD.Float32x4.shuffle(w,r,0,1,4,5),d=SIMD.Float32x4.shuffle(m,b,0,1,4,5),c=SIMD.Float32x4.shuffle(h,d,0,2,4,6),d=SIMD.Float32x4.shuffle(d,h,1,3,5,7),h=SIMD.Float32x4.shuffle(w,r,2,3,6,7),g=SIMD.Float32x4.shuffle(m,b,2,3,6,7),f=SIMD.Float32x4.shuffle(h,g,0,2,4,6),g=SIMD.Float32x4.shuffle(g,h,1,3,5,7),h=SIMD.Float32x4.mul(f,g),h=SIMD.Float32x4.swizzle(h,1,0,3,2),l=SIMD.Float32x4.mul(d,h),e=SIMD.Float32x4.mul(c,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,
h),l),e=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,h),e),e=SIMD.Float32x4.swizzle(e,2,3,0,1),h=SIMD.Float32x4.mul(d,f),h=SIMD.Float32x4.swizzle(h,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(g,h),l),q=SIMD.Float32x4.mul(c,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(g,h)),q=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,h),q),q=SIMD.Float32x4.swizzle(q,2,3,0,1),h=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,3,0,1),g),h=SIMD.Float32x4.swizzle(h,1,0,3,2),f=SIMD.Float32x4.swizzle(f,
2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,h),l),k=SIMD.Float32x4.mul(c,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(f,h)),k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,h),k),k=SIMD.Float32x4.swizzle(k,2,3,0,1),h=SIMD.Float32x4.mul(c,d),h=SIMD.Float32x4.swizzle(h,1,0,3,2),k=SIMD.Float32x4.add(SIMD.Float32x4.mul(g,h),k),q=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,h),q),h=SIMD.Float32x4.swizzle(h,2,3,0,1),k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,h),k),q=SIMD.Float32x4.sub(q,
SIMD.Float32x4.mul(f,h)),h=SIMD.Float32x4.mul(c,g),h=SIMD.Float32x4.swizzle(h,1,0,3,2),e=SIMD.Float32x4.sub(e,SIMD.Float32x4.mul(f,h)),k=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,h),k),h=SIMD.Float32x4.swizzle(h,2,3,0,1),e=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,h),e),k=SIMD.Float32x4.sub(k,SIMD.Float32x4.mul(d,h)),h=SIMD.Float32x4.mul(c,f),h=SIMD.Float32x4.swizzle(h,1,0,3,2),e=SIMD.Float32x4.add(SIMD.Float32x4.mul(g,h),e),q=SIMD.Float32x4.sub(q,SIMD.Float32x4.mul(d,h)),h=SIMD.Float32x4.swizzle(h,2,
3,0,1),e=SIMD.Float32x4.sub(e,SIMD.Float32x4.mul(g,h)),q=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,h),q),n=SIMD.Float32x4.mul(c,l),n=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(n,2,3,0,1),n),n=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(n,1,0,3,2),n),h=SIMD.Float32x4.reciprocalApproximation(n),n=SIMD.Float32x4.sub(SIMD.Float32x4.add(h,h),SIMD.Float32x4.mul(n,SIMD.Float32x4.mul(h,h))),(n=SIMD.Float32x4.swizzle(n,0,0,0,0))?(SIMD.Float32x4.store(a,0,SIMD.Float32x4.mul(n,l)),SIMD.Float32x4.store(a,4,SIMD.Float32x4.mul(n,
e)),SIMD.Float32x4.store(a,8,SIMD.Float32x4.mul(n,k)),SIMD.Float32x4.store(a,12,SIMD.Float32x4.mul(n,q)),a):null},e.invert=m.USE_SIMD?e.SIMD.invert:e.scalar.invert,e.scalar.adjoint=function(a,b){var c=b[0],d=b[1],f=b[2],g=b[3],h=b[4],e=b[5],p=b[6],k=b[7],q=b[8],n=b[9],w=b[10],r=b[11],m=b[12],u=b[13],t=b[14];b=b[15];return a[0]=e*(w*b-r*t)-n*(p*b-k*t)+u*(p*r-k*w),a[1]=-(d*(w*b-r*t)-n*(f*b-g*t)+u*(f*r-g*w)),a[2]=d*(p*b-k*t)-e*(f*b-g*t)+u*(f*k-g*p),a[3]=-(d*(p*r-k*w)-e*(f*r-g*w)+n*(f*k-g*p)),a[4]=-(h*
(w*b-r*t)-q*(p*b-k*t)+m*(p*r-k*w)),a[5]=c*(w*b-r*t)-q*(f*b-g*t)+m*(f*r-g*w),a[6]=-(c*(p*b-k*t)-h*(f*b-g*t)+m*(f*k-g*p)),a[7]=c*(p*r-k*w)-h*(f*r-g*w)+q*(f*k-g*p),a[8]=h*(n*b-r*u)-q*(e*b-k*u)+m*(e*r-k*n),a[9]=-(c*(n*b-r*u)-q*(d*b-g*u)+m*(d*r-g*n)),a[10]=c*(e*b-k*u)-h*(d*b-g*u)+m*(d*k-g*e),a[11]=-(c*(e*r-k*n)-h*(d*r-g*n)+q*(d*k-g*e)),a[12]=-(h*(n*t-w*u)-q*(e*t-p*u)+m*(e*w-p*n)),a[13]=c*(n*t-w*u)-q*(d*t-f*u)+m*(d*w-f*n),a[14]=-(c*(e*t-p*u)-h*(d*t-f*u)+m*(d*p-f*e)),a[15]=c*(e*w-p*n)-h*(d*w-f*n)+q*(d*p-
f*e),a},e.SIMD.adjoint=function(a,b){var c,d,f,g,h,e,p,k,q,n,w,r;c=SIMD.Float32x4.load(b,0);d=SIMD.Float32x4.load(b,4);f=SIMD.Float32x4.load(b,8);b=SIMD.Float32x4.load(b,12);return k=SIMD.Float32x4.shuffle(c,d,0,1,4,5),h=SIMD.Float32x4.shuffle(f,b,0,1,4,5),g=SIMD.Float32x4.shuffle(k,h,0,2,4,6),h=SIMD.Float32x4.shuffle(h,k,1,3,5,7),k=SIMD.Float32x4.shuffle(c,d,2,3,6,7),p=SIMD.Float32x4.shuffle(f,b,2,3,6,7),e=SIMD.Float32x4.shuffle(k,p,0,2,4,6),p=SIMD.Float32x4.shuffle(p,k,1,3,5,7),k=SIMD.Float32x4.mul(e,
p),k=SIMD.Float32x4.swizzle(k,1,0,3,2),q=SIMD.Float32x4.mul(h,k),n=SIMD.Float32x4.mul(g,k),k=SIMD.Float32x4.swizzle(k,2,3,0,1),q=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,k),q),n=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,k),n),n=SIMD.Float32x4.swizzle(n,2,3,0,1),k=SIMD.Float32x4.mul(h,e),k=SIMD.Float32x4.swizzle(k,1,0,3,2),q=SIMD.Float32x4.add(SIMD.Float32x4.mul(p,k),q),r=SIMD.Float32x4.mul(g,k),k=SIMD.Float32x4.swizzle(k,2,3,0,1),q=SIMD.Float32x4.sub(q,SIMD.Float32x4.mul(p,k)),r=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,
k),r),r=SIMD.Float32x4.swizzle(r,2,3,0,1),k=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,3,0,1),p),k=SIMD.Float32x4.swizzle(k,1,0,3,2),e=SIMD.Float32x4.swizzle(e,2,3,0,1),q=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,k),q),w=SIMD.Float32x4.mul(g,k),k=SIMD.Float32x4.swizzle(k,2,3,0,1),q=SIMD.Float32x4.sub(q,SIMD.Float32x4.mul(e,k)),w=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,k),w),w=SIMD.Float32x4.swizzle(w,2,3,0,1),k=SIMD.Float32x4.mul(g,h),k=SIMD.Float32x4.swizzle(k,1,0,3,2),w=SIMD.Float32x4.add(SIMD.Float32x4.mul(p,
k),w),r=SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,k),r),k=SIMD.Float32x4.swizzle(k,2,3,0,1),w=SIMD.Float32x4.sub(SIMD.Float32x4.mul(p,k),w),r=SIMD.Float32x4.sub(r,SIMD.Float32x4.mul(e,k)),k=SIMD.Float32x4.mul(g,p),k=SIMD.Float32x4.swizzle(k,1,0,3,2),n=SIMD.Float32x4.sub(n,SIMD.Float32x4.mul(e,k)),w=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,k),w),k=SIMD.Float32x4.swizzle(k,2,3,0,1),n=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,k),n),w=SIMD.Float32x4.sub(w,SIMD.Float32x4.mul(h,k)),k=SIMD.Float32x4.mul(g,e),
k=SIMD.Float32x4.swizzle(k,1,0,3,2),n=SIMD.Float32x4.add(SIMD.Float32x4.mul(p,k),n),r=SIMD.Float32x4.sub(r,SIMD.Float32x4.mul(h,k)),k=SIMD.Float32x4.swizzle(k,2,3,0,1),n=SIMD.Float32x4.sub(n,SIMD.Float32x4.mul(p,k)),r=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,k),r),SIMD.Float32x4.store(a,0,q),SIMD.Float32x4.store(a,4,n),SIMD.Float32x4.store(a,8,w),SIMD.Float32x4.store(a,12,r),a},e.adjoint=m.USE_SIMD?e.SIMD.adjoint:e.scalar.adjoint,e.determinant=function(a){var b=a[0],c=a[1],d=a[2],f=a[3],g=a[4],h=a[5],
e=a[6],p=a[7],k=a[8],q=a[9],n=a[10],w=a[11],r=a[12],m=a[13],u=a[14];a=a[15];return(b*h-c*g)*(n*a-w*u)-(b*e-d*g)*(q*a-w*m)+(b*p-f*g)*(q*u-n*m)+(c*e-d*h)*(k*a-w*r)-(c*p-f*h)*(k*u-n*r)+(d*p-f*e)*(k*m-q*r)},e.SIMD.multiply=function(a,b,c){var d=SIMD.Float32x4.load(b,0),f=SIMD.Float32x4.load(b,4),g=SIMD.Float32x4.load(b,8);b=SIMD.Float32x4.load(b,12);var h=SIMD.Float32x4.load(c,0),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,
1,1,1,1),f),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),g),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),b))));SIMD.Float32x4.store(a,0,h);h=SIMD.Float32x4.load(c,4);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),f),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),g),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),b))));SIMD.Float32x4.store(a,
4,h);h=SIMD.Float32x4.load(c,8);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),f),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),g),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),b))));SIMD.Float32x4.store(a,8,h);c=SIMD.Float32x4.load(c,12);d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,
1,1,1,1),f),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,2,2,2,2),g),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,3,3,3,3),b))));return SIMD.Float32x4.store(a,12,d),a},e.scalar.multiply=function(a,b,c){var d=b[0],f=b[1],g=b[2],h=b[3],e=b[4],p=b[5],k=b[6],q=b[7],n=b[8],m=b[9],r=b[10],v=b[11],u=b[12],t=b[13],x=b[14];b=b[15];var y=c[0],z=c[1],A=c[2],B=c[3];return a[0]=y*d+z*e+A*n+B*u,a[1]=y*f+z*p+A*m+B*t,a[2]=y*g+z*k+A*r+B*x,a[3]=y*h+z*q+A*v+B*b,y=c[4],z=c[5],A=c[6],B=c[7],a[4]=y*d+
z*e+A*n+B*u,a[5]=y*f+z*p+A*m+B*t,a[6]=y*g+z*k+A*r+B*x,a[7]=y*h+z*q+A*v+B*b,y=c[8],z=c[9],A=c[10],B=c[11],a[8]=y*d+z*e+A*n+B*u,a[9]=y*f+z*p+A*m+B*t,a[10]=y*g+z*k+A*r+B*x,a[11]=y*h+z*q+A*v+B*b,y=c[12],z=c[13],A=c[14],B=c[15],a[12]=y*d+z*e+A*n+B*u,a[13]=y*f+z*p+A*m+B*t,a[14]=y*g+z*k+A*r+B*x,a[15]=y*h+z*q+A*v+B*b,a},e.multiply=m.USE_SIMD?e.SIMD.multiply:e.scalar.multiply,e.mul=e.multiply,e.scalar.translate=function(a,b,c){var d,f,g,h,e,p,k,q,n,m,r,v,u=c[0],t=c[1];c=c[2];return b===a?(a[12]=b[0]*u+b[4]*
t+b[8]*c+b[12],a[13]=b[1]*u+b[5]*t+b[9]*c+b[13],a[14]=b[2]*u+b[6]*t+b[10]*c+b[14],a[15]=b[3]*u+b[7]*t+b[11]*c+b[15]):(d=b[0],f=b[1],g=b[2],h=b[3],e=b[4],p=b[5],k=b[6],q=b[7],n=b[8],m=b[9],r=b[10],v=b[11],a[0]=d,a[1]=f,a[2]=g,a[3]=h,a[4]=e,a[5]=p,a[6]=k,a[7]=q,a[8]=n,a[9]=m,a[10]=r,a[11]=v,a[12]=d*u+e*t+n*c+b[12],a[13]=f*u+p*t+m*c+b[13],a[14]=g*u+k*t+r*c+b[14],a[15]=h*u+q*t+v*c+b[15]),a},e.SIMD.translate=function(a,b,c){var d=SIMD.Float32x4.load(b,0),f=SIMD.Float32x4.load(b,4),g=SIMD.Float32x4.load(b,
8),h=SIMD.Float32x4.load(b,12);c=SIMD.Float32x4(c[0],c[1],c[2],0);b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11]);d=SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(c,0,0,0,0));f=SIMD.Float32x4.mul(f,SIMD.Float32x4.swizzle(c,1,1,1,1));g=SIMD.Float32x4.mul(g,SIMD.Float32x4.swizzle(c,2,2,2,2));b=SIMD.Float32x4.add(d,SIMD.Float32x4.add(f,SIMD.Float32x4.add(g,h)));return SIMD.Float32x4.store(a,12,b),a},e.translate=m.USE_SIMD?
e.SIMD.translate:e.scalar.translate,e.scalar.scale=function(a,b,c){var d=c[0],f=c[1];c=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*f,a[5]=b[5]*f,a[6]=b[6]*f,a[7]=b[7]*f,a[8]=b[8]*c,a[9]=b[9]*c,a[10]=b[10]*c,a[11]=b[11]*c,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.SIMD.scale=function(a,b,c){var d,f,g;c=SIMD.Float32x4(c[0],c[1],c[2],0);return d=SIMD.Float32x4.load(b,0),SIMD.Float32x4.store(a,0,SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(c,0,0,0,0))),f=SIMD.Float32x4.load(b,
4),SIMD.Float32x4.store(a,4,SIMD.Float32x4.mul(f,SIMD.Float32x4.swizzle(c,1,1,1,1))),g=SIMD.Float32x4.load(b,8),SIMD.Float32x4.store(a,8,SIMD.Float32x4.mul(g,SIMD.Float32x4.swizzle(c,2,2,2,2))),a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.scale=m.USE_SIMD?e.SIMD.scale:e.scalar.scale,e.rotate=function(a,b,c,d){var f,g,h,e,p,k,q,n,w,r,v,u,t,x,y,z,A,B,G,K,D,E,I,H,F=d[0],C=d[1];d=d[2];var J=Math.sqrt(F*F+C*C+d*d);return Math.abs(J)<m.EPSILON?null:(J=1/J,F*=J,C*=J,d*=J,f=Math.sin(c),g=Math.cos(c),
h=1-g,e=b[0],p=b[1],k=b[2],q=b[3],n=b[4],w=b[5],r=b[6],v=b[7],u=b[8],t=b[9],x=b[10],y=b[11],z=F*F*h+g,A=C*F*h+d*f,B=d*F*h-C*f,G=F*C*h-d*f,K=C*C*h+g,D=d*C*h+F*f,E=F*d*h+C*f,I=C*d*h-F*f,H=d*d*h+g,a[0]=e*z+n*A+u*B,a[1]=p*z+w*A+t*B,a[2]=k*z+r*A+x*B,a[3]=q*z+v*A+y*B,a[4]=e*G+n*K+u*D,a[5]=p*G+w*K+t*D,a[6]=k*G+r*K+x*D,a[7]=q*G+v*K+y*D,a[8]=e*E+n*I+u*H,a[9]=p*E+w*I+t*H,a[10]=k*E+r*I+x*H,a[11]=q*E+v*I+y*H,b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a)},e.scalar.rotateX=function(a,b,c){var d=Math.sin(c);
c=Math.cos(c);var f=b[4],g=b[5],h=b[6],e=b[7],p=b[8],k=b[9],q=b[10],n=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*c+p*d,a[5]=g*c+k*d,a[6]=h*c+q*d,a[7]=e*c+n*d,a[8]=p*c-f*d,a[9]=k*c-g*d,a[10]=q*c-h*d,a[11]=n*c-e*d,a},e.SIMD.rotateX=function(a,b,c){var d=SIMD.Float32x4.splat(Math.sin(c));c=SIMD.Float32x4.splat(Math.cos(c));b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);var f=SIMD.Float32x4.load(b,
4);b=SIMD.Float32x4.load(b,8);return SIMD.Float32x4.store(a,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(f,c),SIMD.Float32x4.mul(b,d))),SIMD.Float32x4.store(a,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,c),SIMD.Float32x4.mul(f,d))),a},e.rotateX=m.USE_SIMD?e.SIMD.rotateX:e.scalar.rotateX,e.scalar.rotateY=function(a,b,c){var d=Math.sin(c);c=Math.cos(c);var f=b[0],g=b[1],h=b[2],e=b[3],p=b[8],k=b[9],q=b[10],n=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=
b[15]),a[0]=f*c-p*d,a[1]=g*c-k*d,a[2]=h*c-q*d,a[3]=e*c-n*d,a[8]=f*d+p*c,a[9]=g*d+k*c,a[10]=h*d+q*c,a[11]=e*d+n*c,a},e.SIMD.rotateY=function(a,b,c){var d=SIMD.Float32x4.splat(Math.sin(c));c=SIMD.Float32x4.splat(Math.cos(c));b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);var f=SIMD.Float32x4.load(b,0);b=SIMD.Float32x4.load(b,8);return SIMD.Float32x4.store(a,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,c),SIMD.Float32x4.mul(b,d))),SIMD.Float32x4.store(a,
8,SIMD.Float32x4.add(SIMD.Float32x4.mul(f,d),SIMD.Float32x4.mul(b,c))),a},e.rotateY=m.USE_SIMD?e.SIMD.rotateY:e.scalar.rotateY,e.scalar.rotateZ=function(a,b,c){var d=Math.sin(c);c=Math.cos(c);var f=b[0],g=b[1],h=b[2],e=b[3],p=b[4],k=b[5],q=b[6],n=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*c+p*d,a[1]=g*c+k*d,a[2]=h*c+q*d,a[3]=e*c+n*d,a[4]=p*c-f*d,a[5]=k*c-g*d,a[6]=q*c-h*d,a[7]=n*c-e*d,a},e.SIMD.rotateZ=function(a,b,c){var d=
SIMD.Float32x4.splat(Math.sin(c));c=SIMD.Float32x4.splat(Math.cos(c));b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);var f=SIMD.Float32x4.load(b,0);b=SIMD.Float32x4.load(b,4);return SIMD.Float32x4.store(a,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(f,c),SIMD.Float32x4.mul(b,d))),SIMD.Float32x4.store(a,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,c),SIMD.Float32x4.mul(f,d))),a},e.rotateZ=m.USE_SIMD?e.SIMD.rotateZ:e.scalar.rotateZ,e.fromTranslation=function(a,
b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=b[0],a[13]=b[1],a[14]=b[2],a[15]=1,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=b[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromRotation=function(a,b,c){var d,f,g,h=c[0],e=c[1];c=c[2];var p=Math.sqrt(h*h+e*e+c*c);return Math.abs(p)<m.EPSILON?null:(p=1/p,h*=p,e*=p,c*=p,d=Math.sin(b),f=Math.cos(b),g=1-f,a[0]=h*h*g+f,a[1]=
e*h*g+c*d,a[2]=c*h*g-e*d,a[3]=0,a[4]=h*e*g-c*d,a[5]=e*e*g+f,a[6]=c*e*g+h*d,a[7]=0,a[8]=h*c*g+e*d,a[9]=e*c*g-h*d,a[10]=c*c*g+f,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)},e.fromXRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b,a[6]=c,a[7]=0,a[8]=0,a[9]=-c,a[10]=b,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromYRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);return a[0]=b,a[1]=0,a[2]=-c,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=c,a[9]=0,
a[10]=b,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromZRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);return a[0]=b,a[1]=c,a[2]=0,a[3]=0,a[4]=-c,a[5]=b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromRotationTranslation=function(a,b,c){var d=b[0],f=b[1],g=b[2],h=b[3],e=d+d,p=f+f,k=g+g;b=d*e;var q=d*p,d=d*k,n=f*p,f=f*k,g=g*k,e=h*e,p=h*p,h=h*k;return a[0]=1-(n+g),a[1]=q+h,a[2]=d-p,a[3]=0,a[4]=q-h,a[5]=1-(b+g),a[6]=f+e,a[7]=0,a[8]=d+p,a[9]=f-e,a[10]=1-
(b+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},e.getTranslation=function(a,b){return a[0]=b[12],a[1]=b[13],a[2]=b[14],a},e.getRotation=function(a,b){var c=b[0]+b[5]+b[10],d=0;return 0<c?(d=2*Math.sqrt(c+1),a[3]=.25*d,a[0]=(b[6]-b[9])/d,a[1]=(b[8]-b[2])/d,a[2]=(b[1]-b[4])/d):b[0]>b[5]&b[0]>b[10]?(d=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/d,a[0]=.25*d,a[1]=(b[1]+b[4])/d,a[2]=(b[8]+b[2])/d):b[5]>b[10]?(d=2*Math.sqrt(1+b[5]-b[0]-b[10]),a[3]=(b[8]-b[2])/d,a[0]=(b[1]+b[4])/d,a[1]=.25*
d,a[2]=(b[6]+b[9])/d):(d=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/d,a[0]=(b[8]+b[2])/d,a[1]=(b[6]+b[9])/d,a[2]=.25*d),a},e.fromRotationTranslationScale=function(a,b,c,d){var f=b[0],g=b[1],h=b[2],e=b[3],p=f+f,k=g+g,q=h+h;b=f*p;var n=f*k,f=f*q,m=g*k,g=g*q,h=h*q,p=e*p,k=e*k,e=e*q,q=d[0],r=d[1];d=d[2];return a[0]=(1-(m+h))*q,a[1]=(n+e)*q,a[2]=(f-k)*q,a[3]=0,a[4]=(n-e)*r,a[5]=(1-(b+h))*r,a[6]=(g+p)*r,a[7]=0,a[8]=(f+k)*d,a[9]=(g-p)*d,a[10]=(1-(b+m))*d,a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=
1,a},e.fromRotationTranslationScaleOrigin=function(a,b,c,d,f){var g=b[0],h=b[1],e=b[2],p=b[3],k=g+g,q=h+h,n=e+e;b=g*k;var m=g*q,g=g*n,r=h*q,h=h*n,e=e*n,k=p*k,q=p*q,p=p*n,n=d[0],v=d[1];d=d[2];var u=f[0],t=f[1];f=f[2];return a[0]=(1-(r+e))*n,a[1]=(m+p)*n,a[2]=(g-q)*n,a[3]=0,a[4]=(m-p)*v,a[5]=(1-(b+e))*v,a[6]=(h+k)*v,a[7]=0,a[8]=(g+q)*d,a[9]=(h-k)*d,a[10]=(1-(b+r))*d,a[11]=0,a[12]=c[0]+u-(a[0]*u+a[4]*t+a[8]*f),a[13]=c[1]+t-(a[1]*u+a[5]*t+a[9]*f),a[14]=c[2]+f-(a[2]*u+a[6]*t+a[10]*f),a[15]=1,a},e.fromQuat=
function(a,b){var c=b[0],d=b[1],f=b[2];b=b[3];var g=c+c,h=d+d,e=f+f,c=c*g,p=d*g,d=d*h,k=f*g,q=f*h,f=f*e,g=b*g,h=b*h;b*=e;return a[0]=1-d-f,a[1]=p+b,a[2]=k-h,a[3]=0,a[4]=p-b,a[5]=1-c-f,a[6]=q+g,a[7]=0,a[8]=k+h,a[9]=q-g,a[10]=1-c-d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.frustum=function(a,b,c,d,f,g,h){var e=1/(c-b),p=1/(f-d),k=1/(g-h);return a[0]=2*g*e,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*g*p,a[6]=0,a[7]=0,a[8]=(c+b)*e,a[9]=(f+d)*p,a[10]=(h+g)*k,a[11]=-1,a[12]=0,a[13]=0,a[14]=h*g*2*k,a[15]=0,a},
e.perspective=function(a,b,c,d,f){b=1/Math.tan(b/2);var g=1/(d-f);return a[0]=b/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(f+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*f*d*g,a[15]=0,a},e.perspectiveFromFieldOfView=function(a,b,c,d){var f=Math.tan(b.upDegrees*Math.PI/180),g=Math.tan(b.downDegrees*Math.PI/180),h=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*Math.PI/180);var e=2/(h+b),p=2/(f+g);return a[0]=e,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=p,a[6]=0,a[7]=0,a[8]=
-((h-b)*e*.5),a[9]=(f-g)*p*.5,a[10]=d/(c-d),a[11]=-1,a[12]=0,a[13]=0,a[14]=d*c/(c-d),a[15]=0,a},e.ortho=function(a,b,c,d,f,g,h){var e=1/(b-c),p=1/(d-f),k=1/(g-h);return a[0]=-2*e,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*p,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*k,a[11]=0,a[12]=(b+c)*e,a[13]=(f+d)*p,a[14]=(h+g)*k,a[15]=1,a},e.lookAt=function(a,b,c,d){var f,g,h,l,p,k,q,n,w,r,v=b[0],u=b[1];b=b[2];var t=d[0],x=d[1];d=d[2];var y=c[0],z=c[1];c=c[2];return Math.abs(v-y)<m.EPSILON&&Math.abs(u-z)<m.EPSILON&&Math.abs(b-
c)<m.EPSILON?e.identity(a):(q=v-y,n=u-z,w=b-c,r=1/Math.sqrt(q*q+n*n+w*w),q*=r,n*=r,w*=r,f=x*w-d*n,g=d*q-t*w,h=t*n-x*q,r=Math.sqrt(f*f+g*g+h*h),r?(r=1/r,f*=r,g*=r,h*=r):(f=0,g=0,h=0),l=n*h-w*g,p=w*f-q*h,k=q*g-n*f,r=Math.sqrt(l*l+p*p+k*k),r?(r=1/r,l*=r,p*=r,k*=r):(l=0,p=0,k=0),a[0]=f,a[1]=l,a[2]=q,a[3]=0,a[4]=g,a[5]=p,a[6]=n,a[7]=0,a[8]=h,a[9]=k,a[10]=w,a[11]=0,a[12]=-(f*v+g*u+h*b),a[13]=-(l*v+p*u+k*b),a[14]=-(q*v+n*u+w*b),a[15]=1,a)},e.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+
", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+
c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a[4]=b[4]+c[4],a[5]=b[5]+c[5],a[6]=b[6]+c[6],a[7]=b[7]+c[7],a[8]=b[8]+c[8],a[9]=b[9]+c[9],a[10]=b[10]+c[10],a[11]=b[11]+c[11],a[12]=b[12]+c[12],a[13]=b[13]+c[13],a[14]=b[14]+c[14],a[15]=b[15]+c[15],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a[4]=b[4]-c[4],a[5]=b[5]-c[5],a[6]=b[6]-c[6],a[7]=b[7]-c[7],a[8]=b[8]-c[8],a[9]=b[9]-c[9],a[10]=b[10]-c[10],a[11]=b[11]-c[11],a[12]=b[12]-c[12],a[13]=b[13]-c[13],a[14]=b[14]-
c[14],a[15]=b[15]-c[15],a},e.sub=e.subtract,e.multiplyScalar=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a[4]=b[4]*c,a[5]=b[5]*c,a[6]=b[6]*c,a[7]=b[7]*c,a[8]=b[8]*c,a[9]=b[9]*c,a[10]=b[10]*c,a[11]=b[11]*c,a[12]=b[12]*c,a[13]=b[13]*c,a[14]=b[14]*c,a[15]=b[15]*c,a},e.multiplyScalarAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a[4]=b[4]+c[4]*d,a[5]=b[5]+c[5]*d,a[6]=b[6]+c[6]*d,a[7]=b[7]+c[7]*d,a[8]=b[8]+c[8]*d,a[9]=b[9]+
c[9]*d,a[10]=b[10]+c[10]*d,a[11]=b[11]+c[11]*d,a[12]=b[12]+c[12]*d,a[13]=b[13]+c[13]*d,a[14]=b[14]+c[14]*d,a[15]=b[15]+c[15]*d,a},e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]},e.equals=function(a,b){var c=a[0],d=a[1],f=a[2],g=a[3],h=a[4],e=a[5],p=a[6],k=a[7],q=a[8],n=a[9],w=a[10],r=a[11],v=a[12],
u=a[13],t=a[14];a=a[15];var x=b[0],y=b[1],z=b[2],A=b[3],B=b[4],G=b[5],K=b[6],D=b[7],E=b[8],I=b[9],H=b[10],F=b[11],C=b[12],J=b[13],L=b[14];b=b[15];return Math.abs(c-x)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(d-y)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(y))&&Math.abs(f-z)<=m.EPSILON*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(g-A)<=m.EPSILON*Math.max(1,Math.abs(g),Math.abs(A))&&Math.abs(h-B)<=m.EPSILON*Math.max(1,Math.abs(h),Math.abs(B))&&Math.abs(e-G)<=m.EPSILON*Math.max(1,Math.abs(e),
Math.abs(G))&&Math.abs(p-K)<=m.EPSILON*Math.max(1,Math.abs(p),Math.abs(K))&&Math.abs(k-D)<=m.EPSILON*Math.max(1,Math.abs(k),Math.abs(D))&&Math.abs(q-E)<=m.EPSILON*Math.max(1,Math.abs(q),Math.abs(E))&&Math.abs(n-I)<=m.EPSILON*Math.max(1,Math.abs(n),Math.abs(I))&&Math.abs(w-H)<=m.EPSILON*Math.max(1,Math.abs(w),Math.abs(H))&&Math.abs(r-F)<=m.EPSILON*Math.max(1,Math.abs(r),Math.abs(F))&&Math.abs(v-C)<=m.EPSILON*Math.max(1,Math.abs(v),Math.abs(C))&&Math.abs(u-J)<=m.EPSILON*Math.max(1,Math.abs(u),Math.abs(J))&&
Math.abs(t-L)<=m.EPSILON*Math.max(1,Math.abs(t),Math.abs(L))&&Math.abs(a-b)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))},e})},"esri/views/vectorTiles/RenderBucket":function(){define(["require","exports","../../core/tsSupport/extendsHelper","../../core/tsSupport/decorateHelper"],function(m,e,a,b){Object.defineProperty(e,"__esModule",{value:!0});m=function(){return function(a){this.type=a}}();e.RenderBucket=m;b=function(b){function c(){var a=b.call(this,2)||this;return a.triangleElementStart=0,a.triangleElementCount=
0,a.joinStart=0,a.joinCount=0,a}return a(c,b),c.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.joinCount},c}(m);e.LineRenderBucket=b;b=function(b){function c(){var a=b.call(this,1)||this;return a.triangleElementStart=0,a.triangleElementCount=0,a.outlineElementStart=0,a.outlineElementCount=0,a}return a(c,b),c.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount},c}(m);e.FillRenderBucket=b;b=function(b){function c(){var a=b.call(this,3)||
this;return a.markerPerPageElementsMap=new Map,a.glyphPerPageElementsMap=new Map,a.isSDF=!1,a}return a(c,b),c.prototype.hasData=function(){return 0<this.markerPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size},c}(m);e.SymbolRenderBucket=b;m=function(b){function c(){return b.call(this,0)||this}return a(c,b),c.prototype.hasData=function(){return!0},c}(m);e.BackgroundRenderBucket=m})},"esri/views/vectorTiles/VectorTileContainer":function(){define("require exports ../../core/tsSupport/extendsHelper dojo/has ../../core/libs/gl-matrix/vec3 ../../core/libs/gl-matrix/mat4 ../2d/engine/Container ./renderers/Renderer ./GeometryUtils".split(" "),
function(m,e,a,b,c,d,f,g,h){return function(f){function e(){var a=f.call(this)||this;return a.isInitialized=!1,a._displayWidth=0,a._displayHeight=0,a._tileCoordinateScale=c.create(),a._orientationVec=c.create(),a._displayScale=c.create(),a._orientationVec.set([0,0,1]),a._defaultTransform=d.create(),a}return a(e,f),e.prototype.initialize=function(a,b,c,d){this._renderer=new g;this._renderer.initialize(a,b);this._tileInfoView=d;this._tileInfo=c;this.isInitialized=!0},e.prototype.destroy=function(){this._renderer&&
(this._renderer.dispose(),this._renderer=null)},e.prototype.prepareChildrenRenderParameters=function(a){var b=a.state;return b&&this._tileInfo&&this.isInitialized?(a.displayLevel=this._tileInfo.scaleToZoom(b.scale),a.requiredLevel=this._tileInfoView.getClosestInfoForScale(b.scale).level,a.renderer=this._renderer,a):a},e.prototype.renderChildren=function(a){if(0!==this.children.length&&this.isInitialized&&a&&a.state){this.sortChildren(function(a,b){return a.key.level-b.key.level});for(var c=this.children.length,
d=1;c>=d;d++){var g=this.children[d-1];g.attached&&(g.stencilData.reference=d,g.stencilData.mask=255)}this._updateTilesTransform(a.state,this._tileInfoView.getClosestInfoForScale(a.state.scale).level);c=a.context;if(c.setDepthWriteEnabled(!0),this._renderer.setStateParams(a.state,a.devicePixelRatio,a.displayLevel),this._renderer.drawClippingMasks(c,this.children),c.setStencilWriteMask(0),c.setBlendFunctionSeparate(1,771,1,771),c.setStencilOp(7680,7680,7681),c.setDepthFunction(515),c.setBlendingEnabled(!1),
c.setStencilTestEnabled(!0),c.setDepthTestEnabled(!0),c.setDepthWriteEnabled(!0),a.drawphase=0,f.prototype.renderChildren.call(this,a),c.setDepthWriteEnabled(!1),c.setBlendingEnabled(!0),a.drawphase=1,f.prototype.renderChildren.call(this,a),a.drawphase=2,f.prototype.renderChildren.call(this,a),c.setStencilTestEnabled(!1),c.setDepthTestEnabled(!1),b("esri-vector-tiles-debug"))for(a=0,d=this.children;a<d.length;a++)g=d[a],g.attached&&g.visible&&this._renderer.renderTileInfo(c,g);this._renderer.needsRedraw()&&
this.requestRender()}},e.prototype.removeAllChildren=function(){for(var a=0;a<this.children.length;a++)this.children[a].dispose();f.prototype.removeAllChildren.call(this)},e.prototype._updateTilesTransform=function(a,b){var c=1/a.width,d=1/a.height,f=[0,0];this._calculateRelativeViewProjMat(this._tileInfo.lods[b].resolution,a.resolution,a.rotation,this._tileInfo.size[1],4096,a.width,a.height,this._defaultTransform);for(var g=0,h=this.children;g<h.length;g++){var e=h[g];a.toScreen(f,e.coords);f[1]=
a.height-f[1];e.tileTransform.displayCoord[0]=2*f[0]*c-1;e.tileTransform.displayCoord[1]=2*f[1]*d-1;e.key.level===b&&4096===e.coordRange?e.tileTransform.transform.set(this._defaultTransform):this._calculateRelativeViewProjMat(this._tileInfo.lods[e.key.level].resolution,a.resolution,a.rotation,this._tileInfo.size[1],e.coordRange,a.width,a.height,e.tileTransform.transform)}},e.prototype._calculateRelativeViewProjMat=function(a,b,c,f,g,e,l,p){var k=.125;512!==f&&4096!==g&&(k=f/g);a=a/b*k;this._tileCoordinateScale.set([a,
a,1]);(e!==this._displayWidth||l!==this._displayHeight)&&(this._displayScale.set([2/e,-2/l,1]),this._displayWidth=e,this._displayHeight=l);d.identity(p);d.scale(p,p,this._tileCoordinateScale);d.rotate(p,p,-c*h.C_DEG_TO_RAD,this._orientationVec);d.scale(p,p,this._displayScale);d.transpose(p,p)},e}(f)})},"esri/core/libs/gl-matrix/vec3":function(){define(["./common"],function(m){var e={};return e.create=function(){var a=new m.ARRAY_TYPE(3);return a[0]=0,a[1]=0,a[2]=0,a},e.clone=function(a){var b=new m.ARRAY_TYPE(3);
return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},e.fromValues=function(a,b,c){var d=new m.ARRAY_TYPE(3);return d[0]=a,d[1]=b,d[2]=c,d},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},e.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},e.mul=
e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},e.div=e.divide,e.ceil=function(a,b){return a[0]=Math.ceil(b[0]),a[1]=Math.ceil(b[1]),a[2]=Math.ceil(b[2]),a},e.floor=function(a,b){return a[0]=Math.floor(b[0]),a[1]=Math.floor(b[1]),a[2]=Math.floor(b[2]),a},e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],
c[2]),a},e.round=function(a,b){return a[0]=Math.round(b[0]),a[1]=Math.round(b[1]),a[2]=Math.round(b[2]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return Math.sqrt(c*c+d*d+a*a)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return c*c+d*d+a*a},e.sqrDist=e.squaredDistance,
e.length=function(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a},e.normalize=function(a,b){var c=b[0],d=b[1],f=b[2],c=c*c+d*d+f*f;return 0<c&&(c=1/Math.sqrt(c),a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*
b[1]+a[2]*b[2]},e.cross=function(a,b,c){var d=b[0],f=b[1];b=b[2];var g=c[0],h=c[1];c=c[2];return a[0]=f*c-b*h,a[1]=b*g-d*c,a[2]=d*h-f*g,a},e.lerp=function(a,b,c,d){var f=b[0],g=b[1];b=b[2];return a[0]=f+d*(c[0]-f),a[1]=g+d*(c[1]-g),a[2]=b+d*(c[2]-b),a},e.hermite=function(a,b,c,d,f,g){var h=g*g,e=h*(2*g-3)+1,p=h*(g-2)+g,k=h*(g-1);g=h*(3-2*g);return a[0]=b[0]*e+c[0]*p+d[0]*k+f[0]*g,a[1]=b[1]*e+c[1]*p+d[1]*k+f[1]*g,a[2]=b[2]*e+c[2]*p+d[2]*k+f[2]*g,a},e.bezier=function(a,b,c,d,f,g){var h=1-g,e=h*h,p=
g*g,k=e*h,e=3*g*e,h=3*p*h;g*=p;return a[0]=b[0]*k+c[0]*e+d[0]*h+f[0]*g,a[1]=b[1]*k+c[1]*e+d[1]*h+f[1]*g,a[2]=b[2]*k+c[2]*e+d[2]*h+f[2]*g,a},e.random=function(a,b){b=b||1;var c=2*m.RANDOM()*Math.PI,d=2*m.RANDOM()-1,f=Math.sqrt(1-d*d)*b;return a[0]=Math.cos(c)*f,a[1]=Math.sin(c)*f,a[2]=d*b,a},e.transformMat4=function(a,b,c){var d=b[0],f=b[1];b=b[2];var g=c[3]*d+c[7]*f+c[11]*b+c[15];return g=g||1,a[0]=(c[0]*d+c[4]*f+c[8]*b+c[12])/g,a[1]=(c[1]*d+c[5]*f+c[9]*b+c[13])/g,a[2]=(c[2]*d+c[6]*f+c[10]*b+c[14])/
g,a},e.transformMat3=function(a,b,c){var d=b[0],f=b[1];b=b[2];return a[0]=d*c[0]+f*c[3]+b*c[6],a[1]=d*c[1]+f*c[4]+b*c[7],a[2]=d*c[2]+f*c[5]+b*c[8],a},e.transformQuat=function(a,b,c){var d=b[0],f=b[1],g=b[2];b=c[0];var e=c[1],l=c[2];c=c[3];var p=c*d+e*g-l*f,k=c*f+l*d-b*g,q=c*g+b*f-e*d,d=-b*d-e*f-l*g;return a[0]=p*c+d*-b+k*-l-q*-e,a[1]=k*c+d*-e+q*-b-p*-l,a[2]=q*c+d*-l+p*-e-k*-b,a},e.rotateX=function(a,b,c,d){var f=[],g=[];return f[0]=b[0]-c[0],f[1]=b[1]-c[1],f[2]=b[2]-c[2],g[0]=f[0],g[1]=f[1]*Math.cos(d)-
f[2]*Math.sin(d),g[2]=f[1]*Math.sin(d)+f[2]*Math.cos(d),a[0]=g[0]+c[0],a[1]=g[1]+c[1],a[2]=g[2]+c[2],a},e.rotateY=function(a,b,c,d){var f=[],g=[];return f[0]=b[0]-c[0],f[1]=b[1]-c[1],f[2]=b[2]-c[2],g[0]=f[2]*Math.sin(d)+f[0]*Math.cos(d),g[1]=f[1],g[2]=f[2]*Math.cos(d)-f[0]*Math.sin(d),a[0]=g[0]+c[0],a[1]=g[1]+c[1],a[2]=g[2]+c[2],a},e.rotateZ=function(a,b,c,d){var f=[],g=[];return f[0]=b[0]-c[0],f[1]=b[1]-c[1],f[2]=b[2]-c[2],g[0]=f[0]*Math.cos(d)-f[1]*Math.sin(d),g[1]=f[0]*Math.sin(d)+f[1]*Math.cos(d),
g[2]=f[2],a[0]=g[0]+c[0],a[1]=g[1]+c[1],a[2]=g[2]+c[2],a},e.forEach=function(){var a=e.create();return function(b,c,d,f,g,e){c||(c=3);d||(d=0);for(f=f?Math.min(f*c+d,b.length):b.length;f>d;d+=c)a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],g(a,a,e),b[d]=a[0],b[d+1]=a[1],b[d+2]=a[2];return b}}(),e.angle=function(a,b){a=e.fromValues(a[0],a[1],a[2]);b=e.fromValues(b[0],b[1],b[2]);e.normalize(a,a);e.normalize(b,b);b=e.dot(a,b);return 1<b?0:Math.acos(b)},e.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},
e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]},e.equals=function(a,b){var c=a[0],d=a[1];a=a[2];var f=b[0],g=b[1];b=b[2];return Math.abs(c-f)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(d-g)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(g))&&Math.abs(a-b)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))},e})},"esri/views/vectorTiles/renderers/Renderer":function(){define("require exports ../../../core/libs/gl-matrix/mat4 ../GeometryUtils ./BackgroundRenderer ./LineRenderer ./FillRenderer ./SymbolRenderer ./TileInfoRenderer ./FadeRecorder".split(" "),
function(m,e,a,b,c,d,f,g,h,l){return function(){function e(){this._extrudeRotateVector=new Float32Array([0,0,1]);this._extrudeScaleVector=new Float32Array([1,1,1]);this._state={rotation:0,width:0,height:0};this._cachedRotation=this._cachedHeight=this._cachedWidth=0;this._pixelRatio=1}return e.prototype.initialize=function(a,b,e){void 0===e&&(e=!0);this._SpriteMosaic=a;this._glyphMosaic=b;this._ignoreSpeed=!e;this._backgroundRenderer=new c;this._lineRenderer=new d;this._fillRenderer=new f;this._symbolRenderer=
new g;this._tileInfoRenderer=new h;this._fadeRecorder=new l.FadeRecorder(300);this._extrudeMatrix=new Float32Array(16);this._extrudeNoRotationMatrix=new Float32Array(16);this._backgroundColor=new Float32Array([1,0,0,1])},e.prototype.dispose=function(){this._backgroundRenderer&&(this._backgroundRenderer.dispose(),this._backgroundRenderer=null);this._lineRenderer&&(this._lineRenderer.dispose(),this._lineRenderer=null);this._fillRenderer&&(this._fillRenderer.dispose(),this._fillRenderer=null);this._symbolRenderer&&
(this._symbolRenderer.dispose(),this._symbolRenderer=null);this._tileInfoRenderer&&(this._tileInfoRenderer.dispose(),this._tileInfoRenderer=null)},e.prototype.setStateParams=function(c,d,f){this._pixelRatio=d;this._fadeRecorder.recordLevel(f);this._state=c;(this._state.width!==this._cachedWidth||this._state.height!==this._cachedHeight||this._state.rotation!==this._cachedRotation)&&(this._extrudeScaleVector[0]=2/c.width,this._extrudeScaleVector[1]=-2/c.height,a.identity(this._extrudeMatrix),a.rotate(this._extrudeMatrix,
this._extrudeMatrix,-c.rotation*b.C_DEG_TO_RAD,this._extrudeRotateVector),a.scale(this._extrudeMatrix,this._extrudeMatrix,this._extrudeScaleVector),a.transpose(this._extrudeMatrix,this._extrudeMatrix),a.identity(this._extrudeNoRotationMatrix),a.scale(this._extrudeNoRotationMatrix,this._extrudeNoRotationMatrix,this._extrudeScaleVector),a.transpose(this._extrudeNoRotationMatrix,this._extrudeNoRotationMatrix),this._cachedWidth=this._state.width,this._cachedHeight=this._state.height,this._cachedRotation=
this._state.rotation)},e.prototype.drawClippingMasks=function(a,b){if(0!==b.length){a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setStencilTestEnabled(!0);a.setBlendingEnabled(!1);a.setColorMask(!1,!1,!1,!1);a.setStencilOp(7680,7680,7681);a.setStencilWriteMask(255);a.setClearStencil(0);a.clear(a.gl.STENCIL_BUFFER_BIT);for(var c=0;c<b.length;c++){var d=b[c];d.attached&&d.visible&&(a.setStencilFunctionSeparate(1032,519,d.stencilData.reference,d.stencilData.mask),this._backgroundRenderer.renderSolidColor(a,
{u_matrix:d.tileTransform.transform,u_normalized_origin:d.tileTransform.displayCoord,u_coord_range:d.coordRange,u_depth:0,u_color:this._backgroundColor}))}a.setColorMask(!0,!0,!0,!0);a.setBlendingEnabled(!0)}},e.prototype.renderDebug=function(a,b){var c=b.key;this._backgroundColor.set([c.col%2,c.row%2,0===c.col%2&&0===c.row%2?1:0,.5]);this._backgroundRenderer.renderSolidColor(a,{u_matrix:b.tileTransform.transform,u_normalized_origin:b.tileTransform.displayCoord,u_coord_range:b.coordRange,u_depth:0,
u_color:this._backgroundColor})},e.prototype.renderBucket=function(a,b,c,d,f,e,g,h){switch(b.type){case 0:2!==f&&this._renderBackground(a,c,f,e,g,h);break;case 1:2!==f&&this._renderFill(a,b,c,f,e,g,h);break;case 2:1===f&&this._renderLine(a,b,c,e,g,h);break;case 3:2===f&&this._renderSymbol(a,b,c,d,e,g,h)}},e.prototype.renderTileInfo=function(a,b){this._tileInfoRenderer.render(a,b)},e.prototype.needsRedraw=function(){return this._fadeRecorder.needsRedraw()},e.prototype._renderBackground=function(a,
b,c,d,f,e){this._backgroundRenderer.render(a,b,c,d,f,this._SpriteMosaic,this._SpriteMosaic.pixelRatio,e)},e.prototype._renderLine=function(a,b,c,d,f,e){this._lineRenderer.render(a,b,c,this._state,d,f,this._SpriteMosaic,this._extrudeMatrix,this._SpriteMosaic.pixelRatio,e)},e.prototype._renderFill=function(a,b,c,d,f,e,g){this._fillRenderer.render(a,b,c,this._state.rotation,d,f,e,this._SpriteMosaic,this._extrudeMatrix,this._SpriteMosaic.pixelRatio,g)},e.prototype._renderSymbol=function(a,b,c,d,f,e,g){var h=
!0;d===f.key.level&&(h=!1);a.setStencilTestEnabled(h);this._symbolRenderer.render(a,b,c,this._state.rotation,this._fadeRecorder.getFadeValues(this._ignoreSpeed),f,e,this._SpriteMosaic,this._glyphMosaic,this._extrudeMatrix,this._extrudeNoRotationMatrix,this._SpriteMosaic.pixelRatio,g)},e}()})},"esri/views/vectorTiles/renderers/BackgroundRenderer":function(){define("require exports ../../../core/libs/gl-matrix/mat3 ../../../core/libs/gl-matrix/vec4 ../../webgl/Program ../../webgl/VertexArrayObject ../../webgl/BufferObject ./vtShaderSnippets".split(" "),
function(m,e,a,b,c,d,f,g){return function(){function e(){this._patternMatrix=a.create();this._color=b.create();this._initialized=!1}return e.prototype.dispose=function(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null);this._patternProgram&&(this._patternProgram.dispose(),this._patternProgram=null);this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null);this._patternVertexArrayObject&&(this._patternVertexArrayObject.dispose(),
this._patternVertexArrayObject=null)},e.prototype.renderSolidColor=function(a,b){this._initialized||this._initialize(a);a.bindVAO(this._solidVertexArrayObject);a.bindProgram(this._solidProgram);this._solidProgram.setUniformMatrix4fv("u_transformMatrix",b.u_matrix);this._solidProgram.setUniform2fv("u_normalized_origin",b.u_normalized_origin);this._solidProgram.setUniform1f("u_coord_range",b.u_coord_range||4096);this._solidProgram.setUniform1f("u_depth",b.u_depth||0);this._solidProgram.setUniform4fv("u_color",
b.u_color||new Float32Array([1,0,0,1]));a.drawArrays(5,0,4);a.bindVAO()},e.prototype.render=function(b,c,d,f,e,g,h,m){this._initialized||this._initialize(b);var k=e.getPaintValue("background-color",c);m*=e.getPaintValue("background-opacity",c);var l=e.getPaintValue("background-pattern",c),n=void 0!==l,p=k[3]*m,q=n||1>p;if(!(q&&0===d||!q&&1===d)){if(n){b.bindVAO(this._patternVertexArrayObject);b.bindProgram(this._patternProgram);d=g.getMosaicItemPosition(l,!0);if(!d)return;c=f.coordRange/512/Math.pow(2,
Math.floor(c)-f.key.level)/h;a.identity(this._patternMatrix);h=1/(d.size[1]*c);this._patternMatrix[0]=1/(d.size[0]*c);this._patternMatrix[4]=h;g.bind(b,9729,0);this._patternProgram.setUniformMatrix4fv("u_transformMatrix",f.tileTransform.transform);this._patternProgram.setUniform2fv("u_normalized_origin",f.tileTransform.displayCoord);this._patternProgram.setUniform1f("u_depth",e.z);this._patternProgram.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix);this._patternProgram.setUniform1f("u_opacity",
m);this._patternProgram.setUniform2f("u_pattern_tl",d.tl[0],d.tl[1]);this._patternProgram.setUniform2f("u_pattern_br",d.br[0],d.br[1]);this._patternProgram.setUniform1i("u_texture",0)}else this._color[0]=p*k[0],this._color[1]=p*k[1],this._color[2]=p*k[2],this._color[3]=p,b.bindVAO(this._solidVertexArrayObject),b.bindProgram(this._solidProgram),this._solidProgram.setUniformMatrix4fv("u_transformMatrix",f.tileTransform.transform),this._solidProgram.setUniform2fv("u_normalized_origin",f.tileTransform.displayCoord),
this._solidProgram.setUniform1f("u_coord_range",f.coordRange),this._solidProgram.setUniform1f("u_depth",e.z||0),this._solidProgram.setUniform4fv("u_color",this._color);b.drawArrays(5,0,4);b.bindVAO()}},e.prototype._initialize=function(a){if(this._initialized)return!0;var b={a_pos:0},e=new c(a,g.backgroundVS,g.backgroundFS,b);if(!e)return!1;var h=new c(a,g.patternFillShaderVS,g.patternFillShaderFS,b);if(!h)return!1;var l={geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},
m=new Int8Array([0,0,1,0,0,1,1,1]),r=f.createVertex(a,35044,m),r=new d(a,b,l,{geometry:r}),m=new Int16Array([0,0,4096,0,0,4096,4096,4096]),m=f.createVertex(a,35044,m);a=new d(a,b,{geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:m});return this._solidProgram=e,this._patternProgram=h,this._vertexAttributes=l,this._solidVertexArrayObject=r,this._patternVertexArrayObject=a,this._initialized=!0,!0},e}()})},"esri/core/libs/gl-matrix/mat3":function(){define(["./common"],
function(m){var e={};return e.create=function(){var a=new m.ARRAY_TYPE(9);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromMat4=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10],a},e.clone=function(a){var b=new m.ARRAY_TYPE(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=
b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},e.fromValues=function(a,b,c,d,f,e,h,l,p){var g=new m.ARRAY_TYPE(9);return g[0]=a,g[1]=b,g[2]=c,g[3]=d,g[4]=f,g[5]=e,g[6]=h,g[7]=l,g[8]=p,g},e.set=function(a,b,c,d,f,e,h,l,p,k){return a[0]=b,a[1]=c,a[2]=d,a[3]=f,a[4]=e,a[5]=h,a[6]=l,a[7]=p,a[8]=k,a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],f=b[5];a[1]=b[3];a[2]=b[6];a[3]=c;a[5]=b[7];a[6]=d;a[7]=f}else a[0]=
b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},e.invert=function(a,b){var c=b[0],d=b[1],f=b[2],e=b[3],h=b[4],l=b[5],p=b[6],k=b[7];b=b[8];var q=b*h-l*k,n=-b*e+l*p,m=k*e-h*p,r=c*q+d*n+f*m;return r?(r=1/r,a[0]=q*r,a[1]=(-b*d+f*k)*r,a[2]=(l*d-f*h)*r,a[3]=n*r,a[4]=(b*c-f*p)*r,a[5]=(-l*c+f*e)*r,a[6]=m*r,a[7]=(-k*c+d*p)*r,a[8]=(h*c-d*e)*r,a):null},e.adjoint=function(a,b){var c=b[0],d=b[1],f=b[2],e=b[3],h=b[4],l=b[5],p=b[6],k=b[7];b=b[8];return a[0]=h*b-l*k,
a[1]=f*k-d*b,a[2]=d*l-f*h,a[3]=l*p-e*b,a[4]=c*b-f*p,a[5]=f*e-c*l,a[6]=e*k-h*p,a[7]=d*p-c*k,a[8]=c*h-d*e,a},e.determinant=function(a){var b=a[3],c=a[4],d=a[5],f=a[6],e=a[7],h=a[8];return a[0]*(h*c-d*e)+a[1]*(-h*b+d*f)+a[2]*(e*b-c*f)},e.multiply=function(a,b,c){var d=b[0],f=b[1],e=b[2],h=b[3],l=b[4],p=b[5],k=b[6],q=b[7];b=b[8];var n=c[0],m=c[1],r=c[2],v=c[3],u=c[4],t=c[5],x=c[6],y=c[7];c=c[8];return a[0]=n*d+m*h+r*k,a[1]=n*f+m*l+r*q,a[2]=n*e+m*p+r*b,a[3]=v*d+u*h+t*k,a[4]=v*f+u*l+t*q,a[5]=v*e+u*p+t*
b,a[6]=x*d+y*h+c*k,a[7]=x*f+y*l+c*q,a[8]=x*e+y*p+c*b,a},e.mul=e.multiply,e.translate=function(a,b,c){var d=b[0],f=b[1],e=b[2],h=b[3],l=b[4],p=b[5],k=b[6],q=b[7];b=b[8];var n=c[0];c=c[1];return a[0]=d,a[1]=f,a[2]=e,a[3]=h,a[4]=l,a[5]=p,a[6]=n*d+c*h+k,a[7]=n*f+c*l+q,a[8]=n*e+c*p+b,a},e.rotate=function(a,b,c){var d=b[0],f=b[1],e=b[2],h=b[3],l=b[4],p=b[5],k=b[6],q=b[7];b=b[8];var n=Math.sin(c);c=Math.cos(c);return a[0]=c*d+n*h,a[1]=c*f+n*l,a[2]=c*e+n*p,a[3]=c*h-n*d,a[4]=c*l-n*f,a[5]=c*p-n*e,a[6]=k,a[7]=
q,a[8]=b,a},e.scale=function(a,b,c){var d=c[0];c=c[1];return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=c*b[3],a[4]=c*b[4],a[5]=c*b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=b[0],a[7]=b[1],a[8]=1,a},e.fromRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);return a[0]=b,a[1]=c,a[2]=0,a[3]=-c,a[4]=b,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=b[1],a[5]=0,a[6]=0,
a[7]=0,a[8]=1,a},e.fromMat2d=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=0,a[3]=b[2],a[4]=b[3],a[5]=0,a[6]=b[4],a[7]=b[5],a[8]=1,a},e.fromQuat=function(a,b){var c=b[0],d=b[1],f=b[2];b=b[3];var e=c+c,h=d+d,l=f+f,c=c*e,p=d*e,d=d*h,k=f*e,q=f*h,f=f*l,e=b*e,h=b*h;b*=l;return a[0]=1-d-f,a[3]=p-b,a[6]=k+h,a[1]=p+b,a[4]=1-c-f,a[7]=q-e,a[2]=k-h,a[5]=q+e,a[8]=1-c-d,a},e.normalFromMat4=function(a,b){var c=b[0],d=b[1],f=b[2],e=b[3],h=b[4],l=b[5],p=b[6],k=b[7],q=b[8],n=b[9],m=b[10],r=b[11],v=b[12],u=b[13],t=
b[14];b=b[15];var x=c*l-d*h,y=c*p-f*h,z=c*k-e*h,A=d*p-f*l,B=d*k-e*l,G=f*k-e*p,K=q*u-n*v,D=q*t-m*v,q=q*b-r*v,E=n*t-m*u,n=n*b-r*u,m=m*b-r*t;return(r=x*m-y*n+z*E+A*q-B*D+G*K)?(r=1/r,a[0]=(l*m-p*n+k*E)*r,a[1]=(p*q-h*m-k*D)*r,a[2]=(h*n-l*q+k*K)*r,a[3]=(f*n-d*m-e*E)*r,a[4]=(c*m-f*q+e*D)*r,a[5]=(d*q-c*n-e*K)*r,a[6]=(u*G-t*B+b*A)*r,a[7]=(t*z-v*G-b*y)*r,a[8]=(v*B-u*z+b*x)*r,a):null},e.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},e.frob=
function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a[4]=b[4]+c[4],a[5]=b[5]+c[5],a[6]=b[6]+c[6],a[7]=b[7]+c[7],a[8]=b[8]+c[8],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a[4]=b[4]-c[4],a[5]=b[5]-c[5],a[6]=b[6]-c[6],a[7]=b[7]-c[7],
a[8]=b[8]-c[8],a},e.sub=e.subtract,e.multiplyScalar=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a[4]=b[4]*c,a[5]=b[5]*c,a[6]=b[6]*c,a[7]=b[7]*c,a[8]=b[8]*c,a},e.multiplyScalarAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a[4]=b[4]+c[4]*d,a[5]=b[5]+c[5]*d,a[6]=b[6]+c[6]*d,a[7]=b[7]+c[7]*d,a[8]=b[8]+c[8]*d,a},e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&
a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]},e.equals=function(a,b){var c=a[0],d=a[1],f=a[2],e=a[3],h=a[4],l=a[5],p=a[6],k=a[7],q=a[8],n=b[0],w=b[1],r=b[2],v=b[3],u=b[4],t=b[5];a=a[6];var x=b[7];b=b[8];return Math.abs(c-n)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(n))&&Math.abs(d-w)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(f-r)<=m.EPSILON*Math.max(1,Math.abs(f),Math.abs(r))&&Math.abs(e-v)<=m.EPSILON*Math.max(1,Math.abs(e),Math.abs(v))&&Math.abs(h-u)<=m.EPSILON*Math.max(1,Math.abs(h),Math.abs(u))&&
Math.abs(l-t)<=m.EPSILON*Math.max(1,Math.abs(l),Math.abs(t))&&Math.abs(p-a)<=m.EPSILON*Math.max(1,Math.abs(p),Math.abs(a))&&Math.abs(k-x)<=m.EPSILON*Math.max(1,Math.abs(k),Math.abs(x))&&Math.abs(q-b)<=m.EPSILON*Math.max(1,Math.abs(q),Math.abs(b))},e})},"esri/core/libs/gl-matrix/vec4":function(){define(["./common"],function(m){var e={};return e.create=function(){var a=new m.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a},e.clone=function(a){var b=new m.ARRAY_TYPE(4);return b[0]=a[0],b[1]=a[1],
b[2]=a[2],b[3]=a[3],b},e.fromValues=function(a,b,c,d){var f=new m.ARRAY_TYPE(4);return f[0]=a,f[1]=b,f[2]=c,f[3]=d,f},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},e.set=function(a,b,c,d,f){return a[0]=b,a[1]=c,a[2]=d,a[3]=f,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*
c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},e.div=e.divide,e.ceil=function(a,b){return a[0]=Math.ceil(b[0]),a[1]=Math.ceil(b[1]),a[2]=Math.ceil(b[2]),a[3]=Math.ceil(b[3]),a},e.floor=function(a,b){return a[0]=Math.floor(b[0]),a[1]=Math.floor(b[1]),a[2]=Math.floor(b[2]),a[3]=Math.floor(b[3]),a},e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],
c[2]),a[3]=Math.min(b[3],c[3]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},e.round=function(a,b){return a[0]=Math.round(b[0]),a[1]=Math.round(b[1]),a[2]=Math.round(b[2]),a[3]=Math.round(b[3]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a},e.distance=function(a,b){var c=
b[0]-a[0],d=b[1]-a[1],f=b[2]-a[2];a=b[3]-a[3];return Math.sqrt(c*c+d*d+f*f+a*a)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],f=b[2]-a[2];a=b[3]-a[3];return c*c+d*d+f*f+a*a},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1],d=a[2];a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];a=a[3];return b*b+c*c+d*d+a*a},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=
-b[2],a[3]=-b[3],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a[3]=1/b[3],a},e.normalize=function(a,b){var c=b[0],d=b[1],f=b[2];b=b[3];var e=c*c+d*d+f*f+b*b;return 0<e&&(e=1/Math.sqrt(e),a[0]=c*e,a[1]=d*e,a[2]=f*e,a[3]=b*e),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},e.lerp=function(a,b,c,d){var f=b[0],e=b[1],h=b[2];b=b[3];return a[0]=f+d*(c[0]-f),a[1]=e+d*(c[1]-e),a[2]=h+d*(c[2]-h),a[3]=b+d*(c[3]-b),a},e.random=function(a,b){return b=b||1,a[0]=
m.RANDOM(),a[1]=m.RANDOM(),a[2]=m.RANDOM(),a[3]=m.RANDOM(),e.normalize(a,a),e.scale(a,a,b),a},e.transformMat4=function(a,b,c){var d=b[0],f=b[1],e=b[2];b=b[3];return a[0]=c[0]*d+c[4]*f+c[8]*e+c[12]*b,a[1]=c[1]*d+c[5]*f+c[9]*e+c[13]*b,a[2]=c[2]*d+c[6]*f+c[10]*e+c[14]*b,a[3]=c[3]*d+c[7]*f+c[11]*e+c[15]*b,a},e.transformQuat=function(a,b,c){var d=b[0],f=b[1],e=b[2],h=c[0],l=c[1],p=c[2];c=c[3];var k=c*d+l*e-p*f,q=c*f+p*d-h*e,n=c*e+h*f-l*d,d=-h*d-l*f-p*e;return a[0]=k*c+d*-h+q*-p-n*-l,a[1]=q*c+d*-l+n*-h-
k*-p,a[2]=n*c+d*-p+k*-l-q*-h,a[3]=b[3],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,g,h){c||(c=4);d||(d=0);for(e=e?Math.min(e*c+d,b.length):b.length;e>d;d+=c)a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],a[3]=b[d+3],g(a,a,h),b[d]=a[0],b[d+1]=a[1],b[d+2]=a[2],b[d+3]=a[3];return b}}(),e.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]},e.equals=function(a,b){var c=a[0],d=a[1],e=a[2];a=
a[3];var g=b[0],h=b[1],l=b[2];b=b[3];return Math.abs(c-g)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(d-h)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(h))&&Math.abs(e-l)<=m.EPSILON*Math.max(1,Math.abs(e),Math.abs(l))&&Math.abs(a-b)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))},e})},"esri/views/vectorTiles/renderers/vtShaderSnippets":function(){define("require exports ../../webgl/ShaderSnippets dojo/text!./Shaders.xml dojo/text!./shaders/background.vs.glsl dojo/text!./shaders/background.fs.glsl dojo/text!./shaders/lineShader.vs.glsl dojo/text!./shaders/lineShader.fs.glsl dojo/text!./shaders/patternLineShader.vs.glsl dojo/text!./shaders/patternLineShader.fs.glsl dojo/text!./shaders/lineJoinShader.vs.glsl dojo/text!./shaders/lineJoinShader.fs.glsl dojo/text!./shaders/lineJoinQuadShader.vs.glsl dojo/text!./shaders/lineJoinQuadShader.fs.glsl dojo/text!./shaders/solidFillShader.vs.glsl dojo/text!./shaders/solidFillShader.fs.glsl dojo/text!./shaders/patternFillShader.vs.glsl dojo/text!./shaders/patternFillShader.fs.glsl dojo/text!./shaders/fillOutlineShader.vs.glsl dojo/text!./shaders/fillOutlineShader.fs.glsl dojo/text!./shaders/iconShader.vs.glsl dojo/text!./shaders/iconShader.fs.glsl dojo/text!./shaders/sdfShader.vs.glsl dojo/text!./shaders/sdfShader.fs.glsl dojo/text!./shaders/tileInfo.vs.glsl dojo/text!./shaders/tileInfo.fs.glsl".split(" "),
function(m,e,a,b,c,d,f,g,h,l,p,k,q,n,w,r,v,u,t,x,y,z,A,B,G,K){function D(a,b){E+='\x3csnippet name\x3d"'+a+'"\x3e\x3c![CDATA[';E+=b;E+="]]\x3e\x3c/snippet\x3e"}var E="",E=E+'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e',E=E+"\x3csnippets\x3e";D("backgroundVS",c);D("backgroundFS",d);D("lineShaderVS",f);D("lineShaderFS",g);D("patternLineShaderVS",h);D("patternLineShaderFS",l);D("lineJoinShaderVS",p);D("lineJoinShaderFS",k);D("lineJoinQuadShaderVS",q);D("lineJoinQuadShaderFS",n);D("solidFillShaderVS",
w);D("solidFillShaderFS",r);D("patternFillShaderVS",v);D("patternFillShaderFS",u);D("fillOutlineShaderVS",t);D("fillOutlineShaderFS",x);D("iconShaderVS",y);D("iconShaderFS",z);D("sdfShaderVS",A);D("sdfShaderFS",B);D("tileInfoVS",G);D("tileInfoFS",K);E+="\x3c/snippets\x3e";m=new a;return a.parse(E,m),a.parse(b,m),m})},"esri/views/vectorTiles/renderers/LineRenderer":function(){define("require exports ../../../core/libs/gl-matrix/mat4 ../../../core/libs/gl-matrix/vec4 ../../../core/libs/gl-matrix/vec3 ../../../core/libs/gl-matrix/vec2 ../../webgl/Program ../../webgl/VertexArrayObject ../GeometryUtils ./vtShaderSnippets".split(" "),
function(m,e,a,b,c,d,f,g,h,l){return function(){function e(){this._triangleAttributeLocations={a_pos:0,a_offsetAndNormal:1,a_accumulatedDistance:2};this._initialized=!1;this._viewProjMat=a.create();this._offsetVector=c.create();this._screenSize=d.create();this._color=b.create();this._dashArray=d.create()}return e.prototype.dispose=function(){this._triangleslProgram&&(this._triangleslProgram.dispose(),this._triangleslProgram=null);this._patternLineProgram&&(this._patternLineProgram.dispose(),this._patternLineProgram=
null)},e.prototype.render=function(b,c,d,e,f,g,l,p,m,y){if(0!==c.triangleElementCount){this._initialized||this._initialize(b);var k=f.tileTransform.transform,n=f.coordRange/512,q=g.getPaintValue("line-translate",d);if(0!==q[0]||0!==q[1]){a.copy(this._viewProjMat,f.tileTransform.transform);var k=q[0],q=q[1],r=0,t=0,t=(1<<f.key.level)/Math.pow(2,d)*n,r=e.rotation;if(1===g.getPaintValue("line-translate-anchor",d)){e=Math.sin(h.C_DEG_TO_RAD*-r);var u=Math.cos(h.C_DEG_TO_RAD*-r),r=t*(k*u-q*e),t=t*(k*e+
q*u)}else r=t*k,t*=q;this._offsetVector[0]=r;this._offsetVector[1]=t;this._offsetVector[2]=0;a.translate(this._viewProjMat,this._viewProjMat,this._offsetVector);k=this._viewProjMat}e=g.getPaintValue("line-pattern",d);r=void 0!==e;q=1/m;m=g.getPaintValue("line-blur",d)+q;t=g.getPaintValue("line-width",d);q=.5*(t+q);y*=g.getPaintValue("line-opacity",d);var u=g.getPaintValue("line-color",d),w=u[3]*y;this._color[0]=w*u[0];this._color[1]=w*u[1];this._color[2]=w*u[2];this._color[3]=w;if(u=this._getTrianglesVAO(b,
f))(b.bindVAO(u),r)?(d=l.getMosaicItemPosition(e,!0))&&(l.bind(b,9729,d.page,1),b.bindProgram(this._patternLineProgram),this._patternLineProgram.setUniformMatrix4fv("u_transformMatrix",k),this._patternLineProgram.setUniformMatrix4fv("u_extrudeMatrix",p),this._patternLineProgram.setUniform2fv("u_normalized_origin",f.tileTransform.displayCoord),this._patternLineProgram.setUniform1f("u_depth",g.z),this._patternLineProgram.setUniform1f("u_lineHalfWidth",q),this._patternLineProgram.setUniform1f("u_blur",
m),this._patternLineProgram.setUniform1f("u_opacity",y),this._patternLineProgram.setUniform2f("u_pattern_tl",d.tl[0],d.tl[1]),this._patternLineProgram.setUniform2f("u_pattern_br",d.br[0],d.br[1]),this._patternLineProgram.setUniform2f("u_spriteSize",n*d.size[0],d.size[1]),this._patternLineProgram.setUniform1i("u_texture",1)):(l=g.getPaintValue("line-dasharray",d),2>l.length&&(l=[1,-1]),n*=t,this._dashArray[0]=n*l[0],this._dashArray[1]=n*l[1],b.bindProgram(this._triangleslProgram),this._triangleslProgram.setUniformMatrix4fv("u_transformMatrix",
k),this._triangleslProgram.setUniformMatrix4fv("u_extrudeMatrix",p),this._triangleslProgram.setUniform2fv("u_normalized_origin",f.tileTransform.displayCoord),this._triangleslProgram.setUniform1f("u_depth",g.z),this._triangleslProgram.setUniform4fv("u_color",this._color),this._triangleslProgram.setUniform1f("u_lineHalfWidth",q),this._triangleslProgram.setUniform2fv("u_dasharray",this._dashArray),this._triangleslProgram.setUniform1f("u_blur",m)),b.drawElements(4,c.triangleElementCount,5125,12*c.triangleElementStart),
b.bindVAO()}},e.prototype._initialize=function(a){if(this._initialized)return!0;var b=new f(a,l.lineShaderVS,l.lineShaderFS,this._triangleAttributeLocations);a=new f(a,l.patternLineShaderVS,l.patternLineShaderFS,this._triangleAttributeLocations);return this._triangleslProgram=b,this._patternLineProgram=a,this._trianglesVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,
divisor:0},{name:"a_accumulatedDistance",count:1,type:5122,offset:8,stride:12,normalized:!1,divisor:0}]},this._initialized=!0,!0},e.prototype._getTrianglesVAO=function(a,b){if(b.lineTrianglesVertexArrayObject)return b.lineTrianglesVertexArrayObject;var c=b.lineVertexBuffer,d=b.lineTrianglesIndexBuffer;return c&&d?(b.lineTrianglesVertexArrayObject=new g(a,this._triangleAttributeLocations,this._trianglesVertexAttributes,{geometry:c},d),b.lineTrianglesVertexArrayObject):null},e}()})},"esri/views/vectorTiles/renderers/FillRenderer":function(){define("require exports ../../../core/libs/gl-matrix/mat4 ../../../core/libs/gl-matrix/mat3 ../../../core/libs/gl-matrix/vec4 ../../../core/libs/gl-matrix/vec3 ../../webgl/Program ../../webgl/VertexArrayObject ../GeometryUtils ./vtShaderSnippets".split(" "),
function(m,e,a,b,c,d,f,g,h,l){var p=1/65536;return function(){function e(){this._outlineAttributeLocations={a_pos:0,a_offset:1,a_xnormal:2};this._fillAttributeLocations={a_pos:0};this._initialized=!1;this._viewProjMat=a.create();this._offsetVector=d.create();this._patternMatrix=b.create();this._color=c.create();this._outlineColor=c.create()}return e.prototype.dispose=function(){this._solidFillProgram&&(this._solidFillProgram.dispose(),this._solidFillProgram=null);this._patternFillProgram&&(this._patternFillProgram.dispose(),
this._patternFillProgram=null);this._outlineProgram&&(this._outlineProgram.dispose(),this._outlineProgram=null)},e.prototype.render=function(c,d,e,f,g,k,l,m,y,z,A){if(0!==d.triangleElementCount){this._initialized||this._initialize(c);var n=l.getPaintValue("fill-pattern",e),q=void 0!==n;if(!q||0!==g){var r=l.getPaintValue("fill-antialias",e)&&!q;A*=l.getPaintValue("fill-opacity",e);var t=l.getPaintValue("fill-color",e),u=!1;if(!q){var w=t[3]*A;1===w&&0===g&&(u=!0);1>w&&1===g&&(u=!0)}if(u||0!==g){var x=
k.tileTransform.transform,w=k.coordRange/512,v=l.getPaintValue("fill-translate",e);if(0!==v[0]||0!==v[1]){a.copy(this._viewProjMat,k.tileTransform.transform);var x=v[0],v=v[1],C=0,J=0,w=(1<<k.key.level)/Math.pow(2,e)*w;1===l.getPaintValue("fill-translate-anchor",e)?(J=Math.sin(h.C_DEG_TO_RAD*-f),f=Math.cos(h.C_DEG_TO_RAD*-f),C=w*(x*f-v*J),J=w*(x*J+v*f)):(C=w*x,J=w*v);this._offsetVector[0]=C;this._offsetVector[1]=J;this._offsetVector[2]=0;a.translate(this._viewProjMat,this._viewProjMat,this._offsetVector);
x=this._viewProjMat}if(f=this._getTrianglesVAO(c,k))if(q?1===g&&(n=m.getMosaicItemPosition(n,!0))&&(w=k.coordRange/512/Math.pow(2,Math.round(e)-k.key.level)/z,b.identity(this._patternMatrix),q=1/(n.size[1]*w),this._patternMatrix[0]=1/(n.size[0]*w),this._patternMatrix[4]=q,c.bindVAO(f),m.bind(c,9729,n.page,1),c.bindProgram(this._patternFillProgram),this._patternFillProgram.setUniformMatrix4fv("u_transformMatrix",x),this._patternFillProgram.setUniform2fv("u_normalized_origin",k.tileTransform.displayCoord),
this._patternFillProgram.setUniform1f("u_depth",l.z),this._patternFillProgram.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix),this._patternFillProgram.setUniform1f("u_opacity",A),this._patternFillProgram.setUniform2f("u_pattern_tl",n.tl[0],n.tl[1]),this._patternFillProgram.setUniform2f("u_pattern_br",n.br[0],n.br[1]),this._patternFillProgram.setUniform1i("u_texture",1),c.drawElements(4,d.triangleElementCount,5125,12*d.triangleElementStart),c.bindVAO()):u&&(w=t[3]*A,this._color[0]=w*t[0],
this._color[1]=w*t[1],this._color[2]=w*t[2],this._color[3]=w,c.bindVAO(f),c.bindProgram(this._solidFillProgram),this._solidFillProgram.setUniformMatrix4fv("u_transformMatrix",x),this._solidFillProgram.setUniform2fv("u_normalized_origin",k.tileTransform.displayCoord),this._solidFillProgram.setUniform1f("u_depth",l.z+p),this._solidFillProgram.setUniform4fv("u_color",this._color),c.drawElements(4,d.triangleElementCount,5125,12*d.triangleElementStart),c.bindVAO()),r&&0<d.outlineElementCount&&1===g){e=
l.getPaintValue("fill-outline-color",e);if(0===e[3]){if(1!==this._color[3])return;e=t}z=.75/z;A*=e[3];this._outlineColor[0]=A*e[0];this._outlineColor[1]=A*e[1];this._outlineColor[2]=A*e[2];this._outlineColor[3]=A;if(A=this._getOutlineVAO(c,k))c.bindVAO(A),c.bindProgram(this._outlineProgram),this._outlineProgram.setUniformMatrix4fv("u_transformMatrix",x),this._outlineProgram.setUniformMatrix4fv("u_extrudeMatrix",y),this._outlineProgram.setUniform2fv("u_normalized_origin",k.tileTransform.displayCoord),
this._outlineProgram.setUniform1f("u_depth",l.z),this._outlineProgram.setUniform1f("u_outline_width",z),this._outlineProgram.setUniform4fv("u_color",this._outlineColor),c.drawElements(4,d.outlineElementCount,5125,12*d.outlineElementStart),c.bindVAO()}}}}},e.prototype._initialize=function(a){if(this._initialized)return!0;var b=new f(a,l.solidFillShaderVS,l.solidFillShaderFS,{a_pos:0});if(!b)return!1;var c=new f(a,l.patternFillShaderVS,l.patternFillShaderFS,this._fillAttributeLocations);if(!c)return!1;
a=new f(a,l.fillOutlineShaderVS,l.fillOutlineShaderFS,this._outlineAttributeLocations);return this._solidFillProgram=b,this._patternFillProgram=c,this._trianglesVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]},this._outlineProgram=a,this._outlineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",
count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}]},this._initialized=!0,!0},e.prototype._getTrianglesVAO=function(a,b){if(b.polygonTrianglesVertexArrayObject)return b.polygonTrianglesVertexArrayObject;var c=b.polygonTrianglesVertexBuffer,d=b.polygonTrianglesIndexBuffer;return c&&d?(b.polygonTrianglesVertexArrayObject=new g(a,this._fillAttributeLocations,this._trianglesVertexAttributes,{geometry:c},d),b.polygonTrianglesVertexArrayObject):null},e.prototype._getOutlineVAO=function(a,b){if(b.polygonOutlineVertexArrayObject)return b.polygonOutlineVertexArrayObject;
var c=b.polygonOutlinesVertexBuffer,d=b.polygonOutlinesIndexBuffer;return c&&d?(b.polygonOutlineVertexArrayObject=new g(a,this._outlineAttributeLocations,this._outlineVertexAttributes,{geometry:c},d),b.polygonOutlineVertexArrayObject):null},e}()})},"esri/views/vectorTiles/renderers/SymbolRenderer":function(){define(["require","exports","./IconRenderer","./SDFRenderer"],function(m,e,a,b){return function(){function c(){this._iconRenderer=new a;this._sdfRenderer=new b}return c.prototype.dispose=function(){this._iconRenderer&&
(this._iconRenderer.dispose(),this._iconRenderer=null);this._sdfRenderer&&(this._sdfRenderer.dispose(),this._sdfRenderer=null)},c.prototype.render=function(a,b,c,e,l,p,k,m,n,w,r,v,u){b.hasData()&&(0<b.markerPerPageElementsMap.size&&(b.isSDF||this._iconRenderer.render(a,b,c,e,l,p,k,m,w,r,u)),0<b.glyphPerPageElementsMap.size&&this._sdfRenderer.render(a,b,c,e,l,p,k,n,w,r,v,u))},c}()})},"esri/views/vectorTiles/renderers/IconRenderer":function(){define("require exports ../../../core/libs/gl-matrix/mat4 ../../../core/libs/gl-matrix/vec3 ../../webgl/Program ../../webgl/VertexArrayObject ../GeometryUtils ./vtShaderSnippets".split(" "),
function(m,e,a,b,c,d,f,g){return function(){function e(){this._attributeLocations={a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3};this._spritesTextureSize=new Float32Array(2);this._initialized=!1;this._extrudeMat=a.create();this._scaleVec=b.create()}return e.prototype.dispose=function(){this._iconProgram&&(this._iconProgram.dispose(),this._iconProgram=null)},e.prototype.render=function(b,c,d,e,g,h,m,v,u,t,x){var k=this;this._initialized||this._initialize(b);x*=m.getPaintValue("icon-opacity",d);var l=
m.getLayoutValue("icon-rotation-alignment",d);1===l&&(1!==m.getLayoutValue("symbol-placement",d)||m.hasLayoutProperty("icon-rotation-alignment")||(l=0));var p=0===l,l=m.getLayoutValue("icon-keep-upright",d)&&p,n=m.getLayoutValue("icon-size",d);e=f.degToByte(e);p?a.copy(this._extrudeMat,u):a.copy(this._extrudeMat,t);1!==n&&(this._scaleVec[0]=n,this._scaleVec[1]=n,this._scaleVec[2]=1,a.scale(this._extrudeMat,this._extrudeMat,this._scaleVec));b.bindProgram(this._iconProgram);(u=this._getIconVAO(b,h))&&
(b.bindVAO(u),this._iconProgram.setUniformMatrix4fv("u_transformMatrix",h.tileTransform.transform),this._iconProgram.setUniformMatrix4fv("u_extrudeMatrix",this._extrudeMat),this._iconProgram.setUniform2fv("u_normalized_origin",h.tileTransform.displayCoord),this._iconProgram.setUniform1f("u_depth",m.z),this._iconProgram.setUniform1f("u_mapRotation",e),this._iconProgram.setUniform1f("u_keepUpright",l?1:0),this._iconProgram.setUniform1f("u_level",10*d),this._iconProgram.setUniform1f("u_fadeSpeed",10*
g.fadeSpeed),this._iconProgram.setUniform1f("u_minfadeLevel",10*g.minfadeLevel),this._iconProgram.setUniform1f("u_maxfadeLevel",10*g.maxfadeLevel),this._iconProgram.setUniform1f("u_fadeChange",10*(d+g.fadeChange)),this._iconProgram.setUniform1f("u_opacity",x),this._iconProgram.setUniform1i("u_texture",1),c.markerPerPageElementsMap.forEach(function(a,c){k._spritesTextureSize[0]=v.getWidth(c)/4;k._spritesTextureSize[1]=v.getHeight(c)/4;k._iconProgram.setUniform2fv("u_mosaicSize",k._spritesTextureSize);
v.bind(b,9729,c,1);b.drawElements(4,a[1],5125,12*a[0])}),b.bindVAO())},e.prototype._initialize=function(a){return this._initialized?!0:(this._iconProgram=new c(a,g.iconShaderVS,g.iconShaderFS,this._attributeLocations),this._iconVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",
count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]},this._initialized=!0,!0)},e.prototype._getIconVAO=function(a,b){if(b.iconVertexArrayObject)return b.iconVertexArrayObject;var c=b.iconVertexBuffer,e=b.iconIndexBuffer;return c&&e?(b.iconVertexArrayObject=new d(a,this._attributeLocations,this._iconVertexAttributes,{geometry:c},e),b.iconVertexArrayObject):null},e}()})},"esri/views/vectorTiles/renderers/SDFRenderer":function(){define("require exports dojo/has ../../../core/libs/gl-matrix/mat4 ../../../core/libs/gl-matrix/vec4 ../../../core/libs/gl-matrix/vec3 ../../webgl/Program ../../webgl/VertexArrayObject ../GeometryUtils ./vtShaderSnippets".split(" "),
function(m,e,a,b,c,d,f,g,h,l){var p=1/65536;return function(){function e(){this._attributeLocations={a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3};this._initialized=!1;this._extrudeMat=b.create();this._haloColor=c.create();this._sdfColor=c.create();this._scaleVec=d.create()}return e.prototype.dispose=function(){this._sdfProgram&&(this._sdfProgram.dispose(),this._sdfProgram=null)},e.prototype.render=function(c,d,e,f,g,k,l,m,y,z,A,B){var n=this;if(!a("esri-vector-tiles-avoid-text")){this._initialized||
this._initialize(c);var q=l.getLayoutValue("text-size",e),r=q/24;f=h.degToByte(f);var t=l.getLayoutValue("text-rotation-alignment",e);1===t&&(1!==l.getLayoutValue("symbol-placement",e)||l.hasLayoutProperty("text-rotation-alignment")||(t=0));var u=0===t,t=l.getLayoutValue("text-keep-upright",e)&&u,w=.1*24/q/A,x=B*l.getPaintValue("text-opacity",e);this._glyphTextureSize||(this._glyphTextureSize=new Float32Array([m.width/4,m.height/4]));u?b.copy(this._extrudeMat,y):b.copy(this._extrudeMat,z);this._scaleVec[0]=
r;this._scaleVec[1]=r;this._scaleVec[2]=1;b.scale(this._extrudeMat,this._extrudeMat,this._scaleVec);c.bindProgram(this._sdfProgram);(y=this._getSDFVAO(c,k))&&(c.bindVAO(y),this._sdfProgram.setUniformMatrix4fv("u_transformMatrix",k.tileTransform.transform),this._sdfProgram.setUniformMatrix4fv("u_extrudeMatrix",this._extrudeMat),this._sdfProgram.setUniform2fv("u_normalized_origin",k.tileTransform.displayCoord),this._sdfProgram.setUniform1f("u_depth",l.z+p),this._sdfProgram.setUniform2fv("u_mosaicSize",
this._glyphTextureSize),this._sdfProgram.setUniform1f("u_mapRotation",f),this._sdfProgram.setUniform1f("u_keepUpright",t?1:0),this._sdfProgram.setUniform1f("u_level",10*e),this._sdfProgram.setUniform1f("u_fadeSpeed",10*g.fadeSpeed),this._sdfProgram.setUniform1f("u_minfadeLevel",10*g.minfadeLevel),this._sdfProgram.setUniform1f("u_maxfadeLevel",10*g.maxfadeLevel),this._sdfProgram.setUniform1f("u_fadeChange",10*(e+g.fadeChange)),this._sdfProgram.setUniform1f("u_opacity",x),this._sdfProgram.setUniform1i("u_texture",
0),d.glyphPerPageElementsMap.forEach(function(a,b){m.bind(c,9729,b,0);b=l.getPaintValue("text-halo-color",e);if(0<b[3]){var d=b[3]*x;n._haloColor[0]=d*b[0];n._haloColor[1]=d*b[1];n._haloColor[2]=d*b[2];n._haloColor[3]=d;b=w+l.getPaintValue("text-halo-blur",e)/r/8;d=.75-l.getPaintValue("text-halo-width",e)/r/8;n._sdfProgram.setUniform4fv("u_color",n._haloColor);n._sdfProgram.setUniform1f("u_edgeDistance",d);n._sdfProgram.setUniform1f("u_edgeWidth",b);c.drawElements(4,a[1],5125,12*a[0])}b=l.getPaintValue("text-color",
e);0<b[3]&&(d=b[3]*x,n._sdfColor[0]=d*b[0],n._sdfColor[1]=d*b[1],n._sdfColor[2]=d*b[2],n._sdfColor[3]=d,n._sdfProgram.setUniform4fv("u_color",n._sdfColor),n._sdfProgram.setUniform1f("u_edgeDistance",.75),n._sdfProgram.setUniform1f("u_edgeWidth",w),c.drawElements(4,a[1],5125,12*a[0]))}),c.bindVAO())}},e.prototype._initialize=function(a){return this._initialized?!0:(this._sdfProgram=new f(a,l.sdfShaderVS,l.sdfShaderFS,this._attributeLocations),this._sdfVertexAttributes={geometry:[{name:"a_pos",count:2,
type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]},this._initialized=!0,!0)},e.prototype._getSDFVAO=function(a,b){if(b.textVertexArrayObject)return b.textVertexArrayObject;var c=b.textVertexBuffer,d=b.textIndexBuffer;return c&&d?(b.textVertexArrayObject=
new g(a,this._attributeLocations,this._sdfVertexAttributes,{geometry:c},d),b.textVertexArrayObject):null},e}()})},"esri/views/vectorTiles/renderers/TileInfoRenderer":function(){define("require exports ../../webgl/Program ../../webgl/VertexArrayObject ../../webgl/BufferObject ../../webgl/Texture ../GeometryUtils ./vtShaderSnippets".split(" "),function(m,e,a,b,c,d,f,g){return function(){function e(){this._initialized=!1;this._maxWidth=0;this._color=new Float32Array([1,0,0,1])}return e.prototype.dispose=
function(){this._outlineProgram&&(this._outlineProgram.dispose(),this._outlineProgram=null);this._tileInfoProgram&&(this._tileInfoProgram.dispose(),this._tileInfoProgram=null);this._outlineVertexArrayObject&&(this._outlineVertexArrayObject.dispose(),this._outlineVertexArrayObject=null);this._tileInfoVertexArrayObject&&(this._tileInfoVertexArrayObject.dispose(),this._tileInfoVertexArrayObject=null)},e.prototype.render=function(a,b){this._initialized||this._initialize(a);a.bindVAO(this._outlineVertexArrayObject);
a.bindProgram(this._outlineProgram);this._outlineProgram.setUniformMatrix4fv("u_transformMatrix",b.tileTransform.transform);this._outlineProgram.setUniform2fv("u_normalized_origin",b.tileTransform.displayCoord);this._outlineProgram.setUniform1f("u_coord_range",b.coordRange);this._outlineProgram.setUniform1f("u_depth",0);this._outlineProgram.setUniform4fv("u_color",this._color);a.setLineWidth(2);a.drawArrays(3,0,4);a.bindVAO();var c=this._getTexture(a,b);c&&(a.bindVAO(this._tileInfoVertexArrayObject),
a.bindProgram(this._tileInfoProgram),a.bindTexture(c,0),this._tileInfoProgram.setUniformMatrix4fv("u_transformMatrix",b.tileTransform.transform),this._tileInfoProgram.setUniform2fv("u_normalized_origin",b.tileTransform.displayCoord),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform1f("u_coord_ratio",b.coordRange/512),this._tileInfoProgram.setUniform2f("u_delta",8,8),this._tileInfoProgram.setUniform2f("u_dimensions",c.descriptor.width,c.descriptor.height),a.drawArrays(5,
0,4),a.bindVAO())},e.prototype._initialize=function(d){if(this._initialized)return!0;var e={a_pos:0},f=new a(d,g.backgroundVS,g.backgroundFS,e),h=new a(d,g.tileInfoVS,g.tileInfoFS,e),l={geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},m=new Int8Array([0,0,1,0,1,1,0,1]),m=c.createVertex(d,35044,m),m=new b(d,e,l,{geometry:m}),r=new Int8Array([0,0,1,0,0,1,1,1]),r=c.createVertex(d,35044,r);d=new b(d,e,l,{geometry:r});return this._outlineProgram=f,this._tileInfoProgram=
h,this._vertexAttributes=l,this._outlineVertexArrayObject=m,this._tileInfoVertexArrayObject=d,this._initialized=!0,!0},e.prototype._getTexture=function(a,b){if(b.texture)return b.texture;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","canvas2d"),this._canvas.setAttribute("width","256"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var c=b.key.id,e=this._canvas.getContext("2d");e.font="24px sans-serif";e.textAlign=
"left";e.textBaseline="middle";var g=e.measureText(c),g=Math.pow(2,Math.ceil(f.log2(g.width+2)));g>this._maxWidth&&(this._maxWidth=g);return e.clearRect(0,0,this._maxWidth,32),e.fillStyle=b.key.level>b.refKey.level?"red":"blue",e.fillText(c,0,16),b.texture=new d(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728},this._canvas),b.texture},e}()})},"esri/views/vectorTiles/renderers/FadeRecorder":function(){define(["require","exports","../../../core/now"],function(m,e,a){Object.defineProperty(e,
"__esModule",{value:!0});m=(function(){return function(a,c){this.level=a;this.now=c}}(),function(){return function(a,c,d,e){this.fadeSpeed=a;this.minfadeLevel=c;this.maxfadeLevel=d;this.fadeChange=e}}());e.FadeProperties=m;m=function(){function b(a){void 0===a&&(a=300);this._levelSnapshots=[];this._duration=a}return b.prototype.recordLevel=function(b){var c=a(),e=this._levelSnapshots;0===e.length&&(e.push({level:b,now:0}),e.push({level:b,now:0}));2!==e.length&&e[0].level===b||e.push({level:b,now:c})},
b.prototype.needsRedraw=function(){if(0===this._levelSnapshots.length)return!1;for(var a=this._duration,b=this._levelSnapshots,e=b.length,g=b[e-1],h=-1;e>h+1&&b[h+1].now+a<g.now;)h++;for(0>h&&(h=0);e>h;h++)if(b[h].level!==g.level)return!0;return!1},b.prototype.getFadeValues=function(b){void 0===b&&(b=!1);for(var c=this._duration,e=a(),g=this._levelSnapshots;3<g.length&&g[1].now+c<e;)g.shift();g[1].now+c<e&&(g[0].level=g[1].level);var h=g[0].level,l=g[g.length-1],m=l.level,k=Math.min(h,m),h=Math.max(h,
m),g=(l.level-g[1].level)/((l.now-g[1].now)/c),c=(e-l.now)/c*g;return b?{fadeSpeed:0,minfadeLevel:k,maxfadeLevel:h,fadeChange:0}:{fadeSpeed:g,minfadeLevel:k,maxfadeLevel:h,fadeChange:c}},b}();e.FadeRecorder=m})},"url:esri/views/vectorTiles/renderers/Shaders.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\x3c!--\n  Add your GLSL snippets to this file. You should start from\n  importing your old GLSL files. For instance, if you have a\n  file such as myShader.vs.glsl you should create a new \x3csnippet name\x3d"myShaderVS"\x3e\n  and then copy and paste the GLSL source as the content. You will then convert your\n  code to use the {@link module:esri/views/vectorTiles/renderers/vtShaderSnippets vtShaderSnippets}\n  instance to access the GLSL code, instead of importing it directly with require("dojo/text!...").\n--\x3e\n\x3csnippets\x3e\n\n  \x3csnippet name\x3d"foobarVS"\x3e\n  \x3c/snippet\x3e\n\n  \x3csnippet name\x3d"foobarFS"\x3e\n  \x3c/snippet\x3e\n\n\x3c/snippets\x3e\n\n',
"url:esri/views/vectorTiles/renderers/shaders/background.vs.glsl":"attribute vec2 a_pos;\n\nuniform highp mat4 u_transformMatrix;\nuniform mediump vec2 u_normalized_origin;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n\nvoid main() {\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(u_coord_range * a_pos, 0.0, 1.0);\n}\n","url:esri/views/vectorTiles/renderers/shaders/background.fs.glsl":"uniform lowp vec4 u_color;\nvoid main() {\n  gl_FragColor \x3d u_color;\n}",
"url:esri/views/vectorTiles/renderers/shaders/lineShader.vs.glsl":"/* The implementation of the renderer is based on the article and implementation of MB described here:\n* https://www.mapbox.com/blog/drawing-antialiased-lines/\n*/\n\nattribute vec2 a_pos;\nattribute vec4 a_offsetAndNormal;\nattribute float a_accumulatedDistance;\n\n// the relative transformation of a vertex given in tile coordinates to a relative normalized coordinate\n// relative to the tile's upper left corner\n// the extrusion vector.\nuniform highp mat4 u_transformMatrix;\n// the extrude matrix which is responsible for the 'anti-zoom' as well as the rotation\nuniform highp mat4 u_extrudeMatrix;\n// u_normalized_origin is the tile's upper left corner given in normalized coordinates\nuniform highp vec2 u_normalized_origin;\n// the z of the layer. Given by the order of the layers in the style\nuniform mediump float u_depth;\n// the inset and outset of the line\nuniform mediump float u_lineHalfWidth;\n// the interpolated normal to the line. the information is packed into the two LSBs of the vertex coordinate\nvarying mediump vec2 v_normal;\n// the accumulated distance along the line. We need this information in order to render the dashes.\nvarying highp float v_accumulatedDistance;\n\nconst float scale \x3d 1.0 / 31.0;\n\nvoid main()\n{\n  v_normal \x3d a_offsetAndNormal.zw * scale;\n\n  // calculate the relative distance from the centerline to the edge of the line. Since offset is given in integers (for the\n  // sake of using less attribute memory, we need to scale it back to the original range of ~ 0: 1)\n  mediump vec2 dist \x3d u_lineHalfWidth * a_offsetAndNormal.xy * scale;\n\n  // transform the vertex\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * vec4(dist, 0.0, 0.0);\n\n  // the accumulated distance will be used to calculate the dashes (or the no-data...)\n  v_accumulatedDistance \x3d a_accumulatedDistance;\n}\n",
"url:esri/views/vectorTiles/renderers/shaders/lineShader.fs.glsl":"/* The implementation of the renderer is based on the article and implementation of MB described here:\n* https://www.mapbox.com/blog/drawing-antialiased-lines/\n*/\n\nuniform mediump float u_lineHalfWidth;\nuniform lowp vec4 u_color;\nuniform mediump vec2 u_dasharray;\nuniform lowp float u_blur;\n\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\n\nvoid main()\n{\n  // dist represent the distance of the fragment from the line. 1.0 or -1.0 will be the values on the edge of the line,\n  // and any value in between will be inside the line (the sign represent the direction - right or left).\n  // since u_linewidth.s (half line width) is represented in pixels, dist is also given in pixels\n  mediump float fragDist \x3d length(v_normal) * u_lineHalfWidth;\n\n  // calculate the alpha given the difference between the line-width and the distance of the fragment from the center-line.\n  // We need to count for both sides of the line.\n  lowp float alpha \x3d clamp( min(fragDist + u_blur + 1.0, u_lineHalfWidth - fragDist) / u_blur, 0.0, 1.0);\n\n  // now calculate the dashes given the accumulated distance of the line:\n  // start with calculating a normalized position along the line\n  lowp float dashPos \x3d  mod(v_accumulatedDistance, u_dasharray.x + u_dasharray.y);\n\n  // calculate the contribution to the alpha of the dash part. It is provided by the shortest portion of the position along the dash.\n  // we must clamp since the value might be bigger than 1 or smaller than zero (when over a dash).\n  //   | \x3c--- pos along the dash part\n  // -------_______-------_______\n  // when the dashPos is over the 'gap' part of the dash u_dasharray.x - dashPos is negative and therefore the alpha will\n  // get clamped to zero.\n  // when u_dasharray.x - dashPos is positive, or when dashPos is smaller than 1.0, it gives us a soft edge to each dash part.\n  // along the direction of the line.\n  lowp float dashAlpha \x3d clamp( min(dashPos, u_dasharray.x - dashPos), 0.0, 1.0);\n\n  // if we don't have a no-data part to the dash then it is a solid line\n  dashAlpha \x3d max(sign(-u_dasharray.y), dashAlpha); //sign(-u_dasharray.y) \x3e 0.0 ? 1.0 : dashAlpha;\n  // finally multiply the fragment's alpha by the calculated dash-alpha\n  alpha *\x3d dashAlpha;\n\n  // output the fragment color\n gl_FragColor \x3d alpha * u_color;\n}\n",
"url:esri/views/vectorTiles/renderers/shaders/patternLineShader.vs.glsl":"attribute vec2 a_pos;\nattribute vec4 a_offsetAndNormal;\nattribute float a_accumulatedDistance;\n\n// the relative transformation of a vertex given in tile coordinates to a relative normalized coordinate\n// relative to the tile's upper left corner\n// the extrusion vector.\nuniform highp mat4 u_transformMatrix;\n// the extrude matrix which is responsible for the 'anti-zoom' as well as the rotation\nuniform highp mat4 u_extrudeMatrix;\n// u_normalized_origin is the tile's upper left corner given in normalized coordinates\nuniform highp vec2 u_normalized_origin;\n// the z of the layer. Given by the order of the layers in the style\nuniform mediump float u_depth;\n// the inset and outset of the line\nuniform mediump float u_lineHalfWidth;\n// the interpolated normal to the line. the information is packed into the two LSBs of the vertex coordinate\nvarying mediump vec2 v_normal;\n// the accumulated distance along the line. We need this information in order to render the dashes.\nvarying highp float v_accumulatedDistance;\n\nconst float scale \x3d 1.0 / 31.0;\n\nvoid main()\n{\n  v_normal \x3d a_offsetAndNormal.zw * scale;\n\n  // calculate the relative distance from the centerline to the edge of the line. Since offset is given in integers (for the\n  // sake of using less attribute memory, we need to scale it back to the original range of ~ 0: 1)\n  // sake of using less attribute memory, we need to scale it back to the original range of ~ 0: 1)\n  mediump vec2 dist \x3d u_lineHalfWidth * a_offsetAndNormal.xy * scale;\n\n  // transform the vertex\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * vec4(dist, 0.0, 0.0);\n\n  // the accumulated distance will be used to calculate the dashes (or the no-data...)\n  v_accumulatedDistance \x3d a_accumulatedDistance;\n}\n",
"url:esri/views/vectorTiles/renderers/shaders/patternLineShader.fs.glsl":"uniform mediump float u_lineHalfWidth;\nuniform lowp float u_blur;\nuniform lowp float u_opacity;\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform mediump vec2 u_spriteSize;\nuniform sampler2D u_texture;\n\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\n\n// Horizontal scale is used to scale the horizontal texture coordinate v_normal.x before adding it as an offset to the\n// accumulated distance. Most vertices will have v_normal.x \x3d\x3d 0, because the pattern must be sampled only depending on\n// the v_accumulatedDistance value. But tessellation at caps can have vertices with v_normal.x !\x3d 0, thus allowing to\n// \"keep moving\" for a few more pixel even when the line has ended or has not started yet.\nconst mediump float tileCoordRatio \x3d 8.0;\n\nvoid main()\n{\n  // dist represent the distance of the fragment from the line. 1.0 or -1.0 will be the values on the edge of the line,\n  // and any value in between will be inside the line (the sign represent the direction - right or left).\n  // since u_linewidth.s (half line width) is represented in pixels, dist is also given in pixels\n  mediump float fragDist \x3d length(v_normal) * u_lineHalfWidth;\n\n  // calculate the alpha given the difference between the line-width and the distance of the fragment from the center-line.\n  // We need to count for both sides of the line.\n  lowp float alpha \x3d clamp( min(fragDist + u_blur + 1.0, u_lineHalfWidth - fragDist) / u_blur, 0.0, 1.0);\n  // add the line's opacity to the alpha\n  alpha *\x3d u_opacity;\n\n  // we need to calculate the relative portion of the line texture along the line given the accumulated distance aliong the line\n  // The computed value should is anumber btween 0 and 1 which will later be used to interpolate btween the BR and TL values\n  mediump float relativeTexX \x3d mod((v_accumulatedDistance + v_normal.x * u_lineHalfWidth * tileCoordRatio) / u_spriteSize.x, 1.0);\n\n  // in order to calculate the texture coordinates prependicular to the line (Y axis), we use the interpolated normal values\n  // which range from -1.0 to 1.0. On the line's centerline, the value of the interpolated normal is 0.0, however the relative\n  // texture value shpould be 0.5 (given that at the bottom of the line, the texture coordinate must be equal to 0.0)\n  // (TL) ---------------------------      --\x3e left edge of line. Interpolatedf normal is 1.0\n  //              | -\x3e linwe-width / 2\n  //      - - - - - - - - - - - - - -\n  //              | -\x3e linwe-width / 2\n  //      ---------------------------- (BR)--\x3e right edge of line. Interpolatedf normal is -1.0\n\n  mediump float relativeTexY \x3d 0.5 + (v_normal.y * u_lineHalfWidth / (0.5 * u_spriteSize.y));\n\n  // claculate the actual texture coordinates by interpolating between the TL/BR pattern coordinates\n  mediump vec2 texCoord \x3d mix(u_pattern_tl, u_pattern_br, vec2(relativeTexX, relativeTexY));\n\n  // get the color from the texture\n  lowp vec4 color \x3d texture2D(u_texture, texCoord);\n\n  // 'un-premultiply' the color\n  lowp float inv_alpha \x3d (1.0 / clamp(color.a, 0.00390625, 1.0));\n  // finally write the fragment value\n  gl_FragColor \x3d alpha * color;\n}\n",
"url:esri/views/vectorTiles/renderers/shaders/lineJoinShader.vs.glsl":"attribute vec2 a_pos;\n\nuniform highp mat4 u_transformMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform highp float u_depth;\nuniform highp vec2 u_screen;\nuniform mediump float u_size;\nuniform mediump float u_pixelRatio;\n\nvarying mediump vec2 v_vertexPosition;\n\nvoid main()\n{\n  gl_PointSize \x3d u_pixelRatio * u_size;\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0);\n\n  // calculate the vertex position in pixels (we need to add one in order to shift the origin from the center of the viewport)\n  v_vertexPosition \x3d (gl_Position.xy + 1.0) * u_screen;\n}\n",
"url:esri/views/vectorTiles/renderers/shaders/lineJoinShader.fs.glsl":"uniform lowp vec4 u_color;\nuniform mediump float u_lineHalfWidth;\nuniform mediump float u_oneOverPixelRatio;\n\nvarying mediump vec2 v_vertexPosition;\n\nvoid main()\n{\n  // get the distance of the current fragment from the actual vertex\n  mediump float fragDist \x3d length(v_vertexPosition - u_oneOverPixelRatio * gl_FragCoord.xy);\n\n  // rounding the quare: calculate the alpha given the difference between the line-width and the distance of the fragment\n  // from the center-line. We will end up with a nice round circle with a soft edge.\n  lowp float alpha \x3d clamp(u_lineHalfWidth - fragDist, 0.0, 1.0);\n\n  // finally output the fragment color\n  gl_FragColor \x3d alpha * u_color;\n}\n",
"url:esri/views/vectorTiles/renderers/shaders/lineJoinQuadShader.vs.glsl":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\n\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform highp float u_depth;\n// The width/height of the screen\nuniform mediump vec2 u_screen;\n// u_size is the diameter of the join in tile units\nuniform mediump float u_size;\n\nvarying mediump vec2 v_fragmentOffset;\n\nvoid main()\n{\n  // calculate the offset in pixels from the join's center to the vertex\n  highp vec2 dist \x3d u_size * a_vertexOffset;\n\n  // calculate the position of the join's center in normalized coordinates\n  highp vec4 center_pos \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0);\n\n  // offset in normalized display units\n  highp vec4 vertex_offset \x3d u_extrudeMatrix * vec4(dist, 0.0, 0.0);\n\n  // calculate the vertex offset in windows coordinates\n  v_fragmentOffset \x3d u_screen * vertex_offset.xy;\n\n  // finally calculate the vertex position\n  gl_Position \x3d center_pos + vertex_offset;\n}\n",
"url:esri/views/vectorTiles/renderers/shaders/lineJoinQuadShader.fs.glsl":"uniform lowp vec4 u_color;\nuniform mediump float u_lineHalfWidth;\n\nvarying mediump vec2 v_fragmentOffset;\n\nvoid main()\n{\n  // Calculate the antialiasing fade factor\n  lowp float alpha \x3d clamp(u_lineHalfWidth * u_lineHalfWidth - dot(v_fragmentOffset, v_fragmentOffset), 0.0, 1.0);\n  //lowp float alpha  \x3d 1.0 - smoothstep(u_lineHalfWidth - 0.25, u_lineHalfWidth + 0.25, dist);\n  // YF: if needed w can also use a smoothstep around the edge of the circle and use a single pixel or so as the edge width\n\n  // finally output the fragment color\n  gl_FragColor \x3d alpha * u_color;\n}\n",
"url:esri/views/vectorTiles/renderers/shaders/solidFillShader.vs.glsl":"attribute vec2 a_pos;\n\nuniform highp mat4 u_transformMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_depth;\n\nvoid main()\n{\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0, 1.0);\n}\n","url:esri/views/vectorTiles/renderers/shaders/solidFillShader.fs.glsl":"uniform lowp vec4 u_color;\nvoid main()\n{\n  gl_FragColor \x3d u_color;\n}","url:esri/views/vectorTiles/renderers/shaders/patternFillShader.vs.glsl":"uniform highp mat4 u_transformMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_depth;\nuniform mediump mat3 u_pattern_matrix; // can we use meduim precision??\n\nattribute vec2 a_pos;\n\nvarying mediump vec2 v_tileTextureCoord;\n\nvoid main()\n{\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0);\n  // calculate the texture coordinates of the current vertex. It will of course get interpolated.\n  // The pattern matrix is a 3x3 scale matrix which 'tiles' the texture inside the tile, translating from tile coordinates\n  // (-4k to 8k -1) to texture coordinates.\n  v_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\n}\n",
"url:esri/views/vectorTiles/renderers/shaders/patternFillShader.fs.glsl":"uniform lowp float u_opacity;\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform sampler2D u_texture;\n\nvarying mediump vec2 v_tileTextureCoord;\n\nvoid main()\n{\n  // normalize the calculated texture coordinate such that it fits in the range of 0 to 1.\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\n  // interpolate the image coordinate between the top-left and the bottom right to get the actual position to sample.\n  // after normalizing the position, we get a value ranging between 0 and 1 which refers to the entire texture, however\n  // we need to only sample from area that has our sprite in the mosaic.\n  mediump vec2 samplePos \x3d mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\n  // sample the sprite mosaic\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\n  gl_FragColor \x3d u_opacity * color;\n}\n",
"url:esri/views/vectorTiles/renderers/shaders/fillOutlineShader.vs.glsl":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\n\nvarying lowp vec2 v_normal;\n\nconst float scale \x3d 1.0 / 15.0;\n\nvoid main()\n{\n  v_normal \x3d a_xnormal;\n\n   // calculate the relative distance from the centerline to the edge of the line. Since offset is given in integers (for the\n    // sake of using less attribute memory, we need to scale it back to the original range of ~ 0: 1)\n  mediump vec4 dist \x3d vec4(u_outline_width * a_offset * scale, 0.0, 0.0);\n\n  // Remove the texture normal bit of the position before scaling it with the\n  // model/view matrix. Add the extrusion vector *after* the model/view matrix\n  // because we're extruding the line in pixel space, regardless of the current\n  // tile's zoom level.\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * dist;\n}\n",
"url:esri/views/vectorTiles/renderers/shaders/fillOutlineShader.fs.glsl":"uniform lowp vec4 u_color;\nvarying mediump vec2 v_normal;\n\nvoid main()\n{\n  // Calculate the distance of the pixel from the line in pixels.\n  lowp float dist \x3d abs(v_normal.y);\n\n  lowp float alpha \x3d smoothstep(1.0, 0.0, dist);\n  gl_FragColor \x3d alpha * u_color;\n}\n","url:esri/views/vectorTiles/renderers/shaders/iconShader.vs.glsl":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_tex;\nattribute vec4 a_levelInfo;\n\n// the relative transformation of a vertex given in tile coordinates to a relative normalized coordinate\n// relative to the tile's upper left corner\n// the extrusion vector.\nuniform highp mat4 u_transformMatrix;\n// the extrude matrix which is responsible for the 'anti-zoom' as well as the rotation\nuniform highp mat4 u_extrudeMatrix;\n// u_normalized_origin is the tile's upper left corner given in normalized coordinates\nuniform highp vec2 u_normalized_origin;\n// the size of the mosaic given in pixels\nuniform vec2 u_mosaicSize;\n// the z of the layer. Given by the order of the layers in the style\nuniform mediump float u_depth;\n// the map's rotation from the north\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\n// indicate whether the current set of iconst should be kept upright when the map is rotated\nuniform lowp float u_keepUpright;\n// the rate of the change in the opacity (fade) of the icons\nuniform mediump float u_fadeSpeed;\n// the low level we transition (to/from)\nuniform mediump float u_minfadeLevel;\n// the high level we transition (to/from)\nuniform mediump float u_maxfadeLevel;\n// the amount of fade given teh current time past the last recorded level\nuniform mediump float u_fadeChange;\n// the opacity of the layer given by the painter\nuniform mediump float u_opacity;\n// the interpolated texture coordinate value to be used by the fragment shader in order to sample the sprite texture\nvarying lowp vec2 v_tex;\n// the calculated transparency to be applied by the fragment shader. It is incorporating both the fade as well as the\n// opacity of the layer given by the painter\nvarying lowp float v_transparency;\n\n// the vertex offsets are given in integers, therefore in order to maintain a reasonable precission we multiply the values\n// by 16 and then at the shader devide by the same number\nconst float offsetPrecision \x3d 1.0 / 32.0;\n\nvoid main()\n{\n  mediump float a_labelMinLevel \x3d a_levelInfo[0];\n  mediump float a_angle        \x3d a_levelInfo[1];\n  mediump float a_minLevel    \x3d a_levelInfo[2];\n  mediump float a_maxLevel    \x3d a_levelInfo[3];\n\n  // if the given vertex should not be visible simply clip it by adding it a value that will push it outside the clipping plane\n  mediump float delta_z \x3d 0.0;\n\n  // If the label rotates with the map, and if the rotated label is upside down, hide it\n  mediump float rotated \x3d mod(a_angle - u_mapRotation, 256.0);\n  delta_z +\x3d (1.0 - step(u_keepUpright,0.0)) * step(65.0,rotated) * (1.0 - step(193.0,rotated)); //ie. z +\x3d (flip \x3e 0) \x26\x26 (65 \x3c\x3d rotated) \x26\x26 (rotated \x3c 193)\n\n  // u_level is the current service level adjusted for the change in font size\n  delta_z +\x3d 1.0 - step(a_minLevel, u_level); // Test if (level \x3c minLevel)\n  delta_z +\x3d step(a_maxLevel, u_level); // Test if (maxLevel \x3c\x3d level)\n\n  // calculate the alpha given the change in the fade and the fade-speed\n  lowp float alpha \x3d clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0);\n\n  // if the speed is positive we are zooming in and therefore we need to 'fade-in'. Else we need to 'fade-out'\n  v_transparency \x3d (u_fadeSpeed \x3e\x3d 0.0 ? alpha : 1.0 - alpha);\n\n  // now deal with the min/max fade-levels. If we exceeded the level we simply snap to 0 or 1\n  if (u_maxfadeLevel \x3c a_labelMinLevel)\n  {\n      v_transparency \x3d 0.0;\n  }\n  if (u_minfadeLevel \x3e\x3d a_labelMinLevel)\n  {\n      v_transparency \x3d 1.0;\n  }\n\n  // if label had been faded out, clip it\n  delta_z +\x3d step(v_transparency, 0.0);\n\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * vec4(offsetPrecision * a_vertexOffset, delta_z, 0.0);\n  v_tex \x3d a_tex.xy / u_mosaicSize;\n\n  v_transparency *\x3d u_opacity;\n}\n",
"url:esri/views/vectorTiles/renderers/shaders/iconShader.fs.glsl":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp float v_transparency;\n\nvoid main()\n{\n  lowp vec4 color \x3d texture2D(u_texture, v_tex);\n  gl_FragColor \x3d v_transparency * color;\n}\n","url:esri/views/vectorTiles/renderers/shaders/sdfShader.vs.glsl":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_tex;\nattribute vec4 a_levelInfo;\n\n// attribute bool a_visible; // --\x3e a one bit controlling the visibility of the vertex\n\n// the relative transformation of a vertex given in tile coordinates to a relative normalized coordinate\n// relative to the tile's upper left corner\n// the extrusion vector.\nuniform highp mat4 u_transformMatrix;\n// the extrude matrix which is responsible for the 'anti-zoom' as well as the rotation\nuniform highp mat4 u_extrudeMatrix;\n// u_normalized_origin is the tile's upper left corner given in normalized coordinates\nuniform highp vec2 u_normalized_origin;\n// the size of the mosaic given in pixels\nuniform vec2 u_mosaicSize;\n// the z of the layer. Given by the order of the layers in the style\nuniform mediump float u_depth;\n// the map's rotation from the north\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\n// indicate whether the current set of iconst should be kept upright when the map is rotated\nuniform lowp float u_keepUpright;\n// the rate of the change in the opacity (fade) of the icons\nuniform mediump float u_fadeSpeed;\n// the low level we transition (to/from)\nuniform mediump float u_minfadeLevel;\n// the high level we transition (to/from)\nuniform mediump float u_maxfadeLevel;\n// the amount of fade given teh current time past the last recorded level\nuniform mediump float u_fadeChange;\n// the opacity of the layer given by the painter\nuniform mediump float u_opacity;\n// the interpolated texture coordinate value to be used by the fragment shader in order to sample the sprite texture\nvarying lowp vec2 v_tex;\n// the calculated transparency to be applied by the fragment shader. It is incorporating both the fade as well as the\n// opacity of the layer given by the painter\nvarying lowp float v_transparency;\n\n// the vertex offsets are given in integers, therefore in order to maintain a reasonable precission we multiply the values\n// by 16 and then at the shader devide by the same number\nconst float offsetPrecision \x3d 1.0 / 32.0;\n\nvoid main()\n{\n  mediump float a_labelMinLevel \x3d a_levelInfo[0];\n  mediump float a_angle        \x3d a_levelInfo[1];\n  mediump float a_minLevel    \x3d a_levelInfo[2];\n  mediump float a_maxLevel    \x3d a_levelInfo[3];\n\n  // if the given vertex should not be visible simply clip it by adding it a value that will push it outside the clipping plane\n  mediump float delta_z \x3d 0.0;\n\n  // TODO: force clipping the vertex in case that the vertex isn't visible\n  //delta_z +\x3d a_visible ? 0.0 : 1.0;\n\n  // If the label rotates with the map, and if the rotated label is upside down, hide it\n  mediump float rotated \x3d mod(a_angle - u_mapRotation, 256.0);\n  delta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(65.0, rotated) * (1.0 - step(193.0, rotated)); //ie. z +\x3d (flip \x3e 0) \x26\x26 (65 \x3c\x3d rotated) \x26\x26 (rotated \x3c 193)\n\n  // u_level is the current service level adjusted for the change in font size\n  delta_z +\x3d 1.0 - step(a_minLevel, u_level); // Test if (level \x3c minLevel)\n  delta_z +\x3d step(a_maxLevel, u_level); // Test if (maxLevel \x3c\x3d level)\n\n  // calculate the alpha given the change in the fade and the fade-speed\n  lowp float alpha \x3d clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0);\n\n  // if the speed is positive we are zooming in and therefore we need to 'fade-in'. Else we need to 'fade-out'\n  v_transparency \x3d (u_fadeSpeed \x3e\x3d 0.0 ? alpha : 1.0 - alpha);\n\n  // now deal with the min/max fade-levels. If we exceeded the level we simply snap to 0 or 1\n  if (u_maxfadeLevel \x3c a_labelMinLevel)\n  {\n      v_transparency \x3d 0.0;\n  }\n  if (u_minfadeLevel \x3e\x3d a_labelMinLevel)\n  {\n      v_transparency \x3d 1.0;\n  }\n\n  // if label has been faded out, clip it\n  delta_z +\x3d step(v_transparency, 0.0);\n\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * vec4(offsetPrecision * a_vertexOffset, delta_z, 0.0);\n  v_tex \x3d a_tex.xy / u_mosaicSize;\n\n  v_transparency *\x3d u_opacity;\n}\n",
"url:esri/views/vectorTiles/renderers/shaders/sdfShader.fs.glsl":"uniform lowp sampler2D u_texture;\nuniform lowp vec4 u_color;\nuniform mediump float u_edgeDistance;\nuniform mediump float u_edgeWidth;\n\nvarying lowp vec2 v_tex;\nvarying lowp float v_transparency;\n\n// this is taken from http://www.valvesoftware.com/publications/2007/SIGGRAPH2007_AlphaTestedMagnification.pdf\n// and https://www.mapbox.com/blog/text-signed-distance-fields/\n// http://metalbyexample.com/rendering-text-in-metal-with-signed-distance-fields/\n\nvoid main()\n{\n  // read the distance from the SDF texture\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\n  // use a smooth-step in order to calculate the geometry of the shape given by the distance field\n  mediump float alpha \x3d smoothstep(u_edgeDistance - u_edgeWidth, u_edgeDistance + u_edgeWidth, dist) * v_transparency;\n\n  gl_FragColor \x3d alpha * u_color;\n\n// YF: this code allow having both a fill and an outline colors combined in a single pass\n//  lowp float geometryAlpha \x3d smoothstep(0.75 - 0.21, 0.75 + 0.21, dist) * v_transparency;\n//  lowp vec4 geometryColor \x3d vec4(u_color.rgb, geometryAlpha * u_color.a);\n//\n//  if (true) {\n//    lowp float haloAlpha \x3d smoothstep(0.0 - 0.1, 0.0 + 0.1, dist) * v_transparency;\n//    lowp vec4 haloColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n//    haloColor \x3d vec4(haloColor.rgb, haloAlpha);\n//\n//    // calculate the composite color\n//    lowp float compositeAlpha \x3d geometryColor.a + haloColor.a * (1.0 - geometryColor.a);\n//    lowp vec3 compositeColor \x3d vec3(geometryColor) * geometryColor.a + vec3(haloColor) * haloColor.a * (1.0 - geometryColor.a);\n//    compositeColor /\x3d compositeAlpha;\n//    gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\n//  }\n//  else {\n//    gl_FragColor \x3d geometryColor;\n//  }\n}\n",
"url:esri/views/vectorTiles/renderers/shaders/tileInfo.vs.glsl":"attribute vec2 a_pos;\n\nuniform highp mat4 u_transformMatrix;\nuniform mediump vec2 u_normalized_origin;\nuniform mediump float u_depth;\nuniform mediump float u_coord_ratio;\nuniform mediump vec2 u_delta; // in tile coordinates\nuniform mediump vec2 u_dimensions; // in tile coordinates\n\nvarying mediump vec2 v_tex;\n\nvoid main() {\n  mediump vec2 offests \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(offests, 0.0, 1.0);\n\n  v_tex \x3d a_pos;\n}\n",
"url:esri/views/vectorTiles/renderers/shaders/tileInfo.fs.glsl":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\n\nvoid main(void) {\n  lowp vec4 color \x3d texture2D(u_texture, v_tex);\n  gl_FragColor \x3d 0.75 * color;\n}\n","*noref":1}});
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/HandleRegistry ../../../core/promiseUtils ./LayerView2D ../engine/StageGL ../tiling/TileInfoViewPOT ../tiling/TileStrategy ../tiling/TileKey ../tiling/TileQueue ../../../views/vectorTiles/TileHandler ../../../views/vectorTiles/VectorTileContainer ../../../views/vectorTiles/VectorTileDisplayObject ../../support/screenshotUtils".split(" "),function(m,
e,a,b,c,d,f,g,h,l,p,k,q,n,w,r,v){m=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a._handles=new d,a._fetchQueue=null,a._tileRequests=new Map,a.container=new h,a}return a(c,b),c.prototype.hitTest=function(a,b){return null},c.prototype.update=function(a){if(this._vectorTileContainer&&this._vectorTileContainer.isInitialized){if(a.devicePixelRatio!==this._tileHandler.devicePixelRatio)return void this._start();this._fetchQueue.pause();this._fetchQueue.state=a.state;this._tileStrategy.update(a);
this._fetchQueue.resume();for(var b=0,c=this._vectorTileContainer.children;b<c.length;b++)this._tileHandler.updateTile(c[b],a);this.notifyChange("updating")}},c.prototype.attach=function(){this._start()},c.prototype.detach=function(){this._stop()},c.prototype.moveStart=function(){this.requestUpdate()},c.prototype.viewChange=function(){this.requestUpdate()},c.prototype.moveEnd=function(){this.requestUpdate()},c.prototype.destroy=function(){this.container.dispose();this._vectorTileContainer.destroy();
this._tileHandler.destroy()},c.prototype.takeScreenshot=function(a,b){return this.container?(a=v.adjustScreenshotSettings(a,b),this.container.takeScreenshot(a)):f.reject("Could not find an object capable of capturing screenshot!")},c.prototype.isUpdating=function(){var a=!0;return this._tileRequests.forEach(function(b){a=a&&b.isFulfilled()}),!a},c.prototype.acquireTile=function(a){var b=this,c=k.pool.acquire();c.set(a.level,a.row,a.col,a.world);a=this._tileHandler.getRefKey(c);var d=this.updateParameters.state.rotation,
e=this._tileHandler.getStyleRepository(),f=r.pool.acquire(c,a,this.layer.tileInfo,e,this._tileHandler.glyphMosaic,d);a=this._fetchQueue.push(f.key).then(function(a){f.setData(a.tileData,a.workerId,a.connection);f.once("attach",function(){return b.requestUpdate()});b._vectorTileContainer.addChild(f);b.notifyChange("updating")});return this._tileRequests.set(c.id,a),this.notifyChange("updating"),f},c.prototype.releaseTile=function(a){var b=a.key.id,c=this._tileRequests.get(b);c.isFulfilled()||c.cancel();
this._tileRequests["delete"](b);this._vectorTileContainer.removeChild(a);this.requestUpdate();a.once("detach",function(){return r.pool.release(a)});this.notifyChange("updating")},c.prototype._stop=function(){this._handles.removeAll();this._tileStrategy&&this._tileStrategy.destroy();this._vectorTileContainer&&(this._vectorTileContainer.removeAllChildren(),this.container.removeChild(this._vectorTileContainer));this._tileHandler&&this._tileHandler.stop();r.pool.prune();this._vectorTileContainer=this._tileHandler=
this._tileStrategy=this._tileInfoView=null},c.prototype._start=function(){var a=this;this._stop();this._handles.add(this.watch("layer.currentStyleInfo",function(){return a.attach()}));this._vectorTileContainer=new w;this.container.addChild(this._vectorTileContainer);this._tileInfoView=new l(this.layer.tileInfo,this.layer.fullExtent);this._tileStrategy=new p({cachePolicy:"keep",acquireTile:function(b){return a.acquireTile(b)},releaseTile:function(b){return a.releaseTile(b)},tileInfoView:this._tileInfoView});
this._fetchQueue=new q({tileInfoView:this._tileInfoView,process:function(b){return a._getTileData(b)}});this._tileHandler=new n(this.layer,function(){return a.requestUpdate()},window.devicePixelRatio||1,!0,this._tileInfoView);this._tileHandler.start().then(function(){a._vectorTileContainer.initialize(a._tileHandler.spriteMosaic,a._tileHandler.glyphMosaic,a.layer.tileInfo,a._tileInfoView);a.requestUpdate()})},c.prototype._getTileData=function(a){return this._tileHandler.getTileData(a,this.updateParameters.state.rotation)},
c}(c.declared(g));return m=b([c.subclass("esri.views.2d.layers.VectorTileLayerView2D")],m)});