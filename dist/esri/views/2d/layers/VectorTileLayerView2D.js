//>>built
require({cache:{"esri/views/2d/layers/LayerView2D":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/watchUtils ../../layers/LayerView".split(" "),function(h,v,p,f,m,d,a){h=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;return b.attached=!1,b.moving=!1,b.updateRequested=!1,b}return p(c,a),c.prototype.initialize=function(){var b=this;this.then(function(){b.requestUpdate()});
d.init(this,"suspended",function(e){b.container.visible=!e;!e&&b.updateRequested&&b.view.requestLayerViewUpdate(b)},!0);d.init(this,"fullOpacity",function(e){b.container.opacity=e},!0);var g=function(){this.notifyChange("rendering")}.bind(this);this.container.on("post-render",g);this.container.on("will-render",g)},c.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach());this.updateRequested=!1;this.layer=null},Object.defineProperty(c.prototype,"rendering",{get:function(){return this.isRendering()},
enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0}),c.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))},c.prototype.processUpdate=function(b){return this.isFulfilled()&&!this.isResolved()?void(this.updateRequested=!1):(this._set("updateParameters",b),void(this.updateRequested&&
!this.suspended&&(this.updateRequested=!1,this.update(b))))},c.prototype.isUpdating=function(){return!1},c.prototype.isRendering=function(){return this.attached&&(this.moving||this.container.renderRequested)},c.prototype.canResume=function(){var b=this.inherited(arguments),g=this.layer;if(b&&null!=g.minScale&&null!=g.minScale){var b=this.view.scale,e=g.minScale,g=g.maxScale,a=!e,c=!g;!a&&e>=b&&(a=!0);!c&&b>=g&&(c=!0);b=a&&c}return b},c}(m.declared(a));return f([m.property()],h.prototype,"attached",
void 0),f([m.property()],h.prototype,"container",void 0),f([m.property()],h.prototype,"moving",void 0),f([m.property({dependsOn:["moving"]})],h.prototype,"rendering",null),f([m.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],h.prototype,"suspended",void 0),f([m.property({readOnly:!0})],h.prototype,"updateParameters",void 0),f([m.property()],h.prototype,"updateRequested",void 0),f([m.property({dependsOn:["updateRequested","attached"]})],h.prototype,"updating",null),f([m.property()],
h.prototype,"view",void 0),h=f([m.subclass("esri.views.2d.layers.LayerView2D")],h)})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ./TileKey ./TileInfoView".split(" "),function(h,v,p,f,m,d){return function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return p(c,a),c.prototype.getTileParentId=function(a){a=m.pool.acquire(a);var b=0===a.level?null:m.getId(a.level-1,a.row>>1,a.col>>
1,a.world);return m.pool.release(a),b},c.prototype.getTileIdAtParent=function(a,b){b=m.pool.acquire(b);var g=this._infoByLevel[b.level];if(a.resolution<g.resolution)throw m.pool.release(b),Error("Cannot calculate parent tile. destination LOD's resolution "+a.resolution+" is not a parent resolution of "+g.resolution);if(a.resolution===g.resolution)return a=b.id,m.pool.release(b),a;g=b.level-a.level;if(0>g)throw m.pool.release(b),Error("Wrong way...!");a=m.getId(a.level,b.row>>g,b.col>>g,b.world);return m.pool.release(b),
a},c}(d)})},"esri/views/2d/tiling/TileInfoView":function(){define("require exports ./LODInfo ./TileKey ./TileSpan ./TileCoverage".split(" "),function(h,v,p,f,m,d){var a=function(){function a(b,a,e,c,n,d,f,l){this.x=b;this.ymin=a;this.ymax=e;this.invM=c;this.leftAdjust=n;this.rightAdjust=d;this.leftBound=f;this.rightBound=l}return a.create=function(b,c){b[1]>c[1]&&(l=[c,b],b=l[0],c=l[1]);l=b[0];b=b[1];var e=c[0];c=c[1];var g=e-l,n=c-b,n=0!==n?g/n:0,d=(Math.ceil(b)-b)*n,f=(Math.floor(b)-b)*n;return new a(l,
Math.floor(b),Math.ceil(c),n,0>g?d:f,0>g?f:d,0>g?e:l,0>g?l:e);var l},a.prototype.incrRow=function(){this.x+=this.invM},a.prototype.getLeftCol=function(){return Math.max(this.x+this.leftAdjust,this.leftBound)},a.prototype.getRightCol=function(){return Math.min(this.x+this.rightAdjust,this.rightBound)},a}(),c=[[0,0],[0,0],[0,0],[0,0]];return function(){function l(b,a){var e=this;this.tileInfo=b;this.fullExtent=a;this.scales=[];this._lodInfos=null;this._infoByScale={};this._infoByLevel={};var c=b.lods.slice();
c.sort(function(b,a){return a.scale-b.scale});var g=this._lodInfos=c.map(function(e){return p.create(b,e,a)});c.forEach(function(b,a){e._infoByLevel[b.level]=g[a];e._infoByScale[b.scale]=g[a];e.scales[a]=b.scale},this);this._wrap=b.spatialReference.isWrappable}return l.prototype.getTileBounds=function(b,a){var e=this._infoByLevel[a.level];return e?e.getTileBounds(b,a):b},l.prototype.getTileCoords=function(b,a){var e=this._infoByLevel[a.level];return e?e.getTileCoords(b,a):b},l.prototype.getTileCoverage=
function(b){var g,e,t,n=this.getClosestInfoForScale(b.scale),l=d.pool.acquire(n),f=this._wrap;g=+(1/0);var q=-(1/0),w=l.spans;c[0][0]=c[0][1]=c[1][1]=c[3][0]=0;c[1][0]=c[2][0]=b.size[0];c[2][1]=c[3][1]=b.size[1];for(var k=0;k<c.length;k++){var r=c[k];b.toMap(r,r);r[0]=n.getColumnForX(r[0]);r[1]=n.getRowForY(r[1])}b=[];r=3;for(k=0;4>k;k++){if(c[k][1]!==c[r][1]){var u=a.create(c[k],c[r]);g=Math.min(u.ymin,g);q=Math.max(u.ymax,q);void 0===b[u.ymin]&&(b[u.ymin]=[]);b[u.ymin].push(u)}r=k}if(null==g||null==
q||100<q-g)return null;for(r=[];q>g;){null!=b[g]&&(r=r.concat(b[g]));e=+(1/0);t=-(1/0);for(k=r.length-1;0<=k;k--)u=r[k],e=Math.min(e,u.getLeftCol()),t=Math.max(t,u.getRightCol());if(e=Math.floor(e),t=Math.floor(t),g>=n.first[1]&&g<=n.last[1])if(f)if(n.size[0]<n.worldSize[0])for(u=Math.floor(t/n.worldSize[0]),k=Math.floor(e/n.worldSize[0]);u>=k;k++)w.push(new m(g,Math.max(n.getFirstColumnForWorld(k),e),Math.min(n.getLastColumnForWorld(k),t)));else w.push(new m(g,e,t));else e>n.last[0]||t<n.first[0]||
(e=Math.max(e,n.first[0]),t=Math.min(t,n.last[0]),w.push(new m(g,e,t)));g+=1;for(k=r.length-1;0<=k;k--)u=r[k],u.ymax>=g?u.incrRow():r.splice(k,1)}return l},l.prototype.getTileIdAtParent=function(b,a){a=f.pool.acquire(a);var e=this._infoByLevel[a.level];if(b.resolution<e.resolution)throw Error("Cannot calculate parent tile. destination LOD's resolution "+b.resolution+" is not a parent resolution of "+e.resolution);return b.resolution===e.resolution?a.id:f.getId(b.level,Math.floor(a.row*e.resolution/
b.resolution+.01),Math.floor(a.col*e.resolution/b.resolution+.01),a.world)},l.prototype.getTileParentId=function(b){b=f.pool.acquire(b);var a=this._lodInfos.indexOf(this._infoByLevel[b.level])-1;if(0>a)return f.pool.release(b),null;a=this.getTileIdAtParent(this._lodInfos[a],b);return f.pool.release(b),a},l.prototype.getTileResolution=function(b){return(b=this._infoByLevel[b.level])?b.resolution:-1},l.prototype.getTileScale=function(b){return(b=this._infoByLevel[b.level])?b.scale:-1},l.prototype.intersects=
function(b,a){var e=f.pool.acquire(a);a=this._infoByLevel[e.level];var c=b.lodInfo;if(c.resolution>a.resolution){var g=f.pool.acquire(this.getTileIdAtParent(c,e)),d=c.denormalizeCol(g.col,g.world);a=b.spans.some(function(a){return a.row===g.row&&a.colFrom<=d&&a.colTo>=d});return f.pool.release(e),f.pool.release(g),a}if(c.resolution<a.resolution){var l=b.spans.reduce(function(a,b){return a[0]=Math.min(a[0],b.row),a[1]=Math.max(a[1],b.row),a[2]=Math.min(a[2],b.colFrom),a[3]=Math.max(a[3],b.colTo),a},
[+(1/0),-(1/0),+(1/0),-(1/0)]);b=l[0];var m=l[1],w=l[2],l=l[3],k=a.denormalizeCol(e.col,e.world),r=c.getColumnForX(a.getXForColumn(k)),u=c.getRowForY(a.getYForRow(e.row)),k=c.getColumnForX(a.getXForColumn(k+1))-1;a=c.getRowForY(a.getYForRow(e.row+1))-1;return f.pool.release(e),!(r>l||w>k||u>m||b>a)}var h=c.denormalizeCol(e.col,e.world);a=b.spans.some(function(a){return a.row===e.row&&a.colFrom<=h&&a.colTo>=h});return f.pool.release(e),a},l.prototype.getClosestInfoForScale=function(a){var b=this.scales;
return this._infoByScale[a]?this._infoByScale[a]:(a=b.reduce(function(b,c,g,l){return Math.abs(c-a)<Math.abs(b-a)?c:b},b[0]),this._infoByScale[a])},l}()})},"esri/views/2d/tiling/LODInfo":function(){define(["require","exports","./TileKey","../../../geometry/support/spatialReferenceUtils"],function(h,v,p,f){function m(d,a,c){return d[0]=a,d[1]=c,d}return function(){function d(a,c,l,b,g,e,d,n,f,m,q,w){this.level=a;this.resolution=c;this.scale=l;this.origin=b;this.first=g;this.last=e;this.size=d;this.norm=
n;this.worldStart=f;this.worldEnd=m;this.worldSize=q;this.wrap=w}return d.create=function(a,c,l){var b=f.getInfo(a.spatialReference),g=[a.origin.x,a.origin.y],e=[a.size[0]*c.resolution,a.size[1]*c.resolution],t=[-(1/0),-(1/0)],n=[+(1/0),+(1/0)],h=[+(1/0),+(1/0)];l&&(m(t,Math.max(0,Math.floor((l.xmin-g[0])/e[0])),Math.max(0,Math.floor((g[1]-l.ymax)/e[1]))),m(n,Math.max(0,Math.floor((l.xmax-g[0])/e[0])),Math.max(0,Math.floor((g[1]-l.ymin)/e[1]))),m(h,n[0]-t[0]+1,n[1]-t[1]+1));var p,q,w,k;return b?(p=
[Math.ceil(Math.round(2*b.origin[1]/c.resolution)/a.size[0]),h[1]],q=[Math.floor((b.origin[0]-g[0])/e[0]),t[1]],w=[p[0]-q[0]-1,n[1]],k=!0):(q=t,w=n,p=h,k=!1),new d(c.level,c.resolution,c.scale,g,t,n,h,e,q,w,p,k)},d.prototype.normalizeCol=function(a){if(!this.wrap)return a;var c=this.worldSize[0];return 0>a?c-1-Math.abs((a+1)%c):a%c},d.prototype.denormalizeCol=function(a,c){return this.wrap?this.worldSize[0]*c+a:a},d.prototype.getWorldForColumn=function(a){return this.wrap?Math.floor(a/this.worldSize[0]):
0},d.prototype.getFirstColumnForWorld=function(a){return a*this.worldSize[0]+this.first[0]},d.prototype.getLastColumnForWorld=function(a){return a*this.worldSize[0]+this.first[0]+this.size[0]-1},d.prototype.getColumnForX=function(a){return(a-this.origin[0])/this.norm[0]},d.prototype.getXForColumn=function(a){return this.origin[0]+a*this.norm[0]},d.prototype.getRowForY=function(a){return(this.origin[1]-a)/this.norm[1]},d.prototype.getYForRow=function(a){return this.origin[1]-a*this.norm[1]},d.prototype.getTileBounds=
function(a,c){c=p.pool.acquire(c);var l=this.getXForColumn(this.denormalizeCol(c.col,c.world)),b=this.getYForRow(c.row+1),g=this.getXForColumn(this.denormalizeCol(c.col,c.world)+1),e=this.getYForRow(c.row);return a[0]=l,a[1]=b,a[2]=g,a[3]=e,p.pool.release(c),a},d.prototype.getTileCoords=function(a,c){c=p.pool.acquire(c);return m(a,this.getXForColumn(this.denormalizeCol(c.col,c.world)),this.getYForRow(c.row)),p.pool.release(c),a},d}()})},"esri/views/2d/tiling/TileSpan":function(){define(["require",
"exports","../../../core/ObjectPool"],function(h,v,p){h=function(){return function(f,m,d){this.row=f;this.colFrom=m;this.colTo=d}}();return h.pool=new p(h,!0),h})},"esri/views/2d/tiling/TileCoverage":function(){define(["require","exports","../../../core/ObjectPool","../../../core/ArrayPool","./TileSpan"],function(h,v,p,f,m){h=function(){function d(a){this.lodInfo=a;this.spans=f.acquire()}return d.prototype.release=function(){for(var a=0,c=this.spans;a<c.length;a++)m.pool.release(c[a]);f.release(this.spans)},
d.prototype.forEach=function(a,c){var l=this.spans,b=this.lodInfo,g=b.level;if(0!==l.length)for(var e=0;e<l.length;e++)for(var d=l[e],n=d.row,f=d.colTo,d=d.colFrom;f>=d;d++)a.call(c,g,n,b.normalizeCol(d),b.getWorldForColumn(d))},d}();return h.pool=new p(h,!0),h})},"esri/views/2d/tiling/TileStrategy":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./TileKey"],function(h,v,p,f){var m=new f(0,0,0,0),d=new Map,a=[],c=[];return function(){function l(a){this._previousResolution=
Number.POSITIVE_INFINITY;this.cachePolicy="keep";this.tileIndex=new Map;this.tiles=[];this.acquireTile=a.acquireTile;this.releaseTile=a.releaseTile;this.tileInfoView=a.tileInfoView;a.cachePolicy&&(this.cachePolicy=a.cachePolicy)}return l.prototype.destroy=function(){this.tileIndex.clear()},l.prototype.update=function(b){var g=this,e=this.tileIndex,l=this.tileInfoView.getTileCoverage(b.state);if(l){var n=l.spans,f=l.lodInfo,h=f.level,q=b.state.resolution,p=!b.stationary&&q>this._previousResolution;
this._previousResolution=q;this.tiles.length=0;d.clear();var k=0,r=0;if(0<n.length)for(var u=0;u<n.length;u++){b=n[u];for(var A=b.row,v=b.colTo,x=b.colFrom;v>=x;x++)k++,b=m.set(h,A,f.normalizeCol(x),f.getWorldForColumn(x)).id,e.has(b)?(q=e.get(b),q.attached?(d.set(b,q),r++):q.attached||p||this._addParentTile(b,d)):(q=this.acquireTile(m),this.tileIndex.set(b,q),p||this._addParentTile(b,d))}var B=r===k;c.length=0;a.length=0;e.forEach(function(b,e){if(m.set(e),!d.has(e)){var k=g.tileInfoView.intersects(l,
m);!k||!p&&B?"purge"===g.cachePolicy?a.push(e):(m.level>h||!k)&&a.push(e):b.attached?c.push(e):p&&a.push(e)}});for(n=0;n<c.length;n++)b=c[n],(q=e.get(b))&&q.attached&&d.set(b,q);for(n=0;n<a.length;n++)b=a[n],q=e.get(b),this.releaseTile(q),e["delete"](b);d.forEach(function(a){return g.tiles.push(a)});c.length=0;a.length=0;d.clear()}},l.prototype._addParentTile=function(a,c){for(var b=null;a=this.tileInfoView.getTileParentId(a);)if(this.tileIndex.has(a)&&(b=this.tileIndex.get(a),b&&b.attached)){c.has(b.key.id)||
c.set(b.key.id,b);break}},l}()})},"esri/views/2d/tiling/TileQueue":function(){define(["require","exports","../../../core/QueueProcessor"],function(h,v,p){function f(a,d){return a.length=0,d.forEach(function(b){return a.push(b)}),a}var m=new Set,d=[],a=new Map;return function(){function c(a){var b=this;this.tileInfoView=a.tileInfoView;this._queue=new p({concurrency:6,process:a.process,peeker:function(a){return b._peek(a)}})}return Object.defineProperty(c.prototype,"length",{get:function(){return this._queue.length},
enumerable:!0,configurable:!0}),c.prototype.clear=function(){this._queue.clear()},c.prototype.find=function(a,b){return this._queue.find(a)},c.prototype.has=function(a){return this._queue.has(a)},c.prototype.pause=function(){return this._queue.pause()},c.prototype.push=function(a){return this._queue.push(a)},c.prototype.reset=function(){return this._queue.reset()},c.prototype.resume=function(){return this._queue.resume()},c.prototype._peek=function(c){var b=this;if(!this.state)return c[0];var g=this.tileInfoView,
e=Number.NEGATIVE_INFINITY,l=Number.POSITIVE_INFINITY;c.forEach(function(c){var k=b.tileInfoView.getTileScale(c);a.has(k)||(a.set(k,[]),e=Math.max(k,e),l=Math.min(k,l));a.get(k).push(c);m.add(k)});var n=this.state.scale;a.has(n)||(f(d,m),d.sort(),n=d.reduce(function(a,b,c,e){return Math.abs(b-n)<Math.abs(a-n)?b:a},d[0]));n=Math.min(n,e);n=Math.max(n,l);c=a.get(n);var h=g.getClosestInfoForScale(n),p=h.getColumnForX(this.state.center[0]),q=h.getRowForY(this.state.center[1]);return c.sort(function(a,
b){var c=h.denormalizeCol(a.col,a.world),e=h.denormalizeCol(b.col,b.world);return Math.sqrt((p-c)*(p-c)+(q-a.row)*(q-a.row))-Math.sqrt((p-e)*(p-e)+(q-b.row)*(q-b.row))}),m.clear(),a.clear(),c[0]},c}()})},"esri/core/QueueProcessor":function(){define(["require","exports","dojo/Deferred","./Queue"],function(h,v,p,f){var m={};return function(){function d(a){this._apiPromises=new Map;this._resolvingPromises=new Map;this._isPaused=!1;this.concurrency=1;a.concurrency&&(this.concurrency=a.concurrency);this._queue=
new f(a.peeker?{peeker:a.peeker}:void 0);this.process=a.process}return Object.defineProperty(d.prototype,"length",{get:function(){return this._resolvingPromises.size+this._queue.length},enumerable:!0,configurable:!0}),d.prototype.clear=function(){this._queue.clear();var a=[];this._resolvingPromises.forEach(function(c){return a.push(c)});this._resolvingPromises.clear();a.forEach(function(a){return a.cancel()});a.length=0;this._apiPromises.forEach(function(c){return a.push(c)});this._apiPromises.clear();
a.forEach(function(a){return a.cancel()});this._isPaused=!1},d.prototype.find=function(a,c){var d=this,b=void 0;return this._apiPromises.forEach(function(g,e){a.call(c,e)&&(b=d._apiPromises.get(e).promise)}),b},d.prototype.has=function(a){return this._apiPromises.has(a)},d.prototype.pause=function(){this._isPaused=!0},d.prototype.push=function(a){var c=this;if(this._apiPromises.has(a))return this._apiPromises.get(a).promise;var d=new p(function(b){c._resolvingPromises.has(a)?c._resolvingPromises.get(a).cancel(b):
(c._remove(a),c._scheduleNext())});return this._add(a,d),this._scheduleNext(),d.promise},d.prototype.reset=function(){var a=[];this._resolvingPromises.forEach(function(c){return a.push(c)});this._resolvingPromises.clear();a.forEach(function(a){return a.cancel(m)})},d.prototype.resume=function(){this._isPaused=!1;this._scheduleNext()},d.prototype._scheduleNext=function(){this._isPaused||this._next()},d.prototype._next=function(){this._resolvingPromises.size!==this.concurrency&&this._process(this._queue.pop())},
d.prototype._process=function(a){var c=this;if(null!=a){var d=this._apiPromises.get(a),b=this.process(a);b&&"function"==typeof b.then?(this._resolvingPromises.set(a,b),b.then(function(b){d.resolve(b);c._remove(a);c._scheduleNext()},function(b){b===m?c._process(a):(d.reject(b),c._remove(a),c._scheduleNext())})):(d.resolve(b),this._remove(a),this._scheduleNext())}},d.prototype._add=function(a,c){this._apiPromises.set(a,c);this._queue.push(a)},d.prototype._remove=function(a){this._queue.remove(a);this._apiPromises["delete"](a);
this._resolvingPromises["delete"](a)},d}()})},"esri/core/Queue":function(){define(["require","exports"],function(h,v){return function(){function h(f){this._items=[];this._itemSet=new Set;this._peeker=function(f){return f[0]};this._length=0;f&&f.peeker&&(this._peeker=f.peeker)}return Object.defineProperty(h.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),h.prototype.clear=function(){this._itemSet.clear();this._length=this._items.length=0},h.prototype.peek=function(){return 0!==
this._length?this._peeker(this._items):void 0},h.prototype.push=function(f){this.contains(f)||this._add(f)},h.prototype.contains=function(f){return 0<this._length&&this._itemSet.has(f)},h.prototype.pop=function(){if(0!==this._length){var f=this.peek();return this._remove(f),f}},h.prototype.remove=function(f){this.contains(f)&&this._remove(f)},h.prototype._add=function(f){this._items.push(f);this._itemSet.add(f);this._length++},h.prototype._remove=function(f){this._itemSet["delete"](f);this._items.splice(this._items.indexOf(f),
1);this._length--},h}()})},"esri/views/vectorTiles/VectorTileContainer":function(){define("require exports ../../core/tsSupport/extendsHelper dojo/has ../../core/libs/gl-matrix/vec3 ../../core/libs/gl-matrix/mat4 ../2d/engine/Container ./renderers/Renderer ./GeometryUtils".split(" "),function(h,v,p,f,m,d,a,c,l){return function(a){function b(){var b=a.call(this)||this;return b.isInitialized=!1,b._displayWidth=0,b._displayHeight=0,b._tileCoordinateScale=m.create(),b._orientationVec=m.create(),b._displayScale=
m.create(),b._orientationVec.set([0,0,1]),b._defaultTransform=d.create(),b}return p(b,a),b.prototype.initialize=function(a,b,d,f){this._renderer=new c;this._renderer.initialize(a,b);this._tileInfoView=f;this._tileInfo=d;this.isInitialized=!0},b.prototype.destroy=function(){this._renderer&&(this._renderer.dispose(),this._renderer=null)},b.prototype.prepareChildrenRenderParameters=function(a){var b=a.state;return b&&this._tileInfo&&this.isInitialized?(a.displayLevel=this._tileInfo.scaleToZoom(b.scale),
a.requiredLevel=this._tileInfoView.getClosestInfoForScale(b.scale).level,a.renderer=this._renderer,a):a},b.prototype.renderChildren=function(b){if(0!==this.children.length&&this.isInitialized&&b&&b.state){this.sortChildren(function(a,b){return a.key.level-b.key.level});for(var c=this.children.length,e=1;c>=e;e++){var d=this.children[e-1];d.attached&&(d.stencilData.reference=e,d.stencilData.mask=255)}this._updateTilesTransform(b.state,this._tileInfoView.getClosestInfoForScale(b.state.scale).level);
c=b.context;if(c.setDepthWriteEnabled(!0),this._renderer.setStateParams(b.state,b.devicePixelRatio,b.displayLevel),this._renderer.drawClippingMasks(c,this.children),c.setStencilWriteMask(0),c.setBlendFunctionSeparate(1,771,1,771),c.setStencilOp(7680,7680,7681),c.setDepthFunction(515),c.setBlendingEnabled(!1),c.setStencilTestEnabled(!0),c.setDepthTestEnabled(!0),c.setDepthWriteEnabled(!0),b.drawphase=0,a.prototype.renderChildren.call(this,b),c.setDepthWriteEnabled(!1),c.setBlendingEnabled(!0),b.drawphase=
1,a.prototype.renderChildren.call(this,b),b.drawphase=2,a.prototype.renderChildren.call(this,b),c.setStencilTestEnabled(!1),c.setDepthTestEnabled(!1),f("esri-vector-tiles-debug"))for(b=0,e=this.children;b<e.length;b++)d=e[b],d.attached&&d.visible&&this._renderer.renderTileInfo(c,d);this._renderer.needsRedraw()&&this.requestRender()}},b.prototype.removeAllChildren=function(){for(var b=0;b<this.children.length;b++)this.children[b].dispose();a.prototype.removeAllChildren.call(this)},b.prototype._updateTilesTransform=
function(a,b){var c=1/a.width,e=1/a.height,d=[0,0];this._calculateRelativeViewProjMat(this._tileInfo.lods[b].resolution,a.resolution,a.rotation,this._tileInfo.size[1],4096,a.width,a.height,this._defaultTransform);for(var f=0,g=this.children;f<g.length;f++){var k=g[f];a.toScreen(d,k.coords);d[1]=a.height-d[1];k.tileTransform.displayCoord[0]=2*d[0]*c-1;k.tileTransform.displayCoord[1]=2*d[1]*e-1;k.key.level===b&&4096===k.coordRange?k.tileTransform.transform.set(this._defaultTransform):this._calculateRelativeViewProjMat(this._tileInfo.lods[k.key.level].resolution,
a.resolution,a.rotation,this._tileInfo.size[1],k.coordRange,a.width,a.height,k.tileTransform.transform)}},b.prototype._calculateRelativeViewProjMat=function(a,b,c,f,g,h,m,k){var e=.125;512!==f&&4096!==g&&(e=f/g);a=a/b*e;this._tileCoordinateScale.set([a,a,1]);(h!==this._displayWidth||m!==this._displayHeight)&&(this._displayScale.set([2/h,-2/m,1]),this._displayWidth=h,this._displayHeight=m);d.identity(k);d.scale(k,k,this._tileCoordinateScale);d.rotate(k,k,-c*l.C_DEG_TO_RAD,this._orientationVec);d.scale(k,
k,this._displayScale);d.transpose(k,k)},b}(a)})},"*noref":1}});
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/HandleRegistry ../../../core/promiseUtils ./LayerView2D ../engine/StageGL ../tiling/TileInfoViewPOT ../tiling/TileStrategy ../tiling/TileKey ../tiling/TileQueue ../../../views/vectorTiles/TileHandler ../../../views/vectorTiles/VectorTileContainer ../../../views/vectorTiles/VectorTileDisplayObject ../../support/screenshotUtils".split(" "),function(h,
v,p,f,m,d,a,c,l,b,g,e,t,n,z,y,q){h=function(c){function f(){var a=null!==c&&c.apply(this,arguments)||this;return a._handles=new d,a._fetchQueue=null,a._tileRequests=new Map,a.container=new l,a}return p(f,c),f.prototype.hitTest=function(a,b){return null},f.prototype.update=function(a){if(this._vectorTileContainer&&this._vectorTileContainer.isInitialized){if(a.devicePixelRatio!==this._tileHandler.devicePixelRatio)return void this._start();this._fetchQueue.pause();this._fetchQueue.state=a.state;this._tileStrategy.update(a);
this._fetchQueue.resume();for(var b=0,c=this._vectorTileContainer.children;b<c.length;b++)this._tileHandler.updateTile(c[b],a);this.notifyChange("updating")}},f.prototype.attach=function(){this._start()},f.prototype.detach=function(){this._stop()},f.prototype.moveStart=function(){this.requestUpdate()},f.prototype.viewChange=function(){this.requestUpdate()},f.prototype.moveEnd=function(){this.requestUpdate()},f.prototype.destroy=function(){this.container.dispose();this._vectorTileContainer.destroy();
this._tileHandler.destroy()},f.prototype.takeScreenshot=function(b,c){return this.container?(b=q.adjustScreenshotSettings(b,c),this.container.takeScreenshot(b)):a.reject("Could not find an object capable of capturing screenshot!")},f.prototype.isUpdating=function(){var a=!0;return this._tileRequests.forEach(function(b){a=a&&b.isFulfilled()}),!a},f.prototype.acquireTile=function(a){var b=this,c=e.pool.acquire();c.set(a.level,a.row,a.col,a.world);a=this._tileHandler.getRefKey(c);var d=this.updateParameters.state.rotation,
f=this._tileHandler.getStyleRepository(),g=y.pool.acquire(c,a,this.layer.tileInfo,f,this._tileHandler.glyphMosaic,d);a=this._fetchQueue.push(g.key).then(function(a){g.setData(a.tileData,a.workerId,a.connection);g.once("attach",function(){return b.requestUpdate()});b._vectorTileContainer.addChild(g);b.notifyChange("updating")});return this._tileRequests.set(c.id,a),this.notifyChange("updating"),g},f.prototype.releaseTile=function(a){var b=a.key.id,c=this._tileRequests.get(b);c.isFulfilled()||c.cancel();
this._tileRequests["delete"](b);this._vectorTileContainer.removeChild(a);this.requestUpdate();a.once("detach",function(){return y.pool.release(a)});this.notifyChange("updating")},f.prototype._stop=function(){this._handles.removeAll();this._tileStrategy&&this._tileStrategy.destroy();this._vectorTileContainer&&(this._vectorTileContainer.removeAllChildren(),this.container.removeChild(this._vectorTileContainer));this._tileHandler&&this._tileHandler.stop();y.pool.prune();this._vectorTileContainer=this._tileHandler=
this._tileStrategy=this._tileInfoView=null},f.prototype._start=function(){var a=this;this._stop();this._handles.add(this.watch("layer.currentStyleInfo",function(){return a.attach()}));this._vectorTileContainer=new z;this.container.addChild(this._vectorTileContainer);this._tileInfoView=new b(this.layer.tileInfo,this.layer.fullExtent);this._tileStrategy=new g({cachePolicy:"keep",acquireTile:function(b){return a.acquireTile(b)},releaseTile:function(b){return a.releaseTile(b)},tileInfoView:this._tileInfoView});
this._fetchQueue=new t({tileInfoView:this._tileInfoView,process:function(b){return a._getTileData(b)}});this._tileHandler=new n(this.layer,function(){return a.requestUpdate()},window.devicePixelRatio||1,!0,this._tileInfoView);this._tileHandler.start().then(function(){a._vectorTileContainer.initialize(a._tileHandler.spriteMosaic,a._tileHandler.glyphMosaic,a.layer.tileInfo,a._tileInfoView);a.requestUpdate()})},f.prototype._getTileData=function(a){return this._tileHandler.getTileData(a,this.updateParameters.state.rotation)},
f}(m.declared(c));return h=f([m.subclass("esri.views.2d.layers.VectorTileLayerView2D")],h)});