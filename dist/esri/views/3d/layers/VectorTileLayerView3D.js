//>>built
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper dojo/promise/all ../../../core/accessorSupport/decorators ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../vectorTiles/SchemaHelper ../../vectorTiles/TileHandler ../../vectorTiles/renderers/Renderer ../../layers/LayerView ./support/LayerViewUpdatingPercentage ../terrain/terrainUtils".split(" "),function(a,w,l,g,m,f,h,k,n,p,q,r,t,u,v){a=function(a){function e(b){b=a.call(this)||
this;return b._isUpdating=!1,b.minDataLevel=0,b.maxDataLevel=1/0,b}return l(e,a),e.prototype.initialize=function(){var b,d=this,c=v.checkIfTileInfoSupportedForView(this.layer.tileInfo256,this.layer.fullExtent,this.view.spatialReference,this.view.basemapTerrain.manifold);if(c){var a={layer:this.layer,error:c},e=void 0;switch(c.name){case "tilingscheme:local-gcs-not-supported":e=new h("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",a);break;case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":e=
new h("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",a);break;default:e=new h("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",a)}this.addResolvingPromise(k.reject(e))}else b=n.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){var b=d.view.basemapTerrain.tilingScheme.pixelSize[0];d.schemeHelper=new p(b,d.view.spatialReference.isWGS84);var c;if(c=
256===b?d.layer.tileInfo256:d.view.spatialReference.isWGS84?d.layer.compatibleTileInfo512:d.layer.tileInfo,!d.view.basemapTerrain.tilingScheme.compatibleWith(c))return b=new h("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface"),k.reject(b)});c=this.layer;c.tileInfo&&0<c.tileInfo.lods.length&&(this.minDataLevel=c.tileInfo.lods[0].level,this.maxDataLevel=c.tileInfo.lods[c.tileInfo.lods.length-1].level);var f,c=this._initializeTileHandler();
this.tileHandler=c[0];this.renderer=c[1];this._tileHandlerPromise=f=c[2];this.watch("layer.currentStyleInfo",function(){var b,c,a;d._tileHandlerPromise.isFulfilled()||d._tileHandlerPromise.cancel("cancel");a=d._initializeTileHandler();b=a[0];c=a[1];a=a[2];d._tileHandlerPromise=f;a.then(function(){var a=d.tileHandler;d.renderer=c;d.tileHandler=b;d.emit("data-changed");a.destroy()})});b=m([b,f]);this.addResolvingPromise(b)},e.prototype.destroy=function(){this.renderer=null;this.tileHandler.destroy();
this.tileHandler=null},Object.defineProperty(e.prototype,"isTransparent",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.getTileUrl=function(b,a,c){return this.layer.getTileUrl(b,a,c)},e.prototype.isUpdating=function(){return this._isUpdating},e.prototype._evaluateUpdatingState=function(b){this._isUpdating=!!b;this.notifyChange("updating")},e.prototype._initializeTileHandler=function(){var b=new q(this.layer,function(){},1),a=new r,c=b.start();return c.then(function(){a.initialize(b.spriteMosaic,
b.glyphMosaic,!1)}),[b,a,c]},e}(f.declared(t,u));return g([f.property()],a.prototype,"view",void 0),g([f.property()],a.prototype,"layer",void 0),g([f.property({readOnly:!0})],a.prototype,"isTransparent",null),g([f.property()],a.prototype,"updatingPercentageValue",void 0),a=g([f.subclass("esri.views.3d.layers.VectorTileLayerView3D")],a)});