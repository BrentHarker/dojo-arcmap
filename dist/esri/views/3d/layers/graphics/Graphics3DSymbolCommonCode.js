//>>built
define("require exports ../../../../geometry/Point ../../../../symbols/callouts/calloutUtils ../../../../geometry/support/mathUtils ./graphicUtils ../../support/projectionUtils ../../lib/glMatrix ../../webgl-engine/lib/Object3D".split(" "),function(C,d,y,M,D,E,v,F,N){function z(b,a,e,c){var g=0,q=a.z||0,f=0,h=e.mode,d=e.offset||0;return"on-the-ground"===h?(f=b.getElevation(a,"ground")||0,g=f,c&&(c.verticalDistanceToGround=0,c.terrainElevation=f)):"relative-to-ground"===h?(f=b.getElevation(a,"ground")||
0,g=d,null==e.featureExpression&&(g+=q),c&&(c.verticalDistanceToGround=g,c.terrainElevation=f),g+=f):"relative-to-scene"===h?(f=b.getElevation(a,"scene")||0,g=d,c&&(c.verticalDistanceToGround=g,c.terrainElevation=f),g+=f):"absolute-height"===h&&(g=q+d,c&&(f=b.getElevation(a,"ground")||0,c.verticalDistanceToGround=g-f,c.terrainElevation=f)),g}function G(b,a,e,c,g,d,f){var h=f.mode,q=f.offset,m=0,l=0,n=0;r.spatialReference=b.spatialReference;e*=3;g*=3;for(var k=0;d>k;++k)r.x=a[e+0],r.y=a[e+1],r.z=a[e+
2],"on-the-ground"===h?(m=b.getElevation(r)||0,l=m,n+=m):"relative-to-ground"===h?(m=b.getElevation(r)||0,l=m+q,null==f.featureExpression&&(l+=r.z),n+=m):"relative-to-scene"===h?(m=b.getElevation(r,"scene")||0,l=m+q,n+=m):"absolute-height"===h&&(l=r.z+q),c[g+0]=a[e+0],c[g+1]=a[e+1],c[g+2]=l,e+=3,g+=3;return n/=d,{terrainElevation:n}}function H(b,a,e,c,g){var d,f=0;if(b.metadata.usesVerticalDistanceToGround)f=z(g,a,e,u),E.updateVertexAttributeAuxpos1w(b,u.verticalDistanceToGround),d=u.terrainElevation;
else{var h="absolute-height"!==e.mode,f=z(g,a,e,h?u:null);h&&(d=u.terrainElevation)}e=b.getObjectTransformation();k[0]=a.x;k[1]=a.y;k[2]=f;return v.computeLinearTransformation(a.spatialReference,k,e,c)?b.setObjectTransformation(e):console.warn("Could not locate symbol object properly, it might be misplaced"),{terrainElevation:d}}function I(b){for(var a=0,e=b.length-1,c=0;e>c;c++)a+=b[c][0]*b[c+1][1]-b[c+1][0]*b[c][1];return 0<=a}function w(b,a,e,c,g,d){c*=3;for(var f=0;g>f;++f){var h=b[a++];e[c++]=
h[0];e[c++]=h[1];e[c++]=d?h[2]:0}return c/3}function A(b,a){for(var e=b.length,c=Array(e),g=Array(e),d=Array(e),f=0,h=0,k=0,m=0,l=0;e>l;++l)m+=b[l].length;for(var m=new Float64Array(3*m),n=0,r=e-1;0<=r;r--){var p=b[r];if(I(p))c[f++]=p;else{for(var t=p.length,l=0;f>l;++l)t+=c[l].length;l={index:n,pathLengths:Array(f+1),count:t,holeIndices:Array(f)};l.pathLengths[0]=p.length;0<p.length&&(d[k++]={index:n,count:p.length});n=w(p,0,m,n,p.length,a);for(p=0;f>p;++p)t=c[p],l.holeIndices[p]=n,l.pathLengths[p+
1]=t.length,0<t.length&&(d[k++]={index:n,count:t.length}),n=w(t,0,m,n,t.length,a);f=0;0<l.count&&(g[h++]=l)}}for(p=0;f>p;++p)t=c[p],0<t.length&&(d[k++]={index:n,count:t.length}),n=w(t,0,m,n,t.length,a);return e>h&&(g.length=h),e>k&&(d.length=k),{vertexData:m,polygons:g,outlines:d}}function J(b,a,e,c,g){a*=3;c*=3;for(var d=0;g>d;++d)e[c++]=b[a++],e[c++]=b[a++],e[c++]=b[a++]}function B(b,a,e,c,g,d,f){v.bufferToBuffer(b,e,a,c,d,g,f)}function x(b,a,e){v.pointToVector(b,a,e)}function K(b,a){return!(b[0]>
a[3]||b[0]<a[0]||b[1]>a[4]||b[1]<a[1])}function L(b,a){return!(a[0]>b[3]||a[3]<b[0]||a[1]>b[4]||a[4]<b[1])}Object.defineProperty(d,"__esModule",{value:!0});C=F.mat4d;var k=F.vec3d.create(),O=C.identity(),r=new y({x:0,y:0,z:0,spatialReference:null});d.createStageObjectForPoint=function(b,a,e,c,g,d,f,h,r,m,l){var n=a?a.length:0,q=this._context.clippingExtent;if(x(b,k,this._context.elevationProvider.spatialReference),q&&!K(k,q))return null;x(b,k,this._context.renderSpatialReference);q=this._context.localOriginFactory.getOrigin(k);
f=new N({castShadow:!1,metadata:{layerId:h,graphicId:r,usesVerticalDistanceToGround:!!m},idHint:f});for(h=0;n>h;h++)f.addGeometry(a[h],e[h],c?c[h]:O,g,q,l);b=H(f,b,d,this._context.renderSpatialReference,this._context.elevationProvider);return{object:f,terrainElevation:b.terrainElevation}};d.extendPointGraphicElevationInfo=function(b,a,e){b=b.elevationInfo;e=e.spatialReference;x(a,k,e);b.centerPointInElevationSR=new y({x:k[0],y:k[1],z:a.hasZ?k[2]:0,spatialReference:e})};d.placePointOnPolyline=function(b){var a=
b.paths[0],a=D.getPointOnPath(a,D.getPathLength(a)/2);return new y({x:a[0],y:a[1],z:a[2],spatialReference:b.spatialReference})};d.placePointOnPolygon=function(b){return E.computeCentroid(b)};d.computeElevation=z;d.applyElevation=G;d.setObjectElevation=H;d.getSingleSizeDriver=function(b,a){return void 0===a&&(a=0),isFinite(b[a])?b[a]:null};d.isCounterClockwise=I;d.copyPointData=w;d.copyPathData=A;d.copyVertices=J;d.chooseOrigin=function(b,a,e,c){a=Math.floor(a+(e-1)/2);c[0]=b[3*a+0];c[1]=b[3*a+1];
c[2]=b[3*a+2]};d.subtractCoordinates=function(b,a,e,c){a*=3;for(var d=0;e>d;++d)b[a++]-=c[0],b[a++]-=c[1],b[a++]-=c[2]};d.setZ=function(b,a,e,c){a*=3;for(var d=0;e>d;++d)b[a+2]=c,a+=3};d.offsetZ=function(b,a,e,c){a*=3;for(var d=0;e>d;++d)b[a+2]+=c,a+=3};d.scaleZ=function(b,a,e,c){a*=3;for(var d=0;e>d;++d)b[a+2]*=c,a+=3};d.flatArrayToArrayOfArrays=function(b,a,e){var c=[];a*=3;for(var d=0;e>d;++d)c.push([b[a++],b[a++],b[a++]]);return c};d.reproject=B;d.reprojectPoint=x;d.getGeometryVertexData3D=function(b,
a,e,c,d,k){var f=d.spatialReference;b=A(b,a);a=b.vertexData;var g=a.length/3,q=new Float64Array(a.length);e.equals(f)?J(a,0,q,0,a.length):B(a,0,e,q,0,f,g);e=G(d,q,0,a,0,g,k);return f.equals(c)||B(a,0,f,a,0,c,g),{geometryData:b,vertexData:a,eleVertexData:q,terrainElevation:e.terrainElevation}};d.getGeometryVertexDataDraped=function(b,a,d){b=A(b,!1);var c=b.vertexData,e=c.length/3;return a.equals(d)||v.bufferToBuffer(c,a,0,c,d,0,e),{geometryData:b,vertexData:c}};d.computeBoundingBox=function(b,a,d,
c){c[0]=Number.MAX_VALUE;c[1]=Number.MAX_VALUE;c[2]=Number.MAX_VALUE;c[3]=-Number.MAX_VALUE;c[4]=-Number.MAX_VALUE;c[5]=-Number.MAX_VALUE;a*=3;for(var e=0;d>e;++e){var k=b[a++],f=b[a++],h=b[a++];k<c[0]&&(c[0]=k);f<c[1]&&(c[1]=f);h<c[2]&&(c[2]=h);k>c[3]&&(c[3]=k);f>c[4]&&(c[4]=f);h>c[5]&&(c[5]=h)}return c};d.pointInBox2D=K;d.boxesIntersect2D=L;d.boundingBoxClipped=function(b,a){return a?!L(b,a):!1};d.needsElevationUpdates2D=function(b){return"relative-to-ground"===b||"relative-to-scene"===b};d.needsElevationUpdates3D=
function(b){return"absolute-height"!==b};d.needsOffsetAdjustment=function(b,a,d){return M.isCalloutSupport(d)&&d.hasVisibleVerticalOffset()?!1:"relative-to-ground"!==b.mode||0!==b.offset||a.hasZ&&!b.featureExpression?"relative-to-scene"===b.mode&&0===b.offset?!0:!1:!0};var u={verticalDistanceToGround:0,terrainElevation:0}});