//>>built
define(["require","exports","./gl-matrix"],function(G,d,e){function B(a,c){if(!a)throw a=Error("dummy"),a.stack&&console.log(a.stack),new H(c);}function t(a,c,b){return c>a?c:a>b?b:a}function C(a){return a/180*Math.PI}function D(a){return 180*a/Math.PI}function I(a,c,b){e.mat4d.multiply(c,a,E);e.mat4d.inverse(E);for(a=0;8>a;++a)e.mat4d.multiplyVec4(E,Q[a],g),e.vec3d.set3(g[0]/g[3],g[1]/g[3],g[2]/g[3],b[a])}function p(a,c,b,h){e.vec3d.subtract(a,c,J);e.vec3d.subtract(b,c,K);e.vec3d.cross(K,J,h);e.vec3d.normalize(h);
h[3]=-e.vec3d.dot(h,a)}function L(a,c,b,h){var f=6378137/Math.sqrt(1-d.ECCENTRICITY_SQUARED*Math.pow(Math.sin(a),2)),e=Math.cos(a);h[0]=(f+b)*Math.cos(c)*e;h[1]=(f*(1-d.ECCENTRICITY_SQUARED)+b)*Math.sin(a);h[2]=-(f+b)*Math.sin(c)*e}function M(a){for(var c in a)return c}function N(a,c){a[12]=c[0];a[13]=c[1];a[14]=c[2]}Object.defineProperty(d,"__esModule",{value:!0});var E=e.mat4d.create(),Q=[e.vec4d.createFrom(-1,-1,-1,1),e.vec4d.createFrom(1,-1,-1,1),e.vec4d.createFrom(1,1,-1,1),e.vec4d.createFrom(-1,
1,-1,1),e.vec4d.createFrom(-1,-1,1,1),e.vec4d.createFrom(1,-1,1,1),e.vec4d.createFrom(1,1,1,1),e.vec4d.createFrom(-1,1,1,1)],g=e.vec4d.create(),R=[e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create()],J=e.vec3d.create(),K=e.vec3d.create(),O=e.vec3d.create(),r=e.vec3d.create(),l=e.vec3d.create(),k=e.vec3d.create(),w=e.vec3d.create(),x=e.vec3d.create(),F=e.vec3d.create(),P=e.vec3d.create(),y=e.vec3d.create(),q=e.vec3d.create(),
z=e.vec3d.create(),A=e.vec3d.create(),H=function(){function a(a){this.message=a}return a.prototype.toString=function(){return"AssertException: "+this.message},a}();d.AssertException=H;d.EARTH_RADIUS=6378137;d.METER2FEET=3.28084;d.ECCENTRICITY_SQUARED=.0066943799901414;d.VertexAttrConstants={POSITION:"position",NORMAL:"normal",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region"};d.assert=B;d.verify=function(a,c){a||(console.log("Verify failed: "+
c),console.log(Error("dummy").stack))};d.createQuadVertexUvBuffer=function(a){void 0===a&&(a=Float32Array);a=new a(20);return a[0]=-1,a[1]=-1,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=-1,a[7]=0,a[8]=1,a[9]=0,a[10]=-1,a[11]=1,a[12]=0,a[13]=0,a[14]=1,a[15]=1,a[16]=1,a[17]=0,a[18]=1,a[19]=1,a};d.isPowerOfTwo=function(a){return 0===(a&a-1)};d.lerp=function(a,c,b){return a+(c-a)*b};d.clamp=t;d.fallbackIfUndefined=function(a,c){return void 0===a?c:a};d.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,
(a>>8&255)/255,(255&a)/255]};d.rgb2hex=function(a){var c=t(Math.round(255*a[0]),0,255),b=t(Math.round(255*a[1]),0,255);a=t(Math.round(255*a[2]),0,255);return"0x"+((c<<16)+(b<<8)+a).toString(16)};d.dec2hex=function(a){a=a.toString(16);return"00000000".substr(0,8-a.length)+a};d.deg2rad=C;d.rad2deg=D;d.azimuthElevationAngle2Direction=function(a,c){a=1.5*Math.PI-a;c=.5*Math.PI-c;return[Math.cos(a)*Math.sin(c),Math.cos(c),Math.sin(a)*Math.sin(c)]};d.rayPlane=function(a,c,b,h){var f=e.vec3d.dot(b,c);if(0===
f)return!1;b=-(e.vec3d.dot(b,a)+b[3])/f;return e.vec3d.add(a,e.vec3d.scale(c,b,h),h),!0};d.raySphereClosestPositive=function(a,c,b,h){var f=e.vec3d.dot(c,c),d=2*e.vec3d.dot(c,a);b=e.vec3d.dot(a,a)-b*b;b=d*d-4*f*b;if(0>b)return!1;var m=Math.sqrt(b);b=(-d-m)/(2*f);f=(-d+m)/(2*f);return(0>b||b>f&&0<f)&&(b=f),0<b?(e.vec3d.add(a,e.vec3d.scale(c,b,h),h),!0):!1};d.rayTriangle3D=function(a,c,b,h,d,v,m,n,u){void 0===u&&(u=e.vec3d.create());var f=h[m]-b[v],g=h[m+1]-b[v+1],l=h[m+2]-b[v+2];h=d[n]-b[v];m=d[n+
1]-b[v+1];d=d[n+2]-b[v+2];var k=c[1]*d-m*c[2],r=c[2]*h-d*c[0],q=c[0]*m-h*c[1];n=f*k+g*r+l*q;if(-1E-5<n&&1E-5>n)return!1;n=1/n;var p=a[0]-b[v],t=a[1]-b[v+1];a=a[2]-b[v+2];if(u[1]=n*(p*k+t*r+a*q),0>u[1]||1<u[1])return!1;b=t*l-g*a;a=a*f-l*p;f=p*g-f*t;return u[2]=n*(c[0]*b+c[1]*a+c[2]*f),0>u[2]||1<u[1]+u[2]?!1:(u[0]=n*(h*b+m*a+d*f),!0)};d.rayBoxTest=function(a,c,b,h){var d,e=(b[0]-a[0])/c[0],m=(h[0]-a[0])/c[0];e>m&&(d=e,e=m,m=d);var n=(b[1]-a[1])/c[1],g=(h[1]-a[1])/c[1];if(n>g&&(d=n,n=g,g=d),e>g||n>m)return!1;
n>e&&(e=n);m>g&&(m=g);b=(b[2]-a[2])/c[2];a=(h[2]-a[2])/c[2];return b>a&&(d=b,b=a,a=d),e>a||b>m?!1:(m>a&&(m=a),0>m?!1:!0)};d.rayRay2D=function(a,c,b,d,f,g){void 0===g&&(g=e.vec2d.create());var h=(d[f]-b[f])*(c[0]-a[0])-(d[0]-b[0])*(c[f]-a[f]);if(0===h)return!1;b=((d[0]-b[0])*(a[f]-b[f])-(d[f]-b[f])*(a[0]-b[0]))/h;return g[0]=a[0]+b*(c[0]-a[0]),g[1]=a[f]+b*(c[f]-a[f]),!0};d.matrix2frustum=I;d.matrix2frustumPlanes=function(a,c,b,d){void 0===d&&(d=b,b=R);I(a,c,b);p(b[4],b[0],b[3],d[0]);p(b[1],b[5],b[6],
d[1]);p(b[4],b[5],b[1],d[2]);p(b[3],b[2],b[6],d[3]);p(b[0],b[1],b[2],d[4]);p(b[5],b[4],b[7],d[5])};d.point2plane=p;d.project=function(a,c,b,d,f){f||(f=a);g[0]=a[0];g[1]=a[1];g[2]=a[2];g[3]=1;e.mat4d.multiplyVec4(c,g);2<f.length&&(f[2]=-g[2]);e.mat4d.multiplyVec4(b,g);B(0!==g[3]);f[0]=g[0]/g[3];f[1]=g[1]/g[3];f[2]=g[2]/g[3];f[0]=(.5*f[0]+.5)*d[2]+d[0];f[1]=(.5*f[1]+.5)*d[3]+d[1]};d.geodeticToGeocentricLatidude=function(a){return Math.atan((1-d.ECCENTRICITY_SQUARED)*Math.tan(a))};d.latLon2positionWGS84Ellipsoid=
L;d.pos2latLon=function(a,c){var b=e.vec3d.length(a);c[0]=Math.asin(t(a[1]/b,-1,1));c[1]=(0>a[2]?1:-1)*Math.acos(t(a[0]/(Math.cos(c[0])*b),-1,1));c[0]=D(c[0]);c[1]=D(c[1]);c[2]=b};d.pos2latLonWGS84Ellipsoid=function(a,c){var b=a[0],e=-a[2],f=a[1],g=Math.sqrt(Math.pow(6378137,2)*(1-d.ECCENTRICITY_SQUARED));a=Math.sqrt(Math.pow(b,2)+Math.pow(e,2));var m=Math.atan2(6378137*f,g*a),b=Math.atan2(e,b),e=Math.atan2(f+Math.pow(Math.sqrt((Math.pow(6378137,2)-Math.pow(g,2))/Math.pow(g,2)),2)*g*Math.pow(Math.sin(m),
3),a-6378137*d.ECCENTRICITY_SQUARED*Math.pow(Math.cos(m),3));a=a/Math.cos(e)-6378137/Math.sqrt(1-d.ECCENTRICITY_SQUARED*Math.pow(Math.sin(e),2))+d.EARTH_RADIUS;c[0]=e;c[1]=b;c[2]=a};d.computeGlobeTransformation=function(a,c,b){var d=C(a[0]);a=C(a[1]);return L(d,a,c,O),e.mat4d.translate(b,O),e.mat4d.rotateY(b,.5*Math.PI+a),e.mat4d.rotateX(b,.5*Math.PI-d),b};d.readUInt16=function(a,c){return a[c]+(a[c+1]<<8)};d.readUInt32=function(a,c){return a[c]+(a[c+1]<<8)+(a[c+2]<<16)+(a[c+3]<<24)};d.setIfDefined=
function(a,c,b){void 0!==c[a]&&(b[a]=c[a])};d.array2object=function(a,c){var b={};if(void 0!==c)for(var d=0;d<a.length;d++){var e=a[d];b[c(e)]=e}else for(c=0;c<a.length;c++)e=a[c],b[e]=e;return b};d.object2array=function(a){var c=[],b;for(b in a)c.push(a[b]);return c};d.mergeObjects=function(a,c,b){if(void 0===b&&(b={}),b!==a)for(var d in a)b[d]=a[d];if(b!==c)for(var e in c)b[e]=c[e];return b};d.subtractObjects=function(a,c){var b={},d;for(d in a)void 0===c[d]&&(b[d]=a[d]);return b};d.intersectObjects=
function(a,c){var b={},d;for(d in a)void 0!==c[d]&&(b[d]=a[d]);return b};d.getFirstObjectKey=M;d.getFirstObjectValue=function(a){return a[M(a)]};d.objectEmpty=function(a){for(var c in a)return!1;return!0};d.arraysEqual=function(a,c){if(a.length!==c.length)return!1;for(var b=0,d=a.length;d>b;++b)if(a[b]!==c[b])return!1;return!0};d.arrayRemove=function(a,c){var b=a.indexOf(c);return-1!==b?(a[b]=a[a.length-1],a.pop(),c):null};d.byteBuffer2base64image=function(a,c,b,d,e){var f=4*c;B(a.length===f*b,"buffer length must match image resolution");
var g=document.createElement("canvas");g.width=c;g.height=b;var h=g.getContext("2d");c=h.getImageData(0,0,c,b);for(var l=c.data,k=0;b>k;++k)for(var r=k*f,p=(b-1-k)*f,q=0;f>q;++q)l[r++]=a[p++];return h.putImageData(c,0,0),g.toDataURL(d,e)};d.cround=function(a){return Math.round(100*a)/100};d.logWithBase=function(a,c){return Math.log(a)/Math.log(c)};d.setMatrixTranslation=N;d.setMatrixTranslation3=function(a,c,b,d){a[12]=c;a[13]=b;a[14]=d};d.getMatrixTranslation=function(a,c){return void 0===c&&(c=
e.vec3d.create()),c[0]=a[12],c[1]=a[13],c[2]=a[14],c};d.createTranslationMatrix=function(a,c){return a=e.mat4d.identity(a),N(a,c),a};d.fovx2fovy=function(a,c,b){return 2*Math.atan(b*Math.tan(.5*a)/c)};d.fovy2fovx=function(a,c,b){return 2*Math.atan(c*Math.tan(.5*a)/b)};d.fovx2fovd=function(a,c,b){return 2*Math.atan(Math.sqrt(c*c+b*b)*Math.tan(.5*a)/c)};d.fovy2fovd=function(a,c,b){return 2*Math.atan(Math.sqrt(c*c+b*b)*Math.tan(.5*a)/b)};d.fovd2fovx=function(a,c,b){return 2*Math.atan(c*Math.tan(.5*a)/
Math.sqrt(c*c+b*b))};d.fovd2fovy=function(a,c,b){return 2*Math.atan(b*Math.tan(.5*a)/Math.sqrt(c*c+b*b))};d.nextHighestPowerOfTwo=function(a){--a;for(var c=1;32>c;c<<=1)a|=a>>c;return a+1};d.linelineDistance3D=function(a,c,b,d){var f,g,h,n,q,p;if((r[0]=a[0]-b[0],r[1]=a[1]-b[1],r[2]=a[2]-b[2],l[0]=d[0]-b[0],l[1]=d[1]-b[1],l[2]=d[2]-b[2],1E-4>Math.abs(l[0])&&1E-4>Math.abs(l[1])&&1E-4>Math.abs(l[2]))||(k[0]=c[0]-a[0],k[1]=c[1]-a[1],k[2]=c[2]-a[2],1E-4>Math.abs(k[0])&&1E-4>Math.abs(k[1])&&1E-4>Math.abs(k[2]))||
(f=r[0]*l[0]+r[1]*l[1]+r[2]*l[2],g=l[0]*k[0]+l[1]*k[1]+l[2]*k[2],h=r[0]*k[0]+r[1]*k[1]+r[2]*k[2],n=l[0]*l[0]+l[1]*l[1]+l[2]*l[2],q=k[0]*k[0]+k[1]*k[1]+k[2]*k[2],p=q*n-g*g,1E-4>Math.abs(p)))return[!1];c=(f*g-h*n)/p;f=(f+g*c)/n;w[0]=a[0]+c*k[0];w[1]=a[1]+c*k[1];w[2]=a[2]+c*k[2];x[0]=b[0]+f*l[0];x[1]=b[1]+f*l[1];x[2]=b[2]+f*l[2];return[!0,e.vec3d.dist(w,x),w,x]};d.projectVectorVector2D=function(a,c,b){q[0]=c[0]-a[0];q[1]=c[1]-a[1];q[2]=0;z[0]=b[0]-a[0];z[1]=b[1]-a[1];z[2]=0;A[0]=b[0];A[1]=b[1];A[2]=
0;c=e.vec3d.dot(z,q);b=e.vec3d.length(q);c/=b*b;y[0]=q[0]*c;y[1]=q[1]*c;F[0]=a[0]+y[0];F[1]=a[1]+y[1];e.vec3d.subtract(A,F,P);a=e.vec3d.length(P);c=e.vec3d.length(z);b=e.vec3d.length(q);var d=e.vec3d.length(y);return(d>c||d>b)&&(a=Number.MAX_VALUE),a};G=function(){var a=window.performance||{};if(a.now)return function(){return a.now()};if(a.webkitNow)return function(){return a.webkitNow()};if(a.mozNow)return function(){return a.mozNow()};if(a.msNow)return function(){return a.msNow()};if(a.oNow)return function(){return a.oNow()};
var c;return c=a.timing&&a.timing.navigationStart?a.timing.navigationStart:Date.now(),function(){return Date.now()-c}}();d.performance={now:G}});