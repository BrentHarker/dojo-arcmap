//>>built
define("require exports ./Texture ./ModelContentType ../../../webgl/Texture ../../../webgl/enums".split(" "),function(q,r,n,l,p,t){var m=function(){function a(a){this.textTextures={};this.dirty=!1;this._glTexture=null;this.id=n.idGen.gen(a)}return a.prototype.getId=function(){return this.id},a.prototype.dispose=function(){},a.prototype.deferredLoading=function(){return!1},a.prototype.getWidth=function(){return 512},a.prototype.getHeight=function(){return 512},a.prototype.initializeThroughRender=function(a,
b){b.wrapMode=33071;b.samplingMode=9987;b.flipped=!0;b.preMultiplyAlpha=!0;b.hasMipmap=!0;var e=this._drawToCanvas();return this._glTexture=new p(a,b,e),this.dirty=!1,this._glTexture},a.prototype.redraw=function(){if(this.dirty&&this._glTexture){var a=this._drawToCanvas();this._glTexture.setData(a);this.dirty=!1}},a.prototype.setUnloadFunc=function(a){this._unloadFunc=a},a.prototype.unload=function(){null!=this._unloadFunc&&(this._unloadFunc(this.id),this._unloadFunc=null)},a.prototype._drawToCanvas=
function(){var e=a._create2Dcanvas(),b=e.getContext("2d");b.clearRect(0,0,512,512);for(var f in this.textTextures){var c=this.textTextures[f];c.textTexture.renderText(1,c.placement.width,c.placement.height,b,c.placement.atlasOffX,c.placement.atlasOffY)}return e},a._create2Dcanvas=function(){return a._textCanvas2D||(a._textCanvas2D=document.createElement("canvas"),a._textCanvas2D.setAttribute("id","canvas2d"),a._textCanvas2D.setAttribute("width",(512).toString()),a._textCanvas2D.setAttribute("height",
(512).toString()),a._textCanvas2D.setAttribute("style","display:none")),a._textCanvas2D},a}();return function(){function a(a,b){this._textureAtlasSubtextures=[];this._curLineHeight=this._curY=this._curX=0;this._idHint=a;this._stage=b}return a.prototype.dispose=function(){for(var a=0;a<this._textureAtlasSubtextures.length;a++)this._stage.remove(l.TEXTURE,this._textureAtlasSubtextures[a].getId());this._textureAtlasSubtextures=[]},a.prototype.addTextTexture=function(a){for(var b=JSON.stringify(a.getParams())+
"_"+a.getString(),f=0;f<this._textureAtlasSubtextures.length;f++){var c=this._textureAtlasSubtextures[f].textTextures[b];if(null!=c)return c.placement}var d=null;0===this._textureAtlasSubtextures.length&&(d=new m(this._idHint),this._textureAtlasSubtextures.push(d));var g,h,f=a.getTextWidth(),c=a.getTextHeight(),e=f+2,k=c+2+2;this._curLineHeight=Math.max(this._curLineHeight,k);512>this._curX+e&&512>this._curY+this._curLineHeight?(g=this._curX,h=this._curY,this._curX+=e):512>this._curY+this._curLineHeight+
k?(this._curX=0,this._curY+=this._curLineHeight,g=this._curX,h=this._curY,this._curX+=e):(d=new m(this._idHint),this._textureAtlasSubtextures.push(d),this._curX=0,this._curY=0,this._curLineHeight=k,g=this._curX,h=this._curY,this._curX+=e);null!=d&&this._stage.add(l.TEXTURE,d);d=this._textureAtlasSubtextures[this._textureAtlasSubtextures.length-1];g={uvMinMax:[g/512,1-(h+c)/512,(g+f)/512,1-h/512],atlasOffX:g,atlasOffY:h,width:f,height:c,texture:d};return d.textTextures[b]={placement:g,textTexture:a},
d.dirty=!0,g},a}()});