//>>built
define("./internal/MaterialUtil ../lib/Util ../lib/gl-matrix ../lib/RenderSlot ../lib/DefaultVertexBufferLayouts ../lib/ComponentUtils ../../../webgl/Util".split(" "),function(r,w,x,z,E,F,G){var b=x.vec3d,A=x.vec2d,B=x.mat4d,H=w.VertexAttrConstants,d=b.create(),f=b.create(),m=b.create(),t=b.create(),p=A.create(),q=A.create(),C=b.create(),D=b.create(),g=function(y,u,c,k){"string"==typeof c&&(k=c,c=void 0);r.basicMaterialConstructor(this,k);this.lineType=c||g.LINES;var a=E.Pos3,n=G.getStride(a)/4;this.canBeMerged=
this.lineType===g.LINES;this.setColor=function(e){u=e;this.notifyDirty("matChanged")};this.getColor=function(){return u};this.dispose=function(){};this.getOutputAmount=function(e){e=e/2+1;return this.lineType===g.STRIP?e*n:this.lineType===g.LINES?(2*e-2)*n:void 0};this.getVertexBufferLayout=function(){return a};this.fillInterleaved=function(e,a,b,k,c,d){b=e.vertexAttr[H.POSITION].data;if(a||this.lineType===g.LINES)for(k=b.length/3,e=0;k>e;e++){var f=3*e,h=b[f],v=b[f+1],l=b[f+2];if(a)var f=h,m=v,h=
a[0]*f+a[4]*m+a[8]*l+a[12],v=a[1]*f+a[5]*m+a[9]*l+a[13],l=a[2]*f+a[6]*m+a[10]*l+a[14];c[d++]=h;c[d++]=v;c[d++]=l;this.lineType===g.LINES&&0!==e&&e!==k-1&&(c[d++]=h,c[d++]=v,c[d++]=l)}else for(e=0;e<b.length;e++)c[d++]=b[e]};this.intersect=function(a,c,k,g,n,y,u){if(g.isSelection&&!F.isAllHidden(c.componentVisibilities,a.data.componentOffsets)){var h,e;c=a.getData().getVertexAttr("position").position.data;a=Number.MAX_VALUE;n=g.camera;y=g.point;for(var l=0;l<c.length-5;l+=3){if(d[0]=c[l],d[1]=c[l+
1],d[2]=c[l+2],B.multiplyVec3(k,d),f[0]=c[l+3],f[1]=c[l+4],f[2]=c[l+5],B.multiplyVec3(k,f),n.projectPoint(d,p),n.projectPoint(f,q),0>p[2]&&0<q[2])b.subtract(d,f,m),h=n.frustumPlanes,e=-(b.dot(h[4],d)+h[4][3]),h=e/b.dot(m,h[4]),b.scale(m,h,m),b.add(d,m,d),n.projectPoint(d,p);else if(0<p[2]&&0>q[2])b.subtract(f,d,m),h=n.frustumPlanes,e=-(b.dot(h[4],f)+h[4][3]),h=e/b.dot(m,h[4]),b.scale(m,h,m),b.add(f,m,f),n.projectPoint(f,q);else if(0>p[2]&&0>q[2])continue;h=w.projectVectorVector2D(p,q,y);a>h&&(a=h,
b.set(d,C),b.set(f,D))}k=g.p0;g=g.p1;2>a&&(a=w.linelineDistance3D(C,D,k,g),c=Number.MAX_VALUE,a[0]&&(b.subtract(a[2],k,t),a=b.length(t),b.scale(t,1/a),c=a/b.dist(k,g)),u(c,t))}};this.getGLMaterials=function(){return{color:I,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:J}};this.getAllTextureIds=function(){return[]}};g.STRIP=1;g.LINES=2;var I=function(b,d){r.basicGLMaterialConstructor(this,b);var c=d.get("simple"),k=b.getColor();this.beginSlot=function(a){return a===z.OPAQUE_MATERIAL};
this.getProgram=function(){return c};this.bind=function(a,b){a.bindProgram(c);c.setUniform4fv("color",k);a.setBlendingEnabled(1>k[3]);a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0)};this.release=function(a){1>k[3]&&a.setBlendingEnabled(!1)};this.bindView=function(a,b){r.bindView(b.origin,b.view,c)};this.bindInstance=function(a,b){c.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){a=a.gl;return b.lineType===
g.STRIP?a.LINE_STRIP:a.LINES}},J=function(b,d){r.basicGLMaterialConstructor(this,b);var c=d.get("highlight");this.beginSlot=function(b){return b===z.OPAQUE_MATERIAL};this.getProgram=function(){return c};this.bind=function(b,a){b.bindProgram(c);b.setDepthTestEnabled(!0)};this.release=function(b){};this.bindView=function(b,a){r.bindView(a.origin,a.view,c)};this.bindInstance=function(b,a){c.setUniformMatrix4fv("model",a.transformation)};this.getDrawMode=function(c){c=c.gl;return b.lineType===g.STRIP?
c.LINE_STRIP:c.LINES}};return g});