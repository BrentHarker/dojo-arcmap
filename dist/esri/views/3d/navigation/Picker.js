//>>built
define(["../../../core/declare","../support/RenderCoordsHelper","../lib/glMatrix","../webgl-engine/lib/Selector"],function(l,k,m,n){var e=m.vec3d,g=e.create(),f=e.create();return l([],{constructor:function(c,b){this.navigation=c;this.pickAlongRay=b._pickRay.bind(b);this.createPickRay=b._pickRayWithBeginPoint.bind(b);this.selector=new n(b.viewingMode)},pickPointInScreen:function(c,b){return this.pickedIntersectionPoint(this.pickInScreen(c,!1),b)},pickFreePointInScreen:function(c,b){this.createPickRay(c,
void 0,this.navigation.currentCamera.viewMatrix,g,f);b||(b=e.create());e.subtract(f,g);e.normalize(f);var a;a=this.navigation.view.dataExtent;c=Math.max(a.xmax-a.xmin,a.ymax-a.ymin,8*Math.max(a.xmax-a.xmin,a.ymax-a.ymin));var d=this.navigation.currentCamera,h=Math.max(0,a.xmin-d.eye[0],d.eye[0]-a.xmax);a=Math.max(0,a.ymin-d.eye[1],d.eye[1]-a.ymax);h=Math.sqrt(h*h+a*a);a="global"==this.navigation.view.viewingMode?k.Spherical.prototype.getAltitude(d.eye):k.Planar.prototype.getAltitude(d.eye);d=this.navigation._getTerrainElevationBelowCamera(d);
d=c/Math.max(1,Math.pow(Math.max(0,Math.log(c/(Math.abs(a-d)+Number.MIN_VALUE))),2));d=Math.max(d,Math.min(h,c));e.scale(f,d);e.add(g,f,b)},pickInScreen:function(c,b){return this.createPickRay(c,void 0,this.navigation.currentCamera.viewMatrix,g,f),b&&e.set(this.navigation.currentCamera.eye,g),this.pickAlongRay(g,f,c,c,null,null,this.selector)},pickedIntersectionPoint:function(c,b){return c?(b||(b=e.create()),c.getMinResult().getIntersectionPoint(b)):!1}})});