//>>built
define("../../../geometry/SpatialReference ../../../geometry/Point ./mathUtils ./earthUtils ../lib/glMatrix ../webgl-engine/lib/BufferVectorMath".split(" "),function(v,F,r,A,B,G){var C,m,D,t,w=B.vec3d,u=B.mat4d,H=G.Vec3Compact,d=w.create(),h=w.create(),n=w.create(),k=r.deg2rad(1),x=r.rad2deg(1),E=new v({wkt:'      GEOCCS["Spherical geocentric",        DATUM["Not specified",          SPHEROID["Sphere",'+A.earthRadius+',0]],        PRIMEM["Greenwich",0.0,          AUTHORITY["EPSG","8901"]],        UNIT["m",1.0],        AXIS["Geocentric X",OTHER],        AXIS["Geocentric Y",EAST],        AXIS["Geocentric Z",NORTH]      ]    '}),
g=A.earthRadius,p=function(a){return a===E?1:a.isWGS84?2:a.isWebMercator?3:0};v=function(a,c,b,e){b[e++]=a[c++];b[e++]=a[c++];b[e]=a[c]};var y=function(a,c,b,e){var f=.4999999*Math.PI,d=k*a[c+1],d=r.clamp(d,-f,f),f=Math.sin(d);b[e++]=k*a[c]*g;b[e++]=g/2*Math.log((1+f)/(1-f));b[e]=a[c+2]},z=function(a,c,b,e){var f=g+a[c+2],d=k*a[c+1];a=k*a[c];c=Math.cos(d);b[e++]=Math.cos(a)*c*f;b[e++]=Math.sin(a)*c*f;b[e]=Math.sin(d)*f},I=[void 0,z,v,y],q=[void 0,function(a,c,b,e){var f=H.length(a,c),d=r.asin(a[c+
2]/f);a=(0<a[c+1]?1:-1)*r.acos(a[c]/(Math.cos(d)*f));b[e++]=x*a;b[e++]=x*d;b[e]=f-g},v,function(a,c,b,e){b[e++]=x*(a[c++]/g);b[e++]=x*(Math.PI/2-2*Math.atan(Math.exp(-1*a[c++]/g)));b[e]=a[c]}];return{SphericalRenderSpatialReference:E,vectorToVector:function(a,c,b,e){return 2===a.length?(d[0]=a[0],d[1]=a[1],d[2]=0,a=d):a===b&&(w.set(a,d),a=d),this.bufferToBuffer(a,c,0,b,e,0,1)},pointToVector:function(a,c,b){d[0]=a.x;d[1]=a.y;var e=a.z;return d[2]=void 0!==e?e:0,this.bufferToBuffer(d,a.spatialReference,
0,c,b,0,1)},vectorToPoint:function(a,c,b,e){var f;return"esri.SpatialReference"===b.declaredClass?(e=b,f=new F({spatialReference:e})):(f=b,e=e||f.spatialReference),this.bufferToBuffer(a,c,0,d,e,0,1)?(f.x=d[0],f.y=d[1],f.z=d[2],f.spatialReference=e,f):null},xyzToVector:function(a,c,b,e,f,l){return d[0]=a,d[1]=c,d[2]=b,this.bufferToBuffer(d,e,0,f,l,0,1)},bufferToBuffer:function(a,c,b,e,f,d,g){g=g||1;C!==c&&(m=p(c),C=c);D!==f&&(t=p(f),D=f);g=b+3*g;if(m!==t||0===m&&!c.equals(f)){if(!(0<m&&0<t))return!1;
if(2!==t){var l=I[t];if(2!==m)for(f=q[m];g>b;b+=3,d+=3)f(a,b,h,0,c.wkid),l(h,0,e,d);else for(;g>b;b+=3,d+=3)l(a,b,e,d)}else for(f=q[m];g>b;b+=3,d+=3)f(a,b,e,d,c.wkid)}else if(e!==a||b!==d)for(;g>b;b++,d++)e[d]=a[b];return!0},computeLinearTransformation:function(a,c,b,e){var d=p(a),g=p(e);if(d===g&&(0!==d||a.equals(e)))return u.identity(b),u.translate(b,c),!0;if(1===g){if(e=q[d])return e(c,0,h,0,a.wkid),z(h,0,n,0),e=k*h[0],c=k*h[1],a=Math.sin(e),e=Math.cos(e),d=Math.sin(c),c=Math.cos(c),b[0]=-a,b[4]=
-d*e,b[8]=c*e,b[12]=n[0],b[1]=e,b[5]=-d*a,b[9]=c*a,b[13]=n[1],b[2]=0,b[6]=c,b[10]=d,b[14]=n[2],b[3]=0,b[7]=0,b[11]=0,b[15]=1,!0}else if(3===g&&(2===d||1===d))return q[d](c,0,h,0,a.wkid),a=k*h[1],y(h,0,n,0),u.identity(b),u.translate(b,n),a=1/Math.cos(a),u.scale(b,[a,a,1]),!0;return!1},mbsToMbs:function(a,c,b,d){var e=p(c),l=p(d);if(e===l&&(0!==e||c.equals(d)))return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],!0;if(1===l){if(d=q[e])return d(a,0,h,0,c.wkid),z(h,0,b,0),b[3]=a[3],!0}else if(3===l&&(2===e||
1===e))return q[e](a,0,h,0,c.wkid),c=k*h[1],(c=Math.abs(c)+Math.asin(a[3]/(g+a[2])),y(h,0,b,0),c>.9999*Math.PI)?b[3]=Number.MAX_VALUE:b[3]=1/Math.cos(c)*a[3],!0;return!1},extentToBoundingBox:function(a,c,b){if(null==a)return!1;var e=!0;return d[0]=null!=a.xmin?a.xmin:0,d[1]=null!=a.ymin?a.ymin:0,d[2]=null!=a.zmin?a.zmin:0,e=e&&this.bufferToBuffer(d,a.spatialReference,0,c,b,0,1),d[0]=null!=a.xmax?a.xmax:0,d[1]=null!=a.ymax?a.ymax:0,d[2]=null!=a.zmax?a.zmax:0,e=e&&this.bufferToBuffer(d,a.spatialReference,
0,c,b,3,1),null==a.xmin&&(c[0]=-(1/0)),null==a.ymin&&(c[1]=-(1/0)),null==a.zmin&&(c[2]=-(1/0)),null==a.xmax&&(c[3]=1/0),null==a.ymax&&(c[4]=1/0),null==a.zmax&&(c[5]=1/0),e},extentToBoundingRect:function(a,c,b){if(null==a)return!1;var e=!0;return d[0]=null!=a.xmin?a.xmin:0,d[1]=null!=a.ymin?a.ymin:0,d[2]=null!=a.zmin?a.zmin:0,e=e&&this.bufferToBuffer(d,a.spatialReference,0,d,b,0,1),c[0]=d[0],c[1]=d[1],d[0]=null!=a.xmax?a.xmax:0,d[1]=null!=a.ymax?a.ymax:0,d[2]=null!=a.zmax?a.zmax:0,e=e&&this.bufferToBuffer(d,
a.spatialReference,0,d,b,0,1),c[2]=d[0],c[3]=d[1],null==a.xmin&&(c[0]=-(1/0)),null==a.ymin&&(c[1]=-(1/0)),null==a.xmax&&(c[2]=1/0),null==a.ymax&&(c[3]=1/0),e},webMercator:{x2lon:function(a){return a/g},y2lat:function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/g))},lon2x:function(a){return a*g},lat2y:function(a){a=Math.sin(a);return g/2*Math.log((1+a)/(1-a))}}}});