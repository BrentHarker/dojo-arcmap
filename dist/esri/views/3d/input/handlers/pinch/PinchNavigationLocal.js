//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/glMatrix ../../util ./PinchNavigationBase ./MomentumNavigationLocal".split(" "),function(n,g,r,a,p,t,u){Object.defineProperty(g,"__esModule",{value:!0});var l;!function(a){a[a.Horizontal=0]="Horizontal";a[a.Vertical=1]="Vertical"}(l=g.PanMode||(g.PanMode={}));var v=20/180*Math.PI,q=a.vec3d.createFrom(0,0,1);n=function(g){function m(c,e){var b=g.call(this,c,e)||this;return b.view=c,b._rotation={valueSmooth:new p.ExponentialFalloff(.05)},
b._scaling={valueSmooth:new p.ExponentialFalloff(.05)},b._planeHorizontal={normal:a.vec3d.create(),distance:0},b._planeVertical={normal:a.vec3d.create(),distance:0},b._beginCenterHorizontal=a.vec3d.create(),b._beginCenterVertical=a.vec3d.create(),b._tmpPoints=[],b._tmpPickPointScreen=a.vec2.create(),b._tmpPickPointScene=a.vec3d.create(),b._tmpBwd=a.vec3d.create(),b._tmpUp=a.vec3d.create(),b._tmpD=a.vec3d.create(),b._tmpC3=a.vec3d.create(),b._tmpC2=a.vec2.create(),b._momentumNavigation=new u.MomentumNavigationLocal(b,
e),b}return r(m,g),Object.defineProperty(m.prototype,"momentum",{get:function(){return this._momentumNavigation},enumerable:!0,configurable:!0}),m.prototype.onNavigationBegin=function(c){var e=this._helper,b=this._tmpPickPointScreen,h=this._tmpPickPointScene;this._rotation.valueSmooth.reset();this._scaling.valueSmooth.reset();a.vec2.set2(c.data.currentState.center.x,this.view.height-c.data.currentState.center.y,b);this._planeHorizontal.distance=0;a.vec3d.set(q,this._planeHorizontal.normal);e.picker.pickPointInScreen(b,
h)||e.picker.pickFreePointInScreen(b,h);b=this._tmpBwd;a.vec3d.negate(this.beginCamera.viewForward,b);var d=this._tmpUp;a.vec3d.set(q,d);var k=a.vec3d.dot(b,d);this._mode=Math.asin(0>k?-k:k)>=v?l.Horizontal:l.Vertical;this._planeHorizontal.distance=a.vec3d.dot(this._planeHorizontal.normal,h);0>a.vec3d.dot(this._planeHorizontal.normal,this.beginCamera.eye)-this._planeHorizontal.distance&&(a.vec3d.negate(this._planeHorizontal.normal),this._planeHorizontal.distance*=-1);this._mode===l.Vertical&&(a.vec3d.scale(d,
k),a.vec3d.subtract(b,d,this._planeVertical.normal),a.vec3d.normalize(this._planeVertical.normal),this._planeVertical.distance=a.vec3d.dot(this._planeVertical.normal,h),this.computePlanePoints(c,"currentEvent",this._planeVertical,this.beginCamera,this._tmpPoints),e.planar.computePointCenter(this._tmpPoints,this._beginCenterVertical));this.computePlanePoints(c,"currentEvent",this._planeHorizontal,this.beginCamera,this._tmpPoints);e.planar.computePointCenter(this._tmpPoints,this._beginCenterHorizontal)},
m.prototype.onNavigationUpdate=function(c,e){var b=this._helper,h=1<c.data.pointers.length,d=this._mode===l.Horizontal?this._planeHorizontal:this._planeVertical,k=this._mode===l.Horizontal?this._beginCenterHorizontal:this._beginCenterVertical;if(h){var g=c.data.startState.radius/c.data.currentState.radius,f=.001875*Math.min(Math.max(c.data.currentState.radius,40),120);this._scaling.valueSmooth.gain=f;this._scaling.valueSmooth.update(g);b.planar.applyZoom(d,this.view,e,k,this._scaling.valueSmooth.value);
this.momentum.addScaleValue(c.timestamp,this._scaling.valueSmooth.value,d,k)}f=this._tmpC3;this.computePlanePoints(c,"currentEvent",d,e,this._tmpPoints);b.planar.computePointCenter(this._tmpPoints,f);d=this._tmpD;a.vec3d.subtract(f,k,d);a.vec3d.subtract(e.eye,d);a.vec3d.subtract(e.center,d);e.markViewDirty();g=this._tmpC2;if(a.vec2.set2(c.data.currentState.center.x,c.data.currentState.center.y,g),this.momentum.addPanValue(c.timestamp,g,f,d),h)h=this._planeHorizontal.normal,a.vec3d.set(this._planeHorizontal.normal,
h),d=c.data.currentState.angle,f=this._rotation.valueSmooth.value,d=b.normalizeRotationDelta(d-f),d=f+d,f=.00125*Math.min(Math.max(c.data.currentState.radius,40),120),this._rotation.valueSmooth.gain=f,this._rotation.valueSmooth.update(d),f=this._rotation.valueSmooth.value,this.momentum.addRotationValue(c.timestamp,k,h,f),b.applyRotation(e,k,h,f)},m.prototype.onNavigationEnd=function(a){},m}(t.PinchNavigationBase);g.PinchNavigationLocal=n});