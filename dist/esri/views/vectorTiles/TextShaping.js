//>>built
define(["require","exports","./Placement"],function(u,v,t){return function(){function p(a,d,f,c,k,n,b,h){this._glyphItems=a;this._maxWidth=d;this._lineHeight=f;this._letterSpacing=c;this._offset=k;this._hAnchor=n;this._vAnchor=b;this._justify=h}return p.prototype.getShaping=function(a,d){for(var f=this._glyphItems,c=this._letterSpacing,k=this._offset[0],n=this._offset[1],b=[],h=a.length,e=0;h>e;e++){var q=a.charCodeAt(e),g=f[q];g&&(b.push(new t.ShapedGlyph(q,k,n)),k+=g.metrics.advance+c)}if(0<b.length){q=
this._maxWidth;a=this._lineHeight;c=this._justify;k=b.length;h=n=f=0;if(0!==q)for(var p=g=0,e=0;k>e;e++){var l=b[e];if(l.x-=p,d?l.y-=a*f:l.y+=a*f,l.x>q&&0<g){for(var r=b[g+1].x,h=Math.max(r,h),m=g+1;e>=m;m++)d?b[m].y-=a:b[m].y+=a,b[m].x-=r;c&&this._applyJustification(b,n,g-1);n=g+1;g=0;p+=r;f++}32===l.glyph&&(g=e)}e=b[k-1];h=Math.max(h,e.x+this._glyphItems[e.glyph].metrics.advance);c&&this._applyJustification(b,n,k-1);e=(c-this._hAnchor)*h;c=(-this._vAnchor*(f+1)+.5)*a;d&&f&&(c+=f*a);for(d=0;d<b.length;d++)a=
b[d],a.x+=e,a.y+=c}return b},p.prototype._applyJustification=function(a,d,f){for(var c=a[f],c=(c.x+this._glyphItems[c.glyph].metrics.advance)*this._justify;f>=d;d++)a[d].x-=c},p}()});