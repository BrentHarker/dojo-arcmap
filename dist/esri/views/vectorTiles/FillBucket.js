//>>built
define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ./Bucket ./Geometry ../../core/libs/earcut/earcut".split(" "),function(C,D,z,E,A,x,B){return function(y){function k(a,d,b,c,f,l){a=y.call(this,a,d)||this;return a.polygonVertexBuffer=b,a.polygonIndexBuffer=c,a.polygonOutlineVertexBuffer=f,a.polygonOutlineIndexBuffer=l,a}return z(k,y),Object.defineProperty(k.prototype,"polygonIndexStart",{get:function(){return this._triangleElementsStart},enumerable:!0,configurable:!0}),
Object.defineProperty(k.prototype,"polygonIndexCount",{get:function(){return this._triangleElementsNum},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"polygonOutlineIndexStart",{get:function(){return this._outlineElementsStart},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"polygonOutlineIndexCount",{get:function(){return this._outlineElementsNum},enumerable:!0,configurable:!0}),k.prototype.assignBufferInfo=function(a){a._triangleElementsStart=this._triangleElementsStart;
a._triangleElementsNum=this._triangleElementsNum;a.layer.hasPaintProperty("fill-outline-color")?(a._outlineElementsStart=this._outlineElementsStart,a._outlineElementsNum=this._outlineElementsNum):(a._outlineElementsStart=0,a._outlineElementsNum=0)},k.prototype.processFeatures=function(a,d){this._triangleElementsStart=this.polygonIndexBuffer.index;this._triangleElementsNum=0;this._outlineElementsStart=this.polygonOutlineIndexBuffer.index;this._outlineElementsNum=0;a&&a.setExtent(this.layerExtent);
d=this.layer.getPaintValue("fill-pattern",this.zoom);d=this.layer.getPaintValue("fill-antialias",this.zoom)&&void 0===d;for(var b=0,c=this._features;b<c.length;b++){var f=c[b].getGeometry(a);this._processFeature(f,d)}},k.prototype._processFeature=function(a,d){if(a){var b=a.length;if(d)for(d=0;b>d;d++)this._processOutline(a[d]);var c;for(d=0;b>d;d++){var f=k._area(a[d]);128<f?(void 0!==c&&this._processFill(a,c),c=[d]):-128>f&&void 0!==c&&c.push(d)}void 0!==c&&this._processFill(a,c)}},k.prototype._processOutline=
function(a){var d,b,c,f=this.polygonOutlineVertexBuffer,l=this.polygonOutlineIndexBuffer,k=l.index,m=new x.Point(0,0),p=new x.Point(0,0),n=new x.Point(0,0),h=-1,e=-1,g=-1,t=-1,v=-1,q=a.length;if(!(2>q)){for(var u=a[0],w=a[q-1];q&&w.isEqual(u);)--q,w=a[q-1];if(!(2>q-0)){for(u=0;q>u;++u){0===u?(d=a[q-1],b=a[0],c=a[1],m.assignSub(b,d),m.normalize(),m.rightPerpendicular()):(d=b,b=c,c=u!==q-1?a[u+1]:a[0],m.assign(p));p.assignSub(c,b);p.normalize();p.rightPerpendicular();w=m.x*p.y-m.y*p.x;n.assignAdd(m,
p);n.normalize();var r=-n.x*-m.x+-n.y*-m.y,r=Math.abs(0!==r?1/r:1);8<r&&(r=8);0<=w?(g=f.add(b.x,b.y,m.x,m.y,0,1),-1===t&&(t=g),0<=h&&0<=e&&0<=g&&l.add(h,e,g),e=f.add(b.x,b.y,r*-n.x,r*-n.y,0,-1),-1===v&&(v=e),0<=h&&0<=e&&0<=g&&l.add(h,e,g),h=e,e=g,g=f.add(b.x,b.y,n.x,n.y,0,1),0<=h&&0<=e&&0<=g&&l.add(h,e,g),e=f.add(b.x,b.y,p.x,p.y,0,1),0<=h&&0<=e&&0<=g&&l.add(h,e,g)):(g=f.add(b.x,b.y,r*n.x,r*n.y,0,1),-1===t&&(t=g),0<=h&&0<=e&&0<=g&&l.add(h,e,g),e=f.add(b.x,b.y,-m.x,-m.y,0,-1),-1===v&&(v=e),0<=h&&0<=
e&&0<=g&&l.add(h,e,g),h=e,e=g,g=f.add(b.x,b.y,-n.x,-n.y,0,-1),0<=h&&0<=e&&0<=g&&l.add(h,e,g),h=f.add(b.x,b.y,-p.x,-p.y,0,-1),0<=h&&0<=e&&0<=g&&l.add(h,e,g))}0<=h&&0<=e&&0<=t&&l.add(h,e,t);0<=h&&0<=t&&0<=v&&l.add(h,v,t);this._outlineElementsNum+=3*(l.index-k)}}},k.prototype._processFill=function(a,d){var b;1<d.length&&(b=[]);for(var c=0,f=0;f<d.length;f++){var l=d[f];0!==c&&b.push(c);c+=a[l].length}for(var c=2*c,f=new Float64Array(c),k=0,m=0;m<d.length;m++)for(var l=d[m],l=a[l],p=l.length,n=0;p>n;++n)f[k++]=
l[n].x,f[k++]=l[n].y;a=B(f,b,2);d=a.length;if(0<d){b=this.polygonVertexBuffer.index;for(k=0;c>k;)this.polygonVertexBuffer.add(f[k++],f[k++]);for(c=0;d>c;)this.polygonIndexBuffer.add(b+a[c++],b+a[c++],b+a[c++]);this._triangleElementsNum+=d}},k._area=function(a){for(var d=0,b=a.length-1,c=0;b>c;c++)d+=(a[c].x-a[c+1].x)*(a[c].y+a[c+1].y);return d+=(a[b].x-a[0].x)*(a[b].y+a[0].y),.5*d},k}(A)});