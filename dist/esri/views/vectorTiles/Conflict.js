//>>built
define(["require","exports","./Geometry","./GeometryUtils"],function(n,p,t,r){Object.defineProperty(p,"__esModule",{value:!0});n=function(){function c(a,b,h,d){this.left=a;this.top=b;this.right=h;this.bottom=d}return c.prototype.clone=function(){return new c(this.left,this.top,this.right,this.bottom)},c.prototype.move=function(a,b){this.left+=a;this.top+=b;this.right+=a;this.bottom+=b},c.prototype.rotate=function(a,b){var h=this.left,d=this.right,e=this.top,f=this.bottom,g=h*a-e*b,q=h*b+e*a,c=d*a-
e*b,e=d*b+e*a,l=h*a-f*b,h=h*b+f*a,m=d*a-f*b;a=d*b+f*a;this.left=Math.min(g,c,l,m);this.top=Math.min(q,e,h,a);this.right=Math.max(g,c,l,m);this.bottom=Math.max(q,e,h,a)},c.overlaps=function(a,b){return a.right>b.left&&a.left<b.right&&a.bottom>b.top&&a.top<b.bottom},c}();p.Box=n;var u=function(){function c(a,b,h,d){this.anchor=a;this.corners=b;this.minzoom=h;this.maxzoom=d}return c.prototype.left=function(){return this.corners[0].x},c.prototype.right=function(){return this.corners[2].x},c.prototype.top=
function(){return this.corners[1].y},c.prototype.bottom=function(){return this.corners[3].y},c}();p.Obstacle=u;n=function(){function c(a,b,h){this.obstacles=[];this.mapAngle=a;this.padding=b;this.isScreenAligned=h;this.minzoom=v}return c.prototype.addBox=function(a,b,h,d,e,f){var g=b.left*h-this.padding,c=b.top*h-this.padding,k=b.right*h+this.padding;b=b.bottom*h+this.padding;g=[new t.Point(g,c),new t.Point(k,c),new t.Point(k,b),new t.Point(g,b)];0!==this.mapAngle&&(c=Math.cos(this.mapAngle),k=Math.sin(this.mapAngle),
a=a.clone(),a.rotate(c,k));if(this.isScreenAligned||(d+=this.mapAngle),0!==d){c=Math.cos(d);k=Math.sin(d);g[0].rotate(c,k);g[1].rotate(c,k);g[2].rotate(c,k);g[3].rotate(c,k);d=0;for(c=1;4>c;c++)g[c].x<g[d].x?d=c:g[c].x===g[d].x&&g[c].y<g[d].y&&(d=c);if(d){k=[];for(c=0;4>c;c++)k.push(g[(c+d)%4]);g=k}}this.obstacles.push(new u(a,g,e,f))},c}();p.Footprint=n;var v=.5;n=function(){function c(){this._grid=[]}return c.prototype.setAngle=function(a){this._angle=a;this._c=Math.cos(a);this._s=Math.sin(a)},
c.prototype.reset=function(){this._angle=this._s=0;this._c=1;this._grid=[]},c.prototype.add=function(a){var b=this._grid,h=0;for(a=a.obstacles;h<a.length;h++)for(var d=a[h],e=d.anchor,f=c._gridClamp(Math.min(d.left()+e.x,e.x)),g=c._gridClamp(Math.max(d.right()+e.x,e.x)),q=c._gridClamp(Math.min(d.top()+e.y,e.y)),e=c._gridClamp(Math.max(d.bottom()+e.y,e.y));e>=q;q++)for(var k=f;g>=k;k++){var l=b[16*q+k];l||(l=b[16*q+k]=[]);l.push(d)}},c.prototype.getMinZoom=function(a,b,h,d){if(0===a.obstacles.length)return r.C_INFINITY;
h=this._grid;d=0;for(a=a.obstacles;d<a.length;d++)for(var e=a[d],f=e.anchor,g=c._gridClamp(Math.min(e.left()+f.x,f.x)),q=c._gridClamp(Math.max(e.right()+f.x,f.x)),k=c._gridClamp(Math.min(e.top()+f.y,f.y)),f=c._gridClamp(Math.max(e.bottom()+f.y,f.y));f>=k;k++)for(var l=g;q>=l;l++){var m=h[16*k+l];if(m)for(var n=0;n<m.length;n++){var p=m[n];if(!(e.minzoom>=p.maxzoom||p.minzoom>=e.maxzoom)&&(b=c._calcPlacementZoom(e,p,b),2<=b))return r.C_INFINITY}}return 2>b?b:r.C_INFINITY},c._gridClamp=function(a){return r.clamp(a>>
9,-7,8)},c._calcPlacementZoom=function(a,b,h){var d=b.anchor.x-a.anchor.x;if(0===d&&(a.right()<b.left()||b.right()<a.left()))return h;var e=b.anchor.y-a.anchor.y;if(0===e&&(a.bottom()<b.top()||b.bottom()<a.top()))return h;var f=r.C_INFINITY;if(0!==d){var g=(0<d?a.right()-b.left():a.left()-b.right())/d;f>g&&(f=g);d=0<d?c._calcExtZoomX(a,b,g):c._calcExtZoomX(b,a,g);f>d&&(f=d)}0!==e&&(d=(0<e?a.bottom()-b.top():a.top()-b.bottom())/e,f>d&&(f=d),e=0<e?c._calcExtZoomY(a,b,d):c._calcExtZoomY(b,a,d),f>e&&
(f=e));return f<a.minzoom||f<b.minzoom?h:(f=Math.min(f,a.maxzoom,b.maxzoom),h>f&&(f=h),f)},c._calcExtZoomX=function(a,b,c){var d,e,f,g;if(b.anchor.y+b.corners[0].y/c>a.anchor.y+a.corners[2].y/c){var h=a.corners[2].x-a.corners[3].x,k=a.corners[2].y-a.corners[3].y,l=b.corners[1].x-b.corners[0].x,m=b.corners[1].y-b.corners[0].y;0<=h*m-k*l?a.anchor.y+a.corners[3].y/c<b.anchor.y+b.corners[0].y/c?(d=a.corners[3],e=b.corners[0],f=b.corners[1],g=1):(d=b.corners[0],e=a.corners[3],f=a.corners[2],g=-1):a.anchor.y+
a.corners[2].y/c>b.anchor.y+b.corners[1].y/c?(d=a.corners[2],e=b.corners[0],f=b.corners[1],g=1):(d=b.corners[1],e=a.corners[3],f=a.corners[2],g=-1)}else h=a.corners[2].x-a.corners[1].x,k=a.corners[2].y-a.corners[1].y,l=b.corners[3].x-b.corners[0].x,m=b.corners[3].y-b.corners[0].y,0>h*m-k*l?a.anchor.y+a.corners[1].y/c>b.anchor.y+b.corners[0].y/c?(d=a.corners[1],e=b.corners[0],f=b.corners[3],g=1):(d=b.corners[0],e=a.corners[1],f=a.corners[2],g=-1):a.anchor.y+a.corners[2].y/c<b.anchor.y+b.corners[3].y/
c?(d=a.corners[2],e=b.corners[0],f=b.corners[3],g=1):(d=b.corners[3],e=a.corners[1],f=a.corners[2],g=-1);c=f.x-e.x;f=f.y-e.y;return g*((d.y-e.y)*c-(d.x-e.x)*f)/((a.anchor.x-b.anchor.x)*f-(a.anchor.y-b.anchor.y)*c)},c._calcExtZoomY=function(a,b,c){var d,e,f,g;if(b.anchor.x+b.corners[1].x/c>a.anchor.x+a.corners[3].x/c){var h=a.corners[3].x-a.corners[2].x,k=a.corners[3].y-a.corners[2].y,l=b.corners[0].x-b.corners[1].x,m=b.corners[0].y-b.corners[1].y;0>h*m-k*l?a.anchor.x+a.corners[2].x/c<b.anchor.x+b.corners[1].x/
c?(d=a.corners[2],e=b.corners[1],f=b.corners[0],g=1):(d=b.corners[1],e=a.corners[2],f=a.corners[3],g=-1):a.anchor.x+a.corners[3].x/c>b.anchor.x+b.corners[0].x/c?(d=a.corners[3],e=b.corners[1],f=b.corners[0],g=1):(d=b.corners[0],e=a.corners[2],f=a.corners[3],g=-1)}else h=a.corners[3].x-a.corners[0].x,k=a.corners[3].y-a.corners[0].y,l=b.corners[2].x-b.corners[1].x,m=b.corners[2].y-b.corners[1].y,0<h*m-k*l?a.anchor.x+a.corners[0].x/c>b.anchor.x+b.corners[1].x/c?(d=a.corners[0],e=b.corners[1],f=b.corners[2],
g=1):(d=b.corners[1],e=a.corners[0],f=a.corners[3],g=-1):a.anchor.x+a.corners[3].x/c<b.anchor.x+b.corners[2].x/c?(d=a.corners[3],e=b.corners[1],f=b.corners[2],g=1):(d=b.corners[2],e=a.corners[0],f=a.corners[3],g=-1);c=f.x-e.x;f=f.y-e.y;return g*((d.y-e.y)*c-(d.x-e.x)*f)/((a.anchor.x-b.anchor.x)*f-(a.anchor.y-b.anchor.y)*c)},c}();p.ConflictEngine=n});